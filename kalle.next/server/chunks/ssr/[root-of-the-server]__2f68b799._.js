module.exports=[47349,(a,b,c)=>{"use strict";var d=a.r(72131);d.useState,d.useEffect,d.useLayoutEffect,d.useDebugValue;var e=function(a,b){return b()};c.useSyncExternalStore=void 0!==d.useSyncExternalStore?d.useSyncExternalStore:e},87610,(a,b,c)=>{"use strict";b.exports=a.r(47349)},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},57982,(a,b,c)=>{"use strict";var d,e,f;Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=c.Propagate=c.LogVerbosity=c.Status=void 0,function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(d||(c.Status=d={})),function(a){a[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.ERROR=2]="ERROR",a[a.NONE=3]="NONE"}(e||(c.LogVerbosity=e={})),function(a){a[a.DEADLINE=1]="DEADLINE",a[a.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",a[a.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",a[a.CANCELLATION=8]="CANCELLATION",a[a.DEFAULTS=65535]="DEFAULTS"}(f||(c.Propagate=f={})),c.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,c.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},5365,(a,b,c)=>{b.exports=a.x("process",()=>require("process"))},17887,a=>{a.v({name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]})},11717,(a,b,c)=>{"use strict";var d,e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c.isTracerEnabled=c.trace=c.log=c.setLoggerVerbosity=c.setLogger=c.getLogger=void 0;let h=a.r(57982),i=a.r(5365),j=a.r(17887).version,k={error:(a,...b)=>{console.error("E "+a,...b)},info:(a,...b)=>{console.error("I "+a,...b)},debug:(a,...b)=>{console.error("D "+a,...b)}},l=h.LogVerbosity.ERROR;switch((null!=(e=null!=(d=process.env.GRPC_NODE_VERBOSITY)?d:process.env.GRPC_VERBOSITY)?e:"").toUpperCase()){case"DEBUG":l=h.LogVerbosity.DEBUG;break;case"INFO":l=h.LogVerbosity.INFO;break;case"ERROR":l=h.LogVerbosity.ERROR;break;case"NONE":l=h.LogVerbosity.NONE}c.getLogger=()=>k,c.setLogger=a=>{k=a},c.setLoggerVerbosity=a=>{l=a},c.log=(a,...b)=>{let c;if(a>=l){switch(a){case h.LogVerbosity.DEBUG:c=k.debug;break;case h.LogVerbosity.INFO:c=k.info;break;case h.LogVerbosity.ERROR:c=k.error}c||(c=k.error),c&&c.bind(k)(...b)}};let m=null!=(g=null!=(f=process.env.GRPC_NODE_TRACE)?f:process.env.GRPC_TRACE)?g:"",n=new Set,o=new Set;for(let a of m.split(","))a.startsWith("-")?o.add(a.substring(1)):n.add(a);let p=n.has("all");function q(a,b,d){r(b)&&(0,c.log)(a,new Date().toISOString()+" | v"+j+" "+i.pid+" | "+b+" | "+d)}function r(a){return!o.has(a)&&(p||n.has(a))}c.trace=q,c.isTracerEnabled=r},21015,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getErrorCode=c.getErrorMessage=void 0,c.getErrorMessage=function(a){return a instanceof Error?a.message:String(a)},c.getErrorCode=function(a){return"object"==typeof a&&null!==a&&"code"in a&&"number"==typeof a.code?a.code:null}},57904,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;let d=a.r(11717),e=a.r(57982),f=a.r(21015),g=/^[0-9a-z_.-]+$/,h=/^[ -~]*$/;function i(a){return g.test(a)}function j(a){return h.test(a)}function k(a){return a.endsWith("-bin")}function l(a){return!a.startsWith("grpc-")}function m(a){return a.toLowerCase()}function n(a,b){if(!i(a))throw Error('Metadata key "'+a+'" contains illegal characters');if(null!=b)if(k(a)){if(!Buffer.isBuffer(b))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(b))throw Error("keys that don't end with '-bin' must have String values");if(!j(b))throw Error('Metadata string value "'+b+'" contains illegal characters')}}class o{constructor(a={}){this.internalRepr=new Map,this.options=a}set(a,b){n(a=m(a),b),this.internalRepr.set(a,[b])}add(a,b){n(a=m(a),b);let c=this.internalRepr.get(a);void 0===c?this.internalRepr.set(a,[b]):c.push(b)}remove(a){a=m(a),this.internalRepr.delete(a)}get(a){return a=m(a),this.internalRepr.get(a)||[]}getMap(){let a={};for(let[b,c]of this.internalRepr)if(c.length>0){let d=c[0];a[b]=Buffer.isBuffer(d)?Buffer.from(d):d}return a}clone(){let a=new o(this.options),b=a.internalRepr;for(let[a,c]of this.internalRepr){let d=c.map(a=>Buffer.isBuffer(a)?Buffer.from(a):a);b.set(a,d)}return a}merge(a){for(let[b,c]of a.internalRepr){let a=(this.internalRepr.get(b)||[]).concat(c);this.internalRepr.set(b,a)}}setOptions(a){this.options=a}getOptions(){return this.options}toHttp2Headers(){let a={};for(let[b,c]of this.internalRepr)a[b]=c.map(p);return a}toJSON(){let a={};for(let[b,c]of this.internalRepr)a[b]=c;return a}static fromHttp2Headers(a){let b=new o;for(let c of Object.keys(a)){if(":"===c.charAt(0))continue;let g=a[c];try{k(c)?Array.isArray(g)?g.forEach(a=>{b.add(c,Buffer.from(a,"base64"))}):void 0!==g&&(l(c)?g.split(",").forEach(a=>{b.add(c,Buffer.from(a.trim(),"base64"))}):b.add(c,Buffer.from(g,"base64"))):Array.isArray(g)?g.forEach(a=>{b.add(c,a)}):void 0!==g&&b.add(c,g)}catch(b){let a=`Failed to add metadata entry ${c}: ${g}. ${(0,f.getErrorMessage)(b)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,d.log)(e.LogVerbosity.ERROR,a)}}return b}}c.Metadata=o;let p=a=>Buffer.isBuffer(a)?a.toString("base64"):a},20574,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CallCredentials=void 0;let d=a.r(57904);function e(a){return"getRequestHeaders"in a&&"function"==typeof a.getRequestHeaders}class f{static createFromMetadataGenerator(a){return new h(a)}static createFromGoogleCredential(a){return f.createFromMetadataGenerator((b,c)=>{let f;(f=e(a)?a.getRequestHeaders(b.service_url):new Promise((c,d)=>{a.getRequestMetadata(b.service_url,(a,b)=>{a?d(a):b?c(b):d(Error("Headers not set by metadata plugin"))})})).then(a=>{let b=new d.Metadata;for(let c of Object.keys(a))b.add(c,a[c]);c(null,b)},a=>{c(a)})})}static createEmpty(){return new i}}c.CallCredentials=f;class g extends f{constructor(a){super(),this.creds=a}async generateMetadata(a){let b=new d.Metadata;for(let c of(await Promise.all(this.creds.map(b=>b.generateMetadata(a)))))b.merge(c);return b}compose(a){return new g(this.creds.concat([a]))}_equals(a){return this===a||a instanceof g&&this.creds.every((b,c)=>b._equals(a.creds[c]))}}class h extends f{constructor(a){super(),this.metadataGenerator=a}generateMetadata(a){return new Promise((b,c)=>{this.metadataGenerator(a,(a,d)=>{void 0!==d?b(d):c(a)})})}compose(a){return new g([this,a])}_equals(a){return this===a||a instanceof h&&this.metadataGenerator===a.metadataGenerator}}class i extends f{generateMetadata(a){return Promise.resolve(new d.Metadata)}compose(a){return a}_equals(a){return a instanceof i}}},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},49229,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getDefaultRootsData=c.CIPHER_SUITES=void 0;let d=a.r(22734);c.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let e=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,f=null;c.getDefaultRootsData=function(){return e?(null===f&&(f=d.readFileSync(e)),f):null}},61591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelCredentials=void 0;let d=a.r(55004),e=a.r(20574),f=a.r(49229);function g(a,b){if(a&&!(a instanceof Buffer))throw TypeError(`${b}, if provided, must be a Buffer.`)}class h{constructor(a){this.callCredentials=a||e.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(a,b,c,e){var h;if(g(a,"Root certificate"),g(b,"Private key"),g(c,"Certificate chain"),b&&!c)throw Error("Private key must be given with accompanying certificate chain");if(!b&&c)throw Error("Certificate chain must be given with accompanying private key");return new j((0,d.createSecureContext)({ca:null!=(h=null!=a?a:(0,f.getDefaultRootsData)())?h:void 0,key:null!=b?b:void 0,cert:null!=c?c:void 0,ciphers:f.CIPHER_SUITES}),null!=e?e:{})}static createFromSecureContext(a,b){return new j(a,null!=b?b:{})}static createInsecure(){return new i}}c.ChannelCredentials=h;class i extends h{constructor(a){super(a)}compose(a){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(a){return a instanceof i}}class j extends h{constructor(a,b){super(),this.secureContext=a,this.verifyOptions=b,this.connectionOptions={secureContext:a},(null==b?void 0:b.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=b.checkServerIdentity)}compose(a){return new k(this,this.callCredentials.compose(a))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(a){return this===a||a instanceof j&&this.secureContext===a.secureContext&&this.verifyOptions.checkServerIdentity===a.verifyOptions.checkServerIdentity}}class k extends h{constructor(a,b){super(b),this.channelCredentials=a}compose(a){let b=this.callCredentials.compose(a);return new k(this.channelCredentials,b)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(a){return this===a||a instanceof k&&this.channelCredentials._equals(a.channelCredentials)&&this.callCredentials._equals(a.callCredentials)}}},39071,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.isLoadBalancerNameRegistered=c.createLoadBalancer=c.registerDefaultLoadBalancerType=c.registerLoadBalancerType=c.createChildChannelControlHelper=void 0,c.createChildChannelControlHelper=function(a,b){var c,d,e,f,g,h,i,j,k,l;return{createSubchannel:null!=(d=null==(c=b.createSubchannel)?void 0:c.bind(b))?d:a.createSubchannel.bind(a),updateState:null!=(f=null==(e=b.updateState)?void 0:e.bind(b))?f:a.updateState.bind(a),requestReresolution:null!=(h=null==(g=b.requestReresolution)?void 0:g.bind(b))?h:a.requestReresolution.bind(a),addChannelzChild:null!=(j=null==(i=b.addChannelzChild)?void 0:i.bind(b))?j:a.addChannelzChild.bind(a),removeChannelzChild:null!=(l=null==(k=b.removeChannelzChild)?void 0:k.bind(b))?l:a.removeChannelzChild.bind(a)}};let d={},e=null;c.registerLoadBalancerType=function(a,b,c){d[a]={LoadBalancer:b,LoadBalancingConfig:c}},c.registerDefaultLoadBalancerType=function(a){e=a},c.createLoadBalancer=function(a,b){let c=a.getLoadBalancerName();return c in d?new d[c].LoadBalancer(b):null},c.isLoadBalancerNameRegistered=function(a){return a in d},c.getFirstUsableConfig=function(a,b=!1){for(let b of a)if(b.getLoadBalancerName()in d)return b;return b&&e?new d[e].LoadBalancingConfig:null},c.validateLoadBalancingConfig=function(a){if(null===a||"object"!=typeof a)throw Error("Load balancing config must be an object");let b=Object.keys(a);if(1!==b.length)throw Error("Provided load balancing config has multiple conflicting entries");let c=b[0];if(c in d)return d[c].LoadBalancingConfig.createFromJson(a[c]);throw Error(`Unrecognized load balancing config name ${c}`)}},46786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},83931,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.extractAndSelectServiceConfig=c.validateServiceConfig=c.validateRetryThrottling=void 0;let d=a.r(46786),e=a.r(57982),f=a.r(39071),g=/^\d+(\.\d{1,9})?s$/,h="node";function i(a){if("service"in a&&""!==a.service){if("string"!=typeof a.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof a.service}`);if(!("method"in a)||""===a.method)return{service:a.service};if("string"!=typeof a.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof a.service}`);return{service:a.service,method:a.method}}if("method"in a&&void 0!==a.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function j(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in a)||"string"!=typeof a.initialBackoff||!g.test(a.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in a)||"string"!=typeof a.maxBackoff||!g.test(a.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in a)||"number"!=typeof a.backoffMultiplier||a.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in a&&Array.isArray(a.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===a.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let b of a.retryableStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:a.maxAttempts,initialBackoff:a.initialBackoff,maxBackoff:a.maxBackoff,backoffMultiplier:a.backoffMultiplier,retryableStatusCodes:a.retryableStatusCodes}}function k(a){if(!("maxAttempts"in a)||!Number.isInteger(a.maxAttempts)||a.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in a&&("string"!=typeof a.hedgingDelay||!g.test(a.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in a&&Array.isArray(a.nonFatalStatusCodes))for(let b of a.nonFatalStatusCodes)if("number"==typeof b){if(!Object.values(e.Status).includes(b))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof b){if(!Object.values(e.Status).includes(b.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let b={maxAttempts:a.maxAttempts};return a.hedgingDelay&&(b.hedgingDelay=a.hedgingDelay),a.nonFatalStatusCodes&&(b.nonFatalStatusCodes=a.nonFatalStatusCodes),b}function l(a){var b;let c={name:[]};if(!("name"in a)||!Array.isArray(a.name))throw Error("Invalid method config: invalid name array");for(let b of a.name)c.name.push(i(b));if("waitForReady"in a){if("boolean"!=typeof a.waitForReady)throw Error("Invalid method config: invalid waitForReady");c.waitForReady=a.waitForReady}if("timeout"in a)if("object"==typeof a.timeout){if(!("seconds"in a.timeout)||"number"!=typeof a.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in a.timeout)||"number"!=typeof a.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");c.timeout=a.timeout}else if("string"==typeof a.timeout&&g.test(a.timeout)){let d=a.timeout.substring(0,a.timeout.length-1).split(".");c.timeout={seconds:0|d[0],nanos:(null!=(b=d[1])?b:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in a){if("number"!=typeof a.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxRequestBytes=a.maxRequestBytes}if("maxResponseBytes"in a){if("number"!=typeof a.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");c.maxResponseBytes=a.maxResponseBytes}if("retryPolicy"in a)if("hedgingPolicy"in a)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else c.retryPolicy=j(a.retryPolicy);else"hedgingPolicy"in a&&(c.hedgingPolicy=k(a.hedgingPolicy));return c}function m(a){if(!("maxTokens"in a)||"number"!=typeof a.maxTokens||a.maxTokens<=0||a.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in a)||"number"!=typeof a.tokenRatio||a.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+a.maxTokens.toFixed(3),tokenRatio:+a.tokenRatio.toFixed(3)}}function n(a){let b={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in a)if("string"==typeof a.loadBalancingPolicy)b.loadBalancingPolicy=a.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in a)if(Array.isArray(a.loadBalancingConfig))for(let c of a.loadBalancingConfig)b.loadBalancingConfig.push((0,f.validateLoadBalancingConfig)(c));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in a&&Array.isArray(a.methodConfig))for(let c of a.methodConfig)b.methodConfig.push(l(c));"retryThrottling"in a&&(b.retryThrottling=m(a.retryThrottling));let c=[];for(let a of b.methodConfig)for(let b of a.name){for(let a of c)if(b.service===a.service&&b.method===a.method)throw Error(`Invalid service config: duplicate name ${b.service}/${b.method}`);c.push(b)}return b}function o(a){if(!("serviceConfig"in a))throw Error("Invalid service config choice: missing service config");let b={serviceConfig:n(a.serviceConfig)};if("clientLanguage"in a)if(Array.isArray(a.clientLanguage))for(let c of(b.clientLanguage=[],a.clientLanguage))if("string"==typeof c)b.clientLanguage.push(c);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in a)if(Array.isArray(a.clientHostname))for(let c of(b.clientHostname=[],a.clientHostname))if("string"==typeof c)b.clientHostname.push(c);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in a)if("number"==typeof a.percentage&&0<=a.percentage&&a.percentage<=100)b.percentage=a.percentage;else throw Error("Invalid service config choice: invalid percentage");let c=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let b in a)if(!c.includes(b))throw Error(`Invalid service config choice: unexpected field ${b}`);return b}function p(a,b){if(!Array.isArray(a))throw Error("Invalid service config list");for(let c of a){let a=o(c);if("number"!=typeof a.percentage||!(b>a.percentage)){if(Array.isArray(a.clientHostname)){let b=!1;for(let c of a.clientHostname)c===d.hostname()&&(b=!0);if(!b)continue}if(Array.isArray(a.clientLanguage)){let b=!1;for(let c of a.clientLanguage)c===h&&(b=!0);if(!b)continue}return a.serviceConfig}}throw Error("No matching service config found")}c.validateRetryThrottling=m,c.validateServiceConfig=n,c.extractAndSelectServiceConfig=function(a,b){for(let c of a)if(c.length>0&&c[0].startsWith("grpc_config="))return p(JSON.parse(c.join("").substring(12)),b);return null}},56537,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.ConnectivityState=void 0,function(a){a[a.IDLE=0]="IDLE",a[a.CONNECTING=1]="CONNECTING",a[a.READY=2]="READY",a[a.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",a[a.SHUTDOWN=4]="SHUTDOWN"}(d||(c.ConnectivityState=d={}))},55647,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.uriToString=c.splitHostPort=c.parseUri=void 0;let d=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;c.parseUri=function(a){let b=d.exec(a);return null===b?null:{scheme:b[1],authority:b[2],path:b[3]}};let e=/^\d+$/;c.splitHostPort=function(a){if(a.startsWith("[")){let b=a.indexOf("]");if(-1===b)return null;let c=a.substring(1,b);if(-1===c.indexOf(":"))return null;if(!(a.length>b+1))return{host:c};if(":"!==a[b+1])return null;{let d=a.substring(b+2);return e.test(d)?{host:c,port:+d}:null}}{let b=a.split(":");return 2!==b.length?{host:a}:e.test(b[1])?{host:b[0],port:+b[1]}:null}},c.uriToString=function(a){let b="";return void 0!==a.scheme&&(b+=a.scheme+":"),void 0!==a.authority&&(b+="//"+a.authority+"/"),b+=a.path}},49845,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.mapUriDefaultScheme=c.getDefaultAuthority=c.createResolver=c.registerDefaultScheme=c.registerResolver=void 0;let d=a.r(55647),e={},f=null;c.registerResolver=function(a,b){e[a]=b},c.registerDefaultScheme=function(a){f=a},c.createResolver=function(a,b,c){if(void 0!==a.scheme&&a.scheme in e)return new e[a.scheme](a,b,c);throw Error(`No resolver could be created for target ${(0,d.uriToString)(a)}`)},c.getDefaultAuthority=function(a){if(void 0!==a.scheme&&a.scheme in e)return e[a.scheme].getDefaultAuthority(a);throw Error(`Invalid target ${(0,d.uriToString)(a)}`)},c.mapUriDefaultScheme=function(a){if(void 0===a.scheme||!(a.scheme in e))if(null!==f)return{scheme:f,authority:void 0,path:(0,d.uriToString)(a)};else return null;return a}},3681,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.QueuePicker=c.UnavailablePicker=c.PickResultType=void 0;let e=a.r(57904),f=a.r(57982);!function(a){a[a.COMPLETE=0]="COMPLETE",a[a.QUEUE=1]="QUEUE",a[a.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",a[a.DROP=3]="DROP"}(d||(c.PickResultType=d={}));class g{constructor(a){this.status=Object.assign({code:f.Status.UNAVAILABLE,details:"No connection established",metadata:new e.Metadata},a)}pick(a){return{pickResultType:d.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}c.UnavailablePicker=g;class h{constructor(a){this.loadBalancer=a,this.calledExitIdle=!1}pick(a){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:d.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}c.QueuePicker=h},57451,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BackoffTimeout=void 0;let d=1e3,e=1.6,f=12e4,g=.2;function h(a,b){return Math.random()*(b-a)+a}class i{constructor(a,b){this.callback=a,this.initialDelay=d,this.multiplier=e,this.maxDelay=f,this.jitter=g,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,b&&(b.initialDelay&&(this.initialDelay=b.initialDelay),b.multiplier&&(this.multiplier=b.multiplier),b.jitter&&(this.jitter=b.jitter),b.maxDelay&&(this.maxDelay=b.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(a){var b,c;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},a),this.hasRef||null==(c=(b=this.timerId).unref)||c.call(b)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let a=Math.min(this.nextDelay*this.multiplier,this.maxDelay),b=a*this.jitter;this.nextDelay=a+h(-b,b)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let a=new Date,b=this.startTime;b.setMilliseconds(b.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),a<b?this.runTimer(b.getTime()-a.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var a,b;this.hasRef=!0,null==(b=(a=this.timerId).ref)||b.call(a)}unref(){var a,b;this.hasRef=!1,null==(b=(a=this.timerId).unref)||b.call(a)}getEndTime(){return this.endTime}}c.BackoffTimeout=i},33140,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChildLoadBalancerHandler=void 0;let d=a.r(39071),e=a.r(56537),f="child_load_balancer_helper";class g{constructor(a){this.channelControlHelper=a,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(a){this.parent=a,this.child=null}createSubchannel(a,b){return this.parent.channelControlHelper.createSubchannel(a,b)}updateState(a,b){var c;if(this.calledByPendingChild()){if(a===e.ConnectivityState.CONNECTING)return;null==(c=this.parent.currentChild)||c.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(a,b)}requestReresolution(){var a;let b=null!=(a=this.parent.pendingChild)?a:this.parent.currentChild;this.child===b&&this.parent.channelControlHelper.requestReresolution()}setChild(a){this.child=a}addChannelzChild(a){this.parent.channelControlHelper.addChannelzChild(a)}removeChannelzChild(a){this.parent.channelControlHelper.removeChannelzChild(a)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(a,b){return a.getLoadBalancerName()!==b.getLoadBalancerName()}updateAddressList(a,b,c){let e;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,b)){let a=new this.ChildPolicyHelper(this),c=(0,d.createLoadBalancer)(b,a);a.setChild(c),null===this.currentChild?(this.currentChild=c,e=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=c,e=this.pendingChild)}else e=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=b,e.updateAddressList(a,b,c)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return f}}c.ChildLoadBalancerHandler=g},74765,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingLoadBalancer=void 0;let d=a.r(39071),e=a.r(83931),f=a.r(56537),g=a.r(49845),h=a.r(3681),i=a.r(57451),j=a.r(57982),k=a.r(57904),l=a.r(11717),m=a.r(57982),n=a.r(55647),o=a.r(33140),p="resolving_load_balancer";function q(a){l.trace(m.LogVerbosity.DEBUG,p,a)}let r=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function s(a,b,c,d){for(let e of c.name)switch(d){case"EMPTY":if(!e.service&&!e.method)return!0;break;case"SERVICE":if(e.service===a&&!e.method)return!0;break;case"SERVICE_AND_METHOD":if(e.service===a&&e.method===b)return!0}return!1}function t(a,b,c,d){for(let e of c)if(s(a,b,e,d))return e;return null}function u(a){return function(b,c){var d,e;let f=b.split("/").filter(a=>a.length>0),g=null!=(d=f[0])?d:"",h=null!=(e=f[1])?e:"";if(a&&a.methodConfig)for(let b of r){let c=t(g,h,a.methodConfig,b);if(c)return{methodConfig:c,pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:j.Status.OK,dynamicFilterFactories:[]}}}class v{constructor(a,b,c,l,m){this.target=a,this.channelControlHelper=b,this.onSuccessfulResolution=l,this.onFailedResolution=m,this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,c["grpc.service_config"]?this.defaultServiceConfig=(0,e.validateServiceConfig)(JSON.parse(c["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(f.ConnectivityState.IDLE,new h.QueuePicker(this)),this.childLoadBalancer=new o.ChildLoadBalancerHandler({createSubchannel:b.createSubchannel.bind(b),requestReresolution:()=>{this.backoffTimeout.isRunning()?(q("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,b)=>{this.latestChildState=a,this.latestChildPicker=b,this.updateState(a,b)},addChannelzChild:b.addChannelzChild.bind(b),removeChannelzChild:b.removeChannelzChild.bind(b)}),this.innerResolver=(0,g.createResolver)(a,{onSuccessfulResolution:(a,b,c,e,f)=>{var g;this.backoffTimeout.stop(),this.backoffTimeout.reset();let h=null;null===b?null===c?(this.previousServiceConfig=null,h=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(c):h=this.previousServiceConfig:(h=b,this.previousServiceConfig=b);let i=null!=(g=null==h?void 0:h.loadBalancingConfig)?g:[],l=(0,d.getFirstUsableConfig)(i,!0);if(null===l)return void this.handleResolutionFailure({code:j.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new k.Metadata});this.childLoadBalancer.updateAddressList(a,l,f);let m=null!=h?h:this.defaultServiceConfig;this.onSuccessfulResolution(m,null!=e?e:u(m))},onError:a=>{this.handleResolutionFailure(a)}},c);const n={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},n),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===f.ConnectivityState.IDLE&&this.updateState(f.ConnectivityState.CONNECTING,new h.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(a,b){q((0,n.uriToString)(this.target)+" "+f.ConnectivityState[this.currentState]+" -> "+f.ConnectivityState[a]),a===f.ConnectivityState.IDLE&&(b=new h.QueuePicker(this)),this.currentState=a,this.channelControlHelper.updateState(a,b)}handleResolutionFailure(a){this.latestChildState===f.ConnectivityState.IDLE&&(this.updateState(f.ConnectivityState.TRANSIENT_FAILURE,new h.UnavailablePicker(a)),this.onFailedResolution(a))}exitIdle(){(this.currentState===f.ConnectivityState.IDLE||this.currentState===f.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(a,b){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=f.ConnectivityState.IDLE,this.latestChildPicker=new h.QueuePicker(this),this.currentState=f.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}c.ResolvingLoadBalancer=v},69359,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.channelOptionsEqual=c.recognizedOptions=void 0,c.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},c.channelOptionsEqual=function(a,b){let c=Object.keys(a).sort(),d=Object.keys(b).sort();if(c.length!==d.length)return!1;for(let e=0;e<c.length;e+=1)if(c[e]!==d[e]||a[c[e]]!==b[d[e]])return!1;return!0}},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},91177,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.stringToSubchannelAddress=c.subchannelAddressToString=c.subchannelAddressEqual=c.isTcpSubchannelAddress=void 0;let d=a.r(4446);function e(a){return"port"in a}c.isTcpSubchannelAddress=e,c.subchannelAddressEqual=function(a,b){return!a&&!b||!!a&&!!b&&(e(a)?e(b)&&a.host===b.host&&a.port===b.port:!e(b)&&a.path===b.path)},c.subchannelAddressToString=function(a){return e(a)?a.host+":"+a.port:a.path};let f=443;c.stringToSubchannelAddress=function(a,b){return(0,d.isIP)(a)?{host:a,port:null!=b?b:f}:{path:a}}},31509,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addAdminServicesToServer=c.registerAdminService=void 0;let d=[];c.registerAdminService=function(a,b){d.push({getServiceDefinition:a,getHandlers:b})},c.addAdminServicesToServer=function(a){for(let{getServiceDefinition:b,getHandlers:c}of d)a.addService(b(),c())}},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},51985,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ClientDuplexStreamImpl=c.ClientWritableStreamImpl=c.ClientReadableStreamImpl=c.ClientUnaryCallImpl=c.callErrorFromStatus=void 0;let d=a.r(27699),e=a.r(88947),f=a.r(57982);c.callErrorFromStatus=function(a,b){let c=`${a.code} ${f.Status[a.code]}: ${a.details}`,d=Error(c),e=`${d.stack}
for call at
${b}`;return Object.assign(Error(c),a,{stack:e})};class g extends d.EventEmitter{constructor(){super()}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}}c.ClientUnaryCallImpl=g;class h extends e.Readable{constructor(a){super({objectMode:!0}),this.deserialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}}c.ClientReadableStreamImpl=h;class i extends e.Writable{constructor(a){super({objectMode:!0}),this.serialize=a}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientWritableStreamImpl=i;class j extends e.Duplex{constructor(a,b){super({objectMode:!0}),this.serialize=a,this.deserialize=b}cancel(){var a;null==(a=this.call)||a.cancelWithStatus(f.Status.CANCELLED,"Cancelled on client")}getPeer(){var a,b;return null!=(b=null==(a=this.call)?void 0:a.getPeer())?b:"unknown"}_read(a){var b;null==(b=this.call)||b.startRead()}_write(a,b,c){var d;let e={callback:c},f=Number(b);Number.isNaN(f)||(e.flags=f),null==(d=this.call)||d.sendMessageWithContext(e,a)}_final(a){var b;null==(b=this.call)||b.halfClose(),a()}}c.ClientDuplexStreamImpl=j},5628,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InterceptingListenerImpl=c.isInterceptingListener=void 0,c.isInterceptingListener=function(a){return void 0!==a.onReceiveMetadata&&1===a.onReceiveMetadata.length};class d{constructor(a,b){this.listener=a,this.nextListener=b,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(a){this.processingMetadata=!0,this.listener.onReceiveMetadata(a,a=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(a),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(a){this.processingMessage=!0,this.listener.onReceiveMessage(a,a=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=a,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(a),this.processPendingStatus())})}onReceiveStatus(a){this.listener.onReceiveStatus(a,a=>{this.processingMetadata||this.processingMessage?this.pendingStatus=a:this.nextListener.onReceiveStatus(a)})}}c.InterceptingListenerImpl=d},83278,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getInterceptingCall=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.InterceptorConfigurationError=void 0;let d=a.r(57904),e=a.r(5628),f=a.r(57982),g=a.r(21015);class h extends Error{constructor(a){super(a),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,h)}}c.InterceptorConfigurationError=h;class i{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(a){return this.metadata=a,this}withOnReceiveMessage(a){return this.message=a,this}withOnReceiveStatus(a){return this.status=a,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}c.ListenerBuilder=i;class j{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(a){return this.start=a,this}withSendMessage(a){return this.message=a,this}withHalfClose(a){return this.halfClose=a,this}withCancel(a){return this.cancel=a,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}c.RequesterBuilder=j;let k=(a,b)=>{b(a)},l=(a,b)=>{b(a)},m=(a,b)=>{b(a)},n={start:(a,b,c)=>{c(a,b)},sendMessage:(a,b)=>{b(a)},halfClose:a=>{a()},cancel:a=>{a()}};class o{constructor(a,b){var c,d,e,f;this.nextCall=a,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,b?this.requester={start:null!=(c=b.start)?c:n.start,sendMessage:null!=(d=b.sendMessage)?d:n.sendMessage,halfClose:null!=(e=b.halfClose)?e:n.halfClose,cancel:null!=(f=b.cancel)?f:n.cancel}:this.requester=n}cancelWithStatus(a,b){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(a,b)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(a,b){var c,d,f,g,h,i;let j={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:null!=(g=null==(f=null==b?void 0:b.onReceiveMessage)?void 0:f.bind(b))?g:a=>{},onReceiveStatus:null!=(i=null==(h=null==b?void 0:b.onReceiveStatus)?void 0:h.bind(b))?i:a=>{}};this.processingMetadata=!0,this.requester.start(a,j,(a,b)=>{var c,d,f;let g;if(this.processingMetadata=!1,(0,e.isInterceptingListener)(b))g=b;else{let a={onReceiveMetadata:null!=(c=b.onReceiveMetadata)?c:k,onReceiveMessage:null!=(d=b.onReceiveMessage)?d:l,onReceiveStatus:null!=(f=b.onReceiveStatus)?f:m};g=new e.InterceptingListenerImpl(a,j)}this.nextCall.start(a,g),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(a,b){this.processingMessage=!0,this.requester.sendMessage(b,c=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=a,this.pendingMessage=b):(this.nextCall.sendMessageWithContext(a,c),this.processPendingHalfClose())})}sendMessage(a){this.sendMessageWithContext({},a)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(a,b,c){var d,e;let f=null!=(d=c.deadline)?d:1/0,g=c.host,h=null!=(e=c.parent)?e:null,i=c.propagate_flags,j=c.credentials,k=a.createCall(b,f,g,h,i);return j&&k.setCredentials(j),k}c.InterceptingCall=o;class q{constructor(a,b){this.call=a,this.methodDefinition=b}cancelWithStatus(a,b){this.call.cancelWithStatus(a,b)}getPeer(){return this.call.getPeer()}sendMessageWithContext(a,b){let c;try{c=this.methodDefinition.requestSerialize(b)}catch(a){this.call.cancelWithStatus(f.Status.INTERNAL,`Request message serialization failure: ${(0,g.getErrorMessage)(a)}`);return}this.call.sendMessageWithContext(a,c)}sendMessage(a){this.sendMessageWithContext({},a)}start(a,b){let c=null;this.call.start(a,{onReceiveMetadata:a=>{var c;null==(c=null==b?void 0:b.onReceiveMetadata)||c.call(b,a)},onReceiveMessage:a=>{var e;let h;try{h=this.methodDefinition.responseDeserialize(a)}catch(a){c={code:f.Status.INTERNAL,details:`Response message parsing error: ${(0,g.getErrorMessage)(a)}`,metadata:new d.Metadata},this.call.cancelWithStatus(c.code,c.details);return}null==(e=null==b?void 0:b.onReceiveMessage)||e.call(b,h)},onReceiveStatus:a=>{var d,e;c?null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,c):null==(e=null==b?void 0:b.onReceiveStatus)||e.call(b,a)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class r extends q{constructor(a,b){super(a,b)}start(a,b){var c,d;let e=!1,f={onReceiveMetadata:null!=(d=null==(c=null==b?void 0:b.onReceiveMetadata)?void 0:c.bind(b))?d:a=>{},onReceiveMessage:a=>{var c;e=!0,null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,a)},onReceiveStatus:a=>{var c,d;e||null==(c=null==b?void 0:b.onReceiveMessage)||c.call(b,null),null==(d=null==b?void 0:b.onReceiveStatus)||d.call(b,a)}};super.start(a,f),this.call.startRead()}}class s extends q{}function t(a,b,c){let d=p(a,c.path,b);return c.responseStream?new s(d,c):new r(d,c)}c.getInterceptingCall=function(a,b,c,d){if(a.clientInterceptors.length>0&&a.clientInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(a.callInterceptors.length>0&&a.callInterceptorProviders.length>0)throw new h("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let e=[];e=a.callInterceptors.length>0||a.callInterceptorProviders.length>0?[].concat(a.callInterceptors,a.callInterceptorProviders.map(a=>a(b))).filter(a=>a):[].concat(a.clientInterceptors,a.clientInterceptorProviders.map(a=>a(b))).filter(a=>a);let f=Object.assign({},c,{method_definition:b});return e.reduceRight((a,b)=>c=>b(c,a),a=>t(d,a,b))(f)}},19856,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Client=void 0;let d=a.r(51985),e=a.r(61655),f=a.r(56537),g=a.r(57982),h=a.r(57904),i=a.r(83278),j=Symbol(),k=Symbol(),l=Symbol(),m=Symbol();function n(a){return"function"==typeof a}function o(a){return a.stack.split("\n").slice(1).join("\n")}class p{constructor(a,b,c={}){var d,f;if(c=Object.assign({},c),this[k]=null!=(d=c.interceptors)?d:[],delete c.interceptors,this[l]=null!=(f=c.interceptor_providers)?f:[],delete c.interceptor_providers,this[k].length>0&&this[l].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[m]=c.callInvocationTransformer,delete c.callInvocationTransformer,c.channelOverride)this[j]=c.channelOverride;else if(c.channelFactoryOverride){const d=c.channelFactoryOverride;delete c.channelFactoryOverride,this[j]=d(a,b,c)}else this[j]=new e.ChannelImplementation(a,b,c)}close(){this[j].close()}getChannel(){return this[j]}waitForReady(a,b){let c=d=>{let e;if(d)return void b(Error("Failed to connect before the deadline"));try{e=this[j].getConnectivityState(!0)}catch(a){b(Error("The channel has been closed"));return}if(e===f.ConnectivityState.READY)b();else try{this[j].watchConnectivityState(e,a,c)}catch(a){b(Error("The channel has been closed"))}};setImmediate(c)}checkOptionalUnaryResponseArguments(a,b,c){if(n(a))return{metadata:new h.Metadata,options:{},callback:a};if(n(b))if(a instanceof h.Metadata)return{metadata:a,options:{},callback:b};else return{metadata:new h.Metadata,options:a,callback:b};if(!(a instanceof h.Metadata&&b instanceof Object&&n(c)))throw Error("Incorrect arguments passed");return{metadata:a,options:b,callback:c}}makeUnaryRequest(a,b,c,e,f,h,n){var p,q;let r=this.checkOptionalUnaryResponseArguments(f,h,n),s={path:a,requestStream:!1,responseStream:!1,requestSerialize:b,responseDeserialize:c},t={argument:e,metadata:r.metadata,call:new d.ClientUnaryCallImpl,channel:this[j],methodDefinition:s,callOptions:r.options,callback:r.callback};this[m]&&(t=this[m](t));let u=t.call,v={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(p=t.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(q=t.callOptions.interceptor_providers)?q:[]},w=(0,i.getInterceptingCall)(v,t.methodDefinition,t.callOptions,t.channel);u.call=w;let x=null,y=!1,z=Error();return w.start(t.metadata,{onReceiveMetadata:a=>{u.emit("metadata",a)},onReceiveMessage(a){null!==x&&w.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),x=a},onReceiveStatus(a){if(!y){if(y=!0,a.code===g.Status.OK)if(null===x){let b=o(z);t.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else t.callback(null,x);else{let b=o(z);t.callback((0,d.callErrorFromStatus)(a,b))}z=null,u.emit("status",a)}}}),w.sendMessage(e),w.halfClose(),u}makeClientStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkOptionalUnaryResponseArguments(e,f,h),r={path:a,requestStream:!0,responseStream:!1,requestSerialize:b,responseDeserialize:c},s={metadata:q.metadata,call:new d.ClientWritableStreamImpl(b),channel:this[j],methodDefinition:r,callOptions:q.options,callback:q.callback};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=null,x=!1,y=Error();return v.start(s.metadata,{onReceiveMetadata:a=>{t.emit("metadata",a)},onReceiveMessage(a){null!==w&&v.cancelWithStatus(g.Status.INTERNAL,"Too many responses received"),w=a},onReceiveStatus(a){if(!x){if(x=!0,a.code===g.Status.OK)if(null===w){let b=o(y);s.callback((0,d.callErrorFromStatus)({code:g.Status.INTERNAL,details:"No message received",metadata:a.metadata},b))}else s.callback(null,w);else{let b=o(y);s.callback((0,d.callErrorFromStatus)(a,b))}y=null,t.emit("status",a)}}}),t}checkMetadataAndOptions(a,b){let c,d;return a instanceof h.Metadata?(c=a,d=b||{}):(d=a||{},c=new h.Metadata),{metadata:c,options:d}}makeServerStreamRequest(a,b,c,e,f,h){var n,p;let q=this.checkMetadataAndOptions(f,h),r={path:a,requestStream:!1,responseStream:!0,requestSerialize:b,responseDeserialize:c},s={argument:e,metadata:q.metadata,call:new d.ClientReadableStreamImpl(c),channel:this[j],methodDefinition:r,callOptions:q.options};this[m]&&(s=this[m](s));let t=s.call,u={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(n=s.callOptions.interceptors)?n:[],callInterceptorProviders:null!=(p=s.callOptions.interceptor_providers)?p:[]},v=(0,i.getInterceptingCall)(u,s.methodDefinition,s.callOptions,s.channel);t.call=v;let w=!1,x=Error();return v.start(s.metadata,{onReceiveMetadata(a){t.emit("metadata",a)},onReceiveMessage(a){t.push(a)},onReceiveStatus(a){if(!w){if(w=!0,t.push(null),a.code!==g.Status.OK){let b=o(x);t.emit("error",(0,d.callErrorFromStatus)(a,b))}x=null,t.emit("status",a)}}}),v.sendMessage(e),v.halfClose(),t}makeBidiStreamRequest(a,b,c,e,f){var h,n;let p=this.checkMetadataAndOptions(e,f),q={path:a,requestStream:!0,responseStream:!0,requestSerialize:b,responseDeserialize:c},r={metadata:p.metadata,call:new d.ClientDuplexStreamImpl(b,c),channel:this[j],methodDefinition:q,callOptions:p.options};this[m]&&(r=this[m](r));let s=r.call,t={clientInterceptors:this[k],clientInterceptorProviders:this[l],callInterceptors:null!=(h=r.callOptions.interceptors)?h:[],callInterceptorProviders:null!=(n=r.callOptions.interceptor_providers)?n:[]},u=(0,i.getInterceptingCall)(t,r.methodDefinition,r.callOptions,r.channel);s.call=u;let v=!1,w=Error();return u.start(r.metadata,{onReceiveMetadata(a){s.emit("metadata",a)},onReceiveMessage(a){s.push(a)},onReceiveStatus(a){if(!v){if(v=!0,s.push(null),a.code!==g.Status.OK){let b=o(w);s.emit("error",(0,d.callErrorFromStatus)(a,b))}w=null,s.emit("status",a)}}}),s}}c.Client=p},80721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.loadPackageDefinition=c.makeClientConstructor=void 0;let d=a.r(19856),e={unary:d.Client.prototype.makeUnaryRequest,server_stream:d.Client.prototype.makeServerStreamRequest,client_stream:d.Client.prototype.makeClientStreamRequest,bidi:d.Client.prototype.makeBidiStreamRequest};function f(a){return["__proto__","prototype","constructor"].includes(a)}function g(a,b,c){c||(c={});class g extends d.Client{}return Object.keys(a).forEach(b=>{let c;if(f(b))return;let d=a[b];if("string"==typeof b&&"$"===b.charAt(0))throw Error("Method names cannot start with $");c=d.requestStream?d.responseStream?"bidi":"client_stream":d.responseStream?"server_stream":"unary";let i=d.requestSerialize,j=d.responseDeserialize,k=h(e[c],d.path,i,j);g.prototype[b]=k,Object.assign(g.prototype[b],d),d.originalName&&!f(d.originalName)&&(g.prototype[d.originalName]=g.prototype[b])}),g.service=a,g.serviceName=b,g}function h(a,b,c,d){return function(...e){return a.call(this,b,c,d,...e)}}function i(a){return"format"in a}c.makeClientConstructor=g,c.loadPackageDefinition=function(a){let b={};for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],e=c.split(".");if(e.some(a=>f(a)))continue;let h=e[e.length-1],j=b;for(let a of e.slice(0,-1))j[a]||(j[a]={}),j=j[a];i(d)?j[h]=d:j[h]=g(d,h,{})}return b}},77802,(a,b,c)=>{var d=1/0,e="[object Symbol]",f=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,h="\\ud800-\\udfff",i="\\u0300-\\u036f\\ufe20-\\ufe23",j="\\u20d0-\\u20f0",k="\\u2700-\\u27bf",l="a-z\\xdf-\\xf6\\xf8-\\xff",m="A-Z\\xc0-\\xd6\\xd8-\\xde",n="\\ufe0e\\ufe0f",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="[']",q="["+h+"]",r="["+o+"]",s="["+i+j+"]",t="\\d+",u="["+k+"]",v="["+l+"]",w="[^"+h+o+t+k+l+m+"]",x="\\ud83c[\\udffb-\\udfff]",y="[^"+h+"]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",A="[\\ud800-\\udbff][\\udc00-\\udfff]",B="["+m+"]",C="\\u200d",D="(?:"+v+"|"+w+")",E="(?:"+B+"|"+w+")",F="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",G="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",H="(?:"+s+"|"+x+")?",I="["+n+"]?",J="(?:"+C+"(?:"+[y,z,A].join("|")+")"+I+H+")*",K=I+H+J,L="(?:"+[u,z,A].join("|")+")"+K,M="(?:"+[y+s+"?",s,z,A,q].join("|")+")",N=RegExp(p,"g"),O=RegExp(s,"g"),P=RegExp(x+"(?="+x+")|"+M+K,"g"),Q=RegExp([B+"?"+v+"+"+F+"(?="+[r,B,"$"].join("|")+")",E+"+"+G+"(?="+[r,B+D,"$"].join("|")+")",B+"?"+D+"+"+F,B+"+"+G,t,L].join("|"),"g"),R=RegExp("["+C+h+i+j+n+"]"),S=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,T={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},U=a.g&&a.g.Object===Object&&a.g,V="object"==typeof self&&self&&self.Object===Object&&self,W=U||V||Function("return this")();function X(a,b,c,d){var e=-1,f=a?a.length:0;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function Y(a){return a.split("")}function Z(a){return a.match(f)||[]}var $=function(a){return function(b){return null==a?void 0:a[b]}}(T);function _(a){return R.test(a)}function aa(a){return S.test(a)}function ab(a){return _(a)?ac(a):Y(a)}function ac(a){return a.match(P)||[]}function ad(a){return a.match(Q)||[]}var ae=Object.prototype.toString,af=W.Symbol,ag=af?af.prototype:void 0,ah=ag?ag.toString:void 0;function ai(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function aj(a){if("string"==typeof a)return a;if(an(a))return ah?ah.call(a):"";var b=a+"";return"0"==b&&1/a==-d?"-0":b}function ak(a,b,c){var d=a.length;return c=void 0===c?d:c,!b&&c>=d?a:ai(a,b,c)}function al(a){return function(b){var c=_(b=ao(b))?ab(b):void 0,d=c?c[0]:b.charAt(0),e=c?ak(c,1).join(""):b.slice(1);return d[a]()+e}}function am(a){return!!a&&"object"==typeof a}function an(a){return"symbol"==typeof a||am(a)&&ae.call(a)==e}function ao(a){return null==a?"":aj(a)}var ap=function(a){return function(b){return X(at(ar(b).replace(N,"")),a,"")}}(function(a,b,c){return b=b.toLowerCase(),a+(c?aq(b):b)});function aq(a){return as(ao(a).toLowerCase())}function ar(a){return(a=ao(a))&&a.replace(g,$).replace(O,"")}var as=al("toUpperCase");function at(a,b,c){return(a=ao(a),void 0===(b=c?void 0:b))?aa(a)?ad(a):Z(a):a.match(b)||[]}b.exports=ap},96146,(a,b,c)=>{"use strict";b.exports=function a(a,b){for(var c=Array(arguments.length-1),d=0,e=2,f=!0;e<arguments.length;)c[d++]=arguments[e++];return new Promise(function(e,g){c[d]=function(a){if(f)if(f=!1,a)g(a);else{for(var b=Array(arguments.length-1),c=0;c<b.length;)b[c++]=arguments[c];e.apply(null,b)}};try{a.apply(b||null,c)}catch(a){f&&(f=!1,g(a))}})}},28344,(a,b,c)=>{"use strict";var d=c;d.length=function(a){var b=a.length;if(!b)return 0;for(var c=0;--b%4>1&&"="===a.charAt(b);)++c;return Math.ceil(3*a.length)/4-c};for(var e=Array(64),f=Array(123),g=0;g<64;)f[e[g]=g<26?g+65:g<52?g+71:g<62?g-4:g-59|43]=g++;d.encode=function(a,b,c){for(var d,f=null,g=[],h=0,i=0;b<c;){var j=a[b++];switch(i){case 0:g[h++]=e[j>>2],d=(3&j)<<4,i=1;break;case 1:g[h++]=e[d|j>>4],d=(15&j)<<2,i=2;break;case 2:g[h++]=e[d|j>>6],g[h++]=e[63&j],i=0}h>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),h=0)}return(i&&(g[h++]=e[d],g[h++]=61,1===i&&(g[h++]=61)),f)?(h&&f.push(String.fromCharCode.apply(String,g.slice(0,h))),f.join("")):String.fromCharCode.apply(String,g.slice(0,h))};var h="invalid encoding";d.decode=function(a,b,c){for(var d,e=c,g=0,i=0;i<a.length;){var j=a.charCodeAt(i++);if(61===j&&g>1)break;if(void 0===(j=f[j]))throw Error(h);switch(g){case 0:d=j,g=1;break;case 1:b[c++]=d<<2|(48&j)>>4,d=j,g=2;break;case 2:b[c++]=(15&d)<<4|(60&j)>>2,d=j,g=3;break;case 3:b[c++]=(3&d)<<6|j,g=0}}if(1===g)throw Error(h);return c-e},d.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},38588,(a,b,c)=>{"use strict";function d(){this._listeners={}}b.exports=d,d.prototype.on=function(a,b,c){return(this._listeners[a]||(this._listeners[a]=[])).push({fn:b,ctx:c||this}),this},d.prototype.off=function(a,b){if(void 0===a)this._listeners={};else if(void 0===b)this._listeners[a]=[];else for(var c=this._listeners[a],d=0;d<c.length;)c[d].fn===b?c.splice(d,1):++d;return this},d.prototype.emit=function(a){var b=this._listeners[a];if(b){for(var c=[],d=1;d<arguments.length;)c.push(arguments[d++]);for(d=0;d<b.length;)b[d].fn.apply(b[d++].ctx,c)}return this}},40830,(a,b,c)=>{"use strict";function d(a){return"u">typeof Float32Array?!function(){var b=new Float32Array([-0]),c=new Uint8Array(b.buffer),d=128===c[3];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3]}function f(a,d,e){b[0]=a,d[e]=c[3],d[e+1]=c[2],d[e+2]=c[1],d[e+3]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],b[0]}function h(a,d){return c[3]=a[d],c[2]=a[d+1],c[1]=a[d+2],c[0]=a[d+3],b[0]}a.writeFloatLE=d?e:f,a.writeFloatBE=d?f:e,a.readFloatLE=d?g:h,a.readFloatBE=d?h:g}():!function(){function b(a,b,c,d){var e=+(b<0);if(e&&(b=-b),0===b)a(1/b>0?0:0x80000000,c,d);else if(isNaN(b))a(0x7fc00000,c,d);else if(b>34028234663852886e22)a((e<<31|0x7f800000)>>>0,c,d);else if(b<11754943508222875e-54)a((e<<31|Math.round(b/1401298464324817e-60))>>>0,c,d);else{var f=Math.floor(Math.log(b)/Math.LN2),g=8388607&Math.round(b*Math.pow(2,-f)*8388608);a((e<<31|f+127<<23|g)>>>0,c,d)}}function c(a,b,c){var d=a(b,c),e=(d>>31)*2+1,f=d>>>23&255,g=8388607&d;return 255===f?g?NaN:1/0*e:0===f?1401298464324817e-60*e*g:e*Math.pow(2,f-150)*(g+8388608)}a.writeFloatLE=b.bind(null,e),a.writeFloatBE=b.bind(null,f),a.readFloatLE=c.bind(null,g),a.readFloatBE=c.bind(null,h)}(),"u">typeof Float64Array?!function(){var b=new Float64Array([-0]),c=new Uint8Array(b.buffer),d=128===c[7];function e(a,d,e){b[0]=a,d[e]=c[0],d[e+1]=c[1],d[e+2]=c[2],d[e+3]=c[3],d[e+4]=c[4],d[e+5]=c[5],d[e+6]=c[6],d[e+7]=c[7]}function f(a,d,e){b[0]=a,d[e]=c[7],d[e+1]=c[6],d[e+2]=c[5],d[e+3]=c[4],d[e+4]=c[3],d[e+5]=c[2],d[e+6]=c[1],d[e+7]=c[0]}function g(a,d){return c[0]=a[d],c[1]=a[d+1],c[2]=a[d+2],c[3]=a[d+3],c[4]=a[d+4],c[5]=a[d+5],c[6]=a[d+6],c[7]=a[d+7],b[0]}function h(a,d){return c[7]=a[d],c[6]=a[d+1],c[5]=a[d+2],c[4]=a[d+3],c[3]=a[d+4],c[2]=a[d+5],c[1]=a[d+6],c[0]=a[d+7],b[0]}a.writeDoubleLE=d?e:f,a.writeDoubleBE=d?f:e,a.readDoubleLE=d?g:h,a.readDoubleBE=d?h:g}():!function(){function b(a,b,c,d,e,f){var g,h=+(d<0);if(h&&(d=-d),0===d)a(0,e,f+b),a(1/d>0?0:0x80000000,e,f+c);else if(isNaN(d))a(0,e,f+b),a(0x7ff80000,e,f+c);else if(d>17976931348623157e292)a(0,e,f+b),a((h<<31|0x7ff00000)>>>0,e,f+c);else if(d<22250738585072014e-324)a((g=d/5e-324)>>>0,e,f+b),a((h<<31|g/0x100000000)>>>0,e,f+c);else{var i=Math.floor(Math.log(d)/Math.LN2);1024===i&&(i=1023),a(0x10000000000000*(g=d*Math.pow(2,-i))>>>0,e,f+b),a((h<<31|i+1023<<20|1048576*g&1048575)>>>0,e,f+c)}}function c(a,b,c,d,e){var f=a(d,e+b),g=a(d,e+c),h=(g>>31)*2+1,i=g>>>20&2047,j=0x100000000*(1048575&g)+f;return 2047===i?j?NaN:1/0*h:0===i?5e-324*h*j:h*Math.pow(2,i-1075)*(j+0x10000000000000)}a.writeDoubleLE=b.bind(null,e,0,4),a.writeDoubleBE=b.bind(null,f,4,0),a.readDoubleLE=c.bind(null,g,0,4),a.readDoubleBE=c.bind(null,h,4,0)}(),a}function e(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}function f(a,b,c){b[c]=a>>>24,b[c+1]=a>>>16&255,b[c+2]=a>>>8&255,b[c+3]=255&a}function g(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0}function h(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}b.exports=d(d)},68754,(__turbopack_context__,module,exports)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},66298,(a,b,c)=>{"use strict";var d=c;d.length=function(a){for(var b=0,c=0,d=0;d<a.length;++d)(c=a.charCodeAt(d))<128?b+=1:c<2048?b+=2:(64512&c)==55296&&(64512&a.charCodeAt(d+1))==56320?(++d,b+=4):b+=3;return b},d.read=function(a,b,c){if(c-b<1)return"";for(var d,e=null,f=[],g=0;b<c;)(d=a[b++])<128?f[g++]=d:d>191&&d<224?f[g++]=(31&d)<<6|63&a[b++]:d>239&&d<365?(d=((7&d)<<18|(63&a[b++])<<12|(63&a[b++])<<6|63&a[b++])-65536,f[g++]=55296+(d>>10),f[g++]=56320+(1023&d)):f[g++]=(15&d)<<12|(63&a[b++])<<6|63&a[b++],g>8191&&((e||(e=[])).push(String.fromCharCode.apply(String,f)),g=0);return e?(g&&e.push(String.fromCharCode.apply(String,f.slice(0,g))),e.join("")):String.fromCharCode.apply(String,f.slice(0,g))},d.write=function(a,b,c){for(var d,e,f=c,g=0;g<a.length;++g)(d=a.charCodeAt(g))<128?b[c++]=d:(d<2048?b[c++]=d>>6|192:((64512&d)==55296&&(64512&(e=a.charCodeAt(g+1)))==56320?(d=65536+((1023&d)<<10)+(1023&e),++g,b[c++]=d>>18|240,b[c++]=d>>12&63|128):b[c++]=d>>12|224,b[c++]=d>>6&63|128),b[c++]=63&d|128);return c-f}},82820,(a,b,c)=>{"use strict";b.exports=function a(a,b,c){var d=c||8192,e=d>>>1,f=null,g=d;return function(c){if(c<1||c>e)return a(c);g+c>d&&(f=a(d),g=0);var h=b.call(f,g,g+=c);return 7&g&&(g=(7|g)+1),h}}},48309,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(85457);function e(a,b){this.lo=a>>>0,this.hi=b>>>0}var f=e.zero=new e(0,0);f.toNumber=function(){return 0},f.zzEncode=f.zzDecode=function(){return this},f.length=function(){return 1};var g=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(a){if(0===a)return f;var b=a<0;b&&(a=-a);var c=a>>>0,d=(a-c)/0x100000000>>>0;return b&&(d=~d>>>0,c=~c>>>0,++c>0xffffffff&&(c=0,++d>0xffffffff&&(d=0))),new e(c,d)},e.from=function(a){if("number"==typeof a)return e.fromNumber(a);if(d.isString(a))if(!d.Long)return e.fromNumber(parseInt(a,10));else a=d.Long.fromString(a);return a.low||a.high?new e(a.low>>>0,a.high>>>0):f},e.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var b=~this.lo+1>>>0,c=~this.hi>>>0;return b||(c=c+1>>>0),-(b+0x100000000*c)}return this.lo+0x100000000*this.hi},e.prototype.toLong=function(a){return d.Long?new d.Long(0|this.lo,0|this.hi,!!a):{low:0|this.lo,high:0|this.hi,unsigned:!!a}};var h=String.prototype.charCodeAt;e.fromHash=function(a){return a===g?f:new e((h.call(a,0)|h.call(a,1)<<8|h.call(a,2)<<16|h.call(a,3)<<24)>>>0,(h.call(a,4)|h.call(a,5)<<8|h.call(a,6)<<16|h.call(a,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},e.prototype.zzDecode=function(){var a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},e.prototype.length=function(){var a=this.lo,b=(this.lo>>>28|this.hi<<4)>>>0,c=this.hi>>>24;return 0===c?0===b?a<16384?a<128?1:2:a<2097152?3:4:b<16384?b<128?5:6:b<2097152?7:8:c<128?9:10}},85457,(a,b,c)=>{"use strict";var d=c;function e(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;++e)void 0!==a[d[e]]&&c||(a[d[e]]=b[d[e]]);return a}function f(a){function b(a,c){if(!(this instanceof b))return new b(a,c);Object.defineProperty(this,"message",{get:function(){return a}}),Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:Error().stack||""}),c&&e(this,c)}return b.prototype=Object.create(Error.prototype,{constructor:{value:b,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),b}d.asPromise=a.r(96146),d.base64=a.r(28344),d.EventEmitter=a.r(38588),d.float=a.r(40830),d.inquire=a.r(68754),d.utf8=a.r(66298),d.pool=a.r(82820),d.LongBits=a.r(48309),d.isNode=!!(a.g&&a.g.process&&a.g.process.versions&&a.g.process.versions.node),d.global=d.isNode&&a.g||"u">typeof self&&self||a.e,d.emptyArray=Object.freeze?Object.freeze([]):[],d.emptyObject=Object.freeze?Object.freeze({}):{},d.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},d.isString=function(a){return"string"==typeof a||a instanceof String},d.isObject=function(a){return a&&"object"==typeof a},d.isset=d.isSet=function(a,b){var c=a[b];return!!(null!=c&&a.hasOwnProperty(b))&&("object"!=typeof c||(Array.isArray(c)?c.length:Object.keys(c).length)>0)},d.Buffer=function(){try{var a=d.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch(a){return null}}(),d._Buffer_from=null,d._Buffer_allocUnsafe=null,d.newBuffer=function(a){return"number"==typeof a?d.Buffer?d._Buffer_allocUnsafe(a):new d.Array(a):d.Buffer?d._Buffer_from(a):"u"<typeof Uint8Array?a:new Uint8Array(a)},d.Array="u">typeof Uint8Array?Uint8Array:Array,d.Long=d.global.dcodeIO&&d.global.dcodeIO.Long||d.global.Long||d.inquire("long"),d.key2Re=/^true|false|0|1$/,d.key32Re=/^-?(?:0|[1-9][0-9]*)$/,d.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,d.longToHash=function(a){return a?d.LongBits.from(a).toHash():d.LongBits.zeroHash},d.longFromHash=function(a,b){var c=d.LongBits.fromHash(a);return d.Long?d.Long.fromBits(c.lo,c.hi,b):c.toNumber(!!b)},d.merge=e,d.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},d.newError=f,d.ProtocolError=f("ProtocolError"),d.oneOfGetter=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=1;return function(){for(var a=Object.keys(this),c=a.length-1;c>-1;--c)if(1===b[a[c]]&&void 0!==this[a[c]]&&null!==this[a[c]])return a[c]}},d.oneOfSetter=function(a){return function(b){for(var c=0;c<a.length;++c)a[c]!==b&&delete this[a[c]]}},d.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},d._configure=function(){var a=d.Buffer;if(!a){d._Buffer_from=d._Buffer_allocUnsafe=null;return}d._Buffer_from=a.from!==Uint8Array.from&&a.from||function(b,c){return new a(b,c)},d._Buffer_allocUnsafe=a.allocUnsafe||function(b){return new a(b)}}},23318,(a,b,c)=>{"use strict";b.exports={}},98873,(a,b,c)=>{"use strict";function d(a,b){"string"==typeof a&&(b=a,a=void 0);var c=[];function e(a){if("string"!=typeof a){var b=f();if(d.verbose&&console.log("codegen: "+b),b="return "+b,a){for(var g=Object.keys(a),h=Array(g.length+1),i=Array(g.length),j=0;j<g.length;)h[j]=g[j],i[j]=a[g[j++]];return h[j]=b,Function.apply(null,h).apply(null,i)}return Function(b)()}for(var k=Array(arguments.length-1),l=0;l<k.length;)k[l]=arguments[++l];if(l=0,a=a.replace(/%([%dfijs])/g,function(a,b){var c=k[l++];switch(b){case"d":case"f":return String(Number(c));case"i":return String(Math.floor(c));case"j":return JSON.stringify(c);case"s":return String(c)}return"%"}),l!==k.length)throw Error("parameter count mismatch");return c.push(a),e}function f(d){return"function "+(d||b||"")+"("+(a&&a.join(",")||"")+"){\n  "+c.join("\n  ")+"\n}"}return e.toString=f,e}b.exports=d,d.verbose=!1},6566,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(96146),e=a.r(68754)("fs");function f(a,b,c){return("function"==typeof b?(c=b,b={}):b||(b={}),c)?!b.xhr&&e&&e.readFile?e.readFile(a,function(d,e){return d&&"u">typeof XMLHttpRequest?f.xhr(a,b,c):d?c(d):c(null,b.binary?e:e.toString("utf8"))}):f.xhr(a,b,c):d(f,this,a,b)}f.xhr=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(0!==d.status&&200!==d.status)return c(Error("status "+d.status));if(b.binary){var a=d.response;if(!a){a=[];for(var e=0;e<d.responseText.length;++e)a.push(255&d.responseText.charCodeAt(e))}return c(null,"u">typeof Uint8Array?new Uint8Array(a):a)}return c(null,d.responseText)}},b.binary&&("overrideMimeType"in d&&d.overrideMimeType("text/plain; charset=x-user-defined"),d.responseType="arraybuffer"),d.open("GET",a),d.send()}},7176,(a,b,c)=>{"use strict";var d=c,e=d.isAbsolute=function(a){return/^(?:\/|\w+:)/.test(a)},f=d.normalize=function(a){var b=(a=a.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),c=e(a),d="";c&&(d=b.shift()+"/");for(var f=0;f<b.length;)".."===b[f]?f>0&&".."!==b[f-1]?b.splice(--f,2):c?b.splice(f,1):++f:"."===b[f]?b.splice(f,1):++f;return d+b.join("/")};d.resolve=function(a,b,c){return(c||(b=f(b)),e(b))?b:(c||(a=f(a)),(a=a.replace(/(?:\/|^)[^/]+$/,"")).length?f(a+"/"+b):b)}},42226,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(77601);((l.prototype=Object.create(g.prototype)).constructor=l).className="Namespace";var h=a.r(52093),i=a.r(13793),j=a.r(13175);function k(a,b){if(a&&a.length){for(var c={},d=0;d<a.length;++d)c[a[d].name]=a[d].toJSON(b);return c}}function l(a,b){g.call(this,a,b),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function m(a){a._nestedArray=null,a._lookupCache={};for(var b=a;b=b.parent;)b._lookupCache={};return a}l.fromJSON=function(a,b){return new l(a,b.options).addJSON(b.nested)},l.arrayToJSON=k,l.isReservedId=function(a,b){if(a){for(var c=0;c<a.length;++c)if("string"!=typeof a[c]&&a[c][0]<=b&&a[c][1]>b)return!0}return!1},l.isReservedName=function(a,b){if(a){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=i.toArray(this.nested))}}),l.prototype.toJSON=function(a){return i.toObject(["options",this.options,"nested",k(this.nestedArray,a)])},l.prototype.addJSON=function(a){var b=this;if(a)for(var c,g=Object.keys(a),i=0;i<g.length;++i)c=a[g[i]],b.add((void 0!==c.fields?d.fromJSON:void 0!==c.values?f.fromJSON:void 0!==c.methods?e.fromJSON:void 0!==c.id?h.fromJSON:l.fromJSON)(g[i],c));return this},l.prototype.get=function(a){return this.nested&&this.nested[a]||null},l.prototype.getEnum=function(a){if(this.nested&&this.nested[a]instanceof f)return this.nested[a].values;throw Error("no such enum: "+a)},l.prototype.add=function(a){if(!(a instanceof h&&void 0!==a.extend||a instanceof d||a instanceof j||a instanceof f||a instanceof e||a instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var b=this.get(a.name);if(b)if(b instanceof l&&a instanceof l&&!(b instanceof d||b instanceof e)){for(var c=b.nestedArray,g=0;g<c.length;++g)a.add(c[g]);this.remove(b),this.nested||(this.nested={}),a.setOptions(b.options,!0)}else throw Error("duplicate name '"+a.name+"' in "+this)}else this.nested={};this.nested[a.name]=a,this instanceof d||this instanceof e||this instanceof f||this instanceof h||a._edition||(a._edition=a._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var i=this;i=i.parent;)i._needsRecursiveFeatureResolution=!0,i._needsRecursiveResolve=!0;return a.onAdd(this),m(this)},l.prototype.remove=function(a){if(!(a instanceof g))throw TypeError("object must be a ReflectionObject");if(a.parent!==this)throw Error(a+" is not a member of "+this);return delete this.nested[a.name],Object.keys(this.nested).length||(this.nested=void 0),a.onRemove(this),m(this)},l.prototype.define=function(a,b){if(i.isString(a))a=a.split(".");else if(!Array.isArray(a))throw TypeError("illegal path");if(a&&a.length&&""===a[0])throw Error("path must be relative");for(var c=this;a.length>0;){var d=a.shift();if(c.nested&&c.nested[d]){if(!((c=c.nested[d])instanceof l))throw Error("path conflicts with non-namespace objects")}else c.add(c=new l(d))}return b&&c.addJSON(b),c},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var a=this.nestedArray,b=0;for(this.resolve();b<a.length;)a[b]instanceof l?a[b++].resolveAll():a[b++].resolve();return this._needsRecursiveResolve=!1,this},l.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,a=this._edition||a,g.prototype._resolveFeaturesRecursive.call(this,a),this.nestedArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},l.prototype.lookup=function(a,b,c){if("boolean"==typeof b?(c=b,b=void 0):b&&!Array.isArray(b)&&(b=[b]),i.isString(a)&&a.length){if("."===a)return this.root;a=a.split(".")}else if(!a.length)return this;var d=a.join(".");if(""===a[0])return this.root.lookup(a.slice(1),b);var e=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+d];if(e&&(!b||b.indexOf(e.constructor)>-1)||(e=this._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;if(c)return null;for(var f=this;f.parent;){if((e=f.parent._lookupImpl(a,d))&&(!b||b.indexOf(e.constructor)>-1))return e;f=f.parent}return null},l.prototype._lookupImpl=function(a,b){if(Object.prototype.hasOwnProperty.call(this._lookupCache,b))return this._lookupCache[b];var c=this.get(a[0]),d=null;if(c)1===a.length?d=c:c instanceof l&&(a=a.slice(1),d=c._lookupImpl(a,a.join(".")));else for(var e=0;e<this.nestedArray.length;++e)this._nestedArray[e]instanceof l&&(c=this._nestedArray[e]._lookupImpl(a,b))&&(d=c);return this._lookupCache[b]=d,d},l.prototype.lookupType=function(a){var b=this.lookup(a,[d]);if(!b)throw Error("no such type: "+a);return b},l.prototype.lookupEnum=function(a){var b=this.lookup(a,[f]);if(!b)throw Error("no such Enum '"+a+"' in "+this);return b},l.prototype.lookupTypeOrEnum=function(a){var b=this.lookup(a,[d,f]);if(!b)throw Error("no such Type or Enum '"+a+"' in "+this);return b},l.prototype.lookupService=function(a){var b=this.lookup(a,[e]);if(!b)throw Error("no such Service '"+a+"' in "+this);return b},l._configure=function(a,b,c){d=a,e=b,f=c}},14325,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(52093);((g.prototype=Object.create(d.prototype)).constructor=g).className="MapField";var e=a.r(73362),f=a.r(13793);function g(a,b,c,e,g,h){if(d.call(this,a,b,e,void 0,void 0,g,h),!f.isString(c))throw TypeError("keyType must be a string");this.keyType=c,this.resolvedKeyType=null,this.map=!0}g.fromJSON=function(a,b){return new g(a,b.id,b.keyType,b.type,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},g.prototype.resolve=function(){if(this.resolved)return this;if(void 0===e.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return d.prototype.resolve.call(this)},g.d=function(a,b,c){return"function"==typeof c?c=f.decorateType(c).name:c&&"object"==typeof c&&(c=f.decorateEnum(c).name),function(d,e){f.decorateType(d.constructor).add(new g(e,a,b,c))}}},36654,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(77601);((f.prototype=Object.create(d.prototype)).constructor=f).className="Method";var e=a.r(13793);function f(a,b,c,f,g,h,i,j,k){if(e.isObject(g)?(i=g,g=h=void 0):e.isObject(h)&&(i=h,h=void 0),!(void 0===b||e.isString(b)))throw TypeError("type must be a string");if(!e.isString(c))throw TypeError("requestType must be a string");if(!e.isString(f))throw TypeError("responseType must be a string");d.call(this,a,i),this.type=b||"rpc",this.requestType=c,this.requestStream=!!g||void 0,this.responseType=f,this.responseStream=!!h||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=j,this.parsedOptions=k}f.fromJSON=function(a,b){return new f(a,b.type,b.requestType,b.responseType,b.requestStream,b.responseStream,b.options,b.comment,b.parsedOptions)},f.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return e.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",b?this.comment:void 0,"parsedOptions",this.parsedOptions])},f.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),d.prototype.resolve.call(this))}},61122,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(85457);function e(a,b,c){if("function"!=typeof a)throw TypeError("rpcImpl must be a function");d.EventEmitter.call(this),this.rpcImpl=a,this.requestDelimited=!!b,this.responseDelimited=!!c}(e.prototype=Object.create(d.EventEmitter.prototype)).constructor=e,e.prototype.rpcCall=function a(b,c,e,f,g){if(!f)throw TypeError("request must be specified");var h=this;if(!g)return d.asPromise(a,h,b,c,e,f);if(!h.rpcImpl)return void setTimeout(function(){g(Error("already ended"))},0);try{return h.rpcImpl(b,c[h.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(a,c){if(a)return h.emit("error",a,b),g(a);if(null===c)return void h.end(!0);if(!(c instanceof e))try{c=e[h.responseDelimited?"decodeDelimited":"decode"](c)}catch(a){return h.emit("error",a,b),g(a)}return h.emit("data",c,b),g(null,c)})}catch(a){h.emit("error",a,b),setTimeout(function(){g(a)},0);return}},e.prototype.end=function(a){return this.rpcImpl&&(a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},34207,(a,b,c)=>{"use strict";c.Service=a.r(61122)},26819,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(42226);((h.prototype=Object.create(d.prototype)).constructor=h).className="Service";var e=a.r(36654),f=a.r(13793),g=a.r(34207);function h(a,b){d.call(this,a,b),this.methods={},this._methodsArray=null}function i(a){return a._methodsArray=null,a}h.fromJSON=function(a,b){var c=new h(a,b.options);if(b.methods)for(var d=Object.keys(b.methods),f=0;f<d.length;++f)c.add(e.fromJSON(d[f],b.methods[d[f]]));return b.nested&&c.addJSON(b.nested),b.edition&&(c._edition=b.edition),c.comment=b.comment,c._defaultEdition="proto3",c},h.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"methods",d.arrayToJSON(this.methodsArray,a)||{},"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},Object.defineProperty(h.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=f.toArray(this.methods))}}),h.prototype.get=function(a){return this.methods[a]||d.prototype.get.call(this,a)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolve.call(this);for(var a=this.methodsArray,b=0;b<a.length;++b)a[b].resolve();return this},h.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.methodsArray.forEach(b=>{b._resolveFeaturesRecursive(a)})),this},h.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);return a instanceof e?(this.methods[a.name]=a,a.parent=this,i(this)):d.prototype.add.call(this,a)},h.prototype.remove=function(a){if(a instanceof e){if(this.methods[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.methods[a.name],a.parent=null,i(this)}return d.prototype.remove.call(this,a)},h.prototype.create=function(a,b,c){for(var d,e=new g.Service(a,b,c),h=0;h<this.methodsArray.length;++h){var i=f.lcFirst((d=this._methodsArray[h]).resolve().name).replace(/[^$\w_]/g,"");e[i]=f.codegen(["r","c"],f.isReserved(i)?i+"_":i)("return this.rpcCall(m,q,s,r,c)")({m:d,q:d.resolvedRequestType.ctor,s:d.resolvedResponseType.ctor})}return e}},83884,(a,b,c)=>{"use strict";b.exports=e;var d=a.r(85457);function e(a){if(a)for(var b=Object.keys(a),c=0;c<b.length;++c)this[b[c]]=a[b[c]]}e.create=function(a){return this.$type.create(a)},e.encode=function(a,b){return this.$type.encode(a,b)},e.encodeDelimited=function(a,b){return this.$type.encodeDelimited(a,b)},e.decode=function(a){return this.$type.decode(a)},e.decodeDelimited=function(a){return this.$type.decodeDelimited(a)},e.verify=function(a){return this.$type.verify(a)},e.fromObject=function(a){return this.$type.fromObject(a)},e.toObject=function(a,b){return this.$type.toObject(a,b)},e.prototype.toJSON=function(){return this.$type.toObject(this,d.toJSONOptions)}},72999,(a,b,c)=>{"use strict";b.exports=i;var d,e=a.r(85457),f=e.LongBits,g=e.utf8;function h(a,b){return RangeError("index out of range: "+a.pos+" + "+(b||1)+" > "+a.len)}function i(a){this.buf=a,this.pos=0,this.len=a.length}var j="u">typeof Uint8Array?function(a){if(a instanceof Uint8Array||Array.isArray(a))return new i(a);throw Error("illegal buffer")}:function(a){if(Array.isArray(a))return new i(a);throw Error("illegal buffer")},k=function(){return e.Buffer?function(a){return(i.create=function(a){return e.Buffer.isBuffer(a)?new d(a):j(a)})(a)}:j};function l(){var a=new f(0,0),b=0;if(this.len-this.pos>4){for(;b<4;++b)if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a;if(a.lo=(a.lo|(127&this.buf[this.pos])<<28)>>>0,a.hi=(a.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return a;b=0}else{for(;b<3;++b){if(this.pos>=this.len)throw h(this);if(a.lo=(a.lo|(127&this.buf[this.pos])<<7*b)>>>0,this.buf[this.pos++]<128)return a}return a.lo=(a.lo|(127&this.buf[this.pos++])<<7*b)>>>0,a}if(this.len-this.pos>4){for(;b<5;++b)if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}else for(;b<5;++b){if(this.pos>=this.len)throw h(this);if(a.hi=(a.hi|(127&this.buf[this.pos])<<7*b+3)>>>0,this.buf[this.pos++]<128)return a}throw Error("invalid varint encoding")}function m(a,b){return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0}function n(){if(this.pos+8>this.len)throw h(this,8);return new f(m(this.buf,this.pos+=4),m(this.buf,this.pos+=4))}i.create=k(),i.prototype._slice=e.Array.prototype.subarray||e.Array.prototype.slice,i.prototype.uint32=function(){var a=0xffffffff;return function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return a;if((this.pos+=5)>this.len)throw this.pos=this.len,h(this,10);return a}}(),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var a=this.uint32();return a>>>1^-(1&a)},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw h(this,4);return m(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw h(this,4);return 0|m(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw h(this,4);var a=e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,a},i.prototype.double=function(){if(this.pos+8>this.len)throw h(this,4);var a=e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,a},i.prototype.bytes=function(){var a=this.uint32(),b=this.pos,c=this.pos+a;if(c>this.len)throw h(this,a);if(this.pos+=a,Array.isArray(this.buf))return this.buf.slice(b,c);if(b===c){var d=e.Buffer;return d?d.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,b,c)},i.prototype.string=function(){var a=this.bytes();return g.read(a,0,a.length)},i.prototype.skip=function(a){if("number"==typeof a){if(this.pos+a>this.len)throw h(this,a);this.pos+=a}else do if(this.pos>=this.len)throw h(this);while(128&this.buf[this.pos++])return this},i.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(a=7&this.uint32());)this.skipType(a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos)}return this},i._configure=function(a){d=a,i.create=k(),d._configure();var b=e.Long?"toLong":"toNumber";e.merge(i.prototype,{int64:function(){return l.call(this)[b](!1)},uint64:function(){return l.call(this)[b](!0)},sint64:function(){return l.call(this).zzDecode()[b](!1)},fixed64:function(){return n.call(this)[b](!0)},sfixed64:function(){return n.call(this)[b](!1)}})}},93548,(a,b,c)=>{"use strict";b.exports=l;var d,e=a.r(85457),f=e.LongBits,g=e.base64,h=e.utf8;function i(a,b,c){this.fn=a,this.len=b,this.next=void 0,this.val=c}function j(){}function k(a){this.head=a.head,this.tail=a.tail,this.len=a.len,this.next=a.states}function l(){this.len=0,this.head=new i(j,0,0),this.tail=this.head,this.states=null}var m=function(){return e.Buffer?function(){return(l.create=function(){return new d})()}:function(){return new l}};function n(a,b,c){b[c]=255&a}function o(a,b,c){for(;a>127;)b[c++]=127&a|128,a>>>=7;b[c]=a}function p(a,b){this.len=a,this.next=void 0,this.val=b}function q(a,b,c){for(;a.hi;)b[c++]=127&a.lo|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;a.lo>127;)b[c++]=127&a.lo|128,a.lo=a.lo>>>7;b[c++]=a.lo}function r(a,b,c){b[c]=255&a,b[c+1]=a>>>8&255,b[c+2]=a>>>16&255,b[c+3]=a>>>24}l.create=m(),l.alloc=function(a){return new e.Array(a)},e.Array!==Array&&(l.alloc=e.pool(l.alloc,e.Array.prototype.subarray)),l.prototype._push=function(a,b,c){return this.tail=this.tail.next=new i(a,b,c),this.len+=b,this},p.prototype=Object.create(i.prototype),p.prototype.fn=o,l.prototype.uint32=function(a){return this.len+=(this.tail=this.tail.next=new p((a>>>=0)<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:5,a)).len,this},l.prototype.int32=function(a){return a<0?this._push(q,10,f.fromNumber(a)):this.uint32(a)},l.prototype.sint32=function(a){return this.uint32((a<<1^a>>31)>>>0)},l.prototype.uint64=function(a){var b=f.from(a);return this._push(q,b.length(),b)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(a){var b=f.from(a).zzEncode();return this._push(q,b.length(),b)},l.prototype.bool=function(a){return this._push(n,1,+!!a)},l.prototype.fixed32=function(a){return this._push(r,4,a>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(a){var b=f.from(a);return this._push(r,4,b.lo)._push(r,4,b.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(a){return this._push(e.float.writeFloatLE,4,a)},l.prototype.double=function(a){return this._push(e.float.writeDoubleLE,8,a)};var s=e.Array.prototype.set?function(a,b,c){b.set(a,c)}:function(a,b,c){for(var d=0;d<a.length;++d)b[c+d]=a[d]};l.prototype.bytes=function(a){var b=a.length>>>0;if(!b)return this._push(n,1,0);if(e.isString(a)){var c=l.alloc(b=g.length(a));g.decode(a,c,0),a=c}return this.uint32(b)._push(s,b,a)},l.prototype.string=function(a){var b=h.length(a);return b?this.uint32(b)._push(h.write,b,a):this._push(n,1,0)},l.prototype.fork=function(){return this.states=new k(this),this.head=this.tail=new i(j,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new i(j,0,0),this.len=0),this},l.prototype.ldelim=function(){var a=this.head,b=this.tail,c=this.len;return this.reset().uint32(c),c&&(this.tail.next=a.next,this.tail=b,this.len+=c),this},l.prototype.finish=function(){for(var a=this.head.next,b=this.constructor.alloc(this.len),c=0;a;)a.fn(a.val,b,c),c+=a.len,a=a.next;return b},l._configure=function(a){d=a,l.create=m(),d._configure()}},19419,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(16575),e=a.r(73362),f=a.r(13793);function g(a){return"missing required '"+a.name+"'"}function h(a){for(var b=f.codegen(["r","l","e"],a.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(a.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),c=0;c<a.fieldsArray.length;++c){var h=a._fieldsArray[c].resolve(),i=h.resolvedType instanceof d?"int32":h.type,j="m"+f.safeProp(h.name);b("case %i: {",h.id),h.map?(b("if(%s===util.emptyObject)",j)("%s={}",j)("var c2 = r.uint32()+r.pos"),void 0!==e.defaults[h.keyType]?b("k=%j",e.defaults[h.keyType]):b("k=null"),void 0!==e.defaults[i]?b("value=%j",e.defaults[i]):b("value=null"),b("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",h.keyType)("case 2:"),void 0===e.basic[i]?b("value=types[%i].decode(r,r.uint32())",c):b("value=r.%s()",i),b("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==e.long[h.keyType]?b('%s[typeof k==="object"?util.longToHash(k):k]=value',j):b("%s[k]=value",j)):h.repeated?(b("if(!(%s&&%s.length))",j,j)("%s=[]",j),void 0!==e.packed[i]&&b("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",j,i)("}else"),void 0===e.basic[i]?b(h.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",j,c):b("%s.push(r.%s())",j,i)):void 0===e.basic[i]?b(h.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",j,c):b("%s=r.%s()",j,i),b("break")("}")}for(b("default:")("r.skipType(t&7)")("break")("}")("}"),c=0;c<a._fieldsArray.length;++c){var k=a._fieldsArray[c];k.required&&b("if(!m.hasOwnProperty(%j))",k.name)("throw util.ProtocolError(%j,{instance:m})",g(k))}return b("return m")}},13820,(a,b,c)=>{"use strict";b.exports=i;var d=a.r(16575),e=a.r(13793);function f(a,b){return a.name+": "+b+(a.repeated&&"array"!==b?"[]":a.map&&"object"!==b?"{k:"+a.keyType+"}":"")+" expected"}function g(a,b,c,e){if(b.resolvedType)if(b.resolvedType instanceof d){a("switch(%s){",e)("default:")("return%j",f(b,"enum value"));for(var g=Object.keys(b.resolvedType.values),h=0;h<g.length;++h)a("case %i:",b.resolvedType.values[g[h]]);a("break")("}")}else a("{")("var e=types[%i].verify(%s);",c,e)("if(e)")("return%j+e",b.name+".")("}");else switch(b.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.isInteger(%s))",e)("return%j",f(b,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",e,e,e,e)("return%j",f(b,"integer|Long"));break;case"float":case"double":a('if(typeof %s!=="number")',e)("return%j",f(b,"number"));break;case"bool":a('if(typeof %s!=="boolean")',e)("return%j",f(b,"boolean"));break;case"string":a("if(!util.isString(%s))",e)("return%j",f(b,"string"));break;case"bytes":a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',e,e,e)("return%j",f(b,"buffer"))}return a}function h(a,b,c){switch(b.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":a("if(!util.key32Re.test(%s))",c)("return%j",f(b,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":a("if(!util.key64Re.test(%s))",c)("return%j",f(b,"integer|Long key"));break;case"bool":a("if(!util.key2Re.test(%s))",c)("return%j",f(b,"boolean key"))}return a}function i(a){var b=e.codegen(["m"],a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),c=a.oneofsArray,d={};c.length&&b("var p={}");for(var i=0;i<a.fieldsArray.length;++i){var j=a._fieldsArray[i].resolve(),k="m"+e.safeProp(j.name);if(j.optional&&b("if(%s!=null&&m.hasOwnProperty(%j)){",k,j.name),j.map)b("if(!util.isObject(%s))",k)("return%j",f(j,"object"))("var k=Object.keys(%s)",k)("for(var i=0;i<k.length;++i){"),h(b,j,"k[i]"),g(b,j,i,k+"[k[i]]")("}");else if(j.repeated)b("if(!Array.isArray(%s))",k)("return%j",f(j,"array"))("for(var i=0;i<%s.length;++i){",k),g(b,j,i,k+"[i]")("}");else{if(j.partOf){var l=e.safeProp(j.partOf.name);1===d[j.partOf.name]&&b("if(p%s===1)",l)("return%j",j.partOf.name+": multiple values"),d[j.partOf.name]=1,b("p%s=1",l)}g(b,j,i,k)}j.optional&&b("}")}return b("return null")}},50233,(a,b,c)=>{"use strict";var d=c,e=a.r(16575),f=a.r(13793);function g(a,b,c,d){var f=!1;if(b.resolvedType)if(b.resolvedType instanceof e){a("switch(d%s){",d);for(var g=b.resolvedType.values,h=Object.keys(g),i=0;i<h.length;++i)g[h[i]]!==b.typeDefault||f||(a("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',d,d,d),b.repeated||a("break"),f=!0),a("case%j:",h[i])("case %i:",g[h[i]])("m%s=%j",d,g[h[i]])("break");a("}")}else a('if(typeof d%s!=="object")',d)("throw TypeError(%j)",b.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",d,c,d);else{var j=!1;switch(b.type){case"double":case"float":a("m%s=Number(d%s)",d,d);break;case"uint32":case"fixed32":a("m%s=d%s>>>0",d,d);break;case"int32":case"sint32":case"sfixed32":a("m%s=d%s|0",d,d);break;case"uint64":j=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",d,d,j)('else if(typeof d%s==="string")',d)("m%s=parseInt(d%s,10)",d,d)('else if(typeof d%s==="number")',d)("m%s=d%s",d,d)('else if(typeof d%s==="object")',d)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",d,d,d,j?"true":"");break;case"bytes":a('if(typeof d%s==="string")',d)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",d,d,d)("else if(d%s.length >= 0)",d)("m%s=d%s",d,d);break;case"string":a("m%s=String(d%s)",d,d);break;case"bool":a("m%s=Boolean(d%s)",d,d)}}return a}function h(a,b,c,d){if(b.resolvedType)b.resolvedType instanceof e?a("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",d,c,d,d,c,d,d):a("d%s=types[%i].toObject(m%s,o)",d,c,d);else{var f=!1;switch(b.type){case"double":case"float":a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",d,d,d,d);break;case"uint64":f=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":a('if(typeof m%s==="number")',d)("d%s=o.longs===String?String(m%s):m%s",d,d,d)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",d,d,d,d,f?"true":"",d);break;case"bytes":a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",d,d,d,d,d);break;default:a("d%s=m%s",d,d)}}return a}d.fromObject=function(a){var b=a.fieldsArray,c=f.codegen(["d"],a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!b.length)return c("return new this.ctor");c("var m=new this.ctor");for(var d=0;d<b.length;++d){var h=b[d].resolve(),i=f.safeProp(h.name);h.map?(c("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",h.fullName+": object expected")("m%s={}",i)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),g(c,h,d,i+"[ks[i]]")("}")("}")):h.repeated?(c("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",h.fullName+": array expected")("m%s=[]",i)("for(var i=0;i<d%s.length;++i){",i),g(c,h,d,i+"[i]")("}")("}")):(h.resolvedType instanceof e||c("if(d%s!=null){",i),g(c,h,d,i),h.resolvedType instanceof e||c("}"))}return c("return m")},d.toObject=function(a){var b=a.fieldsArray.slice().sort(f.compareFieldsById);if(!b.length)return f.codegen()("return {}");for(var c=f.codegen(["m","o"],a.name+"$toObject")("if(!o)")("o={}")("var d={}"),d=[],g=[],i=[],j=0;j<b.length;++j)b[j].partOf||(b[j].resolve().repeated?d:b[j].map?g:i).push(b[j]);if(d.length){for(c("if(o.arrays||o.defaults){"),j=0;j<d.length;++j)c("d%s=[]",f.safeProp(d[j].name));c("}")}if(g.length){for(c("if(o.objects||o.defaults){"),j=0;j<g.length;++j)c("d%s={}",f.safeProp(g[j].name));c("}")}if(i.length){for(c("if(o.defaults){"),j=0;j<i.length;++j){var k=i[j],l=f.safeProp(k.name);if(k.resolvedType instanceof e)c("d%s=o.enums===String?%j:%j",l,k.resolvedType.valuesById[k.typeDefault],k.typeDefault);else if(k.long)c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",k.typeDefault.low,k.typeDefault.high,k.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,k.typeDefault.toString(),k.typeDefault.toNumber());else if(k.bytes){var m="["+Array.prototype.slice.call(k.typeDefault).join(",")+"]";c("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,k.typeDefault))("else{")("d%s=%s",l,m)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else c("d%s=%j",l,k.typeDefault)}c("}")}var n=!1;for(j=0;j<b.length;++j){var k=b[j],o=a._fieldsArray.indexOf(k),l=f.safeProp(k.name);k.map?(n||(n=!0,c("var ks2")),c("if(m%s&&(ks2=Object.keys(m%s)).length){",l,l)("d%s={}",l)("for(var j=0;j<ks2.length;++j){"),h(c,k,o,l+"[ks2[j]]")("}")):k.repeated?(c("if(m%s&&m%s.length){",l,l)("d%s=[]",l)("for(var j=0;j<m%s.length;++j){",l),h(c,k,o,l+"[j]")("}")):(c("if(m%s!=null&&m.hasOwnProperty(%j)){",l,k.name),h(c,k,o,l),k.partOf&&c("if(o.oneofs)")("d%s=%j",f.safeProp(k.partOf.name),k.name)),c("}")}return c("return d")}},82170,(a,b,c)=>{"use strict";var d=c,e=a.r(83884);d[".google.protobuf.Any"]={fromObject:function(a){if(a&&a["@type"]){var b=a["@type"].substring(a["@type"].lastIndexOf("/")+1),c=this.lookup(b);if(c){var d="."===a["@type"].charAt(0)?a["@type"].slice(1):a["@type"];return -1===d.indexOf("/")&&(d="/"+d),this.create({type_url:d,value:c.encode(c.fromObject(a)).finish()})}}return this.fromObject(a)},toObject:function(a,b){var c="type.googleapis.com/",d="",f="";if(b&&b.json&&a.type_url&&a.value){f=a.type_url.substring(a.type_url.lastIndexOf("/")+1),d=a.type_url.substring(0,a.type_url.lastIndexOf("/")+1);var g=this.lookup(f);g&&(a=g.decode(a.value))}if(!(a instanceof this.ctor)&&a instanceof e){var h=a.$type.toObject(a,b),i="."===a.$type.fullName[0]?a.$type.fullName.slice(1):a.$type.fullName;return""===d&&(d=c),f=d+i,h["@type"]=f,h}return this.toObject(a,b)}}},7190,(a,b,c)=>{"use strict";b.exports=s;var d=a.r(42226);((s.prototype=Object.create(d.prototype)).constructor=s).className="Type";var e=a.r(16575),f=a.r(13175),g=a.r(52093),h=a.r(14325),i=a.r(26819),j=a.r(83884),k=a.r(72999),l=a.r(93548),m=a.r(13793),n=a.r(19529),o=a.r(19419),p=a.r(13820),q=a.r(50233),r=a.r(82170);function s(a,b){d.call(this,a,b),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function t(a){return a._fieldsById=a._fieldsArray=a._oneofsArray=null,delete a.encode,delete a.decode,delete a.verify,a}Object.defineProperties(s.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var a=Object.keys(this.fields),b=0;b<a.length;++b){var c=this.fields[a[b]],d=c.id;if(this._fieldsById[d])throw Error("duplicate id "+d+" in "+this);this._fieldsById[d]=c}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=m.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=m.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=s.generateConstructor(this)())},set:function(a){var b=a.prototype;b instanceof j||((a.prototype=new j).constructor=a,m.merge(a.prototype,b)),a.$type=a.prototype.$type=this,m.merge(a,j,!0),this._ctor=a;for(var c=0;c<this.fieldsArray.length;++c)this._fieldsArray[c].resolve();var d={};for(c=0;c<this.oneofsArray.length;++c)d[this._oneofsArray[c].resolve().name]={get:m.oneOfGetter(this._oneofsArray[c].oneof),set:m.oneOfSetter(this._oneofsArray[c].oneof)};c&&Object.defineProperties(a.prototype,d)}}}),s.generateConstructor=function(a){for(var b,c=m.codegen(["p"],a.name),d=0;d<a.fieldsArray.length;++d)(b=a._fieldsArray[d]).map?c("this%s={}",m.safeProp(b.name)):b.repeated&&c("this%s=[]",m.safeProp(b.name));return c("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},s.fromJSON=function(a,b){var c=new s(a,b.options);c.extensions=b.extensions,c.reserved=b.reserved;for(var j=Object.keys(b.fields),k=0;k<j.length;++k)c.add((void 0!==b.fields[j[k]].keyType?h.fromJSON:g.fromJSON)(j[k],b.fields[j[k]]));if(b.oneofs)for(j=Object.keys(b.oneofs),k=0;k<j.length;++k)c.add(f.fromJSON(j[k],b.oneofs[j[k]]));if(b.nested)for(j=Object.keys(b.nested),k=0;k<j.length;++k){var l=b.nested[j[k]];c.add((void 0!==l.id?g.fromJSON:void 0!==l.fields?s.fromJSON:void 0!==l.values?e.fromJSON:void 0!==l.methods?i.fromJSON:d.fromJSON)(j[k],l))}return b.extensions&&b.extensions.length&&(c.extensions=b.extensions),b.reserved&&b.reserved.length&&(c.reserved=b.reserved),b.group&&(c.group=!0),b.comment&&(c.comment=b.comment),b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},s.prototype.toJSON=function(a){var b=d.prototype.toJSON.call(this,a),c=!!a&&!!a.keepComments;return m.toObject(["edition",this._editionToJSON(),"options",b&&b.options||void 0,"oneofs",d.arrayToJSON(this.oneofsArray,a),"fields",d.arrayToJSON(this.fieldsArray.filter(function(a){return!a.declaringField}),a)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",b&&b.nested||void 0,"comment",c?this.comment:void 0])},s.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;d.prototype.resolveAll.call(this);var a=this.oneofsArray;for(c=0;c<a.length;)a[c++].resolve();for(var b=this.fieldsArray,c=0;c<b.length;)b[c++].resolve();return this},s.prototype._resolveFeaturesRecursive=function(a){return this._needsRecursiveFeatureResolution&&(a=this._edition||a,d.prototype._resolveFeaturesRecursive.call(this,a),this.oneofsArray.forEach(b=>{b._resolveFeatures(a)}),this.fieldsArray.forEach(b=>{b._resolveFeatures(a)})),this},s.prototype.get=function(a){return this.fields[a]||this.oneofs&&this.oneofs[a]||this.nested&&this.nested[a]||null},s.prototype.add=function(a){if(this.get(a.name))throw Error("duplicate name '"+a.name+"' in "+this);if(a instanceof g&&void 0===a.extend){if(this._fieldsById?this._fieldsById[a.id]:this.fieldsById[a.id])throw Error("duplicate id "+a.id+" in "+this);if(this.isReservedId(a.id))throw Error("id "+a.id+" is reserved in "+this);if(this.isReservedName(a.name))throw Error("name '"+a.name+"' is reserved in "+this);return a.parent&&a.parent.remove(a),this.fields[a.name]=a,a.message=this,a.onAdd(this),t(this)}return a instanceof f?(this.oneofs||(this.oneofs={}),this.oneofs[a.name]=a,a.onAdd(this),t(this)):d.prototype.add.call(this,a)},s.prototype.remove=function(a){if(a instanceof g&&void 0===a.extend){if(!this.fields||this.fields[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.fields[a.name],a.parent=null,a.onRemove(this),t(this)}if(a instanceof f){if(!this.oneofs||this.oneofs[a.name]!==a)throw Error(a+" is not a member of "+this);return delete this.oneofs[a.name],a.parent=null,a.onRemove(this),t(this)}return d.prototype.remove.call(this,a)},s.prototype.isReservedId=function(a){return d.isReservedId(this.reserved,a)},s.prototype.isReservedName=function(a){return d.isReservedName(this.reserved,a)},s.prototype.create=function(a){return new this.ctor(a)},s.prototype.setup=function(){for(var a=this.fullName,b=[],c=0;c<this.fieldsArray.length;++c)b.push(this._fieldsArray[c].resolve().resolvedType);this.encode=n(this)({Writer:l,types:b,util:m}),this.decode=o(this)({Reader:k,types:b,util:m}),this.verify=p(this)({types:b,util:m}),this.fromObject=q.fromObject(this)({types:b,util:m}),this.toObject=q.toObject(this)({types:b,util:m});var d=r[a];if(d){var e=Object.create(this);e.fromObject=this.fromObject,this.fromObject=d.fromObject.bind(e),e.toObject=this.toObject,this.toObject=d.toObject.bind(e)}return this},s.prototype.encode=function(a,b){return this.setup().encode(a,b)},s.prototype.encodeDelimited=function(a,b){return this.encode(a,b&&b.len?b.fork():b).ldelim()},s.prototype.decode=function(a,b){return this.setup().decode(a,b)},s.prototype.decodeDelimited=function(a){return a instanceof k||(a=k.create(a)),this.decode(a,a.uint32())},s.prototype.verify=function(a){return this.setup().verify(a)},s.prototype.fromObject=function(a){return this.setup().fromObject(a)},s.prototype.toObject=function(a,b){return this.setup().toObject(a,b)},s.d=function(a){return function(b){m.decorateType(b,a)}}},67612,(a,b,c)=>{"use strict";b.exports=l;var d,e,f,g=a.r(42226);((l.prototype=Object.create(g.prototype)).constructor=l).className="Root";var h=a.r(52093),i=a.r(16575),j=a.r(13175),k=a.r(13793);function l(a){g.call(this,"",a),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function m(){}l.fromJSON=function(a,b){return b||(b=new l),a.options&&b.setOptions(a.options),b.addJSON(a.nested).resolveAll()},l.prototype.resolvePath=k.path.resolve,l.prototype.fetch=k.fetch,l.prototype.load=function a(b,c,d){"function"==typeof c&&(d=c,c=void 0);var g=this;if(!d)return k.asPromise(a,g,b,c);var h=d===m;function i(a,b){if(d){if(h)throw a;b&&b.resolveAll();var c=d;d=null,c(a,b)}}function j(a){var b=a.lastIndexOf("google/protobuf/");if(b>-1){var c=a.substring(b);if(c in f)return c}return null}function l(a,b){try{if(k.isString(b)&&"{"===b.charAt(0)&&(b=JSON.parse(b)),k.isString(b)){e.filename=a;var d,f=e(b,g,c),l=0;if(f.imports)for(;l<f.imports.length;++l)(d=j(f.imports[l])||g.resolvePath(a,f.imports[l]))&&n(d);if(f.weakImports)for(l=0;l<f.weakImports.length;++l)(d=j(f.weakImports[l])||g.resolvePath(a,f.weakImports[l]))&&n(d,!0)}else g.setOptions(b.options).addJSON(b.nested)}catch(a){i(a)}h||o||i(null,g)}function n(a,b){if(a=j(a)||a,!(g.files.indexOf(a)>-1)){if(g.files.push(a),a in f)return void(h?l(a,f[a]):(++o,setTimeout(function(){--o,l(a,f[a])})));if(h){var c;try{c=k.fs.readFileSync(a).toString("utf8")}catch(a){b||i(a);return}l(a,c)}else++o,g.fetch(a,function(c,e){if(--o,d){if(c)return void(b?o||i(null,g):i(c));l(a,e)}})}}var o=0;k.isString(b)&&(b=[b]);for(var p,q=0;q<b.length;++q)(p=g.resolvePath("",b[q]))&&n(p);return h?g.resolveAll():o||i(null,g),g},l.prototype.loadSync=function(a,b){if(!k.isNode)throw Error("not supported");return this.load(a,b,m)},l.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(a){return"'extend "+a.extend+"' in "+a.parent.fullName}).join(", "));return g.prototype.resolveAll.call(this)};var n=/^[A-Z]/;function o(a,b){var c=b.parent.lookup(b.extend);if(c){var d=new h(b.fullName,b.id,b.type,b.rule,void 0,b.options);return!!c.get(d.name)||(d.declaringField=b,b.extensionField=d,c.add(d),!0)}return!1}l.prototype._handleAdd=function(a){if(a instanceof h)void 0===a.extend||a.extensionField||o(this,a)||this.deferred.push(a);else if(a instanceof i)n.test(a.name)&&(a.parent[a.name]=a.values);else if(!(a instanceof j)){if(a instanceof d)for(var b=0;b<this.deferred.length;)o(this,this.deferred[b])?this.deferred.splice(b,1):++b;for(var c=0;c<a.nestedArray.length;++c)this._handleAdd(a._nestedArray[c]);n.test(a.name)&&(a.parent[a.name]=a)}(a instanceof d||a instanceof i||a instanceof h)&&(this._fullyQualifiedObjects[a.fullName]=a)},l.prototype._handleRemove=function(a){if(a instanceof h){if(void 0!==a.extend)if(a.extensionField)a.extensionField.parent.remove(a.extensionField),a.extensionField=null;else{var b=this.deferred.indexOf(a);b>-1&&this.deferred.splice(b,1)}}else if(a instanceof i)n.test(a.name)&&delete a.parent[a.name];else if(a instanceof g){for(var c=0;c<a.nestedArray.length;++c)this._handleRemove(a._nestedArray[c]);n.test(a.name)&&delete a.parent[a.name]}delete this._fullyQualifiedObjects[a.fullName]},l._configure=function(a,b,c){d=a,e=b,f=c}},13793,(a,b,c)=>{"use strict";var d,e,f=b.exports=a.r(85457),g=a.r(23318);f.codegen=a.r(98873),f.fetch=a.r(6566),f.path=a.r(7176),f.fs=f.inquire("fs"),f.toArray=function(a){if(a){for(var b=Object.keys(a),c=Array(b.length),d=0;d<b.length;)c[d]=a[b[d++]];return c}return[]},f.toObject=function(a){for(var b={},c=0;c<a.length;){var d=a[c++],e=a[c++];void 0!==e&&(b[d]=e)}return b};var h=/\\/g,i=/"/g;f.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},f.safeProp=function(a){return!/^[$\w_]+$/.test(a)||f.isReserved(a)?'["'+a.replace(h,"\\\\").replace(i,'\\"')+'"]':"."+a},f.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var j=/_([a-z])/g;f.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(j,function(a,b){return b.toUpperCase()})},f.compareFieldsById=function(a,b){return a.id-b.id},f.decorateType=function(b,c){if(b.$type)return c&&b.$type.name!==c&&(f.decorateRoot.remove(b.$type),b.$type.name=c,f.decorateRoot.add(b.$type)),b.$type;d||(d=a.r(7190));var e=new d(c||b.name);return f.decorateRoot.add(e),e.ctor=b,Object.defineProperty(b,"$type",{value:e,enumerable:!1}),Object.defineProperty(b.prototype,"$type",{value:e,enumerable:!1}),e};var k=0;f.decorateEnum=function(b){if(b.$type)return b.$type;e||(e=a.r(16575));var c=new e("Enum"+k++,b);return f.decorateRoot.add(c),Object.defineProperty(b,"$type",{value:c,enumerable:!1}),c},f.setProperty=function(a,b,c,d){function e(a,b,c){var f=b.shift();if("__proto__"===f||"prototype"===f)return a;if(b.length>0)a[f]=e(a[f]||{},b,c);else{var g=a[f];if(g&&d)return a;g&&(c=[].concat(g).concat(c)),a[f]=c}return a}if("object"!=typeof a)throw TypeError("dst must be an object");if(!b)throw TypeError("path must be specified");return e(a,b=b.split("."),c)},Object.defineProperty(f,"decorateRoot",{get:function(){return g.decorated||(g.decorated=new(a.r(67612)))}})},73362,(a,b,c)=>{"use strict";var d=c,e=a.r(13793),f=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function g(a,b){var c=0,d={};for(b|=0;c<a.length;)d[f[c+b]]=a[c++];return d}d.basic=g([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),d.defaults=g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),d.long=g([0,0,0,1,1],7),d.mapKey=g([0,0,0,5,5,0,0,0,1,1,0,2],2),d.packed=g([1,5,0,0,0,5,5,0,0,0,1,1,0])},52093,(a,b,c)=>{"use strict";b.exports=j;var d,e=a.r(77601);((j.prototype=Object.create(e.prototype)).constructor=j).className="Field";var f=a.r(16575),g=a.r(73362),h=a.r(13793),i=/^required|optional|repeated$/;function j(a,b,c,d,f,j,k){if(h.isObject(d)?(k=f,j=d,d=f=void 0):h.isObject(f)&&(k=j,j=f,f=void 0),e.call(this,a,j),!h.isInteger(b)||b<0)throw TypeError("id must be a non-negative integer");if(!h.isString(c))throw TypeError("type must be a string");if(void 0!==d&&!i.test(d=d.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==f&&!h.isString(f))throw TypeError("extend must be a string");"proto3_optional"===d&&(d="optional"),this.rule=d&&"optional"!==d?d:void 0,this.type=c,this.id=b,this.extend=f||void 0,this.repeated="repeated"===d,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!h.Long&&void 0!==g.long[c],this.bytes="bytes"===c,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=k}j.fromJSON=function(a,b){var c=new j(a,b.id,b.type,b.rule,b.extend,b.options,b.comment);return b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},Object.defineProperty(j.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(j.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(j.prototype,"delimited",{get:function(){return this.resolvedType instanceof d&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(j.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(j.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),j.prototype.setOption=function(a,b,c){return e.prototype.setOption.call(this,a,b,c)},j.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return h.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",b?this.comment:void 0])},j.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=g.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof f&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof f||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=h.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var a;h.base64.test(this.typeDefault)?h.base64.decode(this.typeDefault,a=h.newBuffer(h.base64.length(this.typeDefault)),0):h.utf8.write(this.typeDefault,a=h.newBuffer(h.utf8.length(this.typeDefault)),0),this.typeDefault=a}return this.map?this.defaultValue=h.emptyObject:this.repeated?this.defaultValue=h.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),e.prototype.resolve.call(this)},j.prototype._inferLegacyProtoFeatures=function(a){if("proto2"!==a&&"proto3"!==a)return{};var b={};if("required"===this.rule&&(b.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===g.defaults[this.type]){var c=this.parent.get(this.type.split(".").pop());c&&c instanceof d&&c.group&&(b.message_encoding="DELIMITED")}return!0===this.getOption("packed")?b.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(b.repeated_field_encoding="EXPANDED"),b},j.prototype._resolveFeatures=function(a){return e.prototype._resolveFeatures.call(this,this._edition||a)},j.d=function(a,b,c,d){return"function"==typeof b?b=h.decorateType(b).name:b&&"object"==typeof b&&(b=h.decorateEnum(b).name),function(e,f){h.decorateType(e.constructor).add(new j(f,a,b,c,{default:d}))}},j._configure=function(a){d=a}},13175,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(77601);((g.prototype=Object.create(d.prototype)).constructor=g).className="OneOf";var e=a.r(52093),f=a.r(13793);function g(a,b,c,e){if(Array.isArray(b)||(c=b,b=void 0),d.call(this,a,c),!(void 0===b||Array.isArray(b)))throw TypeError("fieldNames must be an Array");this.oneof=b||[],this.fieldsArray=[],this.comment=e}function h(a){if(a.parent)for(var b=0;b<a.fieldsArray.length;++b)a.fieldsArray[b].parent||a.parent.add(a.fieldsArray[b])}g.fromJSON=function(a,b){return new g(a,b.oneof,b.options,b.comment)},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["options",this.options,"oneof",this.oneof,"comment",b?this.comment:void 0])},g.prototype.add=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");return a.parent&&a.parent!==this.parent&&a.parent.remove(a),this.oneof.push(a.name),this.fieldsArray.push(a),a.partOf=this,h(this),this},g.prototype.remove=function(a){if(!(a instanceof e))throw TypeError("field must be a Field");var b=this.fieldsArray.indexOf(a);if(b<0)throw Error(a+" is not a member of "+this);return this.fieldsArray.splice(b,1),(b=this.oneof.indexOf(a.name))>-1&&this.oneof.splice(b,1),a.partOf=null,this},g.prototype.onAdd=function(a){d.prototype.onAdd.call(this,a);for(var b=this,c=0;c<this.oneof.length;++c){var e=a.get(this.oneof[c]);e&&!e.partOf&&(e.partOf=b,b.fieldsArray.push(e))}h(this)},g.prototype.onRemove=function(a){for(var b,c=0;c<this.fieldsArray.length;++c)(b=this.fieldsArray[c]).parent&&b.parent.remove(b);d.prototype.onRemove.call(this,a)},Object.defineProperty(g.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var a=this.fieldsArray[0];return null!=a.options&&!0===a.options.proto3_optional}}),g.d=function(){for(var a=Array(arguments.length),b=0;b<arguments.length;)a[b]=arguments[b++];return function(b,c){f.decorateType(b.constructor).add(new g(c,a)),Object.defineProperty(b,c,{get:f.oneOfGetter(a),set:f.oneOfSetter(a)})}}},77601,(a,b,c)=>{"use strict";b.exports=j,j.className="ReflectionObject";let d=a.r(13175);var e,f=a.r(13793),g={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},h={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},i={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function j(a,b){if(!f.isString(a))throw TypeError("name must be a string");if(b&&!f.isObject(b))throw TypeError("options must be an object");this.options=b,this.parsedOptions=null,this.name=a,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(j.prototype,{root:{get:function(){for(var a=this;null!==a.parent;)a=a.parent;return a}},fullName:{get:function(){for(var a=[this.name],b=this.parent;b;)a.unshift(b.name),b=b.parent;return a.join(".")}}}),j.prototype.toJSON=function(){throw Error()},j.prototype.onAdd=function(a){this.parent&&this.parent!==a&&this.parent.remove(this),this.parent=a,this.resolved=!1;var b=a.root;b instanceof e&&b._handleAdd(this)},j.prototype.onRemove=function(a){var b=a.root;b instanceof e&&b._handleRemove(this),this.parent=null,this.resolved=!1},j.prototype.resolve=function(){return this.resolved||this.root instanceof e&&(this.resolved=!0),this},j.prototype._resolveFeaturesRecursive=function(a){return this._resolveFeatures(this._edition||a)},j.prototype._resolveFeatures=function(a){if(!this._featuresResolved){var b={};if(!a)throw Error("Unknown edition for "+this.fullName);var c=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(a));if(this._edition){if("proto2"===a)b=Object.assign({},h);else if("proto3"===a)b=Object.assign({},i);else if("2023"===a)b=Object.assign({},g);else throw Error("Unknown edition: "+a);this._features=Object.assign(b,c||{}),this._featuresResolved=!0;return}if(this.partOf instanceof d){var e=Object.assign({},this.partOf._features);this._features=Object.assign(e,c||{})}else if(this.declaringField);else if(this.parent){var f=Object.assign({},this.parent._features);this._features=Object.assign(f,c||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},j.prototype._inferLegacyProtoFeatures=function(){return{}},j.prototype.getOption=function(a){if(this.options)return this.options[a]},j.prototype.setOption=function(a,b,c){return this.options||(this.options={}),/^features\./.test(a)?f.setProperty(this.options,a,b,c):c&&void 0!==this.options[a]||(this.getOption(a)!==b&&(this.resolved=!1),this.options[a]=b),this},j.prototype.setParsedOption=function(a,b,c){this.parsedOptions||(this.parsedOptions=[]);var d=this.parsedOptions;if(c){var e=d.find(function(b){return Object.prototype.hasOwnProperty.call(b,a)});if(e){var g=e[a];f.setProperty(g,c,b)}else(e={})[a]=f.setProperty({},c,b),d.push(e)}else{var h={};h[a]=b,d.push(h)}return this},j.prototype.setOptions=function(a,b){if(a)for(var c=Object.keys(a),d=0;d<c.length;++d)this.setOption(c[d],a[c[d]],b);return this},j.prototype.toString=function(){var a=this.constructor.className,b=this.fullName;return b.length?a+" "+b:a},j.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},j._configure=function(a){e=a}},16575,(a,b,c)=>{"use strict";b.exports=g;var d=a.r(77601);((g.prototype=Object.create(d.prototype)).constructor=g).className="Enum";var e=a.r(42226),f=a.r(13793);function g(a,b,c,e,f,g){if(d.call(this,a,c),b&&"object"!=typeof b)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=e,this.comments=f||{},this.valuesOptions=g,this._valuesFeatures={},this.reserved=void 0,b)for(var h=Object.keys(b),i=0;i<h.length;++i)"number"==typeof b[h[i]]&&(this.valuesById[this.values[h[i]]=b[h[i]]]=h[i])}g.prototype._resolveFeatures=function(a){return a=this._edition||a,d.prototype._resolveFeatures.call(this,a),Object.keys(this.values).forEach(a=>{var b=Object.assign({},this._features);this._valuesFeatures[a]=Object.assign(b,this.valuesOptions&&this.valuesOptions[a]&&this.valuesOptions[a].features)}),this},g.fromJSON=function(a,b){var c=new g(a,b.values,b.options,b.comment,b.comments);return c.reserved=b.reserved,b.edition&&(c._edition=b.edition),c._defaultEdition="proto3",c},g.prototype.toJSON=function(a){var b=!!a&&!!a.keepComments;return f.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",b?this.comment:void 0,"comments",b?this.comments:void 0])},g.prototype.add=function(a,b,c,d){if(!f.isString(a))throw TypeError("name must be a string");if(!f.isInteger(b))throw TypeError("id must be an integer");if(void 0!==this.values[a])throw Error("duplicate name '"+a+"' in "+this);if(this.isReservedId(b))throw Error("id "+b+" is reserved in "+this);if(this.isReservedName(a))throw Error("name '"+a+"' is reserved in "+this);if(void 0!==this.valuesById[b]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+b+" in "+this);this.values[a]=b}else this.valuesById[this.values[a]=b]=a;return d&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[a]=d||null),this.comments[a]=c||null,this},g.prototype.remove=function(a){if(!f.isString(a))throw TypeError("name must be a string");var b=this.values[a];if(null==b)throw Error("name '"+a+"' does not exist in "+this);return delete this.valuesById[b],delete this.values[a],delete this.comments[a],this.valuesOptions&&delete this.valuesOptions[a],this},g.prototype.isReservedId=function(a){return e.isReservedId(this.reserved,a)},g.prototype.isReservedName=function(a){return e.isReservedName(this.reserved,a)}},19529,(a,b,c)=>{"use strict";b.exports=h;var d=a.r(16575),e=a.r(73362),f=a.r(13793);function g(a,b,c,d){return b.delimited?a("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",c,d,(b.id<<3|3)>>>0,(b.id<<3|4)>>>0):a("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",c,d,(b.id<<3|2)>>>0)}function h(a){for(var b,c,h=f.codegen(["m","w"],a.name+"$encode")("if(!w)")("w=Writer.create()"),i=a.fieldsArray.slice().sort(f.compareFieldsById),b=0;b<i.length;++b){var j=i[b].resolve(),k=a._fieldsArray.indexOf(j),l=j.resolvedType instanceof d?"int32":j.type,m=e.basic[l];c="m"+f.safeProp(j.name),j.map?(h("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",c,j.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",c)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(j.id<<3|2)>>>0,8|e.mapKey[j.keyType],j.keyType),void 0===m?h("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",k,c):h(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|m,l,c),h("}")("}")):j.repeated?(h("if(%s!=null&&%s.length){",c,c),j.packed&&void 0!==e.packed[l]?h("w.uint32(%i).fork()",(j.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",c)("w.%s(%s[i])",l,c)("w.ldelim()"):(h("for(var i=0;i<%s.length;++i)",c),void 0===m?g(h,j,k,c+"[i]"):h("w.uint32(%i).%s(%s[i])",(j.id<<3|m)>>>0,l,c)),h("}")):(j.optional&&h("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",c,j.name),void 0===m?g(h,j,k,c):h("w.uint32(%i).%s(%s)",(j.id<<3|m)>>>0,l,c))}return h("return w")}},30186,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(93548);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(85457);function f(){d.call(this)}function g(a,b,c){a.length<40?e.utf8.write(a,b,c):b.utf8Write?b.utf8Write(a,c):b.write(a,c)}f._configure=function(){f.alloc=e._Buffer_allocUnsafe,f.writeBytesBuffer=e.Buffer&&e.Buffer.prototype instanceof Uint8Array&&"set"===e.Buffer.prototype.set.name?function(a,b,c){b.set(a,c)}:function(a,b,c){if(a.copy)a.copy(b,c,0,a.length);else for(var d=0;d<a.length;)b[c++]=a[d++]}},f.prototype.bytes=function(a){e.isString(a)&&(a=e._Buffer_from(a,"base64"));var b=a.length>>>0;return this.uint32(b),b&&this._push(f.writeBytesBuffer,b,a),this},f.prototype.string=function(a){var b=e.Buffer.byteLength(a);return this.uint32(b),b&&this._push(g,b,a),this},f._configure()},24886,(a,b,c)=>{"use strict";b.exports=f;var d=a.r(72999);(f.prototype=Object.create(d.prototype)).constructor=f;var e=a.r(85457);function f(a){d.call(this,a)}f._configure=function(){e.Buffer&&(f.prototype._slice=e.Buffer.prototype.slice)},f.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+a,this.len))},f._configure()},13383,(a,b,c)=>{"use strict";var d=c;function e(){d.util._configure(),d.Writer._configure(d.BufferWriter),d.Reader._configure(d.BufferReader)}d.build="minimal",d.Writer=a.r(93548),d.BufferWriter=a.r(30186),d.Reader=a.r(72999),d.BufferReader=a.r(24886),d.util=a.r(85457),d.rpc=a.r(34207),d.roots=a.r(23318),d.configure=e,e()},77133,(a,b,c)=>{"use strict";var d=b.exports=a.r(13383);function e(a,b,c){return"function"==typeof b?(c=b,b=new d.Root):b||(b=new d.Root),b.load(a,c)}function f(a,b){return b||(b=new d.Root),b.loadSync(a)}d.build="light",d.load=e,d.loadSync=f,d.encoder=a.r(19529),d.decoder=a.r(19419),d.verifier=a.r(13820),d.converter=a.r(50233),d.ReflectionObject=a.r(77601),d.Namespace=a.r(42226),d.Root=a.r(67612),d.Enum=a.r(16575),d.Type=a.r(7190),d.Field=a.r(52093),d.OneOf=a.r(13175),d.MapField=a.r(14325),d.Service=a.r(26819),d.Method=a.r(36654),d.Message=a.r(83884),d.wrappers=a.r(82170),d.types=a.r(73362),d.util=a.r(13793),d.ReflectionObject._configure(d.Root),d.Namespace._configure(d.Type,d.Service,d.Enum),d.Root._configure(d.Type),d.Field._configure(d.Type)},51098,(a,b,c)=>{"use strict";b.exports=n;var d=/[\s{}=;:[\],'"()<>]/g,e=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,f=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,g=/^ *[*/]+ */,h=/^\s*\*?\/*/,i=/\n/g,j=/\s/,k=/\\(.?)/g,l={0:"\0",r:"\r",n:"\n",t:"	"};function m(a){return a.replace(k,function(a,b){switch(b){case"\\":case"":return b;default:return l[b]||""}})}function n(a,b){a=a.toString();var c=0,k=a.length,l=1,n=0,o={},p=[],q=null;function r(a){return Error("illegal "+a+" (line "+l+")")}function s(){var b="'"===q?f:e;b.lastIndex=c-1;var d=b.exec(a);if(!d)throw r("string");return c=b.lastIndex,y(q),q=null,m(d[1])}function t(b){return a.charAt(b)}function u(c,d,e){var f,j={type:a.charAt(c++),lineEmpty:!1,leading:e},k=c-(b?2:3);do if(--k<0||"\n"===(f=a.charAt(k))){j.lineEmpty=!0;break}while(" "===f||"	"===f)for(var m=a.substring(c,d).split(i),p=0;p<m.length;++p)m[p]=m[p].replace(b?h:g,"").trim();j.text=m.join("\n").trim(),o[l]=j,n=l}function v(b){var c=w(b),d=a.substring(b,c);return/^\s*\/\//.test(d)}function w(a){for(var b=a;b<k&&"\n"!==t(b);)b++;return b}function x(){if(p.length>0)return p.shift();if(q)return s();var e,f,g,h,i,m=0===c;do{if(c===k)return null;for(e=!1;j.test(g=t(c));)if("\n"===g&&(m=!0,++l),++c===k)return null;if("/"===t(c)){if(++c===k)throw r("comment");if("/"===t(c))if(b){if(h=c,i=!1,v(c-1)){i=!0;do if((c=w(c))===k||(c++,!m))break;while(v(c))}else c=Math.min(k,w(c)+1);i&&(u(h,c,m),m=!0),l++,e=!0}else{for(i="/"===t(h=c+1);"\n"!==t(++c);)if(c===k)return null;++c,i&&(u(h,c-1,m),m=!0),++l,e=!0}else{if("*"!==(g=t(c)))return"/";h=c+1,i=b||"*"===t(h);do{if("\n"===g&&++l,++c===k)throw r("comment");f=g,g=t(c)}while("*"!==f||"/"!==g)++c,i&&(u(h,c-2,m),m=!0),e=!0}}}while(e)var n=c;if(d.lastIndex=0,!d.test(t(n++)))for(;n<k&&!d.test(t(n));)++n;var o=a.substring(c,c=n);return('"'===o||"'"===o)&&(q=o),o}function y(a){p.push(a)}function z(){if(!p.length){var a=x();if(null===a)return null;y(a)}return p[0]}function A(a,b){var c=z();if(c===a)return x(),!0;if(!b)throw r("token '"+c+"', '"+a+"' expected");return!1}function B(a){var c,d=null;return void 0===a?(c=o[l-1],delete o[l-1],c&&(b||"*"===c.type||c.lineEmpty)&&(d=c.leading?c.text:null)):(n<a&&z(),c=o[a],delete o[a],c&&!c.lineEmpty&&(b||"/"===c.type)&&(d=c.leading?null:c.text)),d}return Object.defineProperty({next:x,peek:z,push:y,skip:A,cmnt:B},"line",{get:function(){return l}})}n.unescape=m},70233,(a,b,c)=>{"use strict";b.exports=y,y.filename=null,y.defaults={keepCase:!1};var d=a.r(51098),e=a.r(67612),f=a.r(7190),g=a.r(52093),h=a.r(14325),i=a.r(13175),j=a.r(16575),k=a.r(26819),l=a.r(36654),m=a.r(77601),n=a.r(73362),o=a.r(13793),p=/^[1-9][0-9]*$/,q=/^-?[1-9][0-9]*$/,r=/^0[x][0-9a-fA-F]+$/,s=/^-?0[x][0-9a-fA-F]+$/,t=/^0[0-7]+$/,u=/^-?0[0-7]+$/,v=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,w=/^[a-zA-Z_][a-zA-Z_0-9]*$/,x=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function y(a,b,c){b instanceof e||(c=b,b=new e),c||(c=y.defaults);var z,A,B,C,D=c.preferTrailingComment||!1,E=d(a,c.alternateCommentMode||!1),F=E.next,G=E.push,H=E.peek,I=E.skip,J=E.cmnt,K=!0,L="proto2",M=b,N=[],O={},P=c.keepCase?function(a){return a}:o.camelCase;function Q(){N.forEach(a=>{a._edition=L,Object.keys(O).forEach(b=>{void 0===a.getOption(b)&&a.setOption(b,O[b],!0)})})}function R(a,b,c){var d=y.filename;return c||(y.filename=null),Error("illegal "+(b||"token")+" '"+a+"' ("+(d?d+", ":"")+"line "+E.line+")")}function S(){var a,b=[];do{if('"'!==(a=F())&&"'"!==a)throw R(a);b.push(F()),I(a),a=H()}while('"'===a||"'"===a)return b.join("")}function T(a){var b=F();switch(b){case"'":case'"':return G(b),S();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return V(b,!0)}catch(c){if(a&&x.test(b))return b;throw R(b,"value")}}function U(a,b){do if(b&&('"'===(c=H())||"'"===c)){var c,d,e=S();if(a.push(e),L>=2023)throw R(e,"id")}else try{a.push([d=W(F()),I("to",!0)?W(F()):d])}catch(d){if(b&&x.test(c)&&L>=2023)a.push(c);else throw d}while(I(",",!0))var f={options:void 0};f.setOption=function(a,b){void 0===this.options&&(this.options={}),this.options[a]=b},aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)})}function V(a,b){var c=1;switch("-"===a.charAt(0)&&(c=-1,a=a.substring(1)),a){case"inf":case"INF":case"Inf":return 1/0*c;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(a))return c*parseInt(a,10);if(r.test(a))return c*parseInt(a,16);if(t.test(a))return c*parseInt(a,8);if(v.test(a))return c*parseFloat(a);throw R(a,"number",b)}function W(a,b){switch(a){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!b&&"-"===a.charAt(0))throw R(a,"id");if(q.test(a))return parseInt(a,10);if(s.test(a))return parseInt(a,16);if(u.test(a))return parseInt(a,8);throw R(a,"id")}function X(){if(void 0!==A)throw R("package");if(A=F(),!x.test(A))throw R(A,"name");M=M.define(A),I(";")}function Y(){var a,b=H();switch(b){case"weak":a=C||(C=[]),F();break;case"public":F();default:a=B||(B=[])}b=S(),I(";"),a.push(b)}function Z(){if(I("="),(L=S())<2023)throw R(L,"syntax");I(";")}function $(){if(I("="),!["2023"].includes(L=S()))throw R(L,"edition");I(";")}function _(a,b){switch(b){case"option":return ai(a,b),I(";"),!0;case"message":return ab(a,b),!0;case"enum":return ag(a,b),!0;case"service":return an(a,b),!0;case"extend":return ap(a,b),!0}return!1}function aa(a,b,c){var d,e=E.line;if(a&&("string"!=typeof a.comment&&(a.comment=J()),a.filename=y.filename),I("{",!0)){for(;"}"!==(d=F());)b(d);I(";",!0)}else c&&c(),I(";"),a&&("string"!=typeof a.comment||D)&&(a.comment=J(e)||a.comment)}function ab(a,b){if(!w.test(b=F()))throw R(b,"type name");var c=new f(b);aa(c,function(a){if(!_(c,a))switch(a){case"map":ae(c,a);break;case"required":if("proto2"!==L)throw R(a);case"repeated":ac(c,a);break;case"optional":if("proto3"===L)ac(c,"proto3_optional");else if("proto2"!==L)throw R(a);else ac(c,"optional");break;case"oneof":af(c,a);break;case"extensions":U(c.extensions||(c.extensions=[]));break;case"reserved":U(c.reserved||(c.reserved=[]),!0);break;default:if("proto2"===L||!x.test(a))throw R(a);G(a),ac(c,"optional")}}),a.add(c),a===M&&N.push(c)}function ac(a,b,c){var d=F();if("group"===d)return void ad(a,b);for(;d.endsWith(".")||H().startsWith(".");)d+=F();if(!x.test(d))throw R(d,"type");var e=F();if(!w.test(e))throw R(e,"name");e=P(e),I("=");var f=new g(e,W(F()),d,b,c);if(aa(f,function(a){if("option"===a)ai(f,a),I(";");else throw R(a)},function(){am(f)}),"proto3_optional"===b){var h=new i("_"+e);f.setOption("proto3_optional",!0),h.add(f),a.add(h)}else a.add(f);a===M&&N.push(f)}function ad(a,b){if(L>=2023)throw R("group");var c=F();if(!w.test(c))throw R(c,"name");var d=o.lcFirst(c);c===d&&(c=o.ucFirst(c)),I("=");var e=W(F()),h=new f(c);h.group=!0;var i=new g(d,e,c,b);i.filename=y.filename,aa(h,function(a){switch(a){case"option":ai(h,a),I(";");break;case"required":case"repeated":ac(h,a);break;case"optional":"proto3"===L?ac(h,"proto3_optional"):ac(h,"optional");break;case"message":ab(h,a);break;case"enum":ag(h,a);break;case"reserved":U(h.reserved||(h.reserved=[]),!0);break;default:throw R(a)}}),a.add(h).add(i)}function ae(a){I("<");var b=F();if(void 0===n.mapKey[b])throw R(b,"type");I(",");var c=F();if(!x.test(c))throw R(c,"type");I(">");var d=F();if(!w.test(d))throw R(d,"name");I("=");var e=new h(P(d),W(F()),b,c);aa(e,function(a){if("option"===a)ai(e,a),I(";");else throw R(a)},function(){am(e)}),a.add(e)}function af(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new i(P(b));aa(c,function(a){"option"===a?(ai(c,a),I(";")):(G(a),ac(c,"optional"))}),a.add(c)}function ag(a,b){if(!w.test(b=F()))throw R(b,"name");var c=new j(b);aa(c,function(a){switch(a){case"option":ai(c,a),I(";");break;case"reserved":U(c.reserved||(c.reserved=[]),!0),void 0===c.reserved&&(c.reserved=[]);break;default:ah(c,a)}}),a.add(c),a===M&&N.push(c)}function ah(a,b){if(!w.test(b))throw R(b,"name");I("=");var c=W(F(),!0),d={options:void 0};d.getOption=function(a){return this.options[a]},d.setOption=function(a,b){m.prototype.setOption.call(d,a,b)},d.setParsedOption=function(){},aa(d,function(a){if("option"===a)ai(d,a),I(";");else throw R(a)},function(){am(d)}),a.add(b,c,d.comment,d.parsedOptions||d.options)}function ai(a,b){var c,d,e=!0;for("option"===b&&(b=F());"="!==b;){if("("===b){var f=F();I(")"),b="("+f+")"}if(e){if(e=!1,b.includes(".")&&!b.includes("(")){var g=b.split(".");c=g[0]+".",b=g[1];continue}c=b}else d=d?d+=b:b;b=F()}var h=aj(a,d?c.concat(d):c);d=d&&"."===d[0]?d.slice(1):d,al(a,c=c&&"."===c[c.length-1]?c.slice(0,-1):c,h,d)}function aj(a,b){if(I("{",!0)){for(var c={};!I("}",!0);){if(!w.test(z=F()))throw R(z,"name");if(null===z)throw R(z,"end of input");var d,e,f=z;if(I(":",!0),"{"===H())d=aj(a,b+"."+z);else if("["===H()){if(d=[],I("[",!0)){do e=T(!0),d.push(e);while(I(",",!0))I("]"),void 0!==e&&ak(a,b+"."+z,e)}}else d=T(!0),ak(a,b+"."+z,d);var g=c[f];g&&(d=[].concat(g).concat(d)),c[f]=d,I(",",!0),I(";",!0)}return c}var h=T(!0);return ak(a,b,h),h}function ak(a,b,c){if(M===a&&/^features\./.test(b)){O[b]=c;return}a.setOption&&a.setOption(b,c)}function al(a,b,c,d){a.setParsedOption&&a.setParsedOption(b,c,d)}function am(a){if(I("[",!0)){do ai(a,"option");while(I(",",!0))I("]")}return a}function an(a,b){if(!w.test(b=F()))throw R(b,"service name");var c=new k(b);aa(c,function(a){if(!_(c,a))if("rpc"===a)ao(c,a);else throw R(a)}),a.add(c),a===M&&N.push(c)}function ao(a,b){var c=J(),d=b;if(!w.test(b=F()))throw R(b,"name");var e,f,g,h,i=b;if(I("("),I("stream",!0)&&(f=!0),!x.test(b=F())||(e=b,I(")"),I("returns"),I("("),I("stream",!0)&&(h=!0),!x.test(b=F())))throw R(b);g=b,I(")");var j=new l(i,d,e,g,f,h);j.comment=c,aa(j,function(a){if("option"===a)ai(j,a),I(";");else throw R(a)}),a.add(j)}function ap(a,b){if(!x.test(b=F()))throw R(b,"reference");var c=b;aa(null,function(b){switch(b){case"required":case"repeated":ac(a,b,c);break;case"optional":"proto3"===L?ac(a,"proto3_optional",c):ac(a,"optional",c);break;default:if("proto2"===L||!x.test(b))throw R(b);G(b),ac(a,"optional",c)}})}for(;null!==(z=F());)switch(z){case"package":if(!K)throw R(z);X();break;case"import":if(!K)throw R(z);Y();break;case"syntax":if(!K)throw R(z);Z();break;case"edition":if(!K)throw R(z);$();break;case"option":ai(M,z),I(";",!0);break;default:if(_(M,z)){K=!1;continue}throw R(z)}return Q(),y.filename=null,{package:A,imports:B,weakImports:C,root:b}}},19857,(a,b,c)=>{"use strict";b.exports=f;var d,e=/\/|\./;function f(a,b){e.test(a)||(a="google/protobuf/"+a+".proto",b={nested:{google:{nested:{protobuf:{nested:b}}}}}),f[a]=b}f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),f("duration",{Duration:d={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),f("timestamp",{Timestamp:d}),f("empty",{Empty:{fields:{}}}),f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),f.get=function(a){return f[a]||null}},73197,(a,b,c)=>{"use strict";var d=b.exports=a.r(77133);d.build="full",d.tokenize=a.r(51098),d.parse=a.r(70233),d.common=a.r(19857),d.Root._configure(d.Type,d.parse,d.common)},30155,(a,b,c)=>{"use strict";b.exports=a.r(73197)},85565,a=>{a.v(JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}'))},71317,(a,b,c)=>{"use strict";var d=a.r(30155);b.exports=c=d.descriptor=d.Root.fromJSON(a.r(85565)).lookup(".google.protobuf");var e=d.Namespace,f=d.Root,g=d.Enum,h=d.Type,i=d.Field,j=d.MapField,k=d.OneOf,l=d.Service,m=d.Method;function n(a,b,d){var j=c.FileDescriptorProto.create({name:a.filename||(a.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});E(d,j),a instanceof f||(j.package=a.fullName.substring(1));for(var k,m=0;m<a.nestedArray.length;++m)(k=a._nestedArray[m])instanceof h?j.messageType.push(k.toDescriptor(d)):k instanceof g?j.enumType.push(k.toDescriptor()):k instanceof i?j.extension.push(k.toDescriptor(d)):k instanceof l?j.service.push(k.toDescriptor()):k instanceof e&&n(k,b,d);j.options=A(a.options,c.FileOptions),j.messageType.length+j.enumType.length+j.extension.length+j.service.length&&b.push(j)}f.fromDescriptor=function(a){"number"==typeof a.length&&(a=c.FileDescriptorSet.decode(a));var b=new f;if(a.file)for(var d,e,j,k=0;k<a.file.length;++k){e=b,(d=a.file[k]).package&&d.package.length&&(e=b.define(d.package));var m=D(d);if(d.name&&d.name.length&&b.files.push(e.filename=d.name),d.messageType)for(j=0;j<d.messageType.length;++j)e.add(h.fromDescriptor(d.messageType[j],m));if(d.enumType)for(j=0;j<d.enumType.length;++j)e.add(g.fromDescriptor(d.enumType[j],m));if(d.extension)for(j=0;j<d.extension.length;++j)e.add(i.fromDescriptor(d.extension[j],m));if(d.service)for(j=0;j<d.service.length;++j)e.add(l.fromDescriptor(d.service[j],m));var n=y(d.options,c.FileOptions);if(n){var o=Object.keys(n);for(j=0;j<o.length;++j)e.setOption(o[j],n[o[j]])}}return b.resolveAll()},f.prototype.toDescriptor=function(a){var b=c.FileDescriptorSet.create();return n(this,b.file,a),b};var o=0;h.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.DescriptorProto.decode(a));var e,f=new h(a.name.length?a.name:"Type"+o++,y(a.options,c.MessageOptions));if(d||(f._edition=b),a.oneofDecl)for(e=0;e<a.oneofDecl.length;++e)f.add(k.fromDescriptor(a.oneofDecl[e]));if(a.field)for(e=0;e<a.field.length;++e){var j=i.fromDescriptor(a.field[e],b,!0);f.add(j),a.field[e].hasOwnProperty("oneofIndex")&&f.oneofsArray[a.field[e].oneofIndex].add(j)}if(a.extension)for(e=0;e<a.extension.length;++e)f.add(i.fromDescriptor(a.extension[e],b,!0));if(a.nestedType)for(e=0;e<a.nestedType.length;++e)f.add(h.fromDescriptor(a.nestedType[e],b,!0)),a.nestedType[e].options&&a.nestedType[e].options.mapEntry&&f.setOption("map_entry",!0);if(a.enumType)for(e=0;e<a.enumType.length;++e)f.add(g.fromDescriptor(a.enumType[e],b,!0));if(a.extensionRange&&a.extensionRange.length)for(e=0,f.extensions=[];e<a.extensionRange.length;++e)f.extensions.push([a.extensionRange[e].start,a.extensionRange[e].end]);if(a.reservedRange&&a.reservedRange.length||a.reservedName&&a.reservedName.length){if(f.reserved=[],a.reservedRange)for(e=0;e<a.reservedRange.length;++e)f.reserved.push([a.reservedRange[e].start,a.reservedRange[e].end]);if(a.reservedName)for(e=0;e<a.reservedName.length;++e)f.reserved.push(a.reservedName[e])}return f},h.prototype.toDescriptor=function(a){var b,d,e=c.DescriptorProto.create({name:this.name});for(d=0;d<this.fieldsArray.length;++d)if(e.field.push(b=this._fieldsArray[d].toDescriptor(a)),this._fieldsArray[d]instanceof j){var f=w(this._fieldsArray[d].keyType,this._fieldsArray[d].resolvedKeyType,!1),k=w(this._fieldsArray[d].type,this._fieldsArray[d].resolvedType,!1),l=11===k||14===k?this._fieldsArray[d].resolvedType&&B(this.parent,this._fieldsArray[d].resolvedType)||this._fieldsArray[d].type:void 0;e.nestedType.push(c.DescriptorProto.create({name:b.typeName,field:[c.FieldDescriptorProto.create({name:"key",number:1,label:1,type:f}),c.FieldDescriptorProto.create({name:"value",number:2,label:1,type:k,typeName:l})],options:c.MessageOptions.create({mapEntry:!0})}))}for(d=0;d<this.oneofsArray.length;++d)e.oneofDecl.push(this._oneofsArray[d].toDescriptor());for(d=0;d<this.nestedArray.length;++d)this._nestedArray[d]instanceof i?e.field.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof h?e.nestedType.push(this._nestedArray[d].toDescriptor(a)):this._nestedArray[d]instanceof g&&e.enumType.push(this._nestedArray[d].toDescriptor());if(this.extensions)for(d=0;d<this.extensions.length;++d)e.extensionRange.push(c.DescriptorProto.ExtensionRange.create({start:this.extensions[d][0],end:this.extensions[d][1]}));if(this.reserved)for(d=0;d<this.reserved.length;++d)"string"==typeof this.reserved[d]?e.reservedName.push(this.reserved[d]):e.reservedRange.push(c.DescriptorProto.ReservedRange.create({start:this.reserved[d][0],end:this.reserved[d][1]}));return e.options=A(this.options,c.MessageOptions),e};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;i.fromDescriptor=function(a,b,d){if("number"==typeof a.length&&(a=c.DescriptorProto.decode(a)),"number"!=typeof a.number)throw Error("missing field id");switch(e=a.typeName&&a.typeName.length?a.typeName:u(a.type),a.label){case 1:f=void 0;break;case 2:f="required";break;case 3:f="repeated";break;default:throw Error("illegal label: "+a.label)}var e,f,g=a.extendee;void 0!==a.extendee&&(g=g.length?g:void 0);var h=new i(a.name.length?a.name:"field"+a.number,a.number,e,f,g);if(d||(h._edition=b),h.options=y(a.options,c.FieldOptions),a.proto3_optional&&(h.options.proto3_optional=!0),a.defaultValue&&a.defaultValue.length){var j=a.defaultValue;switch(j){case"true":case"TRUE":j=!0;break;case"false":case"FALSE":j=!1;break;default:p.exec(j)&&(j=parseInt(j))}h.setOption("default",j)}return v(a.type)&&("proto3"===b?a.options&&!a.options.packed&&h.setOption("packed",!1):(!b||"proto2"===b)&&a.options&&a.options.packed&&h.setOption("packed",!0)),h},i.prototype.toDescriptor=function(a){var b=c.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)b.type=11,b.typeName=d.util.ucFirst(this.name),b.label=3;else{switch(b.type=w(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:b.typeName=this.resolvedType?B(this.parent,this.resolvedType):this.type}"repeated"===this.rule?b.label=3:this.required&&"proto2"===a?b.label=2:b.label=1}if(b.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(b.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(b.options=A(this.options,c.FieldOptions),null!=this.options.default&&(b.defaultValue=String(this.options.default)),this.options.proto3_optional&&(b.proto3_optional=!0)),"proto3"===a?this.packed||((b.options||(b.options=c.FieldOptions.create())).packed=!1):(!a||"proto2"===a)&&this.packed&&((b.options||(b.options=c.FieldOptions.create())).packed=!0),b};var q=0;g.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.EnumDescriptorProto.decode(a));var e={};if(a.value)for(var f=0;f<a.value.length;++f){var h=a.value[f].name,i=a.value[f].number||0;e[h&&h.length?h:"NAME"+i]=i}var j=new g(a.name&&a.name.length?a.name:"Enum"+q++,e,y(a.options,c.EnumOptions));return d||(j._edition=b),j},g.prototype.toDescriptor=function(){for(var a=[],b=0,d=Object.keys(this.values);b<d.length;++b)a.push(c.EnumValueDescriptorProto.create({name:d[b],number:this.values[d[b]]}));return c.EnumDescriptorProto.create({name:this.name,value:a,options:A(this.options,c.EnumOptions)})};var r=0;k.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.OneofDescriptorProto.decode(a)),new k(a.name&&a.name.length?a.name:"oneof"+r++)},k.prototype.toDescriptor=function(){return c.OneofDescriptorProto.create({name:this.name})};var s=0;l.fromDescriptor=function(a,b,d){"number"==typeof a.length&&(a=c.ServiceDescriptorProto.decode(a));var e=new l(a.name&&a.name.length?a.name:"Service"+s++,y(a.options,c.ServiceOptions));if(d||(e._edition=b),a.method)for(var f=0;f<a.method.length;++f)e.add(m.fromDescriptor(a.method[f]));return e},l.prototype.toDescriptor=function(){for(var a=[],b=0;b<this.methodsArray.length;++b)a.push(this._methodsArray[b].toDescriptor());return c.ServiceDescriptorProto.create({name:this.name,method:a,options:A(this.options,c.ServiceOptions)})};var t=0;function u(a){switch(a){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+a)}function v(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(a,b,c){switch(a){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(b instanceof g)return 14;if(b instanceof h)return c?10:11;throw Error("illegal type: "+a)}function x(a,b){for(var c,d,e={},f=0;f<b.fieldsArray.length;++f)if("uninterpretedOption"!==(d=(c=b._fieldsArray[f]).name)&&Object.prototype.hasOwnProperty.call(a,d)){var i=C(d);c.resolvedType instanceof h?e[i]=x(a[d],c.resolvedType):c.resolvedType instanceof g?e[i]=c.resolvedType.valuesById[a[d]]:e[i]=a[d]}return e}function y(a,b){if(a)return x(b.toObject(a),b)}function z(a,b){for(var c={},e=Object.keys(a),f=0;f<e.length;++f){var g=e[f],i=d.util.camelCase(g);if(Object.prototype.hasOwnProperty.call(b.fields,i)){var j=b.fields[i];j.resolvedType instanceof h?c[i]=z(a[g],j.resolvedType):c[i]=a[g],j.repeated&&!Array.isArray(c[i])&&(c[i]=[c[i]])}}return c}function A(a,b){if(a)return b.fromObject(z(a,b))}function B(a,b){var c=a.fullName.split("."),d=b.fullName.split("."),g=0,h=0,i=d.length-1;if(!(a instanceof f)&&b instanceof e)for(;g<c.length&&h<i&&c[g]===d[h];){var j=b.lookup(c[g++],!0);if(null!==j&&j!==b)break;++h}else for(;g<c.length&&h<i&&c[g]===d[h];++g,++h);return d.slice(h).join(".")}function C(a){return a.substring(0,1)+a.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(a,b){return"_"+b.toLowerCase()})}function D(a){if("editions"===a.syntax)if(a.edition===c.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+a.edition);return"proto3"===a.syntax?"proto3":"proto2"}function E(a,b){if(a)if("proto2"===a||"proto3"===a)b.syntax=a;else if(b.syntax="editions","2023"===a)b.edition=c.Edition.EDITION_2023;else throw Error("Unsupported edition "+a)}m.fromDescriptor=function(a){return"number"==typeof a.length&&(a=c.MethodDescriptorProto.decode(a)),new m(a.name&&a.name.length?a.name:"Method"+t++,"rpc",a.inputType,a.outputType,!!a.clientStreaming,!!a.serverStreaming,y(a.options,c.MethodOptions))},m.prototype.toDescriptor=function(){return c.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:A(this.options,c.MethodOptions)})}},58950,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}})},48109,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}})},95685,a=>{a.v({nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}})},69030,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.addCommonProtos=c.loadProtosWithOptionsSync=c.loadProtosWithOptions=void 0;let d=a.r(22734),e=a.r(14747),f=a.r(30155);function g(a,b){let c=a.resolvePath;a.resolvePath=(a,f)=>{if(e.isAbsolute(f))return f;for(let a of b){let b=e.join(a,f);try{return d.accessSync(b,d.constants.R_OK),b}catch(a){continue}}return process.emitWarning(`${f} not found in any of the include paths ${b}`),c(a,f)}}c.loadProtosWithOptions=async function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));g(c,b.includeDirs)}let d=await c.load(a,b);return d.resolveAll(),d},c.loadProtosWithOptionsSync=function(a,b){let c=new f.Root;if((b=b||{}).includeDirs){if(!Array.isArray(b.includeDirs))throw Error("The includeDirs option must be an array");g(c,b.includeDirs)}let d=c.loadSync(a,b);return d.resolveAll(),d},c.addCommonProtos=function(){let b=a.r(58950),c=a.r(85565),d=a.r(48109),e=a.r(95685);f.common("api",b.nested.google.nested.protobuf.nested),f.common("descriptor",c.nested.google.nested.protobuf.nested),f.common("source_context",d.nested.google.nested.protobuf.nested),f.common("type",e.nested.google.nested.protobuf.nested)}},2774,(a,b,c)=>{!function(d,e){function f(a){return a.default||a}if("function"==typeof define&&define.amd){let b;void 0!==(b=function(){var a={};return e(a),f(a)}())&&a.v(b)}else e(c),b.exports=f(c)}("u">typeof globalThis?globalThis:"u">typeof self?self:a.e,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var b=null;try{b=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function c(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function d(a){return!0===(a&&a.__isLong__)}function e(a){var b=Math.clz32(a&-a);return a?31-b:b}c.prototype.__isLong__,Object.defineProperty(c.prototype,"__isLong__",{value:!0}),c.isLong=d;var f={},g={};function h(a,b){var c,d,e;if(b)return(a>>>=0,(e=0<=a&&a<256)&&(d=g[a]))?d:(c=j(a,0,!0),e&&(g[a]=c),c);return(a|=0,(e=-128<=a&&a<128)&&(d=f[a]))?d:(c=j(a,a<0?-1:0,!1),e&&(f[a]=c),c)}function i(a,b){if(isNaN(a))return b?s:r;if(b){if(a<0)return s;if(a>=o)return x}else{if(a<=-p)return y;if(a+1>=p)return w}return a<0?i(-a,b).neg():j(a%n|0,a/n|0,b)}function j(a,b,d){return new c(a,b,d)}c.fromInt=h,c.fromNumber=i,c.fromBits=j;var k=Math.pow;function l(a,b,c){if(0===a.length)throw Error("empty string");if("number"==typeof b?(c=b,b=!1):b=!!b,"NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return b?s:r;if((c=c||10)<2||36<c)throw RangeError("radix");if((d=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===d)return l(a.substring(1),b,c).neg();for(var d,e=i(k(c,8)),f=r,g=0;g<a.length;g+=8){var h=Math.min(8,a.length-g),j=parseInt(a.substring(g,g+h),c);if(h<8){var m=i(k(c,h));f=f.mul(m).add(i(j))}else f=(f=f.mul(e)).add(i(j))}return f.unsigned=b,f}function m(a,b){return"number"==typeof a?i(a,b):"string"==typeof a?l(a,b):j(a.low,a.high,"boolean"==typeof b?b:a.unsigned)}c.fromString=l,c.fromValue=m;var n=0x100000000,o=0xffffffffffffffff,p=0x8000000000000000,q=h(0x1000000),r=h(0);c.ZERO=r;var s=h(0,!0);c.UZERO=s;var t=h(1);c.ONE=t;var u=h(1,!0);c.UONE=u;var v=h(-1);c.NEG_ONE=v;var w=j(-1,0x7fffffff,!1);c.MAX_VALUE=w;var x=j(-1,-1,!0);c.MAX_UNSIGNED_VALUE=x;var y=j(0,-0x80000000,!1);c.MIN_VALUE=y;var z=c.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low},z.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},z.toString=function(a){if((a=a||10)<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(y))return"-"+this.neg().toString(a);else{var b=i(a),c=this.div(b),d=c.mul(b).sub(this);return c.toString(a)+d.toInt().toString(a)}for(var e=i(k(a,6),this.unsigned),f=this,g="";;){var h=f.div(e),j=(f.sub(h.mul(e)).toInt()>>>0).toString(a);if((f=h).isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},z.getHighBits=function(){return this.high},z.getHighBitsUnsigned=function(){return this.high>>>0},z.getLowBits=function(){return this.low},z.getLowBitsUnsigned=function(){return this.low>>>0},z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&(a&1<<b)==0;b--);return 0!=this.high?b+33:b+1},z.isSafeInteger=function(){var a=this.high>>21;return!a||!this.unsigned&&-1===a&&(0!==this.low||-2097152!==this.high)},z.isZero=function(){return 0===this.high&&0===this.low},z.eqz=z.isZero,z.isNegative=function(){return!this.unsigned&&this.high<0},z.isPositive=function(){return this.unsigned||this.high>=0},z.isOdd=function(){return(1&this.low)==1},z.isEven=function(){return(1&this.low)==0},z.equals=function(a){return d(a)||(a=m(a)),(this.unsigned===a.unsigned||this.high>>>31!=1||a.high>>>31!=1)&&this.high===a.high&&this.low===a.low},z.eq=z.equals,z.notEquals=function(a){return!this.eq(a)},z.neq=z.notEquals,z.ne=z.notEquals,z.lessThan=function(a){return 0>this.comp(a)},z.lt=z.lessThan,z.lessThanOrEqual=function(a){return 0>=this.comp(a)},z.lte=z.lessThanOrEqual,z.le=z.lessThanOrEqual,z.greaterThan=function(a){return this.comp(a)>0},z.gt=z.greaterThan,z.greaterThanOrEqual=function(a){return this.comp(a)>=0},z.gte=z.greaterThanOrEqual,z.ge=z.greaterThanOrEqual,z.compare=function(a){if(d(a)||(a=m(a)),this.eq(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},z.comp=z.compare,z.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(t)},z.neg=z.negate,z.add=function(a){d(a)||(a=m(a));var b,c,e=this.high>>>16,f=65535&this.high,g=this.low>>>16,h=65535&this.low,i=a.high>>>16,k=65535&a.high,l=a.low>>>16,n=65535&a.low,o=0,p=0;return b=0+((c=0+(h+n))>>>16),c&=65535,b+=g+l,p+=b>>>16,b&=65535,p+=f+k,o+=p>>>16,p&=65535,o+=e+i,j(b<<16|c,(o&=65535)<<16|p,this.unsigned)},z.subtract=function(a){return d(a)||(a=m(a)),this.add(a.neg())},z.sub=z.subtract,z.multiply=function(a){if(this.isZero())return this;if(d(a)||(a=m(a)),b)return j(b.mul(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned);if(a.isZero())return this.unsigned?s:r;if(this.eq(y))return a.isOdd()?y:r;if(a.eq(y))return this.isOdd()?y:r;if(this.isNegative())if(a.isNegative())return this.neg().mul(a.neg());else return this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(q)&&a.lt(q))return i(this.toNumber()*a.toNumber(),this.unsigned);var c,e,f=this.high>>>16,g=65535&this.high,h=this.low>>>16,k=65535&this.low,l=a.high>>>16,n=65535&a.high,o=a.low>>>16,p=65535&a.low,t=0,u=0;return c=0+((e=0+k*p)>>>16),e&=65535,c+=h*p,u+=c>>>16,c&=65535,c+=k*o,u+=c>>>16,c&=65535,u+=g*p,t+=u>>>16,u&=65535,u+=h*o,t+=u>>>16,u&=65535,u+=k*n,t+=u>>>16,u&=65535,t+=f*p+g*o+h*n+k*l,j(c<<16|e,(t&=65535)<<16|u,this.unsigned)},z.mul=z.multiply,z.divide=function(a){if(d(a)||(a=m(a)),a.isZero())throw Error("division by zero");if(b){var c,e,f;return this.unsigned||-0x80000000!==this.high||-1!==a.low||-1!==a.high?j((this.unsigned?b.div_u:b.div_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?s:r;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return s;if(a.gt(this.shru(1)))return u;f=s}else{if(this.eq(y))if(a.eq(t)||a.eq(v))return y;else return a.eq(y)?t:(c=this.shr(1).div(a).shl(1)).eq(r)?a.isNegative()?t:v:(e=this.sub(a.mul(c)),f=c.add(e.div(a)));if(a.eq(y))return this.unsigned?s:r;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=r}for(e=this;e.gte(a);){for(var g=Math.ceil(Math.log(c=Math.max(1,Math.floor(e.toNumber()/a.toNumber())))/Math.LN2),h=g<=48?1:k(2,g-48),l=i(c),n=l.mul(a);n.isNegative()||n.gt(e);)c-=h,n=(l=i(c,this.unsigned)).mul(a);l.isZero()&&(l=t),f=f.add(l),e=e.sub(n)}return f},z.div=z.divide,z.modulo=function(a){return(d(a)||(a=m(a)),b)?j((this.unsigned?b.rem_u:b.rem_s)(this.low,this.high,a.low,a.high),b.get_high(),this.unsigned):this.sub(this.div(a).mul(a))},z.mod=z.modulo,z.rem=z.modulo,z.not=function(){return j(~this.low,~this.high,this.unsigned)},z.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},z.clz=z.countLeadingZeros,z.countTrailingZeros=function(){return this.low?e(this.low):e(this.high)+32},z.ctz=z.countTrailingZeros,z.and=function(a){return d(a)||(a=m(a)),j(this.low&a.low,this.high&a.high,this.unsigned)},z.or=function(a){return d(a)||(a=m(a)),j(this.low|a.low,this.high|a.high,this.unsigned)},z.xor=function(a){return d(a)||(a=m(a)),j(this.low^a.low,this.high^a.high,this.unsigned)},z.shiftLeft=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):j(0,this.low<<a-32,this.unsigned)},z.shl=z.shiftLeft,z.shiftRight=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):j(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},z.shr=z.shiftRight,z.shiftRightUnsigned=function(a){return(d(a)&&(a=a.toInt()),0==(a&=63))?this:a<32?j(this.low>>>a|this.high<<32-a,this.high>>>a,this.unsigned):32===a?j(this.high,0,this.unsigned):j(this.high>>>a-32,0,this.unsigned)},z.shru=z.shiftRightUnsigned,z.shr_u=z.shiftRightUnsigned,z.rotateLeft=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.low<<a|this.high>>>b,this.high<<a|this.low>>>b,this.unsigned)):(a-=32,b=32-a,j(this.high<<a|this.low>>>b,this.low<<a|this.high>>>b,this.unsigned))},z.rotl=z.rotateLeft,z.rotateRight=function(a){var b;return(d(a)&&(a=a.toInt()),0==(a&=63))?this:32===a?j(this.high,this.low,this.unsigned):a<32?(b=32-a,j(this.high<<b|this.low>>>a,this.low<<b|this.high>>>a,this.unsigned)):(a-=32,b=32-a,j(this.low<<b|this.high>>>a,this.high<<b|this.low>>>a,this.unsigned))},z.rotr=z.rotateRight,z.toSigned=function(){return this.unsigned?j(this.low,this.high,!1):this},z.toUnsigned=function(){return this.unsigned?this:j(this.low,this.high,!0)},z.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},z.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24,255&a,a>>>8&255,a>>>16&255,a>>>24]},z.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24,a>>>16&255,a>>>8&255,255&a,b>>>24,b>>>16&255,b>>>8&255,255&b]},c.fromBytes=function(a,b,d){return d?c.fromBytesLE(a,b):c.fromBytesBE(a,b)},c.fromBytesLE=function(a,b){return new c(a[0]|a[1]<<8|a[2]<<16|a[3]<<24,a[4]|a[5]<<8|a[6]<<16|a[7]<<24,b)},c.fromBytesBE=function(a,b){return new c(a[4]<<24|a[5]<<16|a[6]<<8|a[7],a[0]<<24|a[1]<<16|a[2]<<8|a[3],b)},"function"==typeof BigInt&&(c.fromBigInt=function(a,b){return j(Number(BigInt.asIntN(32,a)),Number(BigInt.asIntN(32,a>>BigInt(32))),b)},c.fromValue=function(a,b){return"bigint"==typeof a?c.fromBigInt(a,b):m(a,b)},z.toBigInt=function(){var a=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|a}),a.default=c})},67523,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.loadFileDescriptorSetFromObject=c.loadFileDescriptorSetFromBuffer=c.fromJSON=c.loadSync=c.load=c.IdempotencyLevel=c.isAnyExtension=c.Long=void 0;let e=a.r(77802),f=a.r(30155),g=a.r(71317),h=a.r(69030);c.Long=a.r(2774),c.isAnyExtension=function(a){return"@type"in a&&"string"==typeof a["@type"]},function(a){a.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",a.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",a.IDEMPOTENT="IDEMPOTENT"}(d=c.IdempotencyLevel||(c.IdempotencyLevel={}));let i={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function j(a,b){return""===a?b:a+"."+b}function k(a){return a instanceof f.Service||a instanceof f.Type||a instanceof f.Enum}function l(a){return a instanceof f.Namespace||a instanceof f.Root}function m(a,b){let c=j(b,a.name);return k(a)?[[c,a]]:l(a)&&void 0!==a.nested?Object.keys(a.nested).map(b=>m(a.nested[b],c)).reduce((a,b)=>a.concat(b),[]):[]}function n(a,b){return function(c){return a.toObject(a.decode(c),b)}}function o(a){return function(b){if(Array.isArray(b))throw Error(`Failed to serialize message: expected object with ${a.name} structure, got array instead`);let c=a.fromObject(b);return a.encode(c).finish()}}function p(a){return(a||[]).reduce((a,b)=>{for(let[c,d]of Object.entries(b))"uninterpreted_option"===c?a.uninterpreted_option.push(b.uninterpreted_option):a[c]=d;return a},{deprecated:!1,idempotency_level:d.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function q(a,b,c,d){let f=a.resolvedRequestType,g=a.resolvedResponseType;return{path:"/"+b+"/"+a.name,requestStream:!!a.requestStream,responseStream:!!a.responseStream,requestSerialize:o(f),requestDeserialize:n(f,c),responseSerialize:o(g),responseDeserialize:n(g,c),originalName:e(a.name),requestType:s(f,d),responseType:s(g,d),options:p(a.parsedOptions)}}function r(a,b,c,d){let e={};for(let f of a.methodsArray)e[f.name]=q(f,b,c,d);return e}function s(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function t(a,b){let c=a.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:c.$type.toObject(c,i),fileDescriptorProtos:b}}function u(a,b,c,d){if(a instanceof f.Service)return r(a,b,c,d);if(a instanceof f.Type)return s(a,d);if(a instanceof f.Enum)return t(a,d);throw Error("Type mismatch in reflection object handling")}function v(a,b){let c={};a.resolveAll();let d=a.toDescriptor("proto3").file.map(a=>Buffer.from(g.FileDescriptorProto.encode(a).finish()));for(let[e,f]of m(a,""))c[e]=u(f,e,b,d);return c}function w(a,b){b=b||{};let c=f.Root.fromDescriptor(a);return c.resolveAll(),v(c,b)}c.load=function(a,b){return(0,h.loadProtosWithOptions)(a,b).then(a=>v(a,b))},c.loadSync=function(a,b){return v((0,h.loadProtosWithOptionsSync)(a,b),b)},c.fromJSON=function(a,b){b=b||{};let c=f.Root.fromJSON(a);return c.resolveAll(),v(c,b)},c.loadFileDescriptorSetFromBuffer=function(a,b){return w(g.FileDescriptorSet.decode(a),b)},c.loadFileDescriptorSetFromObject=function(a,b){return w(g.FileDescriptorSet.fromObject(a),b)},(0,h.addCommonProtos)()},74970,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.getChannelzServiceDefinition=c.getChannelzHandlers=c.unregisterChannelzRef=c.registerChannelzSocket=c.registerChannelzServer=c.registerChannelzSubchannel=c.registerChannelzChannel=c.ChannelzCallTracker=c.ChannelzChildrenTracker=c.ChannelzTrace=void 0;let d=a.r(4446),e=a.r(56537),f=a.r(57982),g=a.r(91177),h=a.r(31509),i=a.r(80721);function j(a){return{channel_id:a.id,name:a.name}}function k(a){return{subchannel_id:a.id,name:a.name}}function l(a){return{server_id:a.id}}function m(a){return{socket_id:a.id,name:a.name}}let n=32;class o{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(a,b,c){let d=new Date;this.events.push({description:b,severity:a,timestamp:d,childChannel:(null==c?void 0:c.kind)==="channel"?c:void 0,childSubchannel:(null==c?void 0:c.kind)==="subchannel"?c:void 0}),this.events.length>=2*n&&(this.events=this.events.slice(n)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:B(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(a=>({description:a.description,severity:a.severity,timestamp:B(a.timestamp),channel_ref:a.childChannel?j(a.childChannel):null,subchannel_ref:a.childSubchannel?k(a.childSubchannel):null}))}}}c.ChannelzTrace=o;class p{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(a){var b,c,d;switch(a.kind){case"channel":{let c=null!=(b=this.channelChildren.get(a.id))?b:{ref:a,count:0};c.count+=1,this.channelChildren.set(a.id,c);break}case"subchannel":{let b=null!=(c=this.subchannelChildren.get(a.id))?c:{ref:a,count:0};b.count+=1,this.subchannelChildren.set(a.id,b);break}case"socket":{let b=null!=(d=this.socketChildren.get(a.id))?d:{ref:a,count:0};b.count+=1,this.socketChildren.set(a.id,b)}}}unrefChild(a){switch(a.kind){case"channel":{let b=this.channelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.channelChildren.delete(a.id):this.channelChildren.set(a.id,b));break}case"subchannel":{let b=this.subchannelChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.subchannelChildren.delete(a.id):this.subchannelChildren.set(a.id,b));break}case"socket":{let b=this.socketChildren.get(a.id);void 0!==b&&(b.count-=1,0===b.count?this.socketChildren.delete(a.id):this.socketChildren.set(a.id,b))}}}getChildLists(){let a=[];for(let{ref:b}of this.channelChildren.values())a.push(b);let b=[];for(let{ref:a}of this.subchannelChildren.values())b.push(a);let c=[];for(let{ref:a}of this.socketChildren.values())c.push(a);return{channels:a,subchannels:b,sockets:c}}}c.ChannelzChildrenTracker=p;class q{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}c.ChannelzCallTracker=q;let r=1;function s(){return r++}let t=[],u=[],v=[],w=[];function x(a){let b=Number.parseInt(a,16);return[b/256|0,b%256]}function y(a){return""===a?[]:[].concat(...a.split(":").map(a=>x(a)))}function z(a){if((0,d.isIPv4)(a))return Buffer.from(Uint8Array.from(a.split(".").map(a=>Number.parseInt(a))));if(!(0,d.isIPv6)(a))return null;{let b,c,d=a.indexOf("::");-1===d?(b=a,c=""):(b=a.substring(0,d),c=a.substring(d+2));let e=Buffer.from(y(b)),f=Buffer.from(y(c)),g=Buffer.alloc(16-e.length-f.length,0);return Buffer.concat([e,g,f])}}function A(a){switch(a){case e.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case e.ConnectivityState.IDLE:return{state:"IDLE"};case e.ConnectivityState.READY:return{state:"READY"};case e.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case e.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function B(a){if(!a)return null;let b=a.getTime();return{seconds:b/1e3|0,nanos:b%1e3*1e6}}function C(a){let b=a.getInfo();return{ref:j(a.ref),data:{target:b.target,state:A(b.state),calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},channel_ref:b.children.channels.map(a=>j(a)),subchannel_ref:b.children.subchannels.map(a=>k(a))}}function D(a,b){let c=Number.parseInt(a.request.channel_id),d=t[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No channel data found for id "+c}):b(null,{channel:C(d)})}function E(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_channel_id);for(;e<t.length;e++){let a=t[e];if(void 0!==a&&(d.push(C(a)),d.length>=c))break}b(null,{channel:d,end:e>=v.length})}function F(a){let b=a.getInfo();return{ref:l(a.ref),data:{calls_started:b.callTracker.callsStarted,calls_succeeded:b.callTracker.callsSucceeded,calls_failed:b.callTracker.callsFailed,last_call_started_timestamp:B(b.callTracker.lastCallStartedTimestamp),trace:b.trace.getTraceMessage()},listen_socket:b.listenerChildren.sockets.map(a=>m(a))}}function G(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];void 0===d?b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c}):b(null,{server:F(d)})}function H(a,b){let c=Number.parseInt(a.request.max_results),d=[],e=Number.parseInt(a.request.start_server_id);for(;e<v.length;e++){let a=v[e];if(void 0!==a&&(d.push(F(a)),d.length>=c))break}b(null,{server:d,end:e>=v.length})}function I(a,b){let c=Number.parseInt(a.request.subchannel_id),d=u[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No subchannel data found for id "+c});let e=d.getInfo();b(null,{subchannel:{ref:k(d.ref),data:{target:e.target,state:A(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:B(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},socket_ref:e.children.sockets.map(a=>m(a))}})}function J(a){var b;return(0,g.isTcpSubchannelAddress)(a)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(b=z(a.host))?b:void 0,port:a.port}}:{address:"uds_address",uds_address:{filename:a.path}}}function K(a,b){var c,d,e,g,h;let i=Number.parseInt(a.request.socket_id),j=w[i];if(void 0===j)return void b({code:f.Status.NOT_FOUND,details:"No socket data found for id "+i});let k=j.getInfo(),l=k.security?{model:"tls",tls:{cipher_suite:k.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(c=k.security.cipherSuiteStandardName)?c:void 0,other_name:null!=(d=k.security.cipherSuiteOtherName)?d:void 0,local_certificate:null!=(e=k.security.localCertificate)?e:void 0,remote_certificate:null!=(g=k.security.remoteCertificate)?g:void 0}}:null;b(null,{socket:{ref:m(j.ref),local:k.localAddress?J(k.localAddress):null,remote:k.remoteAddress?J(k.remoteAddress):null,remote_name:null!=(h=k.remoteName)?h:void 0,security:l,data:{keep_alives_sent:k.keepAlivesSent,streams_started:k.streamsStarted,streams_succeeded:k.streamsSucceeded,streams_failed:k.streamsFailed,last_local_stream_created_timestamp:B(k.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:B(k.lastRemoteStreamCreatedTimestamp),messages_received:k.messagesReceived,messages_sent:k.messagesSent,last_message_received_timestamp:B(k.lastMessageReceivedTimestamp),last_message_sent_timestamp:B(k.lastMessageSentTimestamp),local_flow_control_window:k.localFlowControlWindow?{value:k.localFlowControlWindow}:null,remote_flow_control_window:k.remoteFlowControlWindow?{value:k.remoteFlowControlWindow}:null}}})}function L(a,b){let c=Number.parseInt(a.request.server_id),d=v[c];if(void 0===d)return void b({code:f.Status.NOT_FOUND,details:"No server data found for id "+c});let e=Number.parseInt(a.request.start_socket_id),g=Number.parseInt(a.request.max_results),h=d.getInfo().sessionChildren.sockets.sort((a,b)=>a.id-b.id),i=[],j=0;for(;j<h.length&&(!(h[j].id>=e)||(i.push(m(h[j])),!(i.length>=g)));j++);b(null,{socket_ref:i,end:j>=h.length})}function M(){return{GetChannel:D,GetTopChannels:E,GetServer:G,GetServers:H,GetSubchannel:I,GetSocket:K,GetServerSockets:L}}c.registerChannelzChannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"channel"};return c&&(t[d]={ref:e,getInfo:b}),e},c.registerChannelzSubchannel=function(a,b,c){let d=s(),e={id:d,name:a,kind:"subchannel"};return c&&(u[d]={ref:e,getInfo:b}),e},c.registerChannelzServer=function(a,b){let c=s(),d={id:c,kind:"server"};return b&&(v[c]={ref:d,getInfo:a}),d},c.registerChannelzSocket=function(a,b,c){let d=s(),e={id:d,name:a,kind:"socket"};return c&&(w[d]={ref:e,getInfo:b}),e},c.unregisterChannelzRef=function(a){switch(a.kind){case"channel":delete t[a.id];return;case"subchannel":delete u[a.id];return;case"server":delete v[a.id];return;case"socket":delete w[a.id];return}},c.getChannelzHandlers=M;let N=null;function O(){if(N)return N;let b=(0,a.r(67523).loadSync)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:["/ROOT/node_modules/@grpc/grpc-js/build/src/../../proto"]});return N=(0,i.loadPackageDefinition)(b).grpc.channelz.v1.Channelz.service}c.getChannelzServiceDefinition=O,c.setup=function(){(0,h.registerAdminService)(O,M)}},85115,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Subchannel=void 0;let d=a.r(56537),e=a.r(57451),f=a.r(11717),g=a.r(57982),h=a.r(55647),i=a.r(91177),j=a.r(74970),k="subchannel",l=0x7fffffff;class m{constructor(a,b,c,f,g){var h;this.channelTarget=a,this.subchannelAddress=b,this.options=c,this.credentials=f,this.connector=g,this.connectivityState=d.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new j.ChannelzCallTracker,this.childrenTracker=new j.ChannelzChildrenTracker,this.streamTracker=new j.ChannelzCallTracker;const k={initialDelay:c["grpc.initial_reconnect_backoff_ms"],maxDelay:c["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new e.BackoffTimeout(()=>{this.handleBackoffTimer()},k),this.backoffTimeout.unref(),this.subchannelAddressString=(0,i.subchannelAddressToString)(b),this.keepaliveTime=null!=(h=c["grpc.keepalive_time_ms"])?h:-1,0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new j.ChannelzTrace,this.channelzRef=(0,j.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(c,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(a){f.trace(g.LogVerbosity.DEBUG,k,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}refTrace(a){f.trace(g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING):this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let a=this.options;if(a["grpc.keepalive_time_ms"]){let b=Math.min(this.keepaliveTime,l);a=Object.assign(Object.assign({},a),{"grpc.keepalive_time_ms":b})}this.connector.connect(this.subchannelAddress,this.credentials,a).then(a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.READY)?(this.transport=a,this.channelzEnabled&&this.childrenTracker.refChild(a.getChannelzRef()),a.addDisconnectListener(a=>{this.transitionToState([d.ConnectivityState.READY],d.ConnectivityState.IDLE),a&&this.keepaliveTime>0&&(this.keepaliveTime*=2,f.log(g.LogVerbosity.ERROR,`Connection to ${(0,h.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):a.shutdown()},a=>{this.transitionToState([d.ConnectivityState.CONNECTING],d.ConnectivityState.TRANSIENT_FAILURE,`${a}`)})}transitionToState(a,b,c){var e,f;if(-1===a.indexOf(this.connectivityState))return!1;this.trace(d.ConnectivityState[this.connectivityState]+" -> "+d.ConnectivityState[b]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+d.ConnectivityState[b]);let g=this.connectivityState;switch(this.connectivityState=b,b){case d.ConnectivityState.READY:this.stopBackoff();break;case d.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case d.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(e=this.transport)||e.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case d.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(f=this.transport)||f.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${b}`)}for(let a of this.stateListeners)a(this,g,b,this.keepaliveTime,c);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,j.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([d.ConnectivityState.CONNECTING,d.ConnectivityState.READY],d.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(a,b,c,d){let e;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),e={onCallEnd:a=>{a.code===g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):e={},this.transport.createCall(a,b,c,d,e)}startConnecting(){process.nextTick(()=>{this.transitionToState([d.ConnectivityState.IDLE],d.ConnectivityState.CONNECTING)||this.connectivityState!==d.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(a){this.stateListeners.add(a)}removeConnectivityStateListener(a){this.stateListeners.delete(a)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([d.ConnectivityState.TRANSIENT_FAILURE],d.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(a){return a.getRealSubchannel()===this}throttleKeepalive(a){a>this.keepaliveTime&&(this.keepaliveTime=a)}}c.Subchannel=m},25328,(a,b,c)=>{b.exports=a.x("http2",()=>require("http2"))},21517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},79594,(a,b,c)=>{b.exports=a.x("dns",()=>require("dns"))},87695,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.DEFAULT_PORT=void 0;let d=a.r(49845),e=a.r(79594),f=a.r(24361),g=a.r(83931),h=a.r(57982),i=a.r(57904),j=a.r(11717),k=a.r(57982),l=a.r(55647),m=a.r(4446),n=a.r(57451),o="dns_resolver";function p(a){j.trace(k.LogVerbosity.DEBUG,o,a)}c.DEFAULT_PORT=443;let q=3e4,r=f.promisify(e.resolveTxt),s=f.promisify(e.lookup);function t(...a){let b=[];for(let c=0;c<Math.max.apply(null,a.map(a=>a.length));c++)for(let d of a)c<d.length&&b.push(d[c]);return b}class u{constructor(a,b,d){var e,f,g;this.target=a,this.listener=b,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,p("Resolver constructed for target "+(0,l.uriToString)(a));const j=(0,l.splitHostPort)(a.path);null===j?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,m.isIPv4)(j.host)||(0,m.isIPv6)(j.host)?(this.ipResult=[{host:j.host,port:null!=(e=j.port)?e:c.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=j.host,this.port=null!=(f=j.port)?f:c.DEFAULT_PORT),this.percentage=100*Math.random(),1===d["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:h.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata};const k={initialDelay:d["grpc.initial_reconnect_backoff_ms"],maxDelay:d["grpc.max_reconnect_backoff_ms"]};this.backoff=new n.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},k),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(g=d["grpc.dns_min_time_between_resolutions_ms"])?g:q,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(p("Returning IP address for target "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)p("Failed to parse DNS address "+(0,l.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:h.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,l.uriToString)(this.target)}`,metadata:new i.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;p("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let a=this.dnsHostname;this.pendingLookupPromise=s(a,{all:!0}),this.pendingLookupPromise.then(a=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let b=a.filter(a=>4===a.family),c=a.filter(a=>6===a.family);this.latestLookupResult=t(c,b).map(a=>({host:a.address,port:+this.port}));let d="["+this.latestLookupResult.map(a=>a.host+":"+a.port).join(",")+"]";(p("Resolved addresses for target "+(0,l.uriToString)(this.target)+": "+d),0===this.latestLookupResult.length)?this.listener.onError(this.defaultResolutionError):this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},a=>{null!==this.pendingLookupPromise&&(p("Resolution error for target "+(0,l.uriToString)(this.target)+": "+a.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=r(a),this.pendingTxtPromise.then(a=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,g.extractAndSelectServiceConfig)(a,this.percentage)}catch(a){this.latestServiceConfigError={code:h.Status.UNAVAILABLE,details:`Parsing service config failed with error ${a.message}`,metadata:new i.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},a=>{}))}}startNextResolutionTimer(){var a,b;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(b=(a=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:b.call(a),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?p('resolution update delayed by "min time between resolutions" rate limit'):p("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(a){return a.path}}c.setup=function(){(0,d.registerResolver)("dns",u),(0,d.registerDefaultScheme)("dns")}},17048,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getProxiedConnection=c.mapProxyName=void 0;let d=a.r(11717),e=a.r(57982),f=a.r(49845),g=a.r(21517),h=a.r(55004),i=a.r(11717),j=a.r(91177),k=a.r(55647),l=a.r(92509),m=a.r(87695),n="proxy";function o(a){i.trace(e.LogVerbosity.DEBUG,n,a)}function p(){let a,b="",c="";if(process.env.grpc_proxy)c="grpc_proxy",b=process.env.grpc_proxy;else if(process.env.https_proxy)c="https_proxy",b=process.env.https_proxy;else{if(!process.env.http_proxy)return{};c="http_proxy",b=process.env.http_proxy}try{a=new l.URL(b)}catch(a){return(0,d.log)(e.LogVerbosity.ERROR,`cannot parse value of "${c}" env var`),{}}if("http:"!==a.protocol)return(0,d.log)(e.LogVerbosity.ERROR,`"${a.protocol}" scheme not supported in proxy URI`),{};let f=null;a.username&&(a.password?((0,d.log)(e.LogVerbosity.INFO,"userinfo found in proxy URI"),f=`${a.username}:${a.password}`):f=a.username);let g=a.hostname,h=a.port;""===h&&(h="80");let i={address:`${g}:${h}`};return f&&(i.creds=f),o("Proxy server "+i.address+" set by environment variable "+c),i}function q(){let a=process.env.no_grpc_proxy,b="no_grpc_proxy";return(a||(a=process.env.no_proxy,b="no_proxy"),a)?(o("No proxy server list set by environment variable "+b),a.split(",")):[]}c.mapProxyName=function(a,b){var c;let d={target:a,extraOptions:{}};if((null!=(c=b["grpc.enable_http_proxy"])?c:1)===0||"unix"===a.scheme)return d;let e=p();if(!e.address)return d;let f=(0,k.splitHostPort)(a.path);if(!f)return d;let g=f.host;for(let b of q())if(b===g)return o("Not using proxy for target in no_proxy list: "+(0,k.uriToString)(a)),d;let h={"grpc.http_connect_target":(0,k.uriToString)(a)};return e.creds&&(h["grpc.http_connect_creds"]=e.creds),{target:{scheme:"dns",path:e.address},extraOptions:h}},c.getProxiedConnection=function(a,b,c){var i;if(!("grpc.http_connect_target"in b))return Promise.resolve({});let l=b["grpc.http_connect_target"],n=(0,k.parseUri)(l);if(null===n)return Promise.resolve({});let p=(0,k.splitHostPort)(n.path);if(null===p)return Promise.resolve({});let q=`${p.host}:${null!=(i=p.port)?i:m.DEFAULT_PORT}`,r={method:"CONNECT",path:q},s={Host:q};(0,j.isTcpSubchannelAddress)(a)?(r.host=a.host,r.port=a.port):r.socketPath=a.path,"grpc.http_connect_creds"in b&&(s["Proxy-Authorization"]="Basic "+Buffer.from(b["grpc.http_connect_creds"]).toString("base64")),r.headers=s;let t=(0,j.subchannelAddressToString)(a);return o("Using proxy "+t+" to connect to "+r.path),new Promise((a,b)=>{let i=g.request(r);i.once("connect",(g,j,l)=>{var m;if(i.removeAllListeners(),j.removeAllListeners(),200===g.statusCode)if(o("Successfully connected to "+r.path+" through proxy "+t),"secureContext"in c){let d=(0,f.getDefaultAuthority)(n),e=(0,k.splitHostPort)(d),g=null!=(m=null==e?void 0:e.host)?m:d,i=h.connect(Object.assign({host:g,servername:g,socket:j},c),()=>{o("Successfully established a TLS connection to "+r.path+" through proxy "+t),a({socket:i,realTarget:n})});i.on("error",a=>{o("Failed to establish a TLS connection to "+r.path+" through proxy "+t+" with error "+a.message),b()})}else o("Successfully established a plaintext connection to "+r.path+" through proxy "+t),a({socket:j,realTarget:n});else(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to "+r.path+" through proxy "+t+" with status "+g.statusCode),b()}),i.once("error",a=>{i.removeAllListeners(),(0,d.log)(e.LogVerbosity.ERROR,"Failed to connect to proxy "+t+" with error "+a.message),b()}),i.end()})}},64241,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.StreamDecoder=void 0,function(a){a[a.NO_DATA=0]="NO_DATA",a[a.READING_SIZE=1]="READING_SIZE",a[a.READING_MESSAGE=2]="READING_MESSAGE"}(d||(d={}));class e{constructor(a){this.maxReadMessageLength=a,this.readState=d.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(a){let b,c=0,e=[];for(;c<a.length;)switch(this.readState){case d.NO_DATA:this.readCompressFlag=a.slice(c,c+1),c+=1,this.readState=d.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case d.READING_SIZE:if(b=Math.min(a.length-c,this.readSizeRemaining),a.copy(this.readPartialSize,4-this.readSizeRemaining,c,c+b),this.readSizeRemaining-=b,c+=b,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=d.READING_MESSAGE;else{let a=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=d.NO_DATA,e.push(a)}}break;case d.READING_MESSAGE:if(b=Math.min(a.length-c,this.readMessageRemaining),this.readPartialMessage.push(a.slice(c,c+b)),this.readMessageRemaining-=b,c+=b,0===this.readMessageRemaining){let a=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),b=Buffer.concat(a,this.readMessageSize+5);this.readState=d.NO_DATA,e.push(b)}break;default:throw Error("Unexpected read state")}return e}}c.StreamDecoder=e},34314,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelCall=void 0;let d=a.r(25328),e=a.r(46786),f=a.r(57982),g=a.r(57904),h=a.r(64241),i=a.r(11717),j=a.r(57982),k="subchannel_call";function l(a){for(let[b,c]of Object.entries(e.constants.errno))if(c===a)return b;return"Unknown system error "+a}class m{constructor(a,b,c,e,i){var j;this.http2Stream=a,this.callEventTracker=b,this.listener=c,this.transport=e,this.callId=i,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=f.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;const k=null!=(j=e.getOptions()["grpc.max_receive_message_length"])?j:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new h.StreamDecoder(k),a.on("response",(a,b)=>{let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";switch(this.trace("Received server headers:\n"+c),a[":status"]){case 400:this.mappedStatusCode=f.Status.INTERNAL;break;case 401:this.mappedStatusCode=f.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=f.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=f.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=f.Status.UNAVAILABLE;break;default:this.mappedStatusCode=f.Status.UNKNOWN}if(b&d.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(a);else{let b;try{b=g.Metadata.fromHttp2Headers(a)}catch(a){this.endCall({code:f.Status.UNKNOWN,details:a.message,metadata:new g.Metadata});return}this.listener.onReceiveMetadata(b)}}),a.on("trailers",a=>{this.handleTrailers(a)}),a.on("data",a=>{let b;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+a.length);try{b=this.decoder.write(a)}catch(a){this.cancelWithStatus(f.Status.RESOURCE_EXHAUSTED,a.message);return}for(let a of b)this.trace("parsed message of length "+a.length),this.callEventTracker.addMessageReceived(),this.tryPush(a)}}),a.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),a.on("close",()=>{process.nextTick(()=>{var b;let c;if(this.trace("HTTP/2 stream closed with code "+a.rstCode),(null==(b=this.finalStatus)?void 0:b.code)===f.Status.OK)return;let e="";switch(a.rstCode){case d.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`;break;case d.constants.NGHTTP2_REFUSED_STREAM:c=f.Status.UNAVAILABLE,e="Stream refused by server";break;case d.constants.NGHTTP2_CANCEL:c=f.Status.CANCELLED,e="Call cancelled";break;case d.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=f.Status.RESOURCE_EXHAUSTED,e="Bandwidth exhausted or memory limit exceeded";break;case d.constants.NGHTTP2_INADEQUATE_SECURITY:c=f.Status.PERMISSION_DENIED,e="Protocol not secure enough";break;case d.constants.NGHTTP2_INTERNAL_ERROR:c=f.Status.INTERNAL,null===this.internalError?e=`Received RST_STREAM with code ${a.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(c=f.Status.UNAVAILABLE,e=this.internalError.message):e=`Received RST_STREAM with code ${a.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=f.Status.INTERNAL,e=`Received RST_STREAM with code ${a.rstCode}`}this.endCall({code:c,details:e,metadata:new g.Metadata,rstCode:a.rstCode})})}),a.on("error",a=>{"ERR_HTTP2_STREAM_ERROR"!==a.code&&(this.trace("Node error event: message="+a.message+" code="+a.code+" errno="+l(a.errno)+" syscall="+a.syscall),this.internalError=a),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:f.Status.UNAVAILABLE,details:"Connection dropped",metadata:new g.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(a){i.trace(j.LogVerbosity.DEBUG,k,"["+this.callId+"] "+a)}endCall(a){(null===this.finalStatus||this.finalStatus.code===f.Status.OK)&&(this.finalStatus=a,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===f.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(a){this.trace("pushing to reader message of length "+(a instanceof Buffer?a.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(a),this.maybeOutputStatus())})}tryPush(a){this.canPush?(this.http2Stream.pause(),this.push(a)):(this.trace("unpushedReadMessages.push message of length "+a.length),this.unpushedReadMessages.push(a))}handleTrailers(a){let b;this.callEventTracker.onStreamEnd(!0);let c="";for(let b of Object.keys(a))c+="		"+b+": "+a[b]+"\n";this.trace("Received server trailers:\n"+c);try{b=g.Metadata.fromHttp2Headers(a)}catch(a){b=new g.Metadata}let d=b.getMap(),e=this.mappedStatusCode;if(e===f.Status.UNKNOWN&&"string"==typeof d["grpc-status"]){let a=Number(d["grpc-status"]);a in f.Status&&(e=a,this.trace("received status code "+a+" from server")),b.remove("grpc-status")}let h="";if("string"==typeof d["grpc-message"]){try{h=decodeURI(d["grpc-message"])}catch(a){h=d["grpc-message"]}b.remove("grpc-message"),this.trace('received status details string "'+h+'" from server')}let i={code:e,details:h,metadata:b};this.endCall(i)}destroyHttp2Stream(){var a;if(!this.http2Stream.destroyed){let b;b=(null==(a=this.finalStatus)?void 0:a.code)===f.Status.OK?d.constants.NGHTTP2_NO_ERROR:d.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+b),this.http2Stream.close(b)}}cancelWithStatus(a,b){this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.endCall({code:a,details:b,metadata:new g.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==f.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let a=this.unpushedReadMessages.shift();this.push(a);return}this.http2Stream.resume()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length);let c=b=>{process.nextTick(()=>{var c;let d=f.Status.UNAVAILABLE;(null==b?void 0:b.code)==="ERR_STREAM_WRITE_AFTER_END"&&(d=f.Status.INTERNAL),b&&this.cancelWithStatus(d,`Write error: ${b.message}`),null==(c=a.callback)||c.call(a)})};this.trace("sending data chunk of length "+b.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(b,c)}catch(a){this.endCall({code:f.Status.UNAVAILABLE,details:`Write failed with error ${a.message}`,metadata:new g.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}c.Http2SubchannelCall=m},72672,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getNextCallNumber=void 0;let d=0;c.getNextCallNumber=function(){return d++}},95320,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2SubchannelConnector=void 0;let d=a.r(25328),e=a.r(55004),f=a.r(74970),g=a.r(57982),h=a.r(17048),i=a.r(11717),j=a.r(49845),k=a.r(91177),l=a.r(55647),m=a.r(4446),n=a.r(34314),o=a.r(72672),p="transport",q="transport_flowctrl",r=a.r(17887).version,{HTTP2_HEADER_AUTHORITY:s,HTTP2_HEADER_CONTENT_TYPE:t,HTTP2_HEADER_METHOD:u,HTTP2_HEADER_PATH:v,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:x}=d.constants,y=2e4,z=Buffer.from("too_many_pings","ascii");class A{constructor(a,b,c,e){this.session=a,this.options=c,this.remoteName=e,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=y,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new f.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,k.subchannelAddressToString)(b),0===c["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,f.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[c["grpc.primary_user_agent"],`grpc-node-js/${r}`,c["grpc.secondary_user_agent"]].filter(a=>a).join(" "),"grpc.keepalive_time_ms"in c&&(this.keepaliveTimeMs=c["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in c&&(this.keepaliveTimeoutMs=c["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in c?this.keepaliveWithoutCalls=1===c["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,a.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),a.once("goaway",(a,b,c)=>{let e=!1;a===d.constants.NGHTTP2_ENHANCE_YOUR_CALM&&c&&c.equals(z)&&(e=!0),this.trace("connection closed by GOAWAY with code "+a+" and data "+(null==c?void 0:c.toString())),this.reportDisconnectToOwner(e)}),a.once("error",a=>{this.trace("connection closed with error "+a.message)}),i.isTracerEnabled(p)&&(a.on("remoteSettings",b=>{this.trace("new settings received"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))}),a.on("localSettings",b=>{this.trace("local settings acknowledged by remote"+(this.session!==a?" on the old connection":"")+": "+JSON.stringify(b))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var a,b,c;let d,e=this.session.socket,f=e.remoteAddress?(0,k.stringToSubchannelAddress)(e.remoteAddress,e.remotePort):null,g=e.localAddress?(0,k.stringToSubchannelAddress)(e.localAddress,e.localPort):null;if(this.session.encrypted){let b=e,c=b.getCipher(),f=b.getCertificate(),g=b.getPeerCertificate();d={cipherSuiteStandardName:null!=(a=c.standardName)?a:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else d=null;return{remoteAddress:f,localAddress:g,security:d,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(b=this.session.state.localWindowSize)?b:null,remoteFlowControlWindow:null!=(c=this.session.state.remoteWindowSize)?c:null}}trace(a){i.trace(g.LogVerbosity.DEBUG,p,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}keepaliveTrace(a){i.trace(g.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}flowControlTrace(a){i.trace(g.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}internalsTrace(a){i.trace(g.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+a)}reportDisconnectToOwner(a){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(b=>b(a)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let a of this.activeCalls)a.onDisconnect()})}addDisconnectListener(a){this.disconnectListeners.push(a)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var a,b;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(b=(a=this.keepaliveTimeoutId).unref)||b.call(a));try{this.session.ping((a,b,c)=>{a&&(this.keepaliveTrace("Ping failed with error "+a.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(a){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var a,b;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(b=(a=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:b.call(a)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(a){this.activeCalls.delete(a),0===this.activeCalls.size&&this.session.unref()}addActiveCall(a){this.activeCalls.add(a),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(a,b,c,d,e){let f,g,h,i=a.toHttp2Headers();i[s]=b,i[x]=this.userAgent,i[t]="application/grpc",i[u]="POST",i[v]=c,i[w]="trailers";try{f=this.session.request(i)}catch(a){throw this.handleDisconnect(),a}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),g={addMessageSent:()=>{var a;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;a?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(b=e.onStreamEnd)||b.call(e,a)}}):g={addMessageSent:()=>{var a;null==(a=e.addMessageSent)||a.call(e)},addMessageReceived:()=>{var a;null==(a=e.addMessageReceived)||a.call(e)},onCallEnd:a=>{var b;null==(b=e.onCallEnd)||b.call(e,a),this.removeActiveCall(h)},onStreamEnd:a=>{var b;null==(b=e.onStreamEnd)||b.call(e,a)}},h=new n.Http2SubchannelCall(f,g,d,this,(0,o.getNextCallNumber)()),this.addActiveCall(h),h}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,f.unregisterChannelzRef)(this.channelzRef)}}class B{constructor(a){this.channelTarget=a,this.session=null,this.isShutdown=!1}trace(a){i.trace(g.LogVerbosity.DEBUG,p,(0,l.uriToString)(this.channelTarget)+" "+a)}createSession(a,b,c,f){return this.isShutdown?Promise.reject():new Promise((g,h)=>{var i,n,o;let p;f.realTarget?(p=(0,l.uriToString)(f.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,l.uriToString)(f.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,k.subchannelAddressToString)(a)));let q=(0,j.getDefaultAuthority)(null!=(i=f.realTarget)?i:this.channelTarget),r=b._getConnectionOptions()||{};r.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in c?r.maxSessionMemory=c["grpc-node.max_session_memory"]:r.maxSessionMemory=Number.MAX_SAFE_INTEGER;let s="http://";if("secureContext"in r){if(s="https://",c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];r.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),r.servername=a}else{let a=null!=(o=null==(n=(0,l.splitHostPort)(q))?void 0:n.host)?o:"localhost";r.servername=a}f.socket&&(r.createConnection=(a,b)=>f.socket)}else r.createConnection=(b,c)=>f.socket?f.socket:m.connect(a);r=Object.assign(Object.assign(Object.assign({},r),a),{enableTrace:1===c["grpc-node.tls_enable_trace"]});let t=d.connect(s+q,r);this.session=t;let u="Failed to connect";t.unref(),t.once("connect",()=>{t.removeAllListeners(),g(new A(t,a,c,p)),this.session=null}),t.once("close",()=>{this.session=null,setImmediate(()=>{h(`${u} (${new Date().toISOString()})`)})}),t.once("error",a=>{u=a.message,this.trace("connection failed with error "+u)})})}connect(a,b,c){var d,f;if(this.isShutdown)return Promise.reject();let g=b._getConnectionOptions()||{};if("secureContext"in g){if(g.ALPNProtocols=["h2"],c["grpc.ssl_target_name_override"]){let a=c["grpc.ssl_target_name_override"];g.checkServerIdentity=(b,c)=>(0,e.checkServerIdentity)(a,c),g.servername=a}else if("grpc.http_connect_target"in c){let a=(0,j.getDefaultAuthority)(null!=(d=(0,l.parseUri)(c["grpc.http_connect_target"]))?d:{path:"localhost"}),b=(0,l.splitHostPort)(a);g.servername=null!=(f=null==b?void 0:b.host)?f:a}c["grpc-node.tls_enable_trace"]&&(g.enableTrace=!0)}return(0,h.getProxiedConnection)(a,c,g).then(d=>this.createSession(a,b,c,d))}shutdown(){var a;this.isShutdown=!0,null==(a=this.session)||a.close(),this.session=null}}c.Http2SubchannelConnector=B},72939,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSubchannelPool=c.SubchannelPool=void 0;let d=a.r(69359),e=a.r(85115),f=a.r(91177),g=a.r(55647),h=a.r(95320),i=1e4;class j{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let a=!0;for(let b in this.pool){let c=this.pool[b].filter(a=>!a.subchannel.unrefIfOneRef());c.length>0&&(a=!1),this.pool[b]=c}a&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var a,b;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},i),null==(b=(a=this.cleanupTimer).unref)||b.call(a))}getOrCreateSubchannel(a,b,c,i){this.ensureCleanupTask();let j=(0,g.uriToString)(a);if(j in this.pool){for(let a of this.pool[j])if((0,f.subchannelAddressEqual)(b,a.subchannelAddress)&&(0,d.channelOptionsEqual)(c,a.channelArguments)&&i._equals(a.channelCredentials))return a.subchannel}let k=new e.Subchannel(a,b,c,i,new h.Http2SubchannelConnector(a));return j in this.pool||(this.pool[j]=[]),this.pool[j].push({subchannelAddress:b,channelArguments:c,channelCredentials:i,subchannel:k}),k.ref(),k}}c.SubchannelPool=j;let k=new j;c.getSubchannelPool=function(a){return a?k:new j}},15325,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FilterStackFactory=c.FilterStack=void 0;class d{constructor(a){this.filters=a}sendMetadata(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMetadata(b);return b}receiveMetadata(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMetadata(b);return b}sendMessage(a){let b=a;for(let a=0;a<this.filters.length;a++)b=this.filters[a].sendMessage(b);return b}receiveMessage(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveMessage(b);return b}receiveTrailers(a){let b=a;for(let a=this.filters.length-1;a>=0;a--)b=this.filters[a].receiveTrailers(b);return b}push(a){this.filters.unshift(...a)}getFilters(){return this.filters}}c.FilterStack=d;class e{constructor(a){this.factories=a}push(a){this.factories.unshift(...a)}clone(){return new e([...this.factories])}createFilter(){return new d(this.factories.map(a=>a.createFilter()))}}c.FilterStackFactory=e},6461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},69425,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionAlgorithms=void 0,function(a){a[a.identity=0]="identity",a[a.deflate=1]="deflate",a[a.gzip=2]="gzip"}(d||(c.CompressionAlgorithms=d={}))},59940,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseFilter=void 0;class d{async sendMetadata(a){return a}receiveMetadata(a){return a}async sendMessage(a){return a}async receiveMessage(a){return a}receiveTrailers(a){return a}}c.BaseFilter=d},13298,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CompressionFilterFactory=c.CompressionFilter=void 0;let d=a.r(6461),e=a.r(69425),f=a.r(57982),g=a.r(59940),h=a.r(11717),i=a=>"number"==typeof a&&"string"==typeof e.CompressionAlgorithms[a];class j{async writeMessage(a,b){let c=a;b&&(c=await this.compressMessage(c));let d=Buffer.allocUnsafe(c.length+5);return d.writeUInt8(+!!b,0),d.writeUInt32BE(c.length,1),c.copy(d,5),d}async readMessage(a){let b=1===a.readUInt8(0),c=a.slice(5);return b&&(c=await this.decompressMessage(c)),c}}class k extends j{async compressMessage(a){return a}async writeMessage(a,b){let c=Buffer.allocUnsafe(a.length+5);return c.writeUInt8(0,0),c.writeUInt32BE(a.length,1),a.copy(c,5),c}decompressMessage(a){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class l extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.deflate(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createInflate();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class m extends j{constructor(a){super(),this.maxRecvMessageLength=a}compressMessage(a){return new Promise((b,c)=>{d.gzip(a,(a,d)=>{a?c(a):b(d)})})}decompressMessage(a){return new Promise((b,c)=>{let e=0,g=[],h=d.createGunzip();h.on("data",a=>{g.push(a),e+=a.byteLength,-1!==this.maxRecvMessageLength&&e>this.maxRecvMessageLength&&(h.destroy(),c({code:f.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),h.on("end",()=>{b(Buffer.concat(g))}),h.write(a),h.end()})}}class n extends j{constructor(a){super(),this.compressionName=a}compressMessage(a){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(a){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function o(a,b){switch(a){case"identity":return new k;case"deflate":return new l(b);case"gzip":return new m(b);default:return new n(a)}}class p extends g.BaseFilter{constructor(a,b){var c,d;super(),this.sharedFilterConfig=b,this.sendCompression=new k,this.receiveCompression=new k,this.currentCompressionAlgorithm="identity";const g=a["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(c=a["grpc.max_receive_message_length"])?c:f.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==g)if(i(g)){const a=e.CompressionAlgorithms[g],c=null==(d=b.serverSupportedEncodingHeader)?void 0:d.split(",");(!c||c.includes(a))&&(this.currentCompressionAlgorithm=a,this.sendCompression=o(this.currentCompressionAlgorithm,-1))}else h.log(f.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${g}`)}async sendMetadata(a){let b=await a;return b.set("grpc-accept-encoding","identity,deflate,gzip"),b.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?b.remove("grpc-encoding"):b.set("grpc-encoding",this.currentCompressionAlgorithm),b}receiveMetadata(a){let b=a.get("grpc-encoding");if(b.length>0){let a=b[0];"string"==typeof a&&(this.receiveCompression=o(a,this.maxReceiveMessageLength))}a.remove("grpc-encoding");let c=a.get("grpc-accept-encoding")[0];return c&&(this.sharedFilterConfig.serverSupportedEncodingHeader=c,c.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new k,this.currentCompressionAlgorithm="identity")),a.remove("grpc-accept-encoding"),a}async sendMessage(a){var b;let c,d=await a;return c=!(this.sendCompression instanceof k)&&((null!=(b=d.flags)?b:0)&2)==0,{message:await this.sendCompression.writeMessage(d.message,c),flags:d.flags}}async receiveMessage(a){return this.receiveCompression.readMessage(await a)}}c.CompressionFilter=p;class q{constructor(a,b){this.options=b,this.sharedFilterConfig={}}createFilter(){return new p(this.options,this.sharedFilterConfig)}}c.CompressionFilterFactory=q},1150,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.deadlineToString=c.getRelativeTimeout=c.getDeadlineTimeoutString=c.minDeadline=void 0,c.minDeadline=function(...a){let b=1/0;for(let c of a){let a=c instanceof Date?c.getTime():c;a<b&&(b=a)}return b};let d=[["m",1],["S",1e3],["M",6e4],["H",36e5]];c.getDeadlineTimeoutString=function(a){let b=new Date().getTime();a instanceof Date&&(a=a.getTime());let c=Math.max(a-b,0);for(let[a,b]of d){let d=c/b;if(d<1e8)return String(Math.ceil(d))+a}throw Error("Deadline is too far in the future")};let e=0x7fffffff;c.getRelativeTimeout=function(a){let b=(a instanceof Date?a.getTime():a)-new Date().getTime();return b<0?0:b>e?1/0:b},c.deadlineToString=function(a){if(a instanceof Date)return a.toISOString();{let b=new Date(a);return Number.isNaN(b.getTime())?""+a:b.toISOString()}}},65149,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.restrictControlPlaneStatusCode=void 0;let d=a.r(57982),e=[d.Status.OK,d.Status.INVALID_ARGUMENT,d.Status.NOT_FOUND,d.Status.ALREADY_EXISTS,d.Status.FAILED_PRECONDITION,d.Status.ABORTED,d.Status.OUT_OF_RANGE,d.Status.DATA_LOSS];c.restrictControlPlaneStatusCode=function(a,b){return e.includes(a)?{code:d.Status.INTERNAL,details:`Invalid status from control plane: ${a} ${d.Status[a]} ${b}`}:{code:a,details:b}}},25326,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoadBalancingCall=void 0;let d=a.r(56537),e=a.r(57982),f=a.r(1150),g=a.r(57904),h=a.r(3681),i=a.r(55647),j=a.r(11717),k=a.r(65149),l=a.r(25328),m="load_balancing_call";class n{constructor(a,b,c,d,e,f,g){var h,j;this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;const k=this.methodName.split("/");let l="";k.length>=2&&(l=k[1]);const m=null!=(j=null==(h=(0,i.splitHostPort)(this.host))?void 0:h.host)?j:"localhost";this.serviceUrl=`https://${m}/${l}`}trace(a){j.trace(e.LogVerbosity.DEBUG,m,"["+this.callNumber+"] "+a)}outputStatus(a,b){var c,d;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+a.code+' details="'+a.details+'"');let e=Object.assign(Object.assign({},a),{progress:b});null==(c=this.listener)||c.onReceiveStatus(e),null==(d=this.onCallEnded)||d.call(this,e.code)}}doPick(){var a,b;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let c=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=c.subchannel?"("+c.subchannel.getChannelzRef().id+") "+c.subchannel.getAddress():""+c.subchannel;switch(this.trace("Pick result: "+h.PickResultType[c.pickResultType]+" subchannel: "+i+" status: "+(null==(a=c.status)?void 0:a.code)+" "+(null==(b=c.status)?void 0:b.details)),c.pickResultType){case h.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var b,h,j;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let k=this.metadata.clone();if(k.merge(a),k.get("authorization").length>1&&this.outputStatus({code:e.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new g.Metadata},"PROCESSED"),c.subchannel.getConnectivityState()!==d.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+d.ConnectivityState[c.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&k.set("grpc-timeout",(0,f.getDeadlineTimeoutString)(this.deadline));try{this.child=c.subchannel.getRealSubchannel().createCall(k,this.host,this.methodName,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(a)},onReceiveMessage:a=>{this.trace("Received message"),this.listener.onReceiveMessage(a)},onReceiveStatus:a=>{this.trace("Received status"),a.rstCode===l.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(a,"REFUSED"):this.outputStatus(a,"PROCESSED")}})}catch(a){this.trace("Failed to start call on picked subchannel "+i+" with error "+a.message),this.outputStatus({code:e.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+a.message,metadata:new g.Metadata},"NOT_STARTED");return}null==(h=(b=this.callConfig).onCommitted)||h.call(b),null==(j=c.onCallStarted)||j.call(c),this.onCallEnded=c.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:b,details:c}=(0,k.restrictControlPlaneStatusCode)("number"==typeof a.code?a.code:e.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:b,details:c,metadata:new g.Metadata},"PROCESSED")});break;case h.PickResultType.DROP:let{code:j,details:m}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:j,details:m,metadata:c.status.metadata},"DROP")});break;case h.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:b}=(0,k.restrictControlPlaneStatusCode)(c.status.code,c.status.details);setImmediate(()=>{this.outputStatus({code:a,details:b,metadata:c.status.metadata},"PROCESSED")})}break;case h.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new g.Metadata},"PROCESSED")}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.listener=b,this.metadata=a,this.doPick()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.child.sendMessageWithContext(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}c.LoadBalancingCall=n},8122,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ResolvingCall=void 0;let d=a.r(57982),e=a.r(1150),f=a.r(57904),g=a.r(11717),h=a.r(65149),i="resolving_call";class j{constructor(a,b,c,f,g,h){this.channel=a,this.method=b,this.filterStackFactory=f,this.credentials=g,this.callNumber=h,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=c.deadline,this.host=c.host,c.parentCall&&(c.flags&d.Propagate.CANCELLATION&&c.parentCall.on("cancelled",()=>{this.cancelWithStatus(d.Status.CANCELLED,"Cancelled by parent call")}),c.flags&d.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+c.parentCall.getDeadline()),this.deadline=(0,e.minDeadline)(this.deadline,c.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(a){g.trace(d.LogVerbosity.DEBUG,i,"["+this.callNumber+"] "+a)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,e.deadlineToString)(this.deadline));let a=(0,e.getRelativeTimeout)(this.deadline);if(a!==1/0){this.trace("Deadline will be reached in "+a+"ms");let b=()=>{this.cancelWithStatus(d.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};a<=0?process.nextTick(b):this.deadlineTimer=setTimeout(b,a)}}outputStatus(a){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let b=this.filterStack.receiveTrailers(a);this.trace("ended with status: code="+b.code+' details="'+b.details+'"'),this.statusWatchers.forEach(a=>a(b)),process.nextTick(()=>{var a;null==(a=this.listener)||a.onReceiveStatus(b)})}}sendMessageOnChild(a,b){if(!this.child)throw Error("sendMessageonChild called with child not populated");let c=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:b,flags:a.flags})).then(b=>{this.writeFilterPending=!1,c.sendMessageWithContext(a,b.message),this.pendingHalfClose&&c.halfClose()},a=>{this.cancelWithStatus(a.code,a.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let a=this.channel.getConfig(this.method,this.metadata);if("NONE"===a.type)return void this.channel.queueCallForConfig(this);if("ERROR"===a.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(a.error));let b=a.config;if(b.status!==d.Status.OK){let{code:a,details:c}=(0,h.restrictControlPlaneStatusCode)(b.status,"Failed to route call to method "+this.method);this.outputStatus({code:a,details:c,metadata:new f.Metadata});return}if(b.methodConfig.timeout){let a=new Date;a.setSeconds(a.getSeconds()+b.methodConfig.timeout.seconds),a.setMilliseconds(a.getMilliseconds()+b.methodConfig.timeout.nanos/1e6),this.deadline=(0,e.minDeadline)(this.deadline,a),this.runDeadlineTimer()}this.filterStackFactory.push(b.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(a=>{this.child=this.channel.createInnerCall(b,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(a,{onReceiveMetadata:a=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(a))},onReceiveMessage:a=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(a).then(a=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(a),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},a=>{this.cancelWithStatus(a.code,a.details)})},onReceiveStatus:a=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=a:this.outputStatus(a)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},a=>{this.outputStatus(a)})}reportResolverError(a){var b;(null==(b=this.metadata)?void 0:b.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(a)}cancelWithStatus(a,b){var c;this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),null==(c=this.child)||c.cancelWithStatus(a,b),this.outputStatus({code:a,details:b,metadata:new f.Metadata})}getPeer(){var a,b;return null!=(b=null==(a=this.child)?void 0:a.getPeer())?b:this.channel.getTarget()}start(a,b){this.trace("start called"),this.metadata=a.clone(),this.listener=b,this.getConfig()}sendMessageWithContext(a,b){this.trace("write() called with message of length "+b.length),this.child?this.sendMessageOnChild(a,b):this.pendingMessage={context:a,message:b}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(a){this.credentials=this.credentials.compose(a)}addStatusWatcher(a){this.statusWatchers.push(a)}getCallNumber(){return this.callNumber}}c.ResolvingCall=j},98364,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.RetryingCall=c.MessageBufferTracker=c.RetryThrottler=void 0;let d=a.r(57982),e=a.r(57904),f=a.r(11717),g="retrying_call";class h{constructor(a,b,c){this.maxTokens=a,this.tokenRatio=b,c?this.tokens=c.tokens*(a/c.maxTokens):this.tokens=a}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}c.RetryThrottler=h;class i{constructor(a,b){this.totalLimit=a,this.limitPerCall=b,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(a,b){var c;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;return!(this.limitPerCall-d<a)&&!(this.totalLimit-this.totalAllocated<a)&&(this.allocatedPerCall.set(b,d+a),this.totalAllocated+=a,!0)}free(a,b){var c;if(this.totalAllocated<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > total allocated ${this.totalAllocated}`);this.totalAllocated-=a;let d=null!=(c=this.allocatedPerCall.get(b))?c:0;if(d<a)throw Error(`Invalid buffer allocation state: call ${b} freed ${a} > allocated for call ${d}`);this.allocatedPerCall.set(b,d-a)}freeAll(a){var b;let c=null!=(b=this.allocatedPerCall.get(a))?b:0;if(this.totalAllocated<c)throw Error(`Invalid buffer allocation state: call ${a} allocated ${c} > total allocated ${this.totalAllocated}`);this.totalAllocated-=c,this.allocatedPerCall.delete(a)}}c.MessageBufferTracker=i;let j="grpc-previous-rpc-attempts";class k{constructor(a,b,c,d,e,f,g,h,i){if(this.channel=a,this.callConfig=b,this.methodName=c,this.host=d,this.credentials=e,this.deadline=f,this.callNumber=g,this.bufferTracker=h,this.retryThrottler=i,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,b.methodConfig.retryPolicy){this.state="RETRY";const a=b.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(a.initialBackoff.substring(0,a.initialBackoff.length-1))}else b.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(a){f.trace(d.LogVerbosity.DEBUG,g,"["+this.callNumber+"] "+a)}reportStatus(a){this.trace("ended with status: code="+a.code+' details="'+a.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var b;null==(b=this.listener)||b.onReceiveStatus({code:a.code,details:a.details,metadata:a.metadata})})}cancelWithStatus(a,b){for(let{call:c}of(this.trace("cancelWithStatus code: "+a+' details: "'+b+'"'),this.reportStatus({code:a,details:b,metadata:new e.Metadata}),this.underlyingCalls))c.cancelWithStatus(a,b)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(a){var b;return null!=(b=this.writeBuffer[a-this.writeBufferOffset])?b:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let a=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let b=this.writeBufferOffset;b<a;b++){let a=this.getBufferEntry(b);a.allocated&&this.bufferTracker.free(a.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(a-this.writeBufferOffset),this.writeBufferOffset=a}commitCall(a){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[a].state){this.trace("Committing call ["+this.underlyingCalls[a].call.getCallNumber()+"] at index "+a),this.state="COMMITTED",this.committedCallIndex=a;for(let b=0;b<this.underlyingCalls.length;b++)b!==a&&"COMPLETED"!==this.underlyingCalls[b].state&&(this.underlyingCalls[b].state="COMPLETED",this.underlyingCalls[b].call.cancelWithStatus(d.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let a=-1,b=-1;for(let[c,d]of this.underlyingCalls.entries())"ACTIVE"===d.state&&d.nextMessageToSend>a&&(a=d.nextMessageToSend,b=c);-1===b?this.state="TRANSPARENT_ONLY":this.commitCall(b)}isStatusCodeInList(a,b){return a.some(a=>a===b||a.toString().toLowerCase()===d.Status[b].toLowerCase())}getNextRetryBackoffMs(){var a;let b=null==(a=this.callConfig)?void 0:a.methodConfig.retryPolicy;if(!b)return 0;let c=Math.random()*this.nextRetryBackoffSec*1e3,d=Number(b.maxBackoff.substring(0,b.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*b.backoffMultiplier,d),c}maybeRetryCall(a,b){let c;if("RETRY"!==this.state)return void b(!1);let d=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return void b(!1);if(null===a)c=this.getNextRetryBackoffMs();else if(a<0){this.state="TRANSPARENT_ONLY",b(!1);return}else c=a,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var a,c;"RETRY"!==this.state?b(!1):(null==(c=null==(a=this.retryThrottler)?void 0:a.canRetryCall())||c)&&(b(!0),this.attempts+=1,this.startNewAttempt())},c)}countActiveCalls(){let a=0;for(let b of this.underlyingCalls)(null==b?void 0:b.state)==="ACTIVE"&&(a+=1);return a}handleProcessedStatus(a,b,c){var d,e,f;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(b),this.reportStatus(a);break;case"HEDGING":if(this.isStatusCodeInList(null!=(d=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?d:[],a.code)){let d;if(null==(e=this.retryThrottler)||e.addCallFailed(),null===c)d=0;else if(c<0){this.state="TRANSPARENT_ONLY",this.commitCall(b),this.reportStatus(a);return}else d=c;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(b),this.reportStatus(a))},d)}else this.commitCall(b),this.reportStatus(a);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,a.code)?(null==(f=this.retryThrottler)||f.addCallFailed(),this.maybeRetryCall(c,c=>{c||(this.commitCall(b),this.reportStatus(a))})):(this.commitCall(b),this.reportStatus(a))}}getPushback(a){let b=a.get("grpc-retry-pushback-ms");if(0===b.length)return null;try{return parseInt(b[0])}catch(a){return -1}}handleChildStatus(a,b){var c;if("COMPLETED"===this.underlyingCalls[b].state)return;if(this.trace("state="+this.state+" handling status with progress "+a.progress+" from child ["+this.underlyingCalls[b].call.getCallNumber()+"] in state "+this.underlyingCalls[b].state),this.underlyingCalls[b].state="COMPLETED",a.code===d.Status.OK){null==(c=this.retryThrottler)||c.addCallSucceeded(),this.commitCall(b),this.reportStatus(a);return}if("COMMITTED"===this.state)return void this.reportStatus(a);let e=this.getPushback(a.metadata);switch(a.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(a,b,e):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(b),this.reportStatus(a);break;case"PROCESSED":this.handleProcessedStatus(a,b,e)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let a=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(a.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var a,b,c;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let d=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(d.maxAttempts,5))return;let e=null!=(a=d.hedgingDelay)?a:"0s",f=Number(e.substring(0,e.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*f),null==(c=(b=this.hedgingTimer).unref)||c.call(b)}startNewAttempt(){let a=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+a.getCallNumber()+"] for attempt "+this.attempts);let b=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:a,nextMessageToSend:0});let c=this.attempts-1,d=this.initialMetadata.clone();c>0&&d.set(j,`${c}`);let e=!1;a.start(d,{onReceiveMetadata:d=>{this.trace("Received metadata from child ["+a.getCallNumber()+"]"),this.commitCall(b),e=!0,c>0&&d.set(j,`${c}`),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMetadata(d)},onReceiveMessage:c=>{this.trace("Received message from child ["+a.getCallNumber()+"]"),this.commitCall(b),"ACTIVE"===this.underlyingCalls[b].state&&this.listener.onReceiveMessage(c)},onReceiveStatus:d=>{this.trace("Received status from child ["+a.getCallNumber()+"]"),!e&&c>0&&d.metadata.set(j,`${c}`),this.handleChildStatus(d,b)}}),this.sendNextChildMessage(b),this.readStarted&&a.startRead()}start(a,b){this.trace("start called"),this.listener=b,this.initialMetadata=a,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(a){var b,c;let d=this.underlyingCalls[a],e=d.nextMessageToSend;null==(c=(b=this.getBufferEntry(e)).callback)||c.call(b),this.clearSentMessages(),d.nextMessageToSend+=1,this.sendNextChildMessage(a)}sendNextChildMessage(a){let b=this.underlyingCalls[a];if("COMPLETED"!==b.state&&this.getBufferEntry(b.nextMessageToSend)){let c=this.getBufferEntry(b.nextMessageToSend);switch(c.entryType){case"MESSAGE":b.call.sendMessageWithContext({callback:b=>{this.handleChildWriteCompleted(a)}},c.message.message);break;case"HALF_CLOSE":b.nextMessageToSend+=1,b.call.halfClose()}}}sendMessageWithContext(a,b){var c;this.trace("write() called with message of length "+b.length);let d={message:b,flags:a.flags},e=this.getNextBufferIndex(),f={entryType:"MESSAGE",message:d,allocated:this.bufferTracker.allocate(b.length,this.callNumber)};if(this.writeBuffer.push(f),f.allocated)for(let[d,f]of(null==(c=a.callback)||c.call(a),this.underlyingCalls.entries()))"ACTIVE"===f.state&&f.nextMessageToSend===e&&f.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(d)}},b);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let c=this.underlyingCalls[this.committedCallIndex];f.callback=a.callback,"ACTIVE"===c.state&&c.nextMessageToSend===e&&c.call.sendMessageWithContext({callback:a=>{this.handleChildWriteCompleted(this.committedCallIndex)}},b)}}startRead(){for(let a of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==a?void 0:a.state)==="ACTIVE"&&a.call.startRead()}halfClose(){this.trace("halfClose called");let a=this.getNextBufferIndex();for(let b of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==b?void 0:b.state)==="ACTIVE"&&b.nextMessageToSend===a&&(b.nextMessageToSend+=1,b.call.halfClose())}setCredentials(a){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}c.RetryingCall=k},4706,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseSubchannelWrapper=void 0;class d{constructor(a){this.child=a}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(a){this.child.addConnectivityStateListener(a)}removeConnectivityStateListener(a){this.child.removeConnectivityStateListener(a)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(a){this.child.throttleKeepalive(a)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(a){return this.getRealSubchannel()===a.getRealSubchannel()}}c.BaseSubchannelWrapper=d},75952,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InternalChannel=void 0;let d=a.r(61591),e=a.r(74765),f=a.r(72939),g=a.r(3681),h=a.r(57982),i=a.r(15325),j=a.r(13298),k=a.r(49845),l=a.r(11717),m=a.r(17048),n=a.r(55647),o=a.r(56537),p=a.r(74970),q=a.r(25326),r=a.r(1150),s=a.r(8122),t=a.r(72672),u=a.r(65149),v=a.r(98364),w=a.r(4706),x=0x7fffffff,y=1e3,z=18e5,A=new Map,B=0x1000000,C=1048576;class D extends w.BaseSubchannelWrapper{constructor(a,b){super(a),this.channel=b,this.refCount=0,this.subchannelStateListener=(a,c,d,e)=>{b.throttleKeepalive(e)},a.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class E{constructor(a,b,c){var q,r,s,t,w,E,F,G;if(this.credentials=b,this.options=c,this.connectivityState=o.ConnectivityState.IDLE,this.currentPicker=new g.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new p.ChannelzCallTracker,this.childrenTracker=new p.ChannelzChildrenTracker,"string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.originalTarget=a;const H=(0,n.parseUri)(a);if(null===H)throw Error(`Could not parse target name "${a}"`);const I=(0,k.mapUriDefaultScheme)(H);if(null===I)throw Error(`Could not find a default scheme for target name "${a}"`);this.callRefTimer=setInterval(()=>{},x),null==(r=(q=this.callRefTimer).unref)||r.call(q),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new p.ChannelzTrace,this.channelzRef=(0,p.registerChannelzChannel)(a,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,k.getDefaultAuthority)(I);const J=(0,m.mapProxyName)(I,c);this.target=J.target,this.options=Object.assign({},this.options,J.extraOptions),this.subchannelPool=(0,f.getSubchannelPool)((null!=(s=c["grpc.use_local_subchannel_pool"])?s:0)===0),this.retryBufferTracker=new v.MessageBufferTracker(null!=(t=c["grpc.retry_buffer_size"])?t:B,null!=(w=c["grpc.per_rpc_retry_buffer_size"])?w:C),this.keepaliveTime=null!=(E=c["grpc.keepalive_time_ms"])?E:-1,this.idleTimeoutMs=Math.max(null!=(F=c["grpc.client_idle_timeout_ms"])?F:z,y);const K={createSubchannel:(a,b)=>{let c=this.subchannelPool.getOrCreateSubchannel(this.target,a,Object.assign({},this.options,b),this.credentials);c.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",c.getChannelzRef());let d=new D(c,this);return this.wrappedSubchannels.add(d),d},updateState:(a,b)=>{this.currentPicker=b;let c=this.pickQueue.slice();for(let a of(this.pickQueue=[],c.length>0&&this.callRefTimerUnref(),c))a.doPick();this.updateState(a)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.refChild(a)},removeChannelzChild:a=>{this.channelzEnabled&&this.childrenTracker.unrefChild(a)}};this.resolvingLoadBalancer=new e.ResolvingLoadBalancer(this.target,K,c,(a,b)=>{a.retryThrottling?A.set(this.getTarget(),new v.RetryThrottler(a.retryThrottling.maxTokens,a.retryThrottling.tokenRatio,A.get(this.getTarget()))):A.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=b,this.currentResolutionError=null,process.nextTick(()=>{let a=this.configSelectionQueue;for(let b of(this.configSelectionQueue=[],a.length>0&&this.callRefTimerUnref(),a))b.getConfig()})},a=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+a.code+' and details "'+a.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,u.restrictControlPlaneStatusCode)(a.code,a.details)),{metadata:a.metadata}));let b=this.configSelectionQueue;for(let c of(this.configSelectionQueue=[],b.length>0&&this.callRefTimerUnref(),b))c.reportResolverError(a)}),this.filterStackFactory=new i.FilterStackFactory([new j.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(c,void 0,2));const L=Error();(0,l.trace)(h.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(G=L.stack)?void 0:G.substring(L.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(a,b){(0,l.trace)(null!=b?b:h.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+a)}callRefTimerRef(){var a,b,c,d;(null==(b=(a=this.callRefTimer).hasRef)?void 0:b.call(a))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(d=(c=this.callRefTimer).ref)||d.call(c))}callRefTimerUnref(){var a,b;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(b=(a=this.callRefTimer).unref)||b.call(a))}removeConnectivityStateWatcher(a){let b=this.connectivityStateWatchers.findIndex(b=>b===a);b>=0&&this.connectivityStateWatchers.splice(b,1)}updateState(a){for(let b of((0,l.trace)(h.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,n.uriToString)(this.target)+" "+o.ConnectivityState[this.connectivityState]+" -> "+o.ConnectivityState[a]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+o.ConnectivityState[a]),this.connectivityState=a,this.connectivityStateWatchers.slice()))a!==b.currentState&&(b.timer&&clearTimeout(b.timer),this.removeConnectivityStateWatcher(b),b.callback());a!==o.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(a){if(a>this.keepaliveTime)for(let b of(this.keepaliveTime=a,this.wrappedSubchannels))b.throttleKeepalive(a)}removeWrappedSubchannel(a){this.wrappedSubchannels.delete(a)}doPick(a,b){return this.currentPicker.pick({metadata:a,extraPickInfo:b})}queueCallForPick(a){this.pickQueue.push(a),this.callRefTimerRef()}getConfig(a,b){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(a,b)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(a){this.configSelectionQueue.push(a),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.IDLE),this.currentPicker=new g.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(a){var b,c;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let a=new Date().valueOf()-this.lastActivityTimestamp.valueOf();a>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-a)},a),null==(c=(b=this.idleTimer).unref)||c.call(b)}maybeStartIdleTimer(){this.connectivityState===o.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(a){this.channelzEnabled&&(a.code===h.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+f+'] method="'+b+'"'),new q.LoadBalancingCall(this,a,b,c,d,e,f)}createRetryingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();return this.trace("createRetryingCall ["+f+'] method="'+b+'"'),new v.RetryingCall(this,a,b,c,d,e,f,this.retryBufferTracker,A.get(this.getTarget()))}createInnerCall(a,b,c,d,e){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(a,b,c,d,e):this.createRetryingCall(a,b,c,d,e)}createResolvingCall(a,b,c,d,e){let f=(0,t.getNextCallNumber)();this.trace("createResolvingCall ["+f+'] method="'+a+'", deadline='+(0,r.deadlineToString)(b));let g={deadline:b,flags:null!=e?e:h.Propagate.DEFAULTS,host:null!=c?c:this.defaultAuthority,parentCall:d},i=new s.ResolvingCall(this,a,g,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),f);return this.onCallStart(),i.addStatusWatcher(a=>{this.onCallEnd(a)}),i}close(){this.resolvingLoadBalancer.destroy(),this.updateState(o.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,p.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,n.uriToString)(this.target)}getConnectivityState(a){let b=this.connectivityState;return a&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),b}watchConnectivityState(a,b,c){if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let d=null;if(b!==1/0){let a=b instanceof Date?b:new Date(b),f=new Date;if(b===-1/0||a<=f)return void process.nextTick(c,Error("Deadline passed without connectivity state change"));d=setTimeout(()=>{this.removeConnectivityStateWatcher(e),c(Error("Deadline passed without connectivity state change"))},a.getTime()-f.getTime())}let e={currentState:a,callback:c,timer:d};this.connectivityStateWatchers.push(e)}getChannelzRef(){return this.channelzRef}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===o.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(a,b,c,d,e)}}c.InternalChannel=E},61655,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ChannelImplementation=void 0;let d=a.r(61591),e=a.r(75952);class f{constructor(a,b,c){if("string"!=typeof a)throw TypeError("Channel target must be a string");if(!(b instanceof d.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(c&&"object"!=typeof c)throw TypeError("Channel options must be an object");this.internalChannel=new e.InternalChannel(a,b,c)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(a){return this.internalChannel.getConnectivityState(a)}watchConnectivityState(a,b,c){this.internalChannel.watchConnectivityState(a,b,c)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(a,b,c,d,e){if("string"!=typeof a)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof b||b instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(a,b,c,d,e)}}c.ChannelImplementation=f},15365,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Http2ServerCallStream=c.ServerDuplexStreamImpl=c.ServerWritableStreamImpl=c.ServerReadableStreamImpl=c.ServerUnaryCallImpl=void 0;let d=a.r(27699),e=a.r(25328),f=a.r(88947),g=a.r(6461),h=a.r(57982),i=a.r(57904),j=a.r(64241),k=a.r(11717),l=a.r(21015),m="server_call";function n(a){k.trace(h.LogVerbosity.DEBUG,m,a)}let o="grpc-message",p="grpc-status",q="grpc-timeout",r=/(\d{1,8})\s*([HMSmun])/,s={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},t={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},u={[e.constants.HTTP2_HEADER_STATUS]:e.constants.HTTP_STATUS_OK,[e.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},v={waitForTrailers:!0};class w extends d.EventEmitter{constructor(a,b,c){super(),this.call=a,this.metadata=b,this.request=c,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerUnaryCallImpl=w;class x extends f.Readable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.deserialize=c,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,d)}_read(a){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}c.ServerReadableStreamImpl=x;class y extends f.Writable{constructor(a,b,c,d){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.request=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(a,b,c){try{let b=this.call.serializeMessage(a);if(!this.call.write(b))return void this.call.once("drain",c)}catch(a){this.emit("error",{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}c()}_final(a){this.call.sendStatus({code:h.Status.OK,details:"OK",metadata:this.trailingMetadata}),a(null)}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerWritableStreamImpl=y;class z extends f.Duplex{constructor(a,b,c,d,e){super({objectMode:!0}),this.call=a,this.metadata=b,this.serialize=c,this.deserialize=d,this.cancelled=!1,this.trailingMetadata=new i.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,e),this.on("error",a=>{this.call.sendError(a),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(a){this.call.sendMetadata(a)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(a){return a&&(this.trailingMetadata=a),super.end()}}c.ServerDuplexStreamImpl=z,z.prototype._read=x.prototype._read,z.prototype._write=y.prototype._write,z.prototype._final=y.prototype._final;class A extends d.EventEmitter{constructor(a,b,c){super(),this.stream=a,this.handler=b,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=h.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=h.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",a=>{}),this.stream.once("close",()=>{var a;n("Request to method "+(null==(a=this.handler)?void 0:a.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:h.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in c&&(this.maxSendMessageSize=c["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in c&&(this.maxReceiveMessageSize=c["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(a,b){let c=a.subarray(5);if("identity"===b)return c;if("deflate"!==b&&"gzip"!==b)return Promise.reject({code:h.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${b}"`});{let a;return a="deflate"===b?g.createInflate():g.createGunzip(),new Promise((b,d)=>{let e=0,f=[];a.on("data",b=>{f.push(b),e+=b.byteLength,-1!==this.maxReceiveMessageSize&&e>this.maxReceiveMessageSize&&(a.destroy(),d({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),a.on("end",()=>{b(Buffer.concat(f))}),a.write(c),a.end()})}}sendMetadata(a){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let b=a?a.toHttp2Headers():null,c=Object.assign(Object.assign(Object.assign({},u),t),b);this.stream.respond(c,v)}receiveMetadata(a){let b=i.Metadata.fromHttp2Headers(a);k.isTracerEnabled(m)&&n("Request to "+this.handler.path+" received headers "+JSON.stringify(b.toJSON()));let c=b.get(q);if(c.length>0){let a=c[0].toString().match(r);if(null===a){let a=Error("Invalid deadline");return a.code=h.Status.OUT_OF_RANGE,this.sendError(a),b}let d=a[1]*s[a[2]]|0,e=new Date;this.deadline=e.setMilliseconds(e.getMilliseconds()+d),this.deadlineTimer=setTimeout(B,d,this),b.remove(q)}return b.remove(e.constants.HTTP2_HEADER_ACCEPT_ENCODING),b.remove(e.constants.HTTP2_HEADER_TE),b.remove(e.constants.HTTP2_HEADER_CONTENT_TYPE),b.remove("grpc-accept-encoding"),b}receiveUnaryMessage(a){return new Promise((b,c)=>{let{stream:d}=this,e=0,f=this,g=[],i=this.maxReceiveMessageSize;function j(a){if(e+=a.byteLength,-1!==i&&e>i){d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),c({code:h.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${e} vs. ${i})`});return}g.push(a)}function k(i){if(d.removeListener("data",j),d.removeListener("end",k),d.removeListener("error",k),void 0!==i)return void c({code:h.Status.INTERNAL,details:i.message});if(0===e)return void c({code:h.Status.INTERNAL,details:"received empty unary message"});f.emit("receiveMessage");let l=Buffer.concat(g,e),m=1===l.readUInt8(0)?a:"identity",n=f.getDecompressedMessage(l,m);Buffer.isBuffer(n)?b(f.deserializeMessageWithInternalError(n)):n.then(a=>b(f.deserializeMessageWithInternalError(a)),b=>c(b.code?b:{code:h.Status.INTERNAL,details:`Received "grpc-encoding" header "${a}" but ${a} decompression failed`}))}this.stream.on("data",j),this.stream.on("end",k),this.stream.on("error",k)})}async deserializeMessageWithInternalError(a){try{return this.deserializeMessage(a)}catch(a){throw{details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL}}}serializeMessage(a){let b=this.handler.serialize(a),c=b.byteLength,d=Buffer.allocUnsafe(c+5);return d.writeUInt8(0,0),d.writeUInt32BE(c,1),b.copy(d,5),d}deserializeMessage(a){return this.handler.deserialize(a)}async sendUnaryMessage(a,b,c,d){if(!this.checkCancelled()){if(void 0===c&&(c=null),a){!Object.prototype.hasOwnProperty.call(a,"metadata")&&c&&(a.metadata=c),this.sendError(a);return}try{let a=this.serializeMessage(b);this.write(a),this.sendStatus({code:h.Status.OK,details:"OK",metadata:c})}catch(a){this.sendError({details:(0,l.getErrorMessage)(a),code:h.Status.INTERNAL})}}}sendStatus(a){var b,c;if(this.emit("callEnd",a.code),this.emit("streamEnd",a.code===h.Status.OK),!this.checkCancelled())if(n("Request to method "+(null==(b=this.handler)?void 0:b.path)+" ended with status code: "+h.Status[a.code]+" details: "+a.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var b;let c=Object.assign({[p]:a.code,[o]:encodeURI(a.details)},null==(b=a.metadata)?void 0:b.toHttp2Headers());this.stream.sendTrailers(c),this.statusSent=!0}),this.stream.end());else{let b=Object.assign(Object.assign({[p]:a.code,[o]:encodeURI(a.details)},u),null==(c=a.metadata)?void 0:c.toHttp2Headers());this.stream.respond(b,{endStream:!0}),this.statusSent=!0}}sendError(a){let b={code:h.Status.UNKNOWN,details:"message"in a?a.message:"Unknown Error",metadata:"metadata"in a&&void 0!==a.metadata?a.metadata:null};"code"in a&&"number"==typeof a.code&&Number.isInteger(a.code)&&(b.code=a.code,"details"in a&&"string"==typeof a.details&&(b.details=a.details)),this.sendStatus(b)}write(a){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&a.length>this.maxSendMessageSize?void this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${a.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(a))}resume(){this.stream.resume()}setupSurfaceCall(a){this.once("cancelled",b=>{a.cancelled=!0,a.emit("cancelled",b)}),this.once("callEnd",b=>a.emit("callEnd",b))}setupReadable(a,b){let c=new j.StreamDecoder(this.maxReceiveMessageSize),d=!1,e=!1,f=!1,g=async()=>{f||!d||e||(f=!0,await this.pushOrBufferMessage(a,null))};this.stream.on("data",async d=>{let f;try{f=c.write(d)}catch(a){this.sendError({code:h.Status.RESOURCE_EXHAUSTED,details:a.message});return}for(let c of(e=!0,this.stream.pause(),f)){let d;this.emit("receiveMessage");let e=1===c.readUInt8(0)?b:"identity";try{d=await this.getDecompressedMessage(c,e)}catch(a){this.sendError(a);return}if(!d)return;await this.pushOrBufferMessage(a,d)}e=!1,this.stream.resume(),await g()}),this.stream.once("end",async()=>{d=!0,await g()})}consumeUnpushedMessages(a){for(this.canPush=!0;this.messagesToPush.length>0;){let b=this.messagesToPush.shift(),c=a.push(b);if(null===b||!1===c){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(a,b){this.isPushPending?this.bufferedMessages.push(b):await this.pushMessage(a,b)}async pushMessage(a,b){if(null===b){n("Received end of stream"),this.canPush?a.push(null):this.messagesToPush.push(null);return}n("Received message of length "+b.length),this.isPushPending=!0;try{let c=await this.deserializeMessage(b);this.canPush?a.push(c)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(c)}catch(c){this.bufferedMessages.length=0;let b=(0,l.getErrorCode)(c);(null===b||b<h.Status.OK||b>h.Status.UNAUTHENTICATED)&&(b=h.Status.INTERNAL),a.emit("error",{details:(0,l.getErrorMessage)(c),code:b})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(a,this.bufferedMessages.shift())}getPeer(){var a;let b=null==(a=this.stream.session)?void 0:a.socket;return null!=b&&b.remoteAddress?b.remotePort?`${b.remoteAddress}:${b.remotePort}`:b.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function B(a){let b=Error("Deadline exceeded");b.code=h.Status.DEADLINE_EXCEEDED,a.sendError(b),a.cancelled=!0,a.emit("cancelled","deadline")}c.Http2ServerCallStream=A},4296,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerCredentials=void 0;let d=a.r(49229);class e{static createInsecure(){return new f}static createSsl(a,b,c=!1){if(null!==a&&!Buffer.isBuffer(a))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(b))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof c)throw TypeError("checkClientCertificate must be a boolean");let e=[],f=[];for(let a=0;a<b.length;a++){let c=b[a];if(null===c||"object"!=typeof c)throw TypeError(`keyCertPair[${a}] must be an object`);if(!Buffer.isBuffer(c.private_key))throw TypeError(`keyCertPair[${a}].private_key must be a Buffer`);if(!Buffer.isBuffer(c.cert_chain))throw TypeError(`keyCertPair[${a}].cert_chain must be a Buffer`);e.push(c.cert_chain),f.push(c.private_key)}return new g({ca:a||(0,d.getDefaultRootsData)()||void 0,cert:e,key:f,requestCert:c,ciphers:d.CIPHER_SUITES})}}c.ServerCredentials=e;class f extends e{_isSecure(){return!1}_getSettings(){return null}}class g extends e{constructor(a){super(),this.options=a}_isSecure(){return!0}_getSettings(){return this.options}}},41069,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Server=void 0;let d=a.r(25328),e=a.r(57982),f=a.r(15365),g=a.r(4296),h=a.r(49845),i=a.r(11717),j=a.r(91177),k=a.r(55647),l=a.r(74970),m=0x7fffffff,n=0x7fffffff,o=2e4,{HTTP2_HEADER_PATH:p}=d.constants,q="server";function r(){}function s(a){return{code:e.Status.UNIMPLEMENTED,details:`The server does not implement the method ${a}`}}function t(a,b){let c=s(b);switch(a){case"unary":return(a,b)=>{b(c,null)};case"clientStream":return(a,b)=>{b(c,null)};case"serverStream":return a=>{a.emit("error",c)};case"bidi":return a=>{a.emit("error",c)};default:throw Error(`Invalid handlerType ${a}`)}}class u{constructor(a){var b,c,d,e;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new l.ChannelzTrace,this.callTracker=new l.ChannelzCallTracker,this.listenerChildrenTracker=new l.ChannelzChildrenTracker,this.sessionChildrenTracker=new l.ChannelzChildrenTracker,this.options=null!=a?a:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,l.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(b=this.options["grpc.max_connection_age_ms"])?b:m,this.maxConnectionAgeGraceMs=null!=(c=this.options["grpc.max_connection_age_grace_ms"])?c:m,this.keepaliveTimeMs=null!=(d=this.options["grpc.keepalive_time_ms"])?d:n,this.keepaliveTimeoutMs=null!=(e=this.options["grpc.keepalive_timeout_ms"])?e:o,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(a){return()=>{var b,c,d;let e,f=this.sessions.get(a),g=a.socket,h=g.remoteAddress?(0,j.stringToSubchannelAddress)(g.remoteAddress,g.remotePort):null,i=g.localAddress?(0,j.stringToSubchannelAddress)(g.localAddress,g.localPort):null;if(a.encrypted){let a=g,c=a.getCipher(),d=a.getCertificate(),f=a.getPeerCertificate();e={cipherSuiteStandardName:null!=(b=c.standardName)?b:null,cipherSuiteOtherName:c.standardName?null:c.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else e=null;return{remoteAddress:h,localAddress:i,security:e,remoteName:null,streamsStarted:f.streamTracker.callsStarted,streamsSucceeded:f.streamTracker.callsSucceeded,streamsFailed:f.streamTracker.callsFailed,messagesSent:f.messagesSent,messagesReceived:f.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:f.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:f.lastMessageSentTimestamp,lastMessageReceivedTimestamp:f.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(c=a.state.localWindowSize)?c:null,remoteFlowControlWindow:null!=(d=a.state.remoteWindowSize)?d:null}}}trace(a){i.trace(e.LogVerbosity.DEBUG,q,"("+this.channelzRef.id+") "+a)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(a,b){if(null===a||"object"!=typeof a||null===b||"object"!=typeof b)throw Error("addService() requires two objects as arguments");let c=Object.keys(a);if(0===c.length)throw Error("Cannot add an empty service to a server");c.forEach(c=>{let d,e,f=a[c];d=f.requestStream?f.responseStream?"bidi":"clientStream":f.responseStream?"serverStream":"unary";let g=b[c];if(void 0===g&&"string"==typeof f.originalName&&(g=b[f.originalName]),e=void 0!==g?g.bind(b):t(d,c),!1===this.register(f.path,e,f.responseSerialize,f.requestDeserialize,d))throw Error(`Method handler for ${f.path} already provided.`)})}removeService(a){if(null===a||"object"!=typeof a)throw Error("removeService() requires object as argument");Object.keys(a).forEach(b=>{let c=a[b];this.unregister(c.path)})}bind(a,b){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(a,b,c){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof a)throw TypeError("port must be a string");if(null===b||!(b instanceof g.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof c)throw TypeError("callback must be a function");let f=(0,k.parseUri)(a);if(null===f)throw Error(`Could not parse port "${a}"`);let m=(0,h.mapUriDefaultScheme)(f);if(null===m)throw Error(`Could not get a default scheme for port "${a}"`);let n={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?n.maxSessionMemory=this.options["grpc-node.max_session_memory"]:n.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(n.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let o=(a,b)=>{process.nextTick(()=>c(a,b))},p=()=>{let a;if(b._isSecure()){let c=Object.assign(n,b._getSettings());c.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(a=d.createSecureServer(c)).on("secureConnection",a=>{a.on("error",a=>{this.trace("An incoming TLS connection closed with error: "+a.message)})})}else a=d.createServer(n);return a.setTimeout(0,r),this._setupHandlers(a),a},q=(a,b,c)=>0===a.length?Promise.resolve({port:b,count:c}):Promise.all(a.map(a=>{let c;this.trace("Attempting to bind "+(0,j.subchannelAddressToString)(a)),c=(0,j.isTcpSubchannelAddress)(a)?{host:a.host,port:b}:a;let d=p();return new Promise((e,f)=>{let g=b=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(a)+" with error "+b.message),e(b)};d.once("error",g),d.listen(c,()=>{let a;if(this.shutdown){d.close(),e(Error("bindAsync failed because server is shutdown"));return}let c=d.address();a="string"==typeof c?{path:c}:{host:c.address,port:c.port};let f=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(a),()=>({localAddress:a,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(f),this.http2ServerList.push({server:d,channelzRef:f}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(a)),e("port"in a?a.port:b),d.removeListener("error",g)})})})).then(a=>{let d=0;for(let c of a)if("number"==typeof c&&(d+=1,c!==b))throw Error("Invalid state: multiple port numbers added from single address");return{port:b,count:d+c}}),s=a=>{if(0===a.length)return Promise.resolve({port:0,count:0});let b=a[0],c=p();return new Promise((d,e)=>{let f=c=>{this.trace("Failed to bind "+(0,j.subchannelAddressToString)(b)+" with error "+c.message),d(s(a.slice(1)))};c.once("error",f),c.listen(b,()=>{if(this.shutdown){c.close(),d({port:0,count:0});return}let b=c.address(),e={host:b.address,port:b.port},g=(0,l.registerChannelzSocket)((0,j.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:c,channelzRef:g}),this.trace("Successfully bound "+(0,j.subchannelAddressToString)(e)),d(q(a.slice(1),b.port,1)),c.removeListener("error",f)})})},t={onSuccessfulResolution:(b,c,d)=>{let f;(t.onSuccessfulResolution=()=>{},this.shutdown&&o(Error("bindAsync failed because server is shutdown"),0),0===b.length)?o(Error(`No addresses resolved for port ${a}`),0):(f=(0,j.isTcpSubchannelAddress)(b[0])?0===b[0].port?s(b):q(b,b[0].port,0):q(b,1,0)).then(a=>{if(0===a.count){let a=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,a),o(Error(a),0)}else a.count<b.length&&i.log(e.LogVerbosity.INFO,`WARNING Only ${a.count} addresses added out of total ${b.length} resolved`),o(null,a.port)},a=>{let c=`No address added out of total ${b.length} resolved`;i.log(e.LogVerbosity.ERROR,c),o(Error(c),0)})},onError:a=>{o(Error(a.details),0)}};(0,h.createResolver)(m,t,this.options).updateResolution()}forceShutdown(){for(let{server:a,channelzRef:b}of this.http2ServerList)a.listening&&a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b))});this.started=!1,this.shutdown=!0,this.sessions.forEach((a,b)=>{b.destroy(d.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef)}register(a,b,c,d,e){return!this.handlers.has(a)&&(this.handlers.set(a,{func:b,serialize:c,deserialize:d,type:e,path:a}),!0)}unregister(a){return this.handlers.delete(a)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:a})=>!0!==a.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(a){let b=b=>{this.channelzEnabled&&(0,l.unregisterChannelzRef)(this.channelzRef),a(b)},c=0;function d(){0==--c&&b()}for(let{server:a,channelzRef:b}of(this.started=!1,this.shutdown=!0,this.http2ServerList))a.listening&&(c++,a.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(b),(0,l.unregisterChannelzRef)(b)),d()}));this.sessions.forEach((a,b)=>{b.closed||(c+=1,b.close(d))}),0===c&&b()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(a,b){let c=b[d.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof c&&!!c.startsWith("application/grpc")||(a.respond({[d.constants.HTTP2_HEADER_STATUS]:d.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(a){this.trace("Received call to method "+a+" at address "+this.serverAddressString);let b=this.handlers.get(a);return void 0===b?(this.trace("No handler registered for method "+a+". Sending UNIMPLEMENTED status."),null):b}_respondWithError(a,b,c=null){let d=new f.Http2ServerCallStream(b,null,this.options);void 0===a.code&&(a.code=e.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed()),d.sendError(a)}_channelzHandler(a,b){let c=this.sessions.get(a.session);if(this.callTracker.addCallStarted(),null==c||c.streamTracker.addCallStarted(),!this._verifyContentType(a,b)){this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed();return}let d=b[p],g=this._retrieveHandler(d);if(!g)return void this._respondWithError(s(d),a,c);let h=new f.Http2ServerCallStream(a,g,this.options);h.once("callEnd",a=>{a===e.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),c&&(h.once("streamEnd",a=>{a?c.streamTracker.addCallSucceeded():c.streamTracker.addCallFailed()}),h.on("sendMessage",()=>{c.messagesSent+=1,c.lastMessageSentTimestamp=new Date}),h.on("receiveMessage",()=>{c.messagesReceived+=1,c.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(h,g,b)||(this.callTracker.addCallFailed(),null==c||c.streamTracker.addCallFailed(),h.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${g.type}`}))}_streamHandler(a,b){if(!0!==this._verifyContentType(a,b))return;let c=b[p],d=this._retrieveHandler(c);if(!d)return void this._respondWithError(s(c),a,null);let g=new f.Http2ServerCallStream(a,d,this.options);this._runHandlerForCall(g,d,b)||g.sendError({code:e.Status.INTERNAL,details:`Unknown handler type: ${d.type}`})}_runHandlerForCall(a,b,c){var d;let e=a.receiveMetadata(c),f=null!=(d=e.get("grpc-encoding")[0])?d:"identity";e.remove("grpc-encoding");let{type:g}=b;if("unary"===g)v(a,b,e,f);else if("clientStream"===g)w(a,b,e,f);else if("serverStream"===g)x(a,b,e,f);else{if("bidi"!==g)return!1;y(a,b,e,f)}return!0}_setupHandlers(a){if(null===a)return;let b=a.address(),c="null";b&&(c="string"==typeof b?b:b.address+":"+b.port),this.serverAddressString=c;let e=this.channelzEnabled?this._channelzHandler:this._streamHandler;a.on("stream",e.bind(this)),a.on("session",a=>{var b,c,e,f,g;if(!this.started)return void a.destroy();let h=(0,l.registerChannelzSocket)(null!=(b=a.socket.remoteAddress)?b:"unknown",this.getChannelzSessionInfoGetter(a),this.channelzEnabled),i={ref:h,streamTracker:new l.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(a,i);let j=a.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+j),this.sessionChildrenTracker.refChild(h));let k=null,n=null,o=!1;if(this.maxConnectionAgeMs!==m){let b=this.maxConnectionAgeMs/10,f=Math.random()*b*2-b;k=null==(e=(c=setTimeout(()=>{var b,c;o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+j);try{a.goaway(d.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(b){a.destroy();return}a.close(),this.maxConnectionAgeGraceMs!==m&&(n=null==(c=(b=setTimeout(()=>{a.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:c.call(b))},this.maxConnectionAgeMs+f)).unref)?void 0:e.call(c)}let p=null==(g=(f=setInterval(()=>{var b,c;let d=null==(c=(b=setTimeout(()=>{o=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+j),a.close()},this.keepaliveTimeoutMs)).unref)?void 0:c.call(b);try{a.ping((a,b,c)=>{clearTimeout(d)})}catch(b){a.destroy()}},this.keepaliveTimeMs)).unref)?void 0:g.call(f);a.on("close",()=>{this.channelzEnabled&&(o||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+j),this.sessionChildrenTracker.unrefChild(h),(0,l.unregisterChannelzRef)(h)),k&&clearTimeout(k),n&&clearTimeout(n),p&&clearTimeout(p),this.sessions.delete(a)})})}}async function v(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerUnaryCallImpl(a,c,e);b.func(g,(b,c,d,e)=>{a.sendUnaryMessage(b,c,d,e)})}catch(b){a.sendError(b)}}function w(a,b,c,d){let e=new f.ServerReadableStreamImpl(a,c,b.deserialize,d);function g(b,c,d,f){e.destroy(),a.sendUnaryMessage(b,c,d,f)}a.cancelled||(e.on("error",g),b.func(e,g))}async function x(a,b,c,d){try{let e=await a.receiveUnaryMessage(d);if(void 0===e||a.cancelled)return;let g=new f.ServerWritableStreamImpl(a,c,b.serialize,e);b.func(g)}catch(b){a.sendError(b)}}function y(a,b,c,d){let e=new f.ServerDuplexStreamImpl(a,c,b.serialize,b.deserialize,d);a.cancelled||b.func(e)}c.Server=u},36272,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StatusBuilder=void 0;class d{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(a){return this.code=a,this}withDetails(a){return this.details=a,this}withMetadata(a){return this.metadata=a,this}build(){let a={};return null!==this.code&&(a.code=this.code),null!==this.details&&(a.details=this.details),null!==this.metadata&&(a.metadata=this.metadata),a}}c.StatusBuilder=d},38999,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.isDuration=c.durationToMs=c.msToDuration=void 0,c.msToDuration=function(a){return{seconds:a/1e3|0,nanos:a%1e3*1e6|0}},c.durationToMs=function(a){return 1e3*a.seconds+a.nanos/1e6|0},c.isDuration=function(a){return"number"==typeof a.seconds&&"number"==typeof a.nanos}},62818,(a,b,c)=>{"use strict";var d;Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.OutlierDetectionLoadBalancer=c.OutlierDetectionLoadBalancingConfig=void 0;let e=a.r(56537),f=a.r(57982),g=a.r(38999),h=a.r(94497),i=a.r(39071),j=a.r(33140),k=a.r(3681),l=a.r(91177),m=a.r(4706),n=a.r(11717),o="outlier_detection";function p(a){n.trace(f.LogVerbosity.DEBUG,o,a)}let q="outlier_detection",r=(null!=(d=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?d:"true")==="true",s={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},t={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function u(a,b,c,d){if(b in a&&typeof a[b]!==c){let e=d?`${d}.${b}`:b;throw Error(`outlier detection config ${e} parse error: expected ${c}, got ${typeof a[b]}`)}}function v(a,b,c){let d=c?`${c}.${b}`:b;if(b in a){if(!(0,g.isDuration)(a[b]))throw Error(`outlier detection config ${d} parse error: expected Duration, got ${typeof a[b]}`);if(!(a[b].seconds>=0&&a[b].seconds<=315576e6&&a[b].nanos>=0&&a[b].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${d} parse error: values out of range for non-negative Duaration`)}}function w(a,b,c){let d=c?`${c}.${b}`:b;if(u(a,b,"number",c),b in a&&!(a[b]>=0&&a[b]<=100))throw Error(`outlier detection config ${d} parse error: value out of range for percentage (0-100)`)}class x{constructor(a,b,c,d,e,f,g){if(this.childPolicy=g,g.length>0&&"pick_first"===g[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=a?a:1e4,this.baseEjectionTimeMs=null!=b?b:3e4,this.maxEjectionTimeMs=null!=c?c:3e5,this.maxEjectionPercent=null!=d?d:10,this.successRateEjection=e?Object.assign(Object.assign({},s),e):null,this.failurePercentageEjection=f?Object.assign(Object.assign({},t),f):null}getLoadBalancerName(){return q}toJsonObject(){return{interval:(0,g.msToDuration)(this.intervalMs),base_ejection_time:(0,g.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,g.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(a=>a.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(a){return new x(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,a)}static createFromJson(a){var b;if(v(a,"interval"),v(a,"base_ejection_time"),v(a,"max_ejection_time"),w(a,"max_ejection_percent"),"success_rate_ejection"in a){if("object"!=typeof a.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");u(a.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(a.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),u(a.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),u(a.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in a){if("object"!=typeof a.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(a.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(a.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),u(a.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),u(a.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new x(a.interval?(0,g.durationToMs)(a.interval):null,a.base_ejection_time?(0,g.durationToMs)(a.base_ejection_time):null,a.max_ejection_time?(0,g.durationToMs)(a.max_ejection_time):null,null!=(b=a.max_ejection_percent)?b:null,a.success_rate_ejection,a.failure_percentage_ejection,a.child_policy.map(i.validateLoadBalancingConfig))}}c.OutlierDetectionLoadBalancingConfig=x;class y extends m.BaseSubchannelWrapper{constructor(a,b){super(a),this.mapEntry=b,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=a.getConnectivityState(),a.addConnectivityStateListener((a,b,c,d)=>{if(this.childSubchannelState=c,!this.ejected)for(let a of this.stateListeners)a(this,b,c,d)})}getConnectivityState(){return this.ejected?e.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(a){this.stateListeners.push(a)}removeConnectivityStateListener(a){let b=this.stateListeners.indexOf(a);b>-1&&this.stateListeners.splice(b,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let a=this.mapEntry.subchannelWrappers.indexOf(this);a>=0&&this.mapEntry.subchannelWrappers.splice(a,1)}}eject(){for(let a of(this.ejected=!0,this.stateListeners))a(this,this.childSubchannelState,e.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let a of(this.ejected=!1,this.stateListeners))a(this,e.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function z(){return{success:0,failure:0}}class A{constructor(){this.activeBucket=z(),this.inactiveBucket=z()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=z()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class B{constructor(a,b){this.wrappedPicker=a,this.countCalls=b}pick(a){let b=this.wrappedPicker.pick(a);if(b.pickResultType!==k.PickResultType.COMPLETE)return b;{let a=b.subchannel,c=a.getMapEntry();if(!c)return Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel()});{let d=b.onCallEnded;return this.countCalls&&(d=a=>{var d;a===f.Status.OK?c.counter.addSuccess():c.counter.addFailure(),null==(d=b.onCallEnded)||d.call(b,a)}),Object.assign(Object.assign({},b),{subchannel:a.getWrappedSubchannel(),onCallEnded:d})}}}}class C{constructor(a){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new j.ChildLoadBalancerHandler((0,h.createChildChannelControlHelper)(a,{createSubchannel:(b,c)=>{let d=a.createSubchannel(b,c),e=this.addressMap.get((0,l.subchannelAddressToString)(b)),f=new y(d,e);return(null==e?void 0:e.currentEjectionTimestamp)!==null&&f.eject(),null==e||e.subchannelWrappers.push(f),f},updateState:(b,c)=>{b===e.ConnectivityState.READY?a.updateState(b,new B(c,this.isCountingEnabled())):a.updateState(b,c)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let a=0;for(let b of this.addressMap.values())null!==b.currentEjectionTimestamp&&(a+=1);return 100*a/this.addressMap.size}runSuccessRateCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getSuccessRateEjectionConfig();if(!b)return;p("Running success rate check");let c=b.request_volume,d=0,e=[];for(let[a,b]of this.addressMap){let f=b.counter.getLastSuccesses(),g=b.counter.getLastFailures();p("Stats for "+a+": successes="+f+" failures="+g+" targetRequestVolume="+c),f+g>=c&&(d+=1,e.push(f/(f+g)))}if(p("Found "+d+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+e+"]"),d<b.minimum_hosts)return;let f=e.reduce((a,b)=>a+b)/e.length,g=0;for(let a of e){let b=a-f;g+=b*b}let h=Math.sqrt(g/e.length),i=f-h*(b.stdev_factor/1e3);for(let[d,e]of(p("stdev="+h+" ejectionThreshold="+i),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=e.counter.getLastSuccesses(),g=e.counter.getLastFailures();if(f+g<c)continue;let h=f/(f+g);if(p("Checking candidate "+d+" successRate="+h),h<i){let c=100*Math.random();p("Candidate "+d+" randomNumber="+c+" enforcement_percentage="+b.enforcement_percentage),c<b.enforcement_percentage&&(p("Ejecting candidate "+d),this.eject(e,a))}}}runFailurePercentageCheck(a){if(!this.latestConfig)return;let b=this.latestConfig.getFailurePercentageEjectionConfig();if(!b)return;p("Running failure percentage check. threshold="+b.threshold+" request volume threshold="+b.request_volume);let c=0;for(let a of this.addressMap.values())a.counter.getLastSuccesses()+a.counter.getLastFailures()>=b.request_volume&&(c+=1);if(!(c<b.minimum_hosts))for(let[c,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let e=d.counter.getLastSuccesses(),f=d.counter.getLastFailures();if((p("Candidate successes="+e+" failures="+f),!(e+f<b.request_volume))&&100*f/(f+e)>b.threshold){let e=100*Math.random();p("Candidate "+c+" randomNumber="+e+" enforcement_percentage="+b.enforcement_percentage),e<b.enforcement_percentage&&(p("Ejecting candidate "+c),this.eject(d,a))}}}eject(a,b){for(let b of(a.currentEjectionTimestamp=new Date,a.ejectionTimeMultiplier+=1,a.subchannelWrappers))b.eject()}uneject(a){for(let b of(a.currentEjectionTimestamp=null,a.subchannelWrappers))b.uneject()}switchAllBuckets(){for(let a of this.addressMap.values())a.counter.switchBuckets()}startTimer(a){var b,c;this.ejectionTimer=setTimeout(()=>this.runChecks(),a),null==(c=(b=this.ejectionTimer).unref)||c.call(b)}runChecks(){let a=new Date;if(p("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[b,c]of(this.timerStartTime=a,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(a),this.runFailurePercentageCheck(a),this.addressMap.entries()))if(null===c.currentEjectionTimestamp)c.ejectionTimeMultiplier>0&&(c.ejectionTimeMultiplier-=1);else{let a=this.latestConfig.getBaseEjectionTimeMs(),d=this.latestConfig.getMaxEjectionTimeMs(),e=new Date(c.currentEjectionTimestamp.getTime());e.setMilliseconds(e.getMilliseconds()+Math.min(a*c.ejectionTimeMultiplier,Math.max(a,d))),e<new Date&&(p("Unejecting "+b),this.uneject(c))}}updateAddressList(a,b,c){if(!(b instanceof x))return;let d=new Set;for(let b of a)d.add((0,l.subchannelAddressToString)(b));for(let a of d)this.addressMap.has(a)||(p("Adding map entry for "+a),this.addressMap.set(a,{counter:new A,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let a of this.addressMap.keys())d.has(a)||(p("Removing map entry for "+a),this.addressMap.delete(a));let e=(0,i.getFirstUsableConfig)(b.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(a,e,c),b.getSuccessRateEjectionConfig()||b.getFailurePercentageEjectionConfig())if(this.timerStartTime){p("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let a=b.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(a)}else p("Starting new timer"),this.timerStartTime=new Date,this.startTimer(b.getIntervalMs()),this.switchAllBuckets();else for(let a of(p("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(a),a.ejectionTimeMultiplier=0;this.latestConfig=b}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return q}}c.OutlierDetectionLoadBalancer=C,c.setup=function(){r&&(0,h.registerLoadBalancerType)(q,C,x)}},94497,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OutlierDetectionLoadBalancingConfig=c.BaseSubchannelWrapper=c.registerAdminService=c.FilterStackFactory=c.BaseFilter=c.PickResultType=c.QueuePicker=c.UnavailablePicker=c.ChildLoadBalancerHandler=c.subchannelAddressToString=c.validateLoadBalancingConfig=c.getFirstUsableConfig=c.registerLoadBalancerType=c.createChildChannelControlHelper=c.BackoffTimeout=c.durationToMs=c.uriToString=c.createResolver=c.registerResolver=c.log=c.trace=void 0;var d=a.r(11717);Object.defineProperty(c,"trace",{enumerable:!0,get:function(){return d.trace}}),Object.defineProperty(c,"log",{enumerable:!0,get:function(){return d.log}});var e=a.r(49845);Object.defineProperty(c,"registerResolver",{enumerable:!0,get:function(){return e.registerResolver}}),Object.defineProperty(c,"createResolver",{enumerable:!0,get:function(){return e.createResolver}});var f=a.r(55647);Object.defineProperty(c,"uriToString",{enumerable:!0,get:function(){return f.uriToString}});var g=a.r(38999);Object.defineProperty(c,"durationToMs",{enumerable:!0,get:function(){return g.durationToMs}});var h=a.r(57451);Object.defineProperty(c,"BackoffTimeout",{enumerable:!0,get:function(){return h.BackoffTimeout}});var i=a.r(39071);Object.defineProperty(c,"createChildChannelControlHelper",{enumerable:!0,get:function(){return i.createChildChannelControlHelper}}),Object.defineProperty(c,"registerLoadBalancerType",{enumerable:!0,get:function(){return i.registerLoadBalancerType}}),Object.defineProperty(c,"getFirstUsableConfig",{enumerable:!0,get:function(){return i.getFirstUsableConfig}}),Object.defineProperty(c,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return i.validateLoadBalancingConfig}});var j=a.r(91177);Object.defineProperty(c,"subchannelAddressToString",{enumerable:!0,get:function(){return j.subchannelAddressToString}});var k=a.r(33140);Object.defineProperty(c,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return k.ChildLoadBalancerHandler}});var l=a.r(3681);Object.defineProperty(c,"UnavailablePicker",{enumerable:!0,get:function(){return l.UnavailablePicker}}),Object.defineProperty(c,"QueuePicker",{enumerable:!0,get:function(){return l.QueuePicker}}),Object.defineProperty(c,"PickResultType",{enumerable:!0,get:function(){return l.PickResultType}});var m=a.r(59940);Object.defineProperty(c,"BaseFilter",{enumerable:!0,get:function(){return m.BaseFilter}});var n=a.r(15325);Object.defineProperty(c,"FilterStackFactory",{enumerable:!0,get:function(){return n.FilterStackFactory}});var o=a.r(31509);Object.defineProperty(c,"registerAdminService",{enumerable:!0,get:function(){return o.registerAdminService}});var p=a.r(4706);Object.defineProperty(c,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return p.BaseSubchannelWrapper}});var q=a.r(62818);Object.defineProperty(c,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return q.OutlierDetectionLoadBalancingConfig}})},5560,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(49845);class e{constructor(a,b,c){let d;this.listener=b,this.addresses=[],this.hasReturnedResult=!1,d=""===a.authority?"/"+a.path:a.path,this.addresses=[{path:d}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(a){return"localhost"}}c.setup=function(){(0,d.registerResolver)("unix",e)}},40926,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=void 0;let d=a.r(4446),e=a.r(57982),f=a.r(57904),g=a.r(49845),h=a.r(55647),i=a.r(11717),j="ip_resolver";function k(a){i.trace(e.LogVerbosity.DEBUG,j,a)}let l="ipv4",m="ipv6",n=443;class o{constructor(a,b,c){var g;this.listener=b,this.addresses=[],this.error=null,this.hasReturnedResult=!1,k("Resolver constructed for target "+(0,h.uriToString)(a));const i=[];if(a.scheme!==l&&a.scheme!==m){this.error={code:e.Status.UNAVAILABLE,details:`Unrecognized scheme ${a.scheme} in IP resolver`,metadata:new f.Metadata};return}for(const b of a.path.split(",")){const c=(0,h.splitHostPort)(b);if(null===c||a.scheme===l&&!(0,d.isIPv4)(c.host)||a.scheme===m&&!(0,d.isIPv6)(c.host)){this.error={code:e.Status.UNAVAILABLE,details:`Failed to parse ${a.scheme} address ${b}`,metadata:new f.Metadata};return}i.push({host:c.host,port:null!=(g=c.port)?g:n})}this.addresses=i,k("Parsed "+a.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(a){return a.path.split(",")[0]}}c.setup=function(){(0,g.registerResolver)(l,o),(0,g.registerResolver)(m,o)}},24241,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.PickFirstLoadBalancer=c.shuffled=c.PickFirstLoadBalancingConfig=void 0;let d=a.r(39071),e=a.r(56537),f=a.r(3681),g=a.r(11717),h=a.r(57982),i="pick_first";function j(a){g.trace(h.LogVerbosity.DEBUG,i,a)}let k="pick_first",l=250;class m{constructor(a){this.shuffleAddressList=a}getLoadBalancerName(){return k}toJsonObject(){return{[k]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(a){if("shuffleAddressList"in a&&"boolean"!=typeof a.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new m(!0===a.shuffleAddressList)}}c.PickFirstLoadBalancingConfig=m;class n{constructor(a){this.subchannel=a}pick(a){return{pickResultType:f.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function o(a){let b=a.slice();for(let a=b.length-1;a>1;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}c.shuffled=o;class p{constructor(a){this.channelControlHelper=a,this.children=[],this.currentState=e.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(a,b,c,d,e)=>{this.onSubchannelStateUpdate(a,b,c,e)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(a=>a.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(e.ConnectivityState.READY,new n(this.currentPick)):0===this.children.length?this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:a}of(this.stickyTransientFailureMode=!0,this.children))a.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let a=this.currentPick;this.currentPick=null,a.unref(),a.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(a.getChannelzRef())}}onSubchannelStateUpdate(a,b,c,d){var f;if(null==(f=this.currentPick)?void 0:f.realSubchannelEquals(a)){c!==e.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[b,f]of this.children.entries())if(a.realSubchannelEquals(f.subchannel)){c===e.ConnectivityState.READY&&this.pickSubchannel(f.subchannel),c===e.ConnectivityState.TRANSIENT_FAILURE&&(f.hasReportedTransientFailure=!0,d&&(this.lastError=d),this.maybeEnterStickyTransientFailureMode(),b===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(b+1)),f.subchannel.startConnecting();return}}startNextSubchannelConnecting(a){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[b,c]of this.children.entries())if(b>=a){let a=c.subchannel.getConnectivityState();if(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.CONNECTING)return void this.startConnecting(b)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(a){var b,c;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=a,this.children[a].subchannel.getConnectivityState()===e.ConnectivityState.IDLE&&(j("Start connecting to subchannel with address "+this.children[a].subchannel.getAddress()),process.nextTick(()=>{var b;null==(b=this.children[a])||b.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(c=(b=setTimeout(()=>{this.startNextSubchannelConnecting(a+1)},l)).unref)?void 0:c.call(b)}pickSubchannel(a){this.currentPick&&a.realSubchannelEquals(this.currentPick)||(j("Pick subchannel with address "+a.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=a,a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(a,b){j(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.children)this.currentPick&&a.subchannel.realSubchannelEquals(this.currentPick)||a.subchannel.removeConnectivityStateListener(this.subchannelStateListener),a.subchannel.unref(),this.channelControlHelper.removeChannelzChild(a.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(a){let b=a.map(a=>({subchannel:this.channelControlHelper.createSubchannel(a,{}),hasReportedTransientFailure:!1}));for(let{subchannel:a}of b)a.ref(),this.channelControlHelper.addChannelzChild(a.getChannelzRef());for(let{subchannel:a}of(this.resetSubchannelList(),this.children=b,this.children))if(a.addConnectivityStateListener(this.subchannelStateListener),a.getConnectivityState()===e.ConnectivityState.READY)return void this.pickSubchannel(a);for(let a of this.children)a.subchannel.getConnectivityState()===e.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(a,b){b instanceof m&&(b.getShuffleAddressList()&&(a=o(a)),this.latestAddressList=a,this.connectToAddressList(a))}exitIdle(){this.currentState===e.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return k}}c.PickFirstLoadBalancer=p,c.setup=function(){(0,d.registerLoadBalancerType)(k,p,m),(0,d.registerDefaultLoadBalancerType)(k)}},63765,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.setup=c.RoundRobinLoadBalancer=void 0;let d=a.r(39071),e=a.r(56537),f=a.r(3681),g=a.r(91177),h=a.r(11717),i=a.r(57982),j="round_robin";function k(a){h.trace(i.LogVerbosity.DEBUG,j,a)}let l="round_robin";class m{getLoadBalancerName(){return l}toJsonObject(){return{[l]:{}}}static createFromJson(a){return new m}}class n{constructor(a,b=0){this.subchannelList=a,this.nextIndex=b}pick(a){let b=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:f.PickResultType.COMPLETE,subchannel:b,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class o{constructor(a){this.channelControlHelper=a,this.subchannels=[],this.currentState=e.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(a,b,c,d,f)=>{this.calculateAndUpdateState(),(c===e.ConnectivityState.TRANSIENT_FAILURE||c===e.ConnectivityState.IDLE)&&(f&&(this.lastError=f),this.channelControlHelper.requestReresolution(),a.startConnecting())}}countSubchannelsWithState(a){return this.subchannels.filter(b=>b.getConnectivityState()===a).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(e.ConnectivityState.READY)>0){let a=this.subchannels.filter(a=>a.getConnectivityState()===e.ConnectivityState.READY),b=0;null!==this.currentReadyPicker&&(b=a.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(b=0),this.updateState(e.ConnectivityState.READY,new n(a,b))}else this.countSubchannelsWithState(e.ConnectivityState.CONNECTING)>0?this.updateState(e.ConnectivityState.CONNECTING,new f.QueuePicker(this)):this.countSubchannelsWithState(e.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(e.ConnectivityState.TRANSIENT_FAILURE,new f.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(e.ConnectivityState.IDLE,new f.QueuePicker(this))}updateState(a,b){k(e.ConnectivityState[this.currentState]+" -> "+e.ConnectivityState[a]),a===e.ConnectivityState.READY?this.currentReadyPicker=b:this.currentReadyPicker=null,this.currentState=a,this.channelControlHelper.updateState(a,b)}resetSubchannelList(){for(let a of this.subchannels)a.removeConnectivityStateListener(this.subchannelStateListener),a.unref(),this.channelControlHelper.removeChannelzChild(a.getChannelzRef());this.subchannels=[]}updateAddressList(a,b){for(let b of(this.resetSubchannelList(),k("Connect to address list "+a.map(a=>(0,g.subchannelAddressToString)(a))),this.subchannels=a.map(a=>this.channelControlHelper.createSubchannel(a,{})),this.subchannels)){b.ref(),b.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(b.getChannelzRef());let a=b.getConnectivityState();(a===e.ConnectivityState.IDLE||a===e.ConnectivityState.TRANSIENT_FAILURE)&&b.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let a of this.subchannels)a.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return l}}c.RoundRobinLoadBalancer=o,c.setup=function(){(0,d.registerLoadBalancerType)(l,o,m)}},80304,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.experimental=c.addAdminServicesToServer=c.getChannelzHandlers=c.getChannelzServiceDefinition=c.InterceptorConfigurationError=c.InterceptingCall=c.RequesterBuilder=c.ListenerBuilder=c.StatusBuilder=c.getClientChannel=c.ServerCredentials=c.Server=c.setLogVerbosity=c.setLogger=c.load=c.loadObject=c.CallCredentials=c.ChannelCredentials=c.waitForClientReady=c.closeClient=c.Channel=c.makeGenericClientConstructor=c.makeClientConstructor=c.loadPackageDefinition=c.Client=c.compressionAlgorithms=c.propagate=c.connectivityState=c.status=c.logVerbosity=c.Metadata=c.credentials=void 0;let d=a.r(20574);Object.defineProperty(c,"CallCredentials",{enumerable:!0,get:function(){return d.CallCredentials}});let e=a.r(61655);Object.defineProperty(c,"Channel",{enumerable:!0,get:function(){return e.ChannelImplementation}});let f=a.r(69425);Object.defineProperty(c,"compressionAlgorithms",{enumerable:!0,get:function(){return f.CompressionAlgorithms}});let g=a.r(56537);Object.defineProperty(c,"connectivityState",{enumerable:!0,get:function(){return g.ConnectivityState}});let h=a.r(61591);Object.defineProperty(c,"ChannelCredentials",{enumerable:!0,get:function(){return h.ChannelCredentials}});let i=a.r(19856);Object.defineProperty(c,"Client",{enumerable:!0,get:function(){return i.Client}});let j=a.r(57982);Object.defineProperty(c,"logVerbosity",{enumerable:!0,get:function(){return j.LogVerbosity}}),Object.defineProperty(c,"status",{enumerable:!0,get:function(){return j.Status}}),Object.defineProperty(c,"propagate",{enumerable:!0,get:function(){return j.Propagate}});let k=a.r(11717),l=a.r(80721);Object.defineProperty(c,"loadPackageDefinition",{enumerable:!0,get:function(){return l.loadPackageDefinition}}),Object.defineProperty(c,"makeClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}}),Object.defineProperty(c,"makeGenericClientConstructor",{enumerable:!0,get:function(){return l.makeClientConstructor}});let m=a.r(57904);Object.defineProperty(c,"Metadata",{enumerable:!0,get:function(){return m.Metadata}});let n=a.r(41069);Object.defineProperty(c,"Server",{enumerable:!0,get:function(){return n.Server}});let o=a.r(4296);Object.defineProperty(c,"ServerCredentials",{enumerable:!0,get:function(){return o.ServerCredentials}});let p=a.r(36272);Object.defineProperty(c,"StatusBuilder",{enumerable:!0,get:function(){return p.StatusBuilder}}),c.credentials={combineChannelCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),combineCallCredentials:(a,...b)=>b.reduce((a,b)=>a.compose(b),a),createInsecure:h.ChannelCredentials.createInsecure,createSsl:h.ChannelCredentials.createSsl,createFromSecureContext:h.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:d.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:d.CallCredentials.createFromGoogleCredential,createEmpty:d.CallCredentials.createEmpty},c.closeClient=a=>a.close(),c.waitForClientReady=(a,b,c)=>a.waitForReady(b,c),c.loadObject=(a,b)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.load=(a,b,c)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},c.setLogger=a=>{k.setLogger(a)},c.setLogVerbosity=a=>{k.setLoggerVerbosity(a)},c.getClientChannel=a=>i.Client.prototype.getChannel.call(a);var q=a.r(83278);Object.defineProperty(c,"ListenerBuilder",{enumerable:!0,get:function(){return q.ListenerBuilder}}),Object.defineProperty(c,"RequesterBuilder",{enumerable:!0,get:function(){return q.RequesterBuilder}}),Object.defineProperty(c,"InterceptingCall",{enumerable:!0,get:function(){return q.InterceptingCall}}),Object.defineProperty(c,"InterceptorConfigurationError",{enumerable:!0,get:function(){return q.InterceptorConfigurationError}});var r=a.r(74970);Object.defineProperty(c,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return r.getChannelzServiceDefinition}}),Object.defineProperty(c,"getChannelzHandlers",{enumerable:!0,get:function(){return r.getChannelzHandlers}});var s=a.r(31509);Object.defineProperty(c,"addAdminServicesToServer",{enumerable:!0,get:function(){return s.addAdminServicesToServer}}),c.experimental=a.r(94497);let t=a.r(87695),u=a.r(5560),v=a.r(40926),w=a.r(24241),x=a.r(63765),y=a.r(62818),z=a.r(74970);(()=>{t.setup(),u.setup(),v.setup(),w.setup(),x.setup(),y.setup(),z.setup()})()},54052,a=>{"use strict";let b,c;var d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.i(87924),r=q;function s(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];throw Error("number"==typeof a?"[MobX] minified error nr: "+a+(c.length?" "+c.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+a)}function t(){return"u">typeof globalThis?globalThis:a.g}var u=Object.assign,v=Object.getOwnPropertyDescriptor,w=Object.defineProperty,x=Object.prototype,y=[];Object.freeze(y);var z={};Object.freeze(z);var A="u">typeof Proxy,B=Object.toString();function C(){A||s("Proxy not available")}function D(a){var b=!1;return function(){if(!b)return b=!0,a.apply(this,arguments)}}var E=function(){};function F(a){return"function"==typeof a}function G(a){switch(typeof a){case"string":case"symbol":case"number":return!0}return!1}function H(a){return null!==a&&"object"==typeof a}function I(a){if(!H(a))return!1;var b=Object.getPrototypeOf(a);if(null==b)return!0;var c=Object.hasOwnProperty.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c.toString()===B}function J(a){var b=null==a?void 0:a.constructor;return!!b&&("GeneratorFunction"===b.name||"GeneratorFunction"===b.displayName)}function K(a,b,c){w(a,b,{enumerable:!1,writable:!0,configurable:!0,value:c})}function L(a,b,c){w(a,b,{enumerable:!1,writable:!1,configurable:!0,value:c})}function M(a,b){var c="isMobX"+a;return b.prototype[c]=!0,function(a){return H(a)&&!0===a[c]}}function N(a){return null!=a&&"[object Map]"===Object.prototype.toString.call(a)}function O(a){return null===Object.getPrototypeOf(Object.getPrototypeOf(Object.getPrototypeOf(a)))}function P(a){return null!=a&&"[object Set]"===Object.prototype.toString.call(a)}var Q=void 0!==Object.getOwnPropertySymbols;function R(a){var b=Object.keys(a);if(!Q)return b;var c=Object.getOwnPropertySymbols(a);return c.length?[].concat(b,c.filter(function(b){return x.propertyIsEnumerable.call(a,b)})):b}var S="u">typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:Q?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:Object.getOwnPropertyNames;function T(a){return null===a?null:"object"==typeof a?""+a:a}function U(a,b){return x.hasOwnProperty.call(a,b)}var V=Object.getOwnPropertyDescriptors||function(a){var b={};return S(a).forEach(function(c){b[c]=v(a,c)}),b};function W(a,b){return!!(a&b)}function X(a,b,c){return c?a|=b:a&=~b,a}function Y(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function Z(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,ae(d.key),d)}}function $(a,b,c){return b&&Z(a.prototype,b),c&&Z(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _(a,b){var c="u">typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(c)return(c=c.call(a)).next.bind(c);if(Array.isArray(a)||(c=af(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0;return function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function aa(){return(aa=Object.assign.bind()).apply(null,arguments)}function ab(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,ac(a,b)}function ac(a,b){return(ac=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a})(a,b)}function ad(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function ae(a){var b=ad(a,"string");return"symbol"==typeof b?b:b+""}function af(a,b){if(a){if("string"==typeof a)return Y(a,b);var c=({}).toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?Y(a,b):void 0}}var ag=Symbol("mobx-stored-annotations");function ah(a){return Object.assign(function(b,c){if(al(c))return a.decorate_20223_(b,c);ai(b,c,a)},a)}function ai(a,b,c){U(a,ag)||K(a,ag,aa({},a[ag])),aj(a,c,b),ax(c)||(a[ag][b]=c)}function aj(a,b,c){}function ak(a){return U(a,ag)||K(a,ag,aa({},a[ag])),a[ag]}function al(a){return"object"==typeof a&&"string"==typeof a.kind}var am=Symbol("mobx administration"),an=function(){function a(a){void 0===a&&(a="Atom"),this.name_=void 0,this.flags_=0,this.observers_=new Set,this.lastAccessedBy_=0,this.lowestObserverState_=f.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=a}var b=a.prototype;return b.onBO=function(){this.onBOL&&this.onBOL.forEach(function(a){return a()})},b.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(a){return a()})},b.reportObserved=function(){return bW(this)},b.reportChanged=function(){bU(),bX(this),bV()},b.toString=function(){return this.name_},$(a,[{key:"isBeingObserved",get:function(){return W(this.flags_,a.isBeingObservedMask_)},set:function(b){this.flags_=X(this.flags_,a.isBeingObservedMask_,b)}},{key:"isPendingUnobservation",get:function(){return W(this.flags_,a.isPendingUnobservationMask_)},set:function(b){this.flags_=X(this.flags_,a.isPendingUnobservationMask_,b)}},{key:"diffValue",get:function(){return+!!W(this.flags_,a.diffValueMask_)},set:function(b){this.flags_=X(this.flags_,a.diffValueMask_,1===b)}}])}();an.isBeingObservedMask_=1,an.isPendingUnobservationMask_=2,an.diffValueMask_=4;var ao=M("Atom",an);function ap(a,b,c){void 0===b&&(b=E),void 0===c&&(c=E);var d=new an(a);return b!==E&&cs(d,b),c!==E&&ct(d,c),d}var aq=function(a,b){return dK(a,b)},ar=function(a,b){return Object.is?Object.is(a,b):a===b?0!==a||1/a==1/b:a!=a&&b!=b};function as(a,b,c){if(cL(a))return a;if(Array.isArray(a))return bd.array(a,{name:c});if(I(a))return bd.object(a,void 0,{name:c});if(N(a))return bd.map(a,{name:c});if(P(a))return bd.set(a,{name:c});if("function"==typeof a&&!ck(a)&&!cJ(a))if(J(a))return cH(a);else return ci(c,a);return a}function at(a,b,c){return null==a||dt(a)||da(a)||df(a)||dk(a)?a:Array.isArray(a)?bd.array(a,{name:c,deep:!1}):I(a)?bd.object(a,void 0,{name:c,deep:!1}):N(a)?bd.map(a,{name:c,deep:!1}):P(a)?bd.set(a,{name:c,deep:!1}):void 0}function au(a){return a}function av(a,b){return dK(a,b)?b:a}var aw="override";function ax(a){return a.annotationType_===aw}function ay(a,b){return{annotationType_:a,options_:b,make_:az,extend_:aA,decorate_20223_:aB}}function az(a,b,c,d){if(null!=(e=this.options_)&&e.bound)return+(null!==this.extend_(a,b,c,!1));if(d===a.target_)return 2*(null!==this.extend_(a,b,c,!1));if(ck(c.value))return 1;var e,f=aD(a,this,b,c,!1);return w(d,b,f),2}function aA(a,b,c,d){var e=aD(a,this,b,c);return a.defineProperty_(b,e,d)}function aB(a,b){var c,d=b.kind,e=b.name,f=b.addInitializer,g=this,h=function(a){var b,c,d,f;return bn(null!=(b=null==(c=g.options_)?void 0:c.name)?b:e.toString(),a,null!=(d=null==(f=g.options_)?void 0:f.autoAction)&&d)};return"field"==d?function(a){var b,c=a;return ck(c)||(c=h(c)),null!=(b=g.options_)&&b.bound&&((c=c.bind(this)).isMobxAction=!0),c}:"method"==d?(ck(a)||(a=h(a)),null!=(c=this.options_)&&c.bound&&f(function(){var a=this,b=a[e].bind(a);b.isMobxAction=!0,a[e]=b}),a):void s("Cannot apply '"+g.annotationType_+"' to '"+String(e)+"' (kind: "+d+"):\n'"+g.annotationType_+"' can only be used on properties with a function value.")}function aC(a,b,c,d){b.annotationType_,d.value}function aD(a,b,c,d,e){void 0===e&&(e=bP.safeDescriptors),aC(a,b,c,d);var f,g,h,i,j,k,l,m,n=d.value;return null!=(f=b.options_)&&f.bound&&(n=n.bind(null!=(m=a.proxy_)?m:a.target_)),{value:bn(null!=(g=null==(h=b.options_)?void 0:h.name)?g:c.toString(),n,null!=(i=null==(j=b.options_)?void 0:j.autoAction)&&i,null!=(k=b.options_)&&k.bound?null!=(l=a.proxy_)?l:a.target_:void 0),configurable:!e||a.isPlainObject_,enumerable:!1,writable:!e}}function aE(a,b){return{annotationType_:a,options_:b,make_:aF,extend_:aG,decorate_20223_:aH}}function aF(a,b,c,d){if(d===a.target_)return 2*(null!==this.extend_(a,b,c,!1));if(null!=(e=this.options_)&&e.bound&&(!U(a.target_,b)||!cJ(a.target_[b]))&&null===this.extend_(a,b,c,!1))return 0;if(cJ(c.value))return 1;var e,f=aJ(a,this,b,c,!1,!1);return w(d,b,f),2}function aG(a,b,c,d){var e,f=aJ(a,this,b,c,null==(e=this.options_)?void 0:e.bound);return a.defineProperty_(b,f,d)}function aH(a,b){var c,d=b.name,e=b.addInitializer;return cJ(a)||(a=cH(a)),null!=(c=this.options_)&&c.bound&&e(function(){var a=this,b=a[d].bind(a);b.isMobXFlow=!0,a[d]=b}),a}function aI(a,b,c,d){b.annotationType_,d.value}function aJ(a,b,c,d,e,f){void 0===f&&(f=bP.safeDescriptors),aI(a,b,c,d);var g,h=d.value;return cJ(h)||(h=cH(h)),e&&((h=h.bind(null!=(g=a.proxy_)?g:a.target_)).isMobXFlow=!0),{value:h,configurable:!f||a.isPlainObject_,enumerable:!1,writable:!f}}function aK(a,b){return{annotationType_:a,options_:b,make_:aL,extend_:aM,decorate_20223_:aN}}function aL(a,b,c){return+(null!==this.extend_(a,b,c,!1))}function aM(a,b,c,d){return aO(a,this,b,c),a.defineComputedProperty_(b,aa({},this.options_,{get:c.get,set:c.set}),d)}function aN(a,b){var c=this,d=b.name;return(0,b.addInitializer)(function(){var b=dq(this)[am],e=aa({},c.options_,{get:a,context:this});e.name||(e.name="ObservableObject."+d.toString()),b.values_.set(d,new bv(e))}),function(){return this[am].getObservablePropValue_(d)}}function aO(a,b,c,d){b.annotationType_,d.get}function aP(a,b){return{annotationType_:a,options_:b,make_:aQ,extend_:aR,decorate_20223_:aS}}function aQ(a,b,c){return+(null!==this.extend_(a,b,c,!1))}function aR(a,b,c,d){var e,f;return aT(a,this,b,c),a.defineObservableProperty_(b,c.value,null!=(e=null==(f=this.options_)?void 0:f.enhancer)?e:as,d)}function aS(a,b){var c=this,d=b.kind,e=b.name,f=new WeakSet;function g(a,b){var d,g,h=dq(a)[am],i=new bu(b,null!=(d=null==(g=c.options_)?void 0:g.enhancer)?d:as,"ObservableObject."+e.toString(),!1);h.values_.set(e,i),f.add(a)}if("accessor"==d)return{get:function(){return f.has(this)||g(this,a.get.call(this)),this[am].getObservablePropValue_(e)},set:function(a){return f.has(this)||g(this,a),this[am].setObservablePropValue_(e,a)},init:function(a){return f.has(this)||g(this,a),a}}}function aT(a,b,c,d){b.annotationType_}var aU="true",aV=aW();function aW(a){return{annotationType_:aU,options_:a,make_:aX,extend_:aY,decorate_20223_:aZ}}function aX(a,b,c,d){if(c.get)return bi.make_(a,b,c,d);if(c.set){var e,f,g,h,i,j=ck(c.set)?c.set:bn(b.toString(),c.set);return d===a.target_?2*(null!==a.defineProperty_(b,{configurable:!bP.safeDescriptors||a.isPlainObject_,set:j})):(w(d,b,{configurable:!0,set:j}),2)}if(d!==a.target_&&"function"==typeof c.value)return J(c.value)?(null!=(h=this.options_)&&h.autoBind?cH.bound:cH).make_(a,b,c,d):(null!=(g=this.options_)&&g.autoBind?ci.bound:ci).make_(a,b,c,d);var k=(null==(e=this.options_)?void 0:e.deep)===!1?bd.ref:bd;return"function"==typeof c.value&&null!=(f=this.options_)&&f.autoBind&&(c.value=c.value.bind(null!=(i=a.proxy_)?i:a.target_)),k.make_(a,b,c,d)}function aY(a,b,c,d){var e,f,g;return c.get?bi.extend_(a,b,c,d):c.set?a.defineProperty_(b,{configurable:!bP.safeDescriptors||a.isPlainObject_,set:bn(b.toString(),c.set)},d):("function"==typeof c.value&&null!=(e=this.options_)&&e.autoBind&&(c.value=c.value.bind(null!=(g=a.proxy_)?g:a.target_)),((null==(f=this.options_)?void 0:f.deep)===!1?bd.ref:bd).extend_(a,b,c,d))}function aZ(a,b){s("'"+this.annotationType_+"' cannot be used as a decorator")}var a$="observable",a_="observable.ref",a0="observable.shallow",a1="observable.struct",a2={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function a3(a){return a||a2}Object.freeze(a2);var a4=aP(a$),a5=aP(a_,{enhancer:au}),a6=aP(a0,{enhancer:at}),a7=aP(a1,{enhancer:av}),a8=ah(a4);function a9(a){return!0===a.deep?as:!1===a.deep?au:bb(a.defaultDecorator)}function ba(a){var b;return a?null!=(b=a.defaultDecorator)?b:aW(a):void 0}function bb(a){var b,c;return a&&null!=(b=null==(c=a.options_)?void 0:c.enhancer)?b:as}function bc(a,b,c){return al(b)?a4.decorate_20223_(a,b):G(b)?void ai(a,b,a4):cL(a)?a:I(a)?bd.object(a,b,c):Array.isArray(a)?bd.array(a,b):N(a)?bd.map(a,b):P(a)?bd.set(a,b):"object"==typeof a&&null!==a?a:bd.box(a,b)}u(bc,a8);var bd=u(bc,{box:function(a,b){var c=a3(b);return new bu(a,a9(c),c.name,!0,c.equals)},array:function(a,b){var c=a3(b);return(!1===bP.useProxies||!1===c.proxy?dE:c3)(a,a9(c),c.name)},map:function(a,b){var c=a3(b);return new de(a,a9(c),c.name)},set:function(a,b){var c=a3(b);return new dj(a,a9(c),c.name)},object:function(a,b,c){return dI(function(){return cz(!1===bP.useProxies||(null==c?void 0:c.proxy)===!1?dq({},c):cQ({},c),a,b)})},ref:ah(a5),shallow:ah(a6),deep:a8,struct:ah(a7)}),be="computed",bf="computed.struct",bg=aK(be),bh=aK(bf,{equals:aq}),bi=function(a,b){if(al(b))return bg.decorate_20223_(a,b);if(G(b))return ai(a,b,bg);if(I(a))return ah(aK(be,a));var c=I(b)?b:{};return c.get=a,c.name||(c.name=a.name||""),new bv(c)};Object.assign(bi,bg),bi.struct=ah(bh);var bj=0,bk=1,bl=null!=(d=null==(e=v(function(){},"name"))?void 0:e.configurable)&&d,bm={value:"action",configurable:!0,writable:!1,enumerable:!1};function bn(a,b,c,d){function e(){return bo(a,c,b,d||this,arguments)}return void 0===c&&(c=!1),e.isMobxAction=!0,e.toString=function(){return b.toString()},bl&&(bm.value=a,w(e,"name",bm)),e}function bo(a,b,c,d,e){var f=bp(a,b,d,e);try{return c.apply(d,e)}catch(a){throw f.error_=a,a}finally{bq(f)}}function bp(a,b,c,d){var e=!1,f=0,g=bP.trackingDerivation,h=!b||!g;bU();var i=bP.allowStateChanges;h&&(bH(),i=bs(!0));var j={runAsAction_:h,prevDerivation_:g,prevAllowStateChanges_:i,prevAllowStateReads_:bJ(!0),notifySpy_:e,startTime_:f,actionId_:bk++,parentActionId_:bj};return bj=j.actionId_,j}function bq(a){bj!==a.actionId_&&s(30),bj=a.parentActionId_,void 0!==a.error_&&(bP.suppressReactionErrors=!0),bt(a.prevAllowStateChanges_),bK(a.prevAllowStateReads_),bV(),a.runAsAction_&&bI(a.prevDerivation_),bP.suppressReactionErrors=!1}function br(a,b){var c=bs(a);try{return b()}finally{bt(c)}}function bs(a){var b=bP.allowStateChanges;return bP.allowStateChanges=a,b}function bt(a){bP.allowStateChanges=a}var bu=function(a){function b(b,c,d,e,f){var g;return void 0===d&&(d="ObservableValue"),void 0===e&&(e=!0),void 0===f&&(f=ar),(g=a.call(this,d)||this).enhancer=void 0,g.name_=void 0,g.equals=void 0,g.hasUnreportedChange_=!1,g.interceptors_=void 0,g.changeListeners_=void 0,g.value_=void 0,g.dehancer=void 0,g.enhancer=c,g.name_=d,g.equals=f,g.value_=c(b,void 0,d),g}ab(b,a);var c=b.prototype;return c.dehanceValue=function(a){return void 0!==this.dehancer?this.dehancer(a):a},c.set=function(a){this.value_,(a=this.prepareNewValue_(a))!==bP.UNCHANGED&&(b5(),this.setNewValue_(a))},c.prepareNewValue_=function(a){if(bA(this),cR(this)){var b=cT(this,{object:this,type:c_,newValue:a});if(!b)return bP.UNCHANGED;a=b.newValue}return a=this.enhancer(a,this.value_,this.name_),this.equals(this.value_,a)?bP.UNCHANGED:a},c.setNewValue_=function(a){var b=this.value_;this.value_=a,this.reportChanged(),cU(this)&&cW(this,{type:c_,object:this,newValue:a,oldValue:b})},c.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},c.intercept_=function(a){return cS(this,a)},c.observe_=function(a,b){return b&&a({observableKind:"value",debugObjectName:this.name_,object:this,type:c_,newValue:this.value_,oldValue:void 0}),cV(this,a)},c.raw=function(){return this.value_},c.toJSON=function(){return this.get()},c.toString=function(){return this.name_+"["+this.value_+"]"},c.valueOf=function(){return T(this.get())},c[Symbol.toPrimitive]=function(){return this.valueOf()},b}(an),bv=function(){function a(a){this.dependenciesState_=f.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.observers_=new Set,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=f.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new bx(null),this.name_=void 0,this.triggeredBy_=void 0,this.flags_=0,this.derivation=void 0,this.setter_=void 0,this.isTracing_=g.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,a.get||s(31),this.derivation=a.get,this.name_=a.name||"ComputedValue",a.set&&(this.setter_=bn("ComputedValue-setter",a.set)),this.equals_=a.equals||(a.compareStructural||a.struct?aq:ar),this.scope_=a.context,this.requiresReaction_=a.requiresReaction,this.keepAlive_=!!a.keepAlive}var b=a.prototype;return b.onBecomeStale_=function(){bZ(this)},b.onBO=function(){this.onBOL&&this.onBOL.forEach(function(a){return a()})},b.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(a){return a()})},b.get=function(){if(this.isComputing&&s(32,this.name_,this.derivation),0!==bP.inBatch||0!==this.observers_.size||this.keepAlive_){if(bW(this),bz(this)){var a=bP.trackingContext;this.keepAlive_&&!a&&(bP.trackingContext=this),this.trackAndCompute()&&bY(this),bP.trackingContext=a}}else bz(this)&&(this.warnAboutUntrackedRead_(),bU(),this.value_=this.computeValue_(!1),bV());var b=this.value_;if(by(b))throw b.cause;return b},b.set=function(a){if(this.setter_){this.isRunningSetter&&s(33,this.name_),this.isRunningSetter=!0;try{this.setter_.call(this.scope_,a)}finally{this.isRunningSetter=!1}}else s(34,this.name_)},b.trackAndCompute=function(){var a=this.value_,b=this.dependenciesState_===f.NOT_TRACKING_,c=this.computeValue_(!0),d=b||by(a)||by(c)||!this.equals_(a,c);return d&&(this.value_=c),d},b.computeValue_=function(a){this.isComputing=!0;var b,c=bs(!1);if(a)b=bC(this,this.derivation,this.scope_);else if(!0===bP.disableErrorBoundaries)b=this.derivation.call(this.scope_);else try{b=this.derivation.call(this.scope_)}catch(a){b=new bx(a)}return bt(c),this.isComputing=!1,b},b.suspend_=function(){this.keepAlive_||(bF(this),this.value_=void 0)},b.observe_=function(a,b){var c=this,d=!0,e=void 0;return cl(function(){var f=c.get();if(!d||b){var g=bH();a({observableKind:"computed",debugObjectName:c.name_,type:c_,object:c,newValue:f,oldValue:e}),bI(g)}d=!1,e=f})},b.warnAboutUntrackedRead_=function(){},b.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},b.valueOf=function(){return T(this.get())},b[Symbol.toPrimitive]=function(){return this.valueOf()},$(a,[{key:"isComputing",get:function(){return W(this.flags_,a.isComputingMask_)},set:function(b){this.flags_=X(this.flags_,a.isComputingMask_,b)}},{key:"isRunningSetter",get:function(){return W(this.flags_,a.isRunningSetterMask_)},set:function(b){this.flags_=X(this.flags_,a.isRunningSetterMask_,b)}},{key:"isBeingObserved",get:function(){return W(this.flags_,a.isBeingObservedMask_)},set:function(b){this.flags_=X(this.flags_,a.isBeingObservedMask_,b)}},{key:"isPendingUnobservation",get:function(){return W(this.flags_,a.isPendingUnobservationMask_)},set:function(b){this.flags_=X(this.flags_,a.isPendingUnobservationMask_,b)}},{key:"diffValue",get:function(){return+!!W(this.flags_,a.diffValueMask_)},set:function(b){this.flags_=X(this.flags_,a.diffValueMask_,1===b)}}])}();bv.isComputingMask_=1,bv.isRunningSetterMask_=2,bv.isBeingObservedMask_=4,bv.isPendingUnobservationMask_=8,bv.diffValueMask_=16;var bw=M("ComputedValue",bv);!function(a){a[a.NOT_TRACKING_=-1]="NOT_TRACKING_",a[a.UP_TO_DATE_=0]="UP_TO_DATE_",a[a.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",a[a.STALE_=2]="STALE_"}(f||(f={})),function(a){a[a.NONE=0]="NONE",a[a.LOG=1]="LOG",a[a.BREAK=2]="BREAK"}(g||(g={}));var bx=function(a){this.cause=void 0,this.cause=a};function by(a){return a instanceof bx}function bz(a){switch(a.dependenciesState_){case f.UP_TO_DATE_:return!1;case f.NOT_TRACKING_:case f.STALE_:return!0;case f.POSSIBLY_STALE_:for(var b=bJ(!0),c=bH(),d=a.observing_,e=d.length,g=0;g<e;g++){var h=d[g];if(bw(h)){if(bP.disableErrorBoundaries)h.get();else try{h.get()}catch(a){return bI(c),bK(b),!0}if(a.dependenciesState_===f.STALE_)return bI(c),bK(b),!0}}return bL(a),bI(c),bK(b),!1}}function bA(a){}function bB(a){}function bC(a,b,c){var d,e=bJ(!0);bL(a),a.newObserving_=Array(0===a.runId_?100:a.observing_.length),a.unboundDepsCount_=0,a.runId_=++bP.runId;var f=bP.trackingDerivation;if(bP.trackingDerivation=a,bP.inBatch++,!0===bP.disableErrorBoundaries)d=b.call(c);else try{d=b.call(c)}catch(a){d=new bx(a)}return bP.inBatch--,bP.trackingDerivation=f,bE(a),bD(a),bK(e),d}function bD(a){}function bE(a){for(var b=a.observing_,c=a.observing_=a.newObserving_,d=f.UP_TO_DATE_,e=0,g=a.unboundDepsCount_,h=0;h<g;h++){var i=c[h];0===i.diffValue&&(i.diffValue=1,e!==h&&(c[e]=i),e++),i.dependenciesState_>d&&(d=i.dependenciesState_)}for(c.length=e,a.newObserving_=null,g=b.length;g--;){var j=b[g];0===j.diffValue&&bS(j,a),j.diffValue=0}for(;e--;){var k=c[e];1===k.diffValue&&(k.diffValue=0,bR(k,a))}d!==f.UP_TO_DATE_&&(a.dependenciesState_=d,a.onBecomeStale_())}function bF(a){var b=a.observing_;a.observing_=[];for(var c=b.length;c--;)bS(b[c],a);a.dependenciesState_=f.NOT_TRACKING_}function bG(a){var b=bH();try{return a()}finally{bI(b)}}function bH(){var a=bP.trackingDerivation;return bP.trackingDerivation=null,a}function bI(a){bP.trackingDerivation=a}function bJ(a){var b=bP.allowStateReads;return bP.allowStateReads=a,b}function bK(a){bP.allowStateReads=a}function bL(a){if(a.dependenciesState_!==f.UP_TO_DATE_){a.dependenciesState_=f.UP_TO_DATE_;for(var b=a.observing_,c=b.length;c--;)b[c].lowestObserverState_=f.UP_TO_DATE_}}var bM=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},bN=!0,bO=!1,bP=function(){var a=t();return(a.__mobxInstanceCount>0&&!a.__mobxGlobals&&(bN=!1),a.__mobxGlobals&&a.__mobxGlobals.version!==new bM().version&&(bN=!1),bN)?a.__mobxGlobals?(a.__mobxInstanceCount+=1,a.__mobxGlobals.UNCHANGED||(a.__mobxGlobals.UNCHANGED={}),a.__mobxGlobals):(a.__mobxInstanceCount=1,a.__mobxGlobals=new bM):(setTimeout(function(){bO||s(35)},1),new bM)}();function bQ(){if((bP.pendingReactions.length||bP.inBatch||bP.isRunningReactions)&&s(36),bO=!0,bN){var a=t();0==--a.__mobxInstanceCount&&(a.__mobxGlobals=void 0),bP=new bM}}function bR(a,b){a.observers_.add(b),a.lowestObserverState_>b.dependenciesState_&&(a.lowestObserverState_=b.dependenciesState_)}function bS(a,b){a.observers_.delete(b),0===a.observers_.size&&bT(a)}function bT(a){!1===a.isPendingUnobservation&&(a.isPendingUnobservation=!0,bP.pendingUnobservations.push(a))}function bU(){bP.inBatch++}function bV(){if(0==--bP.inBatch){b1();for(var a=bP.pendingUnobservations,b=0;b<a.length;b++){var c=a[b];c.isPendingUnobservation=!1,0===c.observers_.size&&(c.isBeingObserved&&(c.isBeingObserved=!1,c.onBUO()),c instanceof bv&&c.suspend_())}bP.pendingUnobservations=[]}}function bW(a){bB(a);var b=bP.trackingDerivation;return null!==b?(b.runId_!==a.lastAccessedBy_&&(a.lastAccessedBy_=b.runId_,b.newObserving_[b.unboundDepsCount_++]=a,!a.isBeingObserved&&bP.trackingContext&&(a.isBeingObserved=!0,a.onBO())),a.isBeingObserved):(0===a.observers_.size&&bP.inBatch>0&&bT(a),!1)}function bX(a){a.lowestObserverState_!==f.STALE_&&(a.lowestObserverState_=f.STALE_,a.observers_.forEach(function(a){a.dependenciesState_===f.UP_TO_DATE_&&a.onBecomeStale_(),a.dependenciesState_=f.STALE_}))}function bY(a){a.lowestObserverState_!==f.STALE_&&(a.lowestObserverState_=f.STALE_,a.observers_.forEach(function(b){b.dependenciesState_===f.POSSIBLY_STALE_?b.dependenciesState_=f.STALE_:b.dependenciesState_===f.UP_TO_DATE_&&(a.lowestObserverState_=f.UP_TO_DATE_)}))}function bZ(a){a.lowestObserverState_===f.UP_TO_DATE_&&(a.lowestObserverState_=f.POSSIBLY_STALE_,a.observers_.forEach(function(a){a.dependenciesState_===f.UP_TO_DATE_&&(a.dependenciesState_=f.POSSIBLY_STALE_,a.onBecomeStale_())}))}var b$=function(){function a(a,b,c,d){void 0===a&&(a="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=f.NOT_TRACKING_,this.runId_=0,this.unboundDepsCount_=0,this.flags_=0,this.isTracing_=g.NONE,this.name_=a,this.onInvalidate_=b,this.errorHandler_=c,this.requiresObservable_=d}var b=a.prototype;return b.onBecomeStale_=function(){this.schedule_()},b.schedule_=function(){this.isScheduled||(this.isScheduled=!0,bP.pendingReactions.push(this),b1())},b.runReaction_=function(){if(!this.isDisposed){bU(),this.isScheduled=!1;var a=bP.trackingContext;if(bP.trackingContext=this,bz(this)){this.isTrackPending=!0;try{this.onInvalidate_()}catch(a){this.reportExceptionInDerivation_(a)}}bP.trackingContext=a,bV()}},b.track=function(a){if(!this.isDisposed){bU(),b5(),this.isRunning=!0;var b=bP.trackingContext;bP.trackingContext=this;var c=bC(this,a,void 0);bP.trackingContext=b,this.isRunning=!1,this.isTrackPending=!1,this.isDisposed&&bF(this),by(c)&&this.reportExceptionInDerivation_(c.cause),bV()}},b.reportExceptionInDerivation_=function(a){var b=this;if(this.errorHandler_)return void this.errorHandler_(a,this);if(bP.disableErrorBoundaries)throw a;var c="[mobx] uncaught error in '"+this+"'";bP.suppressReactionErrors||console.error(c,a),bP.globalReactionErrorHandlers.forEach(function(c){return c(a,b)})},b.dispose=function(){!this.isDisposed&&(this.isDisposed=!0,this.isRunning||(bU(),bF(this),bV()))},b.getDisposer_=function(a){var b=this,c=function c(){b.dispose(),null==a||null==a.removeEventListener||a.removeEventListener("abort",c)};return null==a||null==a.addEventListener||a.addEventListener("abort",c),c[am]=this,"dispose"in Symbol&&"symbol"==typeof Symbol.dispose&&(c[Symbol.dispose]=c),c},b.toString=function(){return"Reaction["+this.name_+"]"},b.trace=function(a){void 0===a&&(a=!1),cM(this,a)},$(a,[{key:"isDisposed",get:function(){return W(this.flags_,a.isDisposedMask_)},set:function(b){this.flags_=X(this.flags_,a.isDisposedMask_,b)}},{key:"isScheduled",get:function(){return W(this.flags_,a.isScheduledMask_)},set:function(b){this.flags_=X(this.flags_,a.isScheduledMask_,b)}},{key:"isTrackPending",get:function(){return W(this.flags_,a.isTrackPendingMask_)},set:function(b){this.flags_=X(this.flags_,a.isTrackPendingMask_,b)}},{key:"isRunning",get:function(){return W(this.flags_,a.isRunningMask_)},set:function(b){this.flags_=X(this.flags_,a.isRunningMask_,b)}},{key:"diffValue",get:function(){return+!!W(this.flags_,a.diffValueMask_)},set:function(b){this.flags_=X(this.flags_,a.diffValueMask_,1===b)}}])}();b$.isDisposedMask_=1,b$.isScheduledMask_=2,b$.isTrackPendingMask_=4,b$.isRunningMask_=8,b$.diffValueMask_=16;var b_=100,b0=function(a){return a()};function b1(){bP.inBatch>0||bP.isRunningReactions||b0(b2)}function b2(){bP.isRunningReactions=!0;for(var a=bP.pendingReactions,b=0;a.length>0;){++b===b_&&(console.error("[mobx] cycle in reaction: "+a[0]),a.splice(0));for(var c=a.splice(0),d=0,e=c.length;d<e;d++)c[d].runReaction_()}bP.isRunningReactions=!1}var b3=M("Reaction",b$);function b4(a){var b=b0;b0=function(c){return a(function(){return b(c)})}}function b5(){return!1}function b6(a){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var b7="action",b8="action.bound",b9="autoAction",ca="autoAction.bound",cb="<unnamed action>",cc=ay(b7),cd=ay(b8,{bound:!0}),ce=ay(b9,{autoAction:!0}),cf=ay(ca,{autoAction:!0,bound:!0});function cg(a){return function(b,c){return F(b)?bn(b.name||cb,b,a):F(c)?bn(b,c,a):al(c)?(a?ce:cc).decorate_20223_(b,c):G(c)?ai(b,c,a?ce:cc):G(b)?ah(ay(a?b9:b7,{name:b,autoAction:a})):void 0}}var ch=cg(!1);Object.assign(ch,cc);var ci=cg(!0);function cj(a){return bo(a.name||cb,!1,a,this,void 0)}function ck(a){return F(a)&&!0===a.isMobxAction}function cl(a,b){void 0===b&&(b=z);var c,d,e,f,g,h=null!=(c=null==(d=b)?void 0:d.name)?c:"Autorun";if(b.scheduler||b.delay){var i=cn(b),j=!1;g=new b$(h,function(){j||(j=!0,i(function(){j=!1,g.isDisposed||g.track(k)}))},b.onError,b.requiresObservable)}else g=new b$(h,function(){this.track(k)},b.onError,b.requiresObservable);function k(){a(g)}return null!=(e=b)&&null!=(e=e.signal)&&e.aborted||g.schedule_(),g.getDisposer_(null==(f=b)?void 0:f.signal)}Object.assign(ci,ce),ch.bound=ah(cd),ci.bound=ah(cf);var cm=function(a){return a()};function cn(a){return a.scheduler?a.scheduler:a.delay?function(b){return setTimeout(b,a.delay)}:cm}function co(a,b,c){void 0===c&&(c=z);var d,e,f,g,h=null!=(d=c.name)?d:"Reaction",i=ch(h,c.onError?cp(c.onError,b):b),j=!c.scheduler&&!c.delay,k=cn(c),l=!0,m=!1,n=c.compareStructural?aq:c.equals||ar,o=new b$(h,function(){l||j?p():m||(m=!0,k(p))},c.onError,c.requiresObservable);function p(){if(m=!1,!o.isDisposed){var b=!1,d=g;o.track(function(){var c=br(!1,function(){return a(o)});b=l||!n(g,c),g=c}),l&&c.fireImmediately?i(g,d,o):!l&&b&&i(g,d,o),l=!1}}return null!=(e=c)&&null!=(e=e.signal)&&e.aborted||o.schedule_(),o.getDisposer_(null==(f=c)?void 0:f.signal)}function cp(a,b){return function(){try{return b.apply(this,arguments)}catch(b){a.call(this,b)}}}var cq="onBO",cr="onBUO";function cs(a,b,c){return cu(cq,a,b,c)}function ct(a,b,c){return cu(cr,a,b,c)}function cu(a,b,c,d){var e="function"==typeof d?dF(b,c):dF(b),f=F(d)?d:c,g=a+"L";return e[g]?e[g].add(f):e[g]=new Set([f]),function(){var a=e[g];a&&(a.delete(f),0===a.size&&delete e[g])}}var cv="never",cw="always",cx="observed";function cy(a){!0===a.isolateGlobalState&&bQ();var b=a.useProxies,c=a.enforceActions;if(void 0!==b&&(bP.useProxies=b===cw||b!==cv&&"u">typeof Proxy),"ifavailable"===b&&(bP.verifyProxies=!0),void 0!==c){var d=c===cw?cw:c===cx;bP.enforceActions=d,bP.allowStateChanges=!0!==d&&d!==cw}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach(function(b){b in a&&(bP[b]=!!a[b])}),bP.allowStateReads=!bP.observableRequiresReaction,a.reactionScheduler&&b4(a.reactionScheduler)}function cz(a,b,c,d){var e=V(b);return dI(function(){var b=dq(a,d)[am];S(e).forEach(function(a){b.extend_(a,e[a],!c||!(a in c)||c[a])})}),a}function cA(a,b){return cB(dF(a,b))}function cB(a){var b={name:a.name_};return a.observing_&&a.observing_.length>0&&(b.dependencies=cC(a.observing_).map(cB)),b}function cC(a){return Array.from(new Set(a))}var cD=0;function cE(){this.message="FLOW_CANCELLED"}cE.prototype=Object.create(Error.prototype);var cF=aE("flow"),cG=aE("flow.bound",{bound:!0}),cH=Object.assign(function(a,b){if(al(b))return cF.decorate_20223_(a,b);if(G(b))return ai(a,b,cF);var c=a,d=c.name||"<unnamed flow>",e=function(){var a,b=this,e=arguments,f=++cD,g=ch(d+" - runid: "+f+" - init",c).apply(b,e),h=void 0,i=new Promise(function(b,c){var e=0;function i(a){var b;h=void 0;try{b=ch(d+" - runid: "+f+" - yield "+e++,g.next).call(g,a)}catch(a){return c(a)}k(b)}function j(a){var b;h=void 0;try{b=ch(d+" - runid: "+f+" - yield "+e++,g.throw).call(g,a)}catch(a){return c(a)}k(b)}function k(a){return F(null==a?void 0:a.then)?void a.then(k,c):a.done?b(a.value):(h=Promise.resolve(a.value)).then(i,j)}a=c,i(void 0)});return i.cancel=ch(d+" - runid: "+f+" - cancel",function(){try{h&&cI(h);var b=g.return(void 0),c=Promise.resolve(b.value);c.then(E,E),cI(c),a(new cE)}catch(b){a(b)}}),i};return e.isMobXFlow=!0,e},cF);function cI(a){F(a.cancel)&&a.cancel()}function cJ(a){return(null==a?void 0:a.isMobXFlow)===!0}function cK(a,b){return!!a&&(void 0!==b?!!dt(a)&&a[am].values_.has(b):dt(a)||!!a[am]||ao(a)||b3(a)||bw(a))}function cL(a){return cK(a)}function cM(){}function cN(a,b){void 0===b&&(b=void 0),bU();try{return a.apply(b)}finally{bV()}}function cO(a){return a[am]}cH.bound=ah(cG);var cP={has:function(a,b){return cO(a).has_(b)},get:function(a,b){return cO(a).get_(b)},set:function(a,b,c){var d;return!!G(b)&&(null==(d=cO(a).set_(b,c,!0))||d)},deleteProperty:function(a,b){var c;return!!G(b)&&(null==(c=cO(a).delete_(b,!0))||c)},defineProperty:function(a,b,c){var d;return null==(d=cO(a).defineProperty_(b,c))||d},ownKeys:function(a){return cO(a).ownKeys_()},preventExtensions:function(a){s(13)}};function cQ(a,b){var c,d;return C(),null!=(d=(c=(a=dq(a,b))[am]).proxy_)?d:c.proxy_=new Proxy(a,cP)}function cR(a){return void 0!==a.interceptors_&&a.interceptors_.length>0}function cS(a,b){var c=a.interceptors_||(a.interceptors_=[]);return c.push(b),D(function(){var a=c.indexOf(b);-1!==a&&c.splice(a,1)})}function cT(a,b){var c=bH();try{for(var d=[].concat(a.interceptors_||[]),e=0,f=d.length;e<f&&((b=d[e](b))&&!b.type&&s(14),b);e++);return b}finally{bI(c)}}function cU(a){return void 0!==a.changeListeners_&&a.changeListeners_.length>0}function cV(a,b){var c=a.changeListeners_||(a.changeListeners_=[]);return c.push(b),D(function(){var a=c.indexOf(b);-1!==a&&c.splice(a,1)})}function cW(a,b){var c=bH(),d=a.changeListeners_;if(d){d=d.slice();for(var e=0,f=d.length;e<f;e++)d[e](b);bI(c)}}function cX(a,b,c){return dI(function(){var d=dq(a,c)[am];null!=b||(b=ak(a)),S(b).forEach(function(a){return d.make_(a,b[a])})}),a}var cY=Symbol("mobx-keys");function cZ(a,b,c){return I(a)?cz(a,a,b,c):(dI(function(){var d=dq(a,c)[am];if(!a[cY]){var e=Object.getPrototypeOf(a),f=new Set([].concat(S(a),S(e)));f.delete("constructor"),f.delete(am),K(e,cY,f)}a[cY].forEach(function(a){return d.make_(a,!b||!(a in b)||b[a])})}),a)}var c$="splice",c_="update",c0=1e4,c1={get:function(a,b){var c=a[am];return b===am?c:"length"===b?c.getArrayLength_():"string"!=typeof b||isNaN(b)?U(c4,b)?c4[b]:a[b]:c.get_(parseInt(b))},set:function(a,b,c){var d=a[am];return"length"===b&&d.setArrayLength_(c),"symbol"==typeof b||isNaN(b)?a[b]=c:d.set_(parseInt(b),c),!0},preventExtensions:function(){s(15)}},c2=function(){function a(a,b,c,d){void 0===a&&(a="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=c,this.legacyMode_=d,this.atom_=new an(a),this.enhancer_=function(a,c){return b(a,c,"ObservableArray[..]")}}var b=a.prototype;return b.dehanceValue_=function(a){return void 0!==this.dehancer?this.dehancer(a):a},b.dehanceValues_=function(a){return void 0!==this.dehancer&&a.length>0?a.map(this.dehancer):a},b.intercept_=function(a){return cS(this,a)},b.observe_=function(a,b){return void 0===b&&(b=!1),b&&a({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),cV(this,a)},b.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},b.setArrayLength_=function(a){("number"!=typeof a||isNaN(a)||a<0)&&s("Out of range: "+a);var b=this.values_.length;if(a!==b)if(a>b){for(var c=Array(a-b),d=0;d<a-b;d++)c[d]=void 0;this.spliceWithArray_(b,0,c)}else this.spliceWithArray_(a,b-a)},b.updateArrayLength_=function(a,b){a!==this.lastKnownLength_&&s(16),this.lastKnownLength_+=b,this.legacyMode_&&b>0&&dD(a+b+1)},b.spliceWithArray_=function(a,b,c){var d=this;bA(this.atom_);var e=this.values_.length;if(void 0===a?a=0:a>e?a=e:a<0&&(a=Math.max(0,e+a)),b=1==arguments.length?e-a:null==b?0:Math.max(0,Math.min(b,e-a)),void 0===c&&(c=y),cR(this)){var f=cT(this,{object:this.proxy_,type:c$,index:a,removedCount:b,added:c});if(!f)return y;b=f.removedCount,c=f.added}if(c=0===c.length?c:c.map(function(a){return d.enhancer_(a,void 0)}),this.legacyMode_){var g=c.length-b;this.updateArrayLength_(e,g)}var h=this.spliceItemsIntoValues_(a,b,c);return(0!==b||0!==c.length)&&this.notifyArraySplice_(a,c,h),this.dehanceValues_(h)},b.spliceItemsIntoValues_=function(a,b,c){if(c.length<c0){var d;return(d=this.values_).splice.apply(d,[a,b].concat(c))}var e=this.values_.slice(a,a+b),f=this.values_.slice(a+b);this.values_.length+=c.length-b;for(var g=0;g<c.length;g++)this.values_[a+g]=c[g];for(var h=0;h<f.length;h++)this.values_[a+c.length+h]=f[h];return e},b.notifyArrayChildUpdate_=function(a,b,c){var d=!this.owned_&&b5(),e=cU(this),f=e||d?{observableKind:"array",object:this.proxy_,type:c_,debugObjectName:this.atom_.name_,index:a,newValue:b,oldValue:c}:null;this.atom_.reportChanged(),e&&cW(this,f)},b.notifyArraySplice_=function(a,b,c){var d=!this.owned_&&b5(),e=cU(this),f=e||d?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:c$,index:a,removed:c,added:b,removedCount:c.length,addedCount:b.length}:null;this.atom_.reportChanged(),e&&cW(this,f)},b.get_=function(a){return this.legacyMode_&&a>=this.values_.length?void console.warn("[mobx] Out of bounds read: "+a):(this.atom_.reportObserved(),this.dehanceValue_(this.values_[a]))},b.set_=function(a,b){var c=this.values_;if(this.legacyMode_&&a>c.length&&s(17,a,c.length),a<c.length){bA(this.atom_);var d=c[a];if(cR(this)){var e=cT(this,{type:c_,object:this.proxy_,index:a,newValue:b});if(!e)return;b=e.newValue}(b=this.enhancer_(b,d))!==d&&(c[a]=b,this.notifyArrayChildUpdate_(a,b,d))}else{for(var f=Array(a+1-c.length),g=0;g<f.length-1;g++)f[g]=void 0;f[f.length-1]=b,this.spliceWithArray_(c.length,0,f)}},a}();function c3(a,b,c,d){return void 0===c&&(c="ObservableArray"),void 0===d&&(d=!1),C(),dI(function(){var e=new c2(c,b,d,!1);L(e.values_,am,e);var f=new Proxy(e.values_,c1);return e.proxy_=f,a&&a.length&&e.spliceWithArray_(0,0,a),f})}var c4={clear:function(){return this.splice(0)},replace:function(a){var b=this[am];return b.spliceWithArray_(0,b.values_.length,a)},toJSON:function(){return this.slice()},splice:function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];var f=this[am];switch(arguments.length){case 0:return[];case 1:return f.spliceWithArray_(a);case 2:return f.spliceWithArray_(a,b)}return f.spliceWithArray_(a,b,d)},spliceWithArray:function(a,b,c){return this[am].spliceWithArray_(a,b,c)},push:function(){for(var a=this[am],b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return a.spliceWithArray_(a.values_.length,0,c),a.values_.length},pop:function(){return this.splice(Math.max(this[am].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var a=this[am],b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return a.spliceWithArray_(0,0,c),a.values_.length},reverse:function(){return bP.trackingDerivation&&s(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){bP.trackingDerivation&&s(37,"sort");var a=this.slice();return a.sort.apply(a,arguments),this.replace(a),this},remove:function(a){var b=this[am],c=b.dehanceValues_(b.values_).indexOf(a);return c>-1&&(this.splice(c,1),!0)}};function c5(a,b){"function"==typeof Array.prototype[a]&&(c4[a]=b(a))}function c6(a){return function(){var b=this[am];b.atom_.reportObserved();var c=b.dehanceValues_(b.values_);return c[a].apply(c,arguments)}}function c7(a){return function(b,c){var d=this,e=this[am];return e.atom_.reportObserved(),e.dehanceValues_(e.values_)[a](function(a,e){return b.call(c,a,e,d)})}}function c8(a){return function(){var b=this,c=this[am];c.atom_.reportObserved();var d=c.dehanceValues_(c.values_),e=arguments[0];return arguments[0]=function(a,c,d){return e(a,c,d,b)},d[a].apply(d,arguments)}}c5("at",c6),c5("concat",c6),c5("flat",c6),c5("includes",c6),c5("indexOf",c6),c5("join",c6),c5("lastIndexOf",c6),c5("slice",c6),c5("toString",c6),c5("toLocaleString",c6),c5("toSorted",c6),c5("toSpliced",c6),c5("with",c6),c5("every",c7),c5("filter",c7),c5("find",c7),c5("findIndex",c7),c5("findLast",c7),c5("findLastIndex",c7),c5("flatMap",c7),c5("forEach",c7),c5("map",c7),c5("some",c7),c5("toReversed",c7),c5("reduce",c8),c5("reduceRight",c8);var c9=M("ObservableArrayAdministration",c2);function da(a){return H(a)&&c9(a[am])}var db={},dc="add",dd="delete",de=function(){function a(a,b,c){var d=this;void 0===b&&(b=as),void 0===c&&(c="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[am]=db,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=b,this.name_=c,F(Map)||s(18),dI(function(){d.keysAtom_=ap("ObservableMap.keys()"),d.data_=new Map,d.hasMap_=new Map,a&&d.merge(a)})}var b=a.prototype;return b.has_=function(a){return this.data_.has(a)},b.has=function(a){var b=this;if(!bP.trackingDerivation)return this.has_(a);var c=this.hasMap_.get(a);if(!c){var d=c=new bu(this.has_(a),au,"ObservableMap.key?",!1);this.hasMap_.set(a,d),ct(d,function(){return b.hasMap_.delete(a)})}return c.get()},b.set=function(a,b){var c=this.has_(a);if(cR(this)){var d=cT(this,{type:c?c_:dc,object:this,newValue:b,name:a});if(!d)return this;b=d.newValue}return c?this.updateValue_(a,b):this.addValue_(a,b),this},b.delete=function(a){var b=this;if(bA(this.keysAtom_),cR(this)&&!cT(this,{type:dd,object:this,name:a}))return!1;if(this.has_(a)){var c=b5(),d=cU(this),e=d||c?{observableKind:"map",debugObjectName:this.name_,type:dd,object:this,oldValue:this.data_.get(a).value_,name:a}:null;return cN(function(){var c;b.keysAtom_.reportChanged(),null==(c=b.hasMap_.get(a))||c.setNewValue_(!1),b.data_.get(a).setNewValue_(void 0),b.data_.delete(a)}),d&&cW(this,e),!0}return!1},b.updateValue_=function(a,b){var c=this.data_.get(a);if((b=c.prepareNewValue_(b))!==bP.UNCHANGED){var d=b5(),e=cU(this),f=e||d?{observableKind:"map",debugObjectName:this.name_,type:c_,object:this,oldValue:c.value_,name:a,newValue:b}:null;c.setNewValue_(b),e&&cW(this,f)}},b.addValue_=function(a,b){var c=this;bA(this.keysAtom_),cN(function(){var d,e=new bu(b,c.enhancer_,"ObservableMap.key",!1);c.data_.set(a,e),b=e.value_,null==(d=c.hasMap_.get(a))||d.setNewValue_(!0),c.keysAtom_.reportChanged()});var d=b5(),e=cU(this),f=e||d?{observableKind:"map",debugObjectName:this.name_,type:dc,object:this,name:a,newValue:b}:null;e&&cW(this,f)},b.get=function(a){return this.has(a)?this.dehanceValue_(this.data_.get(a).get()):this.dehanceValue_(void 0)},b.dehanceValue_=function(a){return void 0!==this.dehancer?this.dehancer(a):a},b.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},b.values=function(){var a=this,b=this.keys();return dg({next:function(){var c=b.next(),d=c.done,e=c.value;return{done:d,value:d?void 0:a.get(e)}}})},b.entries=function(){var a=this,b=this.keys();return dg({next:function(){var c=b.next(),d=c.done,e=c.value;return{done:d,value:d?void 0:[e,a.get(e)]}}})},b[Symbol.iterator]=function(){return this.entries()},b.forEach=function(a,b){for(var c,d=_(this);!(c=d()).done;){var e=c.value,f=e[0],g=e[1];a.call(b,g,f,this)}},b.merge=function(a){var b=this;return df(a)&&(a=new Map(a)),cN(function(){I(a)?R(a).forEach(function(c){return b.set(c,a[c])}):Array.isArray(a)?a.forEach(function(a){var c=a[0],d=a[1];return b.set(c,d)}):N(a)?(O(a)||s(19,a),a.forEach(function(a,c){return b.set(c,a)})):null!=a&&s(20,a)}),this},b.clear=function(){var a=this;cN(function(){bG(function(){for(var b,c=_(a.keys());!(b=c()).done;){var d=b.value;a.delete(d)}})})},b.replace=function(a){var b=this;return cN(function(){for(var c,d=dh(a),e=new Map,f=!1,g=_(b.data_.keys());!(c=g()).done;){var h=c.value;if(!d.has(h))if(b.delete(h))f=!0;else{var i=b.data_.get(h);e.set(h,i)}}for(var j,k=_(d.entries());!(j=k()).done;){var l=j.value,m=l[0],n=l[1],o=b.data_.has(m);if(b.set(m,n),b.data_.has(m)){var p=b.data_.get(m);e.set(m,p),o||(f=!0)}}if(!f)if(b.data_.size!==e.size)b.keysAtom_.reportChanged();else for(var q=b.data_.keys(),r=e.keys(),s=q.next(),t=r.next();!s.done;){if(s.value!==t.value){b.keysAtom_.reportChanged();break}s=q.next(),t=r.next()}b.data_=e}),this},b.toString=function(){return"[object ObservableMap]"},b.toJSON=function(){return Array.from(this)},b.observe_=function(a,b){return cV(this,a)},b.intercept_=function(a){return cS(this,a)},$(a,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Map"}}])}(),df=M("ObservableMap",de);function dg(a){return a[Symbol.toStringTag]="MapIterator",dO(a)}function dh(a){if(N(a)||df(a))return a;if(Array.isArray(a))return new Map(a);if(!I(a))return s(21,a);var b=new Map;for(var c in a)b.set(c,a[c]);return b}var di={},dj=function(){function a(a,b,c){var d=this;void 0===b&&(b=as),void 0===c&&(c="ObservableSet"),this.name_=void 0,this[am]=di,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=c,F(Set)||s(22),this.enhancer_=function(a,d){return b(a,d,c)},dI(function(){d.atom_=ap(d.name_),a&&d.replace(a)})}var b=a.prototype;return b.dehanceValue_=function(a){return void 0!==this.dehancer?this.dehancer(a):a},b.clear=function(){var a=this;cN(function(){bG(function(){for(var b,c=_(a.data_.values());!(b=c()).done;){var d=b.value;a.delete(d)}})})},b.forEach=function(a,b){for(var c,d=_(this);!(c=d()).done;){var e=c.value;a.call(b,e,e,this)}},b.add=function(a){var b=this;if(bA(this.atom_),cR(this)){var c=cT(this,{type:dc,object:this,newValue:a});if(!c)return this;a=c.newValue}if(!this.has(a)){cN(function(){b.data_.add(b.enhancer_(a,void 0)),b.atom_.reportChanged()});var d=!1,e=cU(this),f=e||d?{observableKind:"set",debugObjectName:this.name_,type:dc,object:this,newValue:a}:null;e&&cW(this,f)}return this},b.delete=function(a){var b=this;if(cR(this)&&!cT(this,{type:dd,object:this,oldValue:a}))return!1;if(this.has(a)){var c=!1,d=cU(this),e=d||c?{observableKind:"set",debugObjectName:this.name_,type:dd,object:this,oldValue:a}:null;return cN(function(){b.atom_.reportChanged(),b.data_.delete(a)}),d&&cW(this,e),!0}return!1},b.has=function(a){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(a))},b.entries=function(){var a=this.values();return dl({next:function(){var b=a.next(),c=b.value,d=b.done;return d?{value:void 0,done:d}:{value:[c,c],done:d}}})},b.keys=function(){return this.values()},b.values=function(){this.atom_.reportObserved();var a=this,b=this.data_.values();return dl({next:function(){var c=b.next(),d=c.value,e=c.done;return e?{value:void 0,done:e}:{value:a.dehanceValue_(d),done:e}}})},b.intersection=function(a){return P(a)&&!dk(a)?a.intersection(this):new Set(this).intersection(a)},b.union=function(a){return P(a)&&!dk(a)?a.union(this):new Set(this).union(a)},b.difference=function(a){return new Set(this).difference(a)},b.symmetricDifference=function(a){return P(a)&&!dk(a)?a.symmetricDifference(this):new Set(this).symmetricDifference(a)},b.isSubsetOf=function(a){return new Set(this).isSubsetOf(a)},b.isSupersetOf=function(a){return new Set(this).isSupersetOf(a)},b.isDisjointFrom=function(a){return P(a)&&!dk(a)?a.isDisjointFrom(this):new Set(this).isDisjointFrom(a)},b.replace=function(a){var b=this;return dk(a)&&(a=new Set(a)),cN(function(){Array.isArray(a)?(b.clear(),a.forEach(function(a){return b.add(a)})):P(a)?(b.clear(),a.forEach(function(a){return b.add(a)})):null!=a&&s("Cannot initialize set from "+a)}),this},b.observe_=function(a,b){return cV(this,a)},b.intercept_=function(a){return cS(this,a)},b.toJSON=function(){return Array.from(this)},b.toString=function(){return"[object ObservableSet]"},b[Symbol.iterator]=function(){return this.values()},$(a,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Set"}}])}(),dk=M("ObservableSet",dj);function dl(a){return a[Symbol.toStringTag]="SetIterator",dO(a)}var dm=Object.create(null),dn="remove",dp=function(){function a(a,b,c,d){void 0===b&&(b=new Map),void 0===d&&(d=aV),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=a,this.values_=b,this.name_=c,this.defaultAnnotation_=d,this.keysAtom_=new an("ObservableObject.keys"),this.isPlainObject_=I(this.target_)}var b=a.prototype;return b.getObservablePropValue_=function(a){return this.values_.get(a).get()},b.setObservablePropValue_=function(a,b){var c=this.values_.get(a);if(c instanceof bv)return c.set(b),!0;if(cR(this)){var d=cT(this,{type:c_,object:this.proxy_||this.target_,name:a,newValue:b});if(!d)return null;b=d.newValue}if((b=c.prepareNewValue_(b))!==bP.UNCHANGED){var e=cU(this),f=!1,g=e||f?{type:c_,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:c.value_,name:a,newValue:b}:null;c.setNewValue_(b),e&&cW(this,g)}return!0},b.get_=function(a){return bP.trackingDerivation&&!U(this.target_,a)&&this.has_(a),this.target_[a]},b.set_=function(a,b,c){return(void 0===c&&(c=!1),U(this.target_,a))?this.values_.has(a)?this.setObservablePropValue_(a,b):c?Reflect.set(this.target_,a,b):(this.target_[a]=b,!0):this.extend_(a,{value:b,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,c)},b.has_=function(a){if(!bP.trackingDerivation)return a in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var b=this.pendingKeys_.get(a);return b||(b=new bu(a in this.target_,au,"ObservableObject.key?",!1),this.pendingKeys_.set(a,b)),b.get()},b.make_=function(a,b){if(!0===b&&(b=this.defaultAnnotation_),!1!==b){if(dv(this,b,a),!(a in this.target_)){var c;if(null!=(c=this.target_[ag])&&c[a])return;s(1,b.annotationType_,this.name_+"."+a.toString())}for(var d=this.target_;d&&d!==x;){var e=v(d,a);if(e){var f=b.make_(this,a,e,d);if(0===f)return;if(1===f)break}d=Object.getPrototypeOf(d)}du(this,b,a)}},b.extend_=function(a,b,c,d){if(void 0===d&&(d=!1),!0===c&&(c=this.defaultAnnotation_),!1===c)return this.defineProperty_(a,b,d);dv(this,c,a);var e=c.extend_(this,a,b,d);return e&&du(this,c,a),e},b.defineProperty_=function(a,b,c){void 0===c&&(c=!1),bA(this.keysAtom_);try{bU();var d=this.delete_(a);if(!d)return d;if(cR(this)){var e=cT(this,{object:this.proxy_||this.target_,name:a,type:dc,newValue:b.value});if(!e)return null;var f=e.newValue;b.value!==f&&(b=aa({},b,{value:f}))}if(c){if(!Reflect.defineProperty(this.target_,a,b))return!1}else w(this.target_,a,b);this.notifyPropertyAddition_(a,b.value)}finally{bV()}return!0},b.defineObservableProperty_=function(a,b,c,d){void 0===d&&(d=!1),bA(this.keysAtom_);try{bU();var e=this.delete_(a);if(!e)return e;if(cR(this)){var f=cT(this,{object:this.proxy_||this.target_,name:a,type:dc,newValue:b});if(!f)return null;b=f.newValue}var g=ds(a),h={configurable:!bP.safeDescriptors||this.isPlainObject_,enumerable:!0,get:g.get,set:g.set};if(d){if(!Reflect.defineProperty(this.target_,a,h))return!1}else w(this.target_,a,h);var i=new bu(b,c,"ObservableObject.key",!1);this.values_.set(a,i),this.notifyPropertyAddition_(a,i.value_)}finally{bV()}return!0},b.defineComputedProperty_=function(a,b,c){void 0===c&&(c=!1),bA(this.keysAtom_);try{bU();var d=this.delete_(a);if(!d)return d;if(cR(this)&&!cT(this,{object:this.proxy_||this.target_,name:a,type:dc,newValue:void 0}))return null;b.name||(b.name="ObservableObject.key"),b.context=this.proxy_||this.target_;var e=ds(a),f={configurable:!bP.safeDescriptors||this.isPlainObject_,enumerable:!1,get:e.get,set:e.set};if(c){if(!Reflect.defineProperty(this.target_,a,f))return!1}else w(this.target_,a,f);this.values_.set(a,new bv(b)),this.notifyPropertyAddition_(a,void 0)}finally{bV()}return!0},b.delete_=function(a,b){if(void 0===b&&(b=!1),bA(this.keysAtom_),!U(this.target_,a))return!0;if(cR(this)&&!cT(this,{object:this.proxy_||this.target_,name:a,type:dn}))return null;try{bU();var c,d,e=cU(this),f=!1,g=this.values_.get(a),h=void 0;if(!g&&(e||f)&&(h=null==(d=v(this.target_,a))?void 0:d.value),b){if(!Reflect.deleteProperty(this.target_,a))return!1}else delete this.target_[a];if(g&&(this.values_.delete(a),g instanceof bu&&(h=g.value_),bX(g)),this.keysAtom_.reportChanged(),null==(c=this.pendingKeys_)||null==(c=c.get(a))||c.set(a in this.target_),e||f){var i={type:dn,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:h,name:a};e&&cW(this,i)}}finally{bV()}return!0},b.observe_=function(a,b){return cV(this,a)},b.intercept_=function(a){return cS(this,a)},b.notifyPropertyAddition_=function(a,b){var c,d=cU(this),e=!1;if(d||e){var f=d||e?{type:dc,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:a,newValue:b}:null;d&&cW(this,f)}null==(c=this.pendingKeys_)||null==(c=c.get(a))||c.set(!0),this.keysAtom_.reportChanged()},b.ownKeys_=function(){return this.keysAtom_.reportObserved(),S(this.target_)},b.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},a}();function dq(a,b){if(U(a,am))return a;var c,d=null!=(c=null==b?void 0:b.name)?c:"ObservableObject",e=new dp(a,new Map,String(d),ba(b));return K(a,am,e),a}var dr=M("ObservableObjectAdministration",dp);function ds(a){return dm[a]||(dm[a]={get:function(){return this[am].getObservablePropValue_(a)},set:function(b){return this[am].setObservablePropValue_(a,b)}})}function dt(a){return!!H(a)&&dr(a[am])}function du(a,b,c){var d;null==(d=a.target_[ag])||delete d[c]}function dv(a,b,c){}var dw=dB(0),dx=function(){var a=!1,b={};return Object.defineProperty(b,"0",{set:function(){a=!0}}),Object.create(b)["0"]=1,!1===a}(),dy=0,dz=function(){};!function(a,b){Object.setPrototypeOf?Object.setPrototypeOf(a.prototype,b):void 0!==a.prototype.__proto__?a.prototype.__proto__=b:a.prototype=b}(dz,Array.prototype);var dA=function(a){function b(b,c,d,e){var f;return void 0===d&&(d="ObservableArray"),void 0===e&&(e=!1),f=a.call(this)||this,dI(function(){var a=new c2(d,c,e,!0);a.proxy_=f,L(f,am,a),b&&b.length&&f.spliceWithArray(0,0,b),dx&&Object.defineProperty(f,"0",dw)}),f}ab(b,a);var c=b.prototype;return c.concat=function(){this[am].atom_.reportObserved();for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return Array.prototype.concat.apply(this.slice(),b.map(function(a){return da(a)?a.slice():a}))},c[Symbol.iterator]=function(){var a=this,b=0;return dO({next:function(){return b<a.length?{value:a[b++],done:!1}:{done:!0,value:void 0}}})},$(b,[{key:"length",get:function(){return this[am].getArrayLength_()},set:function(a){this[am].setArrayLength_(a)}},{key:Symbol.toStringTag,get:function(){return"Array"}}])}(dz);function dB(a){return{enumerable:!1,configurable:!0,get:function(){return this[am].get_(a)},set:function(b){this[am].set_(a,b)}}}function dC(a){w(dA.prototype,""+a,dB(a))}function dD(a){if(a>dy){for(var b=dy;b<a+100;b++)dC(b);dy=a}}function dE(a,b,c){return new dA(a,b,c)}function dF(a,b){if("object"==typeof a&&null!==a){if(da(a))return void 0!==b&&s(23),a[am].atom_;if(dk(a))return a.atom_;if(df(a)){if(void 0===b)return a.keysAtom_;var c=a.data_.get(b)||a.hasMap_.get(b);return c||s(25,b,dH(a)),c}if(dt(a)){if(!b)return s(26);var d=a[am].values_.get(b);return d||s(27,b,dH(a)),d}if(ao(a)||bw(a)||b3(a))return a}else if(F(a)&&b3(a[am]))return a[am];s(28)}function dG(a,b){return(a||s(29),void 0!==b)?dG(dF(a,b)):ao(a)||bw(a)||b3(a)||df(a)||dk(a)?a:a[am]?a[am]:void s(24,a)}function dH(a,b){var c;if(void 0!==b)c=dF(a,b);else{if(ck(a))return a.name;c=dt(a)||df(a)||dk(a)?dG(a):dF(a)}return c.name_}function dI(a){var b=bH(),c=bs(!0);bU();try{return a()}finally{bV(),bt(c),bI(b)}}Object.entries(c4).forEach(function(a){var b=a[0],c=a[1];"concat"!==b&&K(dA.prototype,b,c)}),dD(1e3);var dJ=x.toString;function dK(a,b,c){return void 0===c&&(c=-1),dL(a,b,c)}function dL(a,b,c,d,e){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return!1;if(a!=a)return b!=b;var f=typeof a;if("function"!==f&&"object"!==f&&"object"!=typeof b)return!1;var g=dJ.call(a);if(g!==dJ.call(b))return!1;switch(g){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":if(+a!=+a)return+b!=+b;return 0==+a?1/a==1/b:+a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object Symbol]":return"u">typeof Symbol&&Symbol.valueOf.call(a)===Symbol.valueOf.call(b);case"[object Map]":case"[object Set]":c>=0&&c++}a=dM(a),b=dM(b);var h="[object Array]"===g;if(!h){if("object"!=typeof a||"object"!=typeof b)return!1;var i=a.constructor,j=b.constructor;if(i!==j&&!(F(i)&&i instanceof i&&F(j)&&j instanceof j)&&"constructor"in a&&"constructor"in b)return!1}if(0===c)return!1;c<0&&(c=-1),e=e||[];for(var k=(d=d||[]).length;k--;)if(d[k]===a)return e[k]===b;if(d.push(a),e.push(b),h){if((k=a.length)!==b.length)return!1;for(;k--;)if(!dL(a[k],b[k],c-1,d,e))return!1}else{var l=Object.keys(a),m=l.length;if(Object.keys(b).length!==m)return!1;for(var n=0;n<m;n++){var o=l[n];if(!(U(b,o)&&dL(a[o],b[o],c-1,d,e)))return!1}}return d.pop(),e.pop(),!0}function dM(a){return da(a)?a.slice():N(a)||df(a)||P(a)||dk(a)?Array.from(a.entries()):a}var dN=(null==(h=t().Iterator)?void 0:h.prototype)||{};function dO(a){return a[Symbol.iterator]=dP,Object.assign(Object.create(dN),a)}function dP(){return this}["Symbol","Map","Set"].forEach(function(a){void 0===t()[a]&&s("MobX requires global '"+a+"' to be available or polyfilled")}),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:b6,extras:{getDebugName:dH},$mobx:am});var dQ=a.i(72131);if(!dQ.useState)throw Error("mobx-react-lite requires React with Hooks support");if(!cX)throw Error("mobx-react-lite@3 requires mobx at least version 6 to be available");var dR=a.i(35112);function dS(a){a()}function dT(a){a||(a=dS),cy({reactionScheduler:a})}var dU=dQ;function dV(a){return cA(a)}var dW=!1;function dX(){return dW}var dY=1e4,dZ=1e4,d$=function(){function a(a){var b=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(a){void 0===a&&(a=dY),clearTimeout(b.sweepTimeout),b.sweepTimeout=void 0;var c=Date.now();b.registrations.forEach(function(d,e){c-d.registeredAt>=a&&(b.finalize(d.value),b.registrations.delete(e))}),b.registrations.size>0&&b.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){b.sweep(0)}})}return Object.defineProperty(a.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(a,b,c){this.registrations.set(c,{value:b,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(a.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(a){this.registrations.delete(a)}}),Object.defineProperty(a.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){void 0===this.sweepTimeout&&(this.sweepTimeout=setTimeout(this.sweep,dZ))}}),a}(),d_=new("u">typeof FinalizationRegistry?FinalizationRegistry:d$)(function(a){var b;null==(b=a.reaction)||b.dispose(),a.reaction=null}),d0=a.i(87610);function d1(a){a.reaction=new b$("observer".concat(a.name),function(){var b;a.stateVersion=Symbol(),null==(b=a.onStoreChange)||b.call(a)})}function d2(a,b){if(void 0===b&&(b="observed"),dX())return a();var c,d,e=dU.default.useRef(null);if(!e.current){var f={reaction:null,onStoreChange:null,stateVersion:Symbol(),name:b,subscribe:function(a){return d_.unregister(f),f.onStoreChange=a,f.reaction||(d1(f),f.stateVersion=Symbol()),function(){var a;f.onStoreChange=null,null==(a=f.reaction)||a.dispose(),f.reaction=null}},getSnapshot:function(){return f.stateVersion}};e.current=f}var g=e.current;if(g.reaction||(d1(g),d_.register(e,g,g)),dU.default.useDebugValue(g.reaction,dV),(0,d0.useSyncExternalStore)(g.subscribe,g.getSnapshot,g.getSnapshot),g.reaction.track(function(){try{c=a()}catch(a){d=a}}),d)throw d;return c}var d3=dQ,d4="function"==typeof Symbol&&Symbol.for,d5=null!=(j=null==(i=Object.getOwnPropertyDescriptor(function(){},"name"))?void 0:i.configurable)&&j,d6=d4?Symbol.for("react.forward_ref"):"function"==typeof d3.forwardRef&&(0,d3.forwardRef)(function(a){return null}).$$typeof,d7=d4?Symbol.for("react.memo"):"function"==typeof d3.memo&&(0,d3.memo)(function(a){return null}).$$typeof;function d8(a,b){if(d7&&a.$$typeof===d7)throw Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");if(dX())return a;var c,d=null!=(c=null==b?void 0:b.forwardRef)&&c,e=a,f=a.displayName||a.name;if(d6&&a.$$typeof===d6&&(d=!0,"function"!=typeof(e=a.render)))throw Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var g=function(a,b){return d2(function(){return e(a,b)},f)};return g.displayName=a.displayName,d5&&Object.defineProperty(g,"name",{value:a.name,writable:!0,configurable:!0}),a.contextTypes&&(g.contextTypes=a.contextTypes),d&&(g=(0,d3.forwardRef)(g)),ea(a,g=(0,d3.memo)(g)),g}var d9={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};function ea(a,b){Object.keys(a).forEach(function(c){d9[c]||Object.defineProperty(b,c,Object.getOwnPropertyDescriptor(a,c))})}(function a(a){var b=a.children,c=a.render;b&&c&&console.error("MobX Observer: Do not use children and render in the same time in `Observer`");var d=b||c;return"function"!=typeof d?null:d2(d)}).displayName="Observer",dT(dR.unstable_batchedUpdates),k=d_.finalizeAllImmediately;var eb=q,ec=q;function ed(a){return a.promise&&a.error?(0,ec.jsx)("span",{children:a.error.toString()}):(0,ec.jsx)("div",{children:"Loading..."})}var ee=q,ef=q;function eg({restaurant:a}){return(0,ef.jsxs)("div",{className:"restaurant-card",children:[(0,ef.jsx)("div",{className:"restaurant-name",children:a.name}),(0,ef.jsx)("div",{className:"restaurant-open",children:(0,ef.jsx)("span",{className:"lower-text",children:a.is_open?"Open":"Closed"})}),(0,ef.jsx)("div",{className:"restaurant-delivery-time",children:(0,ef.jsxs)("span",{className:"lower-text",children:[a.delivery_time_minutes," min"]})})]})}function eh(a){return a.allRestaurants?(0,ee.jsxs)("div",{className:"results-parent",children:[(0,ee.jsx)("h2",{className:"results-title",children:"Restaurants"}),(0,ee.jsx)("div",{className:"results-content",children:0===a.allRestaurants.length?(0,ee.jsx)("p",{children:"Inga restauranger matchar dina filter."}):a.allRestaurants.map(a=>(0,ee.jsx)(eg,{restaurant:a},a.id))})]}):(0,ee.jsx)(ed,{model:a.model})}var ei=q;function ej(a){return a.foodCategoryFilters&&a.activeFilters?(0,ei.jsx)("div",{className:"topbar-filter-parent",children:(0,ei.jsx)("div",{className:"topbar-filter-cards",children:(a.foodCategoryFilters||[]).map(b=>(0,ei.jsx)("button",{className:"topbar-filter-card "+(a.activeFilters.includes(b.id)?"active":""),onClick:()=>a.onFilterClick(b.id),children:(0,ei.jsx)("span",{children:b.name})},b.id))})}):null}var ek=q;function el(a){return a.foodCategoryFilters&&a.deliveryTimeFilters&&a.priceFilters&&a.activeFilters?(0,ek.jsxs)("div",{className:"sidebar-filter-parent",children:[(0,ek.jsx)("h2",{className:"sidebar-filter-title",children:"Filter"}),(0,ek.jsxs)("div",{className:"sidebar-filter-content",children:[(0,ek.jsxs)("div",{className:"filter-food-category sidebar-filter-item",children:[(0,ek.jsx)("h3",{className:"filter-subcategory-title",children:"Food Category"}),(a.foodCategoryFilters||[]).map(b=>(0,ek.jsx)("button",{className:"filter-pill "+(a.activeFilters.includes(b.id)?"active":""),onClick:()=>a.onFilterClick(b.id),children:b.name},b.id))]}),(0,ek.jsxs)("div",{className:"filter-delivery-time sidebar-filter-item",children:[(0,ek.jsx)("h3",{className:"filter-subcategory-title",children:"Delivery Time"}),(a.deliveryTimeFilters||[]).map(b=>(0,ek.jsx)("button",{className:"filter-pill "+(a.activeFilters.includes(b.id)?"active":""),onClick:()=>a.onFilterClick(b.id),children:b.name},b.id))]}),(0,ek.jsxs)("div",{className:"filter-price-range sidebar-filter-item",children:[(0,ek.jsx)("h3",{className:"filter-subcategory-title",children:"Price Range"}),(a.priceFilters||[]).map(b=>(0,ek.jsx)("button",{className:"filter-pill "+(a.activeFilters.includes(b.id)?"active":""),onClick:()=>a.onFilterClick(b.id),children:b.name},b.id))]})]})]}):null}let em=d8(function(a){function b(b){a.model.toggleFilter(b)}return console.log("All restaurants:",a.model.allRestaurants),console.log("Food filters:",a.model.foodCategoryFilters),console.log("Price filters:",a.model.priceFilters),console.log("Time filters:",a.model.deliveryTimeFilters),console.log("Applied filters:",a.model.appliedFilters),console.log("Filtered restaurants:",a.model.filterRestaurants()),(0,eb.jsxs)("div",{className:"page-layout",children:[(0,eb.jsx)(el,{onFilterClick:b,activeFilters:a.model.appliedFilters,foodCategoryFilters:a.model.foodCategoryFilters,deliveryTimeFilters:a.model.deliveryTimeFilters,priceFilters:a.model.priceFilters}),(0,eb.jsxs)("div",{className:"topbar-results-layout",children:[(0,eb.jsx)(ej,{onFilterClick:b,activeFilters:a.model.appliedFilters,foodCategoryFilters:a.model.foodCategoryFilters}),(0,eb.jsx)("div",{className:"results-layout",children:a.model.filterResultsPromiseState.data?(0,eb.jsx)(eh,{restaurants:a.model.filterRestaurants()}):(0,eb.jsx)(ed,{promise:a.model.filterResultsPromiseState.promise,error:a.model.filterResultsPromiseState.error})})]})]})}),en=d8(function(a){return a.model.ready?(0,r.jsx)("div",{children:(0,r.jsx)(em,{model:a.model})}):(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{children:"Model not ready..."}),(0,r.jsx)(ed,{promise:a.model.filterResultsPromiseState.promise,error:a.model.filterResultsPromiseState.error})]})});function eo(a,b){function c(c){console.log(c),b.promise===a&&(b.data=c)}function d(c){console.log(c),console.log(a),console.log(b),b.promise===a&&(b.error=c)}console.log("Resolving promise:",a),console.log("With promise state:",b),cj(()=>{b.promise=a,b.data=null,b.error=null}),a&&a.then(c).catch(d)}let ep="https://work-test-web-2024-eze6j4scpq-lz.a.run.app/api";function eq(){function a(a){if(200===a.status)return a.json();throw Error(`API returned status ${a.status}`)}function b(a){return console.log("Full API response:",a),a.restaurants||[]}return fetch(`${ep}/restaurants`).then(a).then(b)}function er(){function a(a){if(200===a.status)return a.json();throw Error(`API returned status ${a.status}`)}function b(a){return console.log("Full API response:",a),a.filters||[]}return fetch(`${ep}/filter`).then(a).then(b)}function es(a){function b(a){if(200===a.status)return a.json();throw Error(`API returned status ${a.status}`)}function c(a){return console.log("Full API response:",a),a.is_currently_open||[]}return fetch(`${ep}/open/${a}`).then(b).then(c)}let et={ready:!1,allRestaurants:[],foodCategoryFilters:[],priceFilters:[],deliveryTimeFilters:[],appliedFilters:[],filterResultsPromiseState:{promise:null,data:null,error:null},setReady(a){this.ready=a},setAllRestaurants(a){this.allRestaurants=a},async loadRestaurants(){let a=eq();console.log("Restaurants from Api:",a),eo(a,this.filterResultsPromiseState);try{let b=await a;this.setAllRestaurants(b)}catch(a){console.error("Error loading restaurants:",a)}},getAllRestaurants(){return this.allRestaurants},setFilter(a,b){this[a]=b},async loadFoodFilters(){let a=er();return console.log("Fetched food filters:",a),a},assignTimeFilter:a=>a<=10?"0-10 min":a<=30?"10-30 min":a<=60?"30-60 min":"1+ hour",assignPriceFilters:a=>a<=100?"$":a<=200?"$$":a<=300?"$$$":"$$$$",generatePriceFilters(){let a=new Set;return this.allRestaurants.forEach(b=>{b.price_range_id&&a.add(b.price_range_id)}),Array.from(a).sort()},generateDeliveryTimeFilters(){let a=new Set;this.allRestaurants.forEach(b=>{let c=this.assignTimeFilter(b.delivery_time_minutes);a.add(c)});let b=["0-10 min","10-30 min","30-60 min","1+ hour"];return Array.from(a).sort((a,c)=>b.indexOf(a)-b.indexOf(c))},assignImgAsset(a){let b=["hamburgers","pizza","taco","breakfast","coffee","fries","mexican"].find(b=>a.includes(b));return b?`${b}.png`:"default.png"},async loadIfOpenFilter(a){let b=es(a);return console.log("Fetched if open",b),b},setIfOpen(a,b){let c=this.allRestaurants.find(b=>b.id===a);c&&(c.is_currently_open=b)},getFoodFilterIds(a){let b=new Set;return a.forEach(a=>{a.filter_ids&&a.filter_ids.forEach(a=>{b.add(a)})}),Array.from(b)},toggleFilter(a){console.log("Applied filters:",this.appliedFilters),this.appliedFilters.includes(a)?this.appliedFilters=this.appliedFilters.filter(b=>b!==a):this.appliedFilters=[...this.appliedFilters,a]},filterRestaurants(){let a=this.allRestaurants||[];return 0===this.appliedFilters.length?a:a=a.filter(a=>this.appliedFilters.some(b=>!!a.filter_ids?.includes(b)||this.assignPriceFilters(a.price_range_id)===b||this.assignTimeFilter(a.delivery_time_minutes)===b))}};cZ(et);let eu=bd(et);cy({enforceActions:"always"});let ev=()=>void 0,ew={NODE_CLIENT:!1},ex=function(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b},ey=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c++];if(e<128)b[d++]=String.fromCharCode(e);else if(e>191&&e<224){let f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else if(e>239&&e<365){let f=((7&e)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;b[d++]=String.fromCharCode(55296+(f>>10)),b[d++]=String.fromCharCode(56320+(1023&f))}else{let f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},ez={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(a,b){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();let c=b?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length,g=f?a[b+1]:0,h=b+2<a.length,i=h?a[b+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;!h&&(m=64,f||(l=64)),d.push(c[j],c[k],c[l],c[m])}return d.join("")},encodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?btoa(a):this.encodeByteArray(ex(a),b)},decodeString(a,b){return this.HAS_NATIVE_SUPPORT&&!b?atob(a):ey(this.decodeStringToByteArray(a,b))},decodeStringToByteArray(a,b){this.init_();let c=b?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let b=0;b<a.length;){let e=c[a.charAt(b++)],f=b<a.length?c[a.charAt(b)]:0,g=++b<a.length?c[a.charAt(b)]:64,h=++b<a.length?c[a.charAt(b)]:64;if(++b,null==e||null==f||null==g||null==h)throw new eA;let i=e<<2|f>>4;if(d.push(i),64!==g){let a=f<<4&240|g>>2;if(d.push(a),64!==h){let a=g<<6&192|h;d.push(a)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class eA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let eB=function(a){let b=ex(a);return ez.encodeByteArray(b,!0)},eC=function(a){return eB(a).replace(/\./g,"")},eD=function(a){try{return ez.decodeString(a,!0)}catch(a){console.error("base64Decode failed: ",a)}return null};function eE(){return"u">typeof self?self:a.g}let eF=()=>eE().__FIREBASE_DEFAULTS__,eG=()=>{if("u"<typeof process||void 0===process.env)return;let a=process.env.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},eH=()=>{let a;if("u"<typeof document)return;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(a){return}let b=a&&eD(a[1]);return b&&JSON.parse(b)},eI=()=>{try{return ev()||eF()||eG()||eH()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},eJ=a=>eI()?.emulatorHosts?.[a],eK=a=>{let b=eJ(a);if(!b)return;let c=b.lastIndexOf(":");if(c<=0||c+1===b.length)throw Error(`Invalid host ${b} with no separate hostname and port!`);let d=parseInt(b.substring(c+1),10);return"["===b[0]?[b.substring(1,c-1),d]:[b.substring(0,c),d]},eL=()=>eI()?.config;class eM{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}wrapCallback(a){return(b,c)=>{b?this.reject(b):this.resolve(c),"function"==typeof a&&(this.promise.catch(()=>{}),1===a.length?a(b):a(b,c))}}}function eN(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function eO(a){return(await fetch(a,{credentials:"include"})).ok}function eP(a,b){if(a.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let c={alg:"none",type:"JWT"},d=b||"demo-project",e=a.iat||0,f=a.sub||a.user_id;if(!f)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let g={iss:`https://securetoken.google.com/${d}`,aud:d,iat:e,exp:e+3600,auth_time:e,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}},...a},h="";return[eC(JSON.stringify(c)),eC(JSON.stringify(g)),h].join(".")}function eQ(a,b){}function eR(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function eS(){let b=eI()?.forceEnvironment;if("node"===b)return!0;if("browser"===b)return!1;try{return"[object process]"===Object.prototype.toString.call(a.g.process)}catch(a){return!1}}function eT(){return eU()}function eU(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function eV(){return!eS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function eW(){return!eS()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function eX(){try{return"object"==typeof indexedDB}catch(a){return!1}}function eY(){return new Promise((a,b)=>{try{let c=!0,d="validate-browser-context-for-indexeddb-analytics-module",e=self.indexedDB.open(d);e.onsuccess=()=>{e.result.close(),c||self.indexedDB.deleteDatabase(d),a(!0)},e.onupgradeneeded=()=>{c=!1},e.onerror=()=>{b(e.error?.message||"")}}catch(a){b(a)}})}let eZ="FirebaseError";class e$ extends Error{constructor(a,b,c){super(b),this.code=a,this.customData=c,this.name=eZ,Object.setPrototypeOf(this,e$.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,e_.prototype.create)}}class e_{constructor(a,b,c){this.service=a,this.serviceName=b,this.errors=c}create(a,...b){let c=b[0]||{},d=`${this.service}/${a}`,e=this.errors[a],f=e?e0(e,c):"Error",g=`${this.serviceName}: ${f} (${d}).`;return new e$(d,g,c)}}function e0(a,b){return a.replace(e1,(a,c)=>{let d=b[c];return null!=d?String(d):`<${c}?>`})}let e1=/\{\$([^}]+)}/g;function e2(a,b){if(a===b)return!0;let c=Object.keys(a),d=Object.keys(b);for(let e of c){if(!d.includes(e))return!1;let c=a[e],f=b[e];if(e3(c)&&e3(f)){if(!e2(c,f))return!1}else if(c!==f)return!1}for(let a of d)if(!c.includes(a))return!1;return!0}function e3(a){return null!==a&&"object"==typeof a}function e4(a){return a&&a._delegate?a._delegate:a}ew.NODE_CLIENT=!0;class e5{constructor(a,b,c){this.name=a,this.instanceFactory=b,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}let e6="[DEFAULT]";class e7{constructor(a,b){this.name=a,this.container=b,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){let b=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(b)){let a=new eM;if(this.instancesDeferred.set(b,a),this.isInitialized(b)||this.shouldAutoInitialize())try{let c=this.getOrInitializeService({instanceIdentifier:b});c&&a.resolve(c)}catch(a){}}return this.instancesDeferred.get(b).promise}getImmediate(a){let b=this.normalizeInstanceIdentifier(a?.identifier),c=a?.optional??!1;if(this.isInitialized(b)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:b})}catch(a){if(c)return null;throw a}if(c)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,this.shouldAutoInitialize()){if(e9(a))try{this.getOrInitializeService({instanceIdentifier:e6})}catch(a){}for(let[a,b]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(a);try{let a=this.getOrInitializeService({instanceIdentifier:c});b.resolve(a)}catch(a){}}}}clearInstance(a=e6){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){let a=Array.from(this.instances.values());await Promise.all([...a.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...a.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return null!=this.component}isInitialized(a=e6){return this.instances.has(a)}getOptions(a=e6){return this.instancesOptions.get(a)||{}}initialize(a={}){let{options:b={}}=a,c=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let d=this.getOrInitializeService({instanceIdentifier:c,options:b});for(let[a,b]of this.instancesDeferred.entries())c===this.normalizeInstanceIdentifier(a)&&b.resolve(d);return d}onInit(a,b){let c=this.normalizeInstanceIdentifier(b),d=this.onInitCallbacks.get(c)??new Set;d.add(a),this.onInitCallbacks.set(c,d);let e=this.instances.get(c);return e&&a(e,c),()=>{d.delete(a)}}invokeOnInitCallbacks(a,b){let c=this.onInitCallbacks.get(b);if(c)for(let d of c)try{d(a,b)}catch{}}getOrInitializeService({instanceIdentifier:a,options:b={}}){let c=this.instances.get(a);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:e8(a),options:b}),this.instances.set(a,c),this.instancesOptions.set(a,b),this.invokeOnInitCallbacks(c,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,c)}catch{}return c||null}normalizeInstanceIdentifier(a=e6){return this.component?this.component.multipleInstances?a:e6:a}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function e8(a){return a===e6?void 0:a}function e9(a){return"EAGER"===a.instantiationMode}class fa{constructor(a){this.name=a,this.providers=new Map}addComponent(a){let b=this.getProvider(a.name);if(b.isComponentSet())throw Error(`Component ${a.name} has already been registered with ${this.name}`);b.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);let b=new e7(a,this);return this.providers.set(a,b),b}getProviders(){return Array.from(this.providers.values())}}let fb=[];!function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"}(l||(l={}));let fc={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},fd=l.INFO,fe={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},ff=(a,b,...c)=>{if(b<a.logLevel)return;let d=new Date().toISOString(),e=fe[b];if(e)console[e](`[${d}]  ${a.name}:`,...c);else throw Error(`Attempted to log a message with an invalid logType (value: ${b})`)};class fg{constructor(a){this.name=a,this._logLevel=fd,this._logHandler=ff,this._userLogHandler=null,fb.push(this)}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in l))throw TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel="string"==typeof a?fc[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if("function"!=typeof a)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...a),this._logHandler(this,l.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...a),this._logHandler(this,l.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,l.INFO,...a),this._logHandler(this,l.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,l.WARN,...a),this._logHandler(this,l.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...a),this._logHandler(this,l.ERROR,...a)}}function fh(a){fb.forEach(b=>{b.setLogLevel(a)})}function fi(a,b){for(let c of fb){let d=null;b&&b.level&&(d=fc[b.level]),null===a?c.userLogHandler=null:c.userLogHandler=(b,c,...e)=>{let f=e.map(a=>{if(null==a)return null;if("string"==typeof a)return a;if("number"==typeof a||"boolean"==typeof a)return a.toString();if(a instanceof Error)return a.message;try{return JSON.stringify(a)}catch(a){return null}}).filter(a=>a).join(" ");c>=(d??b.logLevel)&&a({level:l[c].toLowerCase(),message:f,args:e,type:b.name})}}}let fj=(a,b)=>b.some(b=>a instanceof b);function fk(){return b||(b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fl(){return c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let fm=new WeakMap,fn=new WeakMap,fo=new WeakMap,fp=new WeakMap,fq=new WeakMap;function fr(a){let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(fx(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)});return b.then(b=>{b instanceof IDBCursor&&fm.set(b,a)}).catch(()=>{}),fq.set(b,a),b}function fs(a){if(fn.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});fn.set(a,b)}let ft={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return fn.get(a);if("objectStoreNames"===b)return a.objectStoreNames||fo.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return fx(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function fu(a){ft=a(ft)}function fv(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?fl().includes(a)?function(...b){return a.apply(fy(this),b),fx(fm.get(this))}:function(...b){return fx(a.apply(fy(this),b))}:function(b,...c){let d=a.call(fy(this),b,...c);return fo.set(d,b.sort?b.sort():[b]),fx(d)}}function fw(a){return"function"==typeof a?fv(a):(a instanceof IDBTransaction&&fs(a),fj(a,fk()))?new Proxy(a,ft):a}function fx(a){if(a instanceof IDBRequest)return fr(a);if(fp.has(a))return fp.get(a);let b=fw(a);return b!==a&&(fp.set(a,b),fq.set(b,a)),b}let fy=a=>fq.get(a);function fz(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=fx(g);return d&&g.addEventListener("upgradeneeded",a=>{d(fx(g.result),a.oldVersion,a.newVersion,fx(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let fA=["get","getKey","getAll","getAllKeys","count"],fB=["put","add","delete","clear"],fC=new Map;function fD(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(fC.get(b))return fC.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=fB.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||fA.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return fC.set(b,f),f}fu(a=>({...a,get:(b,c,d)=>fD(b,c)||a.get(b,c,d),has:(b,c)=>!!fD(b,c)||a.has(b,c)}));class fE{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(!fF(a))return null;{let b=a.getImmediate();return`${b.library}/${b.version}`}}).filter(a=>a).join(" ")}}function fF(a){let b=a.getComponent();return b?.type==="VERSION"}let fG="@firebase/app",fH="0.14.7",fI=new fg("@firebase/app"),fJ="12.8.0",fK="[DEFAULT]",fL={[fG]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},fM=new Map,fN=new Map,fO=new Map;function fP(a,b){try{a.container.addComponent(b)}catch(c){fI.debug(`Component ${b.name} failed to register with FirebaseApp ${a.name}`,c)}}function fQ(a,b){a.container.addOrOverwriteComponent(b)}function fR(a){let b=a.name;if(fO.has(b))return fI.debug(`There were multiple attempts to register component ${b}.`),!1;for(let c of(fO.set(b,a),fM.values()))fP(c,a);for(let b of fN.values())fP(b,a);return!0}function fS(a,b){let c=a.container.getProvider("heartbeat").getImmediate({optional:!0});return c&&c.triggerHeartbeat(),a.container.getProvider(b)}function fT(a,b,c=fK){fS(a,b).clearInstance(c)}function fU(a){return void 0!==a.options}function fV(a){return!fU(a)&&("authIdToken"in a||"appCheckToken"in a||"releaseOnDeref"in a||"automaticDataCollectionEnabled"in a)}function fW(a){return null!=a&&void 0!==a.settings}function fX(){fO.clear()}let fY=new e_("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class fZ{constructor(a,b,c){this._isDeleted=!1,this._options={...a},this._config={...b},this._name=b.name,this._automaticDataCollectionEnabled=b.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new e5("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw fY.create("app-deleted",{appName:this._name})}}function f$(a,b){let c=eD(a.split(".")[1]);null===c?console.error(`FirebaseServerApp ${b} is invalid: second part could not be parsed.`):void 0===JSON.parse(c).exp?console.error(`FirebaseServerApp ${b} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(c).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${b} is invalid: the token has expired.`)}class f_ extends fZ{constructor(a,b,c,d){const e=void 0===b.automaticDataCollectionEnabled||b.automaticDataCollectionEnabled,f={name:c,automaticDataCollectionEnabled:e};void 0!==a.apiKey?super(a,f,d):super(a.options,f,d),this._serverConfig={automaticDataCollectionEnabled:e,...b},this._serverConfig.authIdToken&&f$(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&f$(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,b.releaseOnDeref=void 0,f6(fG,fH,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(a){this.isDeleted||(this._refCount++,void 0!==a&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(a,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){f5(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw fY.create("server-app-deleted")}}let f0=fJ;function f1(a,b={}){let c=a;"object"!=typeof b&&(b={name:b});let d={name:fK,automaticDataCollectionEnabled:!0,...b},e=d.name;if("string"!=typeof e||!e)throw fY.create("bad-app-name",{appName:String(e)});if(c||(c=eL()),!c)throw fY.create("no-options");let f=fM.get(e);if(f)if(e2(c,f.options)&&e2(d,f.config))return f;else throw fY.create("duplicate-app",{appName:e});let g=new fa(e);for(let a of fO.values())g.addComponent(a);let h=new fZ(c,d,g);return fM.set(e,h),h}function f2(a,b={}){let c;if(eT()&&!eU())throw fY.create("invalid-server-app-environment");let d=b||{};if(a&&(fU(a)?c=a.options:fV(a)?d=a:c=a),void 0===d.automaticDataCollectionEnabled&&(d.automaticDataCollectionEnabled=!0),c||(c=eL()),!c)throw fY.create("no-options");let e={...d,...c};void 0!==e.releaseOnDeref&&delete e.releaseOnDeref;let f=a=>[...a].reduce((a,b)=>Math.imul(31,a)+b.charCodeAt(0)|0,0);if(void 0!==d.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw fY.create("finalization-registry-not-supported",{});let g=""+f(JSON.stringify(e)),h=fN.get(g);if(h)return h.incRefCount(d.releaseOnDeref),h;let i=new fa(g);for(let a of fO.values())i.addComponent(a);let j=new f_(c,d,g,i);return fN.set(g,j),j}function f3(a=fK){let b=fM.get(a);if(!b&&a===fK&&eL())return f1();if(!b)throw fY.create("no-app",{appName:a});return b}function f4(){return Array.from(fM.values())}async function f5(a){let b=!1,c=a.name;fM.has(c)?(b=!0,fM.delete(c)):fN.has(c)&&0>=a.decRefCount()&&(fN.delete(c),b=!0),b&&(await Promise.all(a.container.getProviders().map(a=>a.delete())),a.isDeleted=!0)}function f6(a,b,c){let d=fL[a]??a;c&&(d+=`-${c}`);let e=d.match(/\s|\//),f=b.match(/\s|\//);if(e||f){let a=[`Unable to register library "${d}" with version "${b}":`];e&&a.push(`library name "${d}" contains illegal characters (whitespace or "/")`),e&&f&&a.push("and"),f&&a.push(`version name "${b}" contains illegal characters (whitespace or "/")`),fI.warn(a.join(" "));return}fR(new e5(`${d}-version`,()=>({library:d,version:b}),"VERSION"))}function f7(a,b){if(null!==a&&"function"!=typeof a)throw fY.create("invalid-log-argument");fi(a,b)}function f8(a){fh(a)}let f9="firebase-heartbeat-database",ga=1,gb="firebase-heartbeat-store",gc=null;function gd(){return gc||(gc=fz(f9,ga,{upgrade:(a,b)=>{if(0===b)try{a.createObjectStore(gb)}catch(a){console.warn(a)}}}).catch(a=>{throw fY.create("idb-open",{originalErrorMessage:a.message})})),gc}async function ge(a){try{let b=(await gd()).transaction(gb),c=await b.objectStore(gb).get(gg(a));return await b.done,c}catch(a){if(a instanceof e$)fI.warn(a.message);else{let b=fY.create("idb-get",{originalErrorMessage:a?.message});fI.warn(b.message)}}}async function gf(a,b){try{let c=(await gd()).transaction(gb,"readwrite"),d=c.objectStore(gb);await d.put(b,gg(a)),await c.done}catch(a){if(a instanceof e$)fI.warn(a.message);else{let b=fY.create("idb-set",{originalErrorMessage:a?.message});fI.warn(b.message)}}}function gg(a){return`${a.name}!${a.options.appId}`}let gh=1024,gi=30;class gj{constructor(a){this.container=a,this._heartbeatsCache=null;const b=this.container.getProvider("app").getImmediate();this._storage=new gm(b),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{let a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),b=gk();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===b||this._heartbeatsCache.heartbeats.some(a=>a.date===b))return;if(this._heartbeatsCache.heartbeats.push({date:b,agent:a}),this._heartbeatsCache.heartbeats.length>gi){let a=go(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){fI.warn(a)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let a=gk(),{heartbeatsToSend:b,unsentEntries:c}=gl(this._heartbeatsCache.heartbeats),d=eC(JSON.stringify({version:2,heartbeats:b}));return this._heartbeatsCache.lastSentHeartbeatDate=a,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(a){return fI.warn(a),""}}}function gk(){return new Date().toISOString().substring(0,10)}function gl(a,b=gh){let c=[],d=a.slice();for(let e of a){let a=c.find(a=>a.agent===e.agent);if(a){if(a.dates.push(e.date),gn(c)>b){a.dates.pop();break}}else if(c.push({agent:e.agent,dates:[e.date]}),gn(c)>b){c.pop();break}d=d.slice(1)}return{heartbeatsToSend:c,unsentEntries:d}}class gm{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!eX()&&eY().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let a=await ge(this.app);return a?.heartbeats?a:{heartbeats:[]}}}async overwrite(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return gf(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:a.heartbeats})}}async add(a){if(await this._canUseIndexedDBPromise){let b=await this.read();return gf(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??b.lastSentHeartbeatDate,heartbeats:[...b.heartbeats,...a.heartbeats]})}}}function gn(a){return eC(JSON.stringify({version:2,heartbeats:a})).length}function go(a){if(0===a.length)return -1;let b=0,c=a[0].date;for(let d=1;d<a.length;d++)a[d].date<c&&(c=a[d].date,b=d);return b}(function(a){fR(new e5("platform-logger",a=>new fE(a),"PRIVATE")),fR(new e5("heartbeat",a=>new gj(a),"PRIVATE")),f6(fG,fH,""),f6(fG,fH,"esm2020"),f6("fire-js","")})(""),a.s(["SDK_VERSION",()=>f0,"_DEFAULT_ENTRY_NAME",()=>fK,"_addComponent",()=>fP,"_addOrOverwriteComponent",()=>fQ,"_apps",()=>fM,"_clearComponents",()=>fX,"_components",()=>fO,"_getProvider",()=>fS,"_isFirebaseApp",()=>fU,"_isFirebaseServerApp",()=>fW,"_isFirebaseServerAppSettings",()=>fV,"_registerComponent",()=>fR,"_removeServiceInstance",()=>fT,"_serverApps",()=>fN,"deleteApp",()=>f5,"getApp",()=>f3,"getApps",()=>f4,"initializeApp",()=>f1,"initializeServerApp",()=>f2,"onLog",()=>f7,"registerVersion",()=>f6,"setLogLevel",()=>f8],88156),f6("firebase","12.8.0","app"),a.i(88156);var gp="u">typeof globalThis?globalThis:a.g,gq={};(function(){function a(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function b(a,b,c){c||(c=0);let d=Array(16);if("string"==typeof b)for(var e=0;e<16;++e)d[e]=b.charCodeAt(c++)|b.charCodeAt(c++)<<8|b.charCodeAt(c++)<<16|b.charCodeAt(c++)<<24;else for(e=0;e<16;++e)d[e]=b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24;b=a.g[0],c=a.g[1],e=a.g[2];let f=a.g[3],g;g=b+(f^c&(e^f))+d[0]+0xd76aa478|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[1]+0xe8c7b756|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[2]+0x242070db|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[3]+0xc1bdceee|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[4]+0xf57c0faf|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[5]+0x4787c62a|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[6]+0xa8304613|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[7]+0xfd469501|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[8]+0x698098d8|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[9]+0x8b44f7af|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[10]+0xffff5bb1|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[11]+0x895cd7be|0,g=b+(f^(c=e+(g<<22|g>>>10))&(e^f))+d[12]+0x6b901122|0,g=f+(e^(b=c+(g<<7|g>>>25))&(c^e))+d[13]+0xfd987193|0,g=e+(c^(f=b+(g<<12|g>>>20))&(b^c))+d[14]+0xa679438e|0,g=c+(b^(e=f+(g<<17|g>>>15))&(f^b))+d[15]+0x49b40821|0,c=e+(g<<22|g>>>10),g=b+(e^f&(c^e))+d[1]+0xf61e2562|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[6]+0xc040b340|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[11]+0x265e5a51|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[0]+0xe9b6c7aa|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[5]+0xd62f105d|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[10]+0x2441453|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[15]+0xd8a1e681|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[4]+0xe7d3fbc8|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[9]+0x21e1cde6|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[14]+0xc33707d6|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[3]+0xf4d50d87|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[8]+0x455a14ed|0,c=e+(g<<20|g>>>12),g=b+(e^f&(c^e))+d[13]+0xa9e3e905|0,b=c+(g<<5|g>>>27),g=f+(c^e&(b^c))+d[2]+0xfcefa3f8|0,f=b+(g<<9|g>>>23),g=e+(b^c&(f^b))+d[7]+0x676f02d9|0,e=f+(g<<14|g>>>18),g=c+(f^b&(e^f))+d[12]+0x8d2a4c8a|0,g=b+((c=e+(g<<20|g>>>12))^e^f)+d[5]+0xfffa3942|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[8]+0x8771f681|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[11]+0x6d9d6122|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[14]+0xfde5380c|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[1]+0xa4beea44|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[4]+0x4bdecfa9|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[7]+0xf6bb4b60|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[10]+0xbebfbc70|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[13]+0x289b7ec6|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[0]+0xeaa127fa|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[3]+0xd4ef3085|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[6]+0x4881d05|0,g=b+((c=e+(g<<23|g>>>9))^e^f)+d[9]+0xd9d4d039|0,g=f+((b=c+(g<<4|g>>>28))^c^e)+d[12]+0xe6db99e5|0,g=e+((f=b+(g<<11|g>>>21))^b^c)+d[15]+0x1fa27cf8|0,g=c+((e=f+(g<<16|g>>>16))^f^b)+d[2]+0xc4ac5665|0,c=e+(g<<23|g>>>9),g=b+(e^(c|~f))+d[0]+0xf4292244|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[7]+0x432aff97|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[14]+0xab9423a7|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[5]+0xfc93a039|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[12]+0x655b59c3|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[3]+0x8f0ccc92|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[10]+0xffeff47d|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[1]+0x85845dd1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[8]+0x6fa87e4f|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[15]+0xfe2ce6e0|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[6]+0xa3014314|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[13]+0x4e0811a1|0,c=e+(g<<21|g>>>11),g=b+(e^(c|~f))+d[4]+0xf7537e82|0,b=c+(g<<6|g>>>26),g=f+(c^(b|~e))+d[11]+0xbd3af235|0,f=b+(g<<10|g>>>22),g=e+(b^(f|~c))+d[2]+0x2ad7d2bb|0,e=f+(g<<15|g>>>17),g=c+(f^(e|~b))+d[9]+0xeb86d391|0,a.g[0]=a.g[0]+b|0,a.g[1]=a.g[1]+(e+(g<<21|g>>>11))|0,a.g[2]=a.g[2]+e|0,a.g[3]=a.g[3]+f|0}function c(a,b){var c=f;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}function d(a,b){this.h=b;let c=[],d=!0;for(let e=a.length-1;e>=0;e--){let f=0|a[e];d&&f==b||(c[e]=f,d=!1)}this.g=c}(function(a,b){function c(){}c.prototype=b.prototype,a.F=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.D=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return b.prototype[c].apply(a,e)}})(a,function(){this.blockSize=-1}),a.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},a.prototype.v=function(a,c){void 0===c&&(c=a.length);let d=c-this.blockSize,e=this.C,f=this.h,g=0;for(;g<c;){if(0==f)for(;g<=d;)b(this,a,g),g+=this.blockSize;if("string"==typeof a){for(;g<c;)if(e[f++]=a.charCodeAt(g++),f==this.blockSize){b(this,e),f=0;break}}else for(;g<c;)if(e[f++]=a[g++],f==this.blockSize){b(this,e),f=0;break}}this.h=f,this.o+=c},a.prototype.A=function(){var a=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;b=8*this.o;for(var c=a.length-8;c<a.length;++c)a[c]=255&b,b/=256;for(this.v(a),a=Array(16),b=0,c=0;c<4;++c)for(let d=0;d<32;d+=8)a[b++]=this.g[c]>>>d&255;return a};var e,f={};function g(a){return -128<=a&&a<128?c(a,function(a){return new d([0|a],a<0?-1:0)}):new d([0|a],a<0?-1:0)}function h(a){if(isNaN(a)||!isFinite(a))return j;if(a<0)return q(h(-a));let b=[],c=1;for(let d=0;a>=c;d++)b[d]=a/c|0,c*=0x100000000;return new d(b,0)}function i(a,b){if(0==a.length)throw Error("number format error: empty string");if((b=b||10)<2||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return q(i(a.substring(1),b));if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character');let c=h(Math.pow(b,8)),d=j;for(let f=0;f<a.length;f+=8){var e=Math.min(8,a.length-f);let g=parseInt(a.substring(f,f+e),b);e<8?(e=h(Math.pow(b,e)),d=d.j(e).add(h(g))):d=(d=d.j(c)).add(h(g))}return d}var j=g(0),k=g(1),l=g(0x1000000);function o(a){if(0!=a.h)return!1;for(let b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function p(a){return -1==a.h}function q(a){let b=a.g.length,c=[];for(let d=0;d<b;d++)c[d]=~a.g[d];return new d(c,~a.h).add(k)}function r(a,b){return a.add(q(b))}function s(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function t(a,b){this.g=a,this.h=b}function u(a,b){if(o(b))throw Error("division by zero");if(o(a))return new t(j,j);if(p(a))return b=u(q(a),b),new t(q(b.g),q(b.h));if(p(b))return b=u(a,q(b)),new t(q(b.g),b.h);if(a.g.length>30){if(p(a)||p(b))throw Error("slowDivide_ only works with positive integers.");for(var c=k,d=b;0>=d.l(a);)c=v(c),d=v(d);var e=w(c,1),f=w(d,1);for(d=w(d,2),c=w(c,2);!o(d);){var g=f.add(d);0>=g.l(a)&&(e=e.add(c),f=g),d=w(d,1),c=w(c,1)}return b=r(a,e.j(b)),new t(e,b)}for(e=j;a.l(b)>=0;){for(d=(d=Math.ceil(Math.log(c=Math.max(1,Math.floor(a.m()/b.m())))/Math.LN2))<=48?1:Math.pow(2,d-48),g=(f=h(c)).j(b);p(g)||g.l(a)>0;)c-=d,g=(f=h(c)).j(b);o(f)&&(f=k),e=e.add(f),a=r(a,g)}return new t(e,a)}function v(a){let b=a.g.length+1,c=[];for(let d=0;d<b;d++)c[d]=a.i(d)<<1|a.i(d-1)>>>31;return new d(c,a.h)}function w(a,b){let c=b>>5;b%=32;let e=a.g.length-c,f=[];for(let d=0;d<e;d++)f[d]=b>0?a.i(d+c)>>>b|a.i(d+c+1)<<32-b:a.i(d+c);return new d(f,a.h)}(e=d.prototype).m=function(){if(p(this))return-q(this).m();let a=0,b=1;for(let c=0;c<this.g.length;c++){let d=this.i(c);a+=(d>=0?d:0x100000000+d)*b,b*=0x100000000}return a},e.toString=function(a){if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if(o(this))return"0";if(p(this))return"-"+q(this).toString(a);let b=h(Math.pow(a,6));var c=this;let d="";for(;;){let e=u(c,b).g,f=(((c=r(c,e.j(b))).g.length>0?c.g[0]:c.h)>>>0).toString(a);if(o(c=e))return f+d;for(;f.length<6;)f="0"+f;d=f+d}},e.i=function(a){return a<0?0:a<this.g.length?this.g[a]:this.h},e.l=function(a){return p(a=r(this,a))?-1:+!o(a)},e.abs=function(){return p(this)?q(this):this},e.add=function(a){let b=Math.max(this.g.length,a.g.length),c=[],e=0;for(let d=0;d<=b;d++){let b=e+(65535&this.i(d))+(65535&a.i(d)),f=(b>>>16)+(this.i(d)>>>16)+(a.i(d)>>>16);e=f>>>16,b&=65535,f&=65535,c[d]=f<<16|b}return new d(c,-0x80000000&c[c.length-1]?-1:0)},e.j=function(a){if(o(this)||o(a))return j;if(p(this))return p(a)?q(this).j(q(a)):q(q(this).j(a));if(p(a))return q(this.j(q(a)));if(0>this.l(l)&&0>a.l(l))return h(this.m()*a.m());let b=this.g.length+a.g.length,c=[];for(var e=0;e<2*b;e++)c[e]=0;for(e=0;e<this.g.length;e++)for(let b=0;b<a.g.length;b++){let d=this.i(e)>>>16,f=65535&this.i(e),g=a.i(b)>>>16,h=65535&a.i(b);c[2*e+2*b]+=f*h,s(c,2*e+2*b),c[2*e+2*b+1]+=d*h,s(c,2*e+2*b+1),c[2*e+2*b+1]+=f*g,s(c,2*e+2*b+1),c[2*e+2*b+2]+=d*g,s(c,2*e+2*b+2)}for(a=0;a<b;a++)c[a]=c[2*a+1]<<16|c[2*a];for(a=b;a<2*b;a++)c[a]=0;return new d(c,0)},e.B=function(a){return u(this,a).h},e.and=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)&a.i(d);return new d(c,this.h&a.h)},e.or=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)|a.i(d);return new d(c,this.h|a.h)},e.xor=function(a){let b=Math.max(this.g.length,a.g.length),c=[];for(let d=0;d<b;d++)c[d]=this.i(d)^a.i(d);return new d(c,this.h^a.h)},a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,n=gq.Md5=a,d.prototype.add=d.prototype.add,d.prototype.multiply=d.prototype.j,d.prototype.modulo=d.prototype.B,d.prototype.compare=d.prototype.l,d.prototype.toNumber=d.prototype.m,d.prototype.toString=d.prototype.toString,d.prototype.getBits=d.prototype.i,d.fromNumber=h,d.fromString=i,m=gq.Integer=d}).apply(void 0!==gp?gp:"u">typeof self?self:{});var gr=a.i(24361),gs=a.i(54799),gt=a.i(80304),gu=a.i(67523);class gv{constructor(a){this.uid=a}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}gv.UNAUTHENTICATED=new gv(null),gv.GOOGLE_CREDENTIALS=new gv("google-credentials-uid"),gv.FIRST_PARTY=new gv("first-party-uid"),gv.MOCK_USER=new gv("mock-user");let gw="12.8.0";function gx(a){gw=a}function gy(a){return(0,gr.inspect)(a,{depth:100})}let gz=new fg("@firebase/firestore");function gA(){return gz.logLevel}function gB(a,...b){if(gz.logLevel<=l.DEBUG){let c=b.map(gE);gz.debug(`Firestore (${gw}): ${a}`,...c)}}function gC(a,...b){if(gz.logLevel<=l.ERROR){let c=b.map(gE);gz.error(`Firestore (${gw}): ${a}`,...c)}}function gD(a,...b){if(gz.logLevel<=l.WARN){let c=b.map(gE);gz.warn(`Firestore (${gw}): ${a}`,...c)}}function gE(a){if("string"==typeof a)return a;try{return gy(a)}catch(b){return a}}function gF(a,b,c){let d="Unexpected state";"string"==typeof b?d=b:c=b,gG(a,d,c)}function gG(a,b,c){let d=`FIRESTORE (${gw}) INTERNAL ASSERTION FAILED: ${b} (ID: ${a.toString(16)})`;if(void 0!==c)try{let a=JSON.stringify(c);d+=" CONTEXT: "+a}catch(a){d+=" CONTEXT: "+c}throw gC(d),Error(d)}function gH(a,b,c,d){let e="Unexpected state";"string"==typeof c?e=c:d=c,a||gG(b,e,d)}function gI(a,b){return a}let gJ="ok",gK="cancelled",gL="unknown",gM="invalid-argument",gN="deadline-exceeded",gO="not-found",gP="already-exists",gQ="permission-denied",gR="unauthenticated",gS="resource-exhausted",gT="failed-precondition",gU="aborted",gV="out-of-range",gW="unimplemented",gX="internal",gY="unavailable",gZ="data-loss";class g$ extends e${constructor(a,b){super(a,b),this.code=a,this.message=b,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class g_{constructor(){this.promise=new Promise((a,b)=>{this.resolve=a,this.reject=b})}}class g0{constructor(a,b){this.user=b,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class g1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,b){a.enqueueRetryable(()=>b(gv.UNAUTHENTICATED))}shutdown(){}}class g2{constructor(a){this.token=a,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(a,b){this.changeListener=b,a.enqueueRetryable(()=>b(this.token.user))}shutdown(){this.changeListener=null}}class g3{constructor(a){this.authProvider=a,this.currentUser=gv.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(a,b){gH(void 0===this.tokenListener,42304);let c=this.tokenCounter,d=a=>this.tokenCounter!==c?(c=this.tokenCounter,b(a)):Promise.resolve(),e=new g_;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),e.resolve(),e=new g_,a.enqueueRetryable(()=>d(this.currentUser))};let f=()=>{let b=e;a.enqueueRetryable(async()=>{await b.promise,await d(this.currentUser)})},g=a=>{gB("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),f())};this.authProvider.onInit(a=>g(a)),setTimeout(()=>{if(!this.auth){let a=this.authProvider.getImmediate({optional:!0});a?g(a):(gB("FirebaseAuthCredentialsProvider","Auth not yet detected"),e.resolve(),e=new g_)}},0),f()}getToken(){let a=this.tokenCounter,b=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(b).then(b=>this.tokenCounter!==a?(gB("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):b?(gH("string"==typeof b.accessToken,31837,{tokenData:b}),new g0(b.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let a=this.auth&&this.auth.getUid();return gH(null===a||"string"==typeof a,2055,{currentUid:a}),new gv(a)}}class g4{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c,this.type="FirstParty",this.user=gv.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let a=this.getAuthToken();return a&&this._headers.set("Authorization",a),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class g5{constructor(a,b,c){this.sessionIndex=a,this.iamToken=b,this.authTokenFactory=c}getToken(){return Promise.resolve(new g4(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(a,b){a.enqueueRetryable(()=>b(gv.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class g6{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class g7{constructor(a,b){this.appCheckProvider=b,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,fW(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken)}start(a,b){gH(void 0===this.tokenListener,3512);let c=a=>{null!=a.error&&gB("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);let c=a.token!==this.latestAppCheckToken;return this.latestAppCheckToken=a.token,gB("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?b(a.token):Promise.resolve()};this.tokenListener=b=>{a.enqueueRetryable(()=>c(b))};let d=a=>{gB("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(a=>d(a)),setTimeout(()=>{if(!this.appCheck){let a=this.appCheckProvider.getImmediate({optional:!0});a?d(a):gB("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new g6(this.serverAppAppCheckToken));let a=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(a).then(a=>a?(gH("string"==typeof a.token,44558,{tokenResult:a}),this.latestAppCheckToken=a.token,new g6(a.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function g8(a){if(!a)return new g1;switch(a.type){case"firstParty":return new g5(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new g$(gM,"makeAuthCredentialsProvider failed due to invalid credential type")}}function g9(a){return(0,gs.randomBytes)(a)}class ha{static newId(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=Math.floor(256/a.length)*a.length,c="",d=20;for(;c.length<d;){let e=g9(40);for(let f=0;f<e.length;++f)c.length<d&&e[f]<b&&(c+=a.charAt(e[f]%a.length))}return c}}function hb(a,b){return a<b?-1:+(a>b)}function hc(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=a.charAt(d),e=b.charAt(d);if(c!==e)return hf(c)===hf(e)?hb(c,e):hf(c)?1:-1}return hb(a.length,b.length)}let hd=55296,he=57343;function hf(a){let b=a.charCodeAt(0);return b>=hd&&b<=he}function hg(a,b,c){return a.length===b.length&&a.every((a,d)=>c(a,b[d]))}function hh(a){return a+"\0"}let hi="__name__";class hj{constructor(a,b,c){void 0===b?b=0:b>a.length&&gF(637,{offset:b,range:a.length}),void 0===c?c=a.length-b:c>a.length-b&&gF(1746,{length:c,range:a.length-b}),this.segments=a,this.offset=b,this.len=c}get length(){return this.len}isEqual(a){return 0===hj.comparator(this,a)}child(a){let b=this.segments.slice(this.offset,this.limit());return a instanceof hj?a.forEach(a=>{b.push(a)}):b.push(a),this.construct(b)}limit(){return this.offset+this.length}popFirst(a){return a=void 0===a?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return 0===this.length}isPrefixOf(a){if(a.length<this.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let b=0;b<this.length;b++)if(this.get(b)!==a.get(b))return!1;return!0}forEach(a){for(let b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,b){let c=Math.min(a.length,b.length);for(let d=0;d<c;d++){let c=hj.compareSegments(a.get(d),b.get(d));if(0!==c)return c}return hb(a.length,b.length)}static compareSegments(a,b){let c=hj.isNumericId(a),d=hj.isNumericId(b);return c&&!d?-1:!c&&d?1:c&&d?hj.extractNumericId(a).compare(hj.extractNumericId(b)):hc(a,b)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return m.fromString(a.substring(4,a.length-2))}}class hk extends hj{construct(a,b,c){return new hk(a,b,c)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){let b=[];for(let c of a){if(c.indexOf("//")>=0)throw new g$(gM,`Invalid segment (${c}). Paths must not contain // in them.`);b.push(...c.split("/").filter(a=>a.length>0))}return new hk(b)}static emptyPath(){return new hk([])}}let hl=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class hm extends hj{construct(a,b,c){return new hm(a,b,c)}static isValidIdentifier(a){return hl.test(a)}canonicalString(){return this.toArray().map(a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),hm.isValidIdentifier(a)||(a="`"+a+"`"),a)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===hi}static keyField(){return new hm([hi])}static fromServerFormat(a){let b=[],c="",d=0,e=()=>{if(0===c.length)throw new g$(gM,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);b.push(c),c=""},f=!1;for(;d<a.length;){let b=a[d];if("\\"===b){if(d+1===a.length)throw new g$(gM,"Path has trailing escape character: "+a);let b=a[d+1];if("\\"!==b&&"."!==b&&"`"!==b)throw new g$(gM,"Path has invalid escape sequence: "+a);c+=b,d+=2}else"`"===b?f=!f:"."!==b||f?c+=b:e(),d++}if(e(),f)throw new g$(gM,"Unterminated ` in path: "+a);return new hm(b)}static emptyPath(){return new hm([])}}class hn{constructor(a){this.path=a}static fromPath(a){return new hn(hk.fromString(a))}static fromName(a){return new hn(hk.fromString(a).popFirst(5))}static empty(){return new hn(hk.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return null!==a&&0===hk.comparator(this.path,a.path)}toString(){return this.path.toString()}static comparator(a,b){return hk.comparator(a.path,b.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new hn(new hk(a.slice()))}}function ho(a,b,c){if(!c)throw new g$(gM,`Function ${a}() cannot be called with an empty ${b}.`)}function hp(a,b,c,d){if(!0===b&&!0===d)throw new g$(gM,`${a} and ${c} cannot be used together.`)}function hq(a){if(!hn.isDocumentKey(a))throw new g$(gM,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function hr(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a))}function hs(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"==typeof a)return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a)if(a instanceof Array)return"an array";else{let b=ht(a);return b?`a custom ${b} object`:"an object"}else if("function"==typeof a)return"a function";else return gF(12329,{type:typeof a})}function ht(a){return a.constructor?a.constructor.name:null}function hu(a,b){if("_delegate"in a&&(a=a._delegate),!(a instanceof b))if(b.name===a.constructor.name)throw new g$(gM,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let c=hs(a);throw new g$(gM,`Expected type '${b.name}', but it was: ${c}`)}return a}function hv(a,b){if(b<=0)throw new g$(gM,`Function ${a}() requires a positive number, but it was: ${b}.`)}function hw(a,b){let c={typeString:a};return b&&(c.value=b),c}function hx(a,b){let c;if(!hr(a))throw new g$(gM,"JSON must be an object");for(let d in b)if(b[d]){let e=b[d].typeString,f="value"in b[d]?{value:b[d].value}:void 0;if(!(d in a)){c=`JSON missing required field: '${d}'`;break}let g=a[d];if(e&&typeof g!==e){c=`JSON field '${d}' must be a ${e}.`;break}if(void 0!==f&&g!==f.value){c=`Expected '${d}' field to equal '${f.value}'`;break}}if(c)throw new g$(gM,c);return!0}let hy=-0xe7791f700,hz=1e6;class hA{static now(){return hA.fromMillis(Date.now())}static fromDate(a){return hA.fromMillis(a.getTime())}static fromMillis(a){let b=Math.floor(a/1e3),c=Math.floor((a-1e3*b)*hz);return new hA(b,c)}constructor(a,b){if(this.seconds=a,this.nanoseconds=b,b<0||b>=1e9)throw new g$(gM,"Timestamp nanoseconds out of range: "+b);if(a<hy||a>=0x3afff44180)throw new g$(gM,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/hz}_compareTo(a){return this.seconds===a.seconds?hb(this.nanoseconds,a.nanoseconds):hb(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:hA._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(hx(a,hA._jsonSchema))return new hA(a.seconds,a.nanoseconds)}valueOf(){return String(this.seconds-hy).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}hA._jsonSchemaVersion="firestore/timestamp/1.0",hA._jsonSchema={type:hw("string",hA._jsonSchemaVersion),seconds:hw("number"),nanoseconds:hw("number")};class hB{static fromTimestamp(a){return new hB(a)}static min(){return new hB(new hA(0,0))}static max(){return new hB(new hA(0x3afff4417f,1e9-1))}constructor(a){this.timestamp=a}compareTo(a){return this.timestamp._compareTo(a.timestamp)}isEqual(a){return this.timestamp.isEqual(a.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let hC=-1,hD=0;class hE{constructor(a,b,c,d){this.indexId=a,this.collectionGroup=b,this.fields=c,this.indexState=d}}function hF(a){return a.fields.find(a=>2===a.kind)}function hG(a){return a.fields.filter(a=>2!==a.kind)}function hH(a){let b=hG(a);return 0===b.length?0:b[b.length-1].kind}function hI(a,b){let c=hb(a.collectionGroup,b.collectionGroup);if(0!==c)return c;for(let d=0;d<Math.min(a.fields.length,b.fields.length);++d)if(0!==(c=hL(a.fields[d],b.fields[d])))return c;return hb(a.fields.length,b.fields.length)}function hJ(a){return`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(a=>`${a.fieldPath}:${a.kind}`).join(",")}`}hE.UNKNOWN_ID=-1;class hK{constructor(a,b){this.fieldPath=a,this.kind=b}}function hL(a,b){let c=hm.comparator(a.fieldPath,b.fieldPath);return 0!==c?c:hb(a.kind,b.kind)}class hM{constructor(a,b){this.sequenceNumber=a,this.offset=b}static empty(){return new hM(hD,hP.min())}}function hN(a,b){let c=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1;return new hP(hB.fromTimestamp(1e9===d?new hA(c+1,0):new hA(c,d)),hn.empty(),b)}function hO(a){return new hP(a.readTime,a.key,hC)}class hP{constructor(a,b,c){this.readTime=a,this.documentKey=b,this.largestBatchId=c}static min(){return new hP(hB.min(),hn.empty(),hC)}static max(){return new hP(hB.max(),hn.empty(),hC)}}function hQ(a,b){let c=a.readTime.compareTo(b.readTime);return 0!==c||0!==(c=hn.comparator(a.documentKey,b.documentKey))?c:hb(a.largestBatchId,b.largestBatchId)}let hR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(a){this.onCommittedListeners.push(a)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(a=>a())}}async function hT(a){if(a.code===gT&&a.message===hR)gB("LocalStore","Unexpectedly lost primary lease");else throw a}class hU{constructor(a){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,a(a=>{this.isDone=!0,this.result=a,this.nextCallback&&this.nextCallback(a)},a=>{this.isDone=!0,this.error=a,this.catchCallback&&this.catchCallback(a)})}catch(a){return this.next(void 0,a)}next(a,b){return(this.callbackAttached&&gF(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(b,this.error):this.wrapSuccess(a,this.result):new hU((c,d)=>{this.nextCallback=b=>{this.wrapSuccess(a,b).next(c,d)},this.catchCallback=a=>{this.wrapFailure(b,a).next(c,d)}})}toPromise(){return new Promise((a,b)=>{this.next(a,b)})}wrapUserFunction(a){try{let b=a();if(b instanceof hU)return b;return hU.resolve(b)}catch(a){return hU.reject(a)}}wrapSuccess(a,b){return a?this.wrapUserFunction(()=>a(b)):hU.resolve(b)}wrapFailure(a,b){return a?this.wrapUserFunction(()=>a(b)):hU.reject(b)}static resolve(a){return new hU((b,c)=>{b(a)})}static reject(a){return new hU((b,c)=>{c(a)})}static waitFor(a){return new hU((b,c)=>{let d=0,e=0,f=!1;a.forEach(a=>{++d,a.next(()=>{++e,f&&e===d&&b()},a=>c(a))}),f=!0,e===d&&b()})}static or(a){let b=hU.resolve(!1);for(let c of a)b=b.next(a=>a?hU.resolve(a):c());return b}static forEach(a,b){let c=[];return a.forEach((a,d)=>{c.push(b.call(this,a,d))}),this.waitFor(c)}static mapArray(a,b){return new hU((c,d)=>{let e=a.length,f=Array(e),g=0;for(let h=0;h<e;h++){let i=h;b(a[i]).next(a=>{f[i]=a,++g===e&&c(f)},a=>d(a))}})}static doWhile(a,b){return new hU((c,d)=>{let e=()=>{!0===a()?b().next(()=>{e()},d):c()};e()})}}let hV="SimpleDb",hW=3;class hX{static open(a,b,c,d){try{return new hX(b,a.transaction(d,c))}catch(a){throw new h_(b,a)}}constructor(a,b){this.action=a,this.transaction=b,this.aborted=!1,this.completionDeferred=new g_,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{b.error?this.completionDeferred.reject(new h_(a,b.error)):this.completionDeferred.resolve()},this.transaction.onerror=b=>{let c=h4(b.target.error);this.completionDeferred.reject(new h_(a,c))}}get completionPromise(){return this.completionDeferred.promise}abort(a){a&&this.completionDeferred.reject(a),this.aborted||(gB(hV,"Aborting transaction:",a?a.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let a=this.transaction;this.aborted||"function"!=typeof a.commit||a.commit()}store(a){return new h1(this.transaction.objectStore(a))}}class hY{static delete(a){return gB(hV,"Removing database:",a),h2(eE().indexedDB.deleteDatabase(a)).toPromise()}static isAvailable(){if(!eX())return!1;if(hY.isMockPersistence())return!0;let a=eR(),b=hY.getIOSVersion(a),c=0<b&&b<10,d=hZ(a),e=0<d&&d<4.5;return!(a.indexOf("MSIE ")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0)&&!c&&!e}static isMockPersistence(){return"u">typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(a,b){return a.store(b)}static getIOSVersion(a){let b=a.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(b?b[1].split("_").slice(0,2).join("."):"-1")}constructor(a,b,c){this.name=a,this.version=b,this.schemaConverter=c,this.lastClosedDbVersion=null,12.2===hY.getIOSVersion(eR())&&gC("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(a){return this.db||(gB(hV,"Opening database:",this.name),this.db=await new Promise((b,c)=>{let d=indexedDB.open(this.name,this.version);d.onsuccess=a=>{b(a.target.result)},d.onblocked=()=>{c(new h_(a,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},d.onerror=b=>{let d=b.target.error;"VersionError"===d.name?c(new g$(gT,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===d.name?c(new g$(gT,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d)):c(new h_(a,d))},d.onupgradeneeded=a=>{gB(hV,'Database "'+this.name+'" requires upgrade from version:',a.oldVersion);let b=a.target.result;this.schemaConverter.createOrUpgrade(b,d.transaction,a.oldVersion,this.version).next(()=>{gB(hV,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=a=>this.versionchangelistener(a)),this.db}setVersionChangeListener(a){this.versionchangelistener=a,this.db&&(this.db.onversionchange=b=>a(b))}async runTransaction(a,b,c,d){let e="readonly"===b,f=0;for(;;){++f;try{this.db=await this.ensureDb(a);let b=hX.open(this.db,a,e?"readonly":"readwrite",c),f=d(b).next(a=>(b.maybeCommit(),a)).catch(a=>(b.abort(a),hU.reject(a))).toPromise();return f.catch(()=>{}),await b.completionPromise,f}catch(c){let a=c,b="FirebaseError"!==a.name&&f<hW;if(gB(hV,"Transaction failed with error:",a.message,"Retrying:",b),this.close(),!b)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}function hZ(a){let b=a.match(/Android ([\d.]+)/i);return Number(b?b[1].split(".").slice(0,2).join("."):"-1")}class h${constructor(a){this.dbCursor=a,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(a){this.dbCursor=a}done(){this.shouldStop=!0}skip(a){this.nextKey=a}delete(){return h2(this.dbCursor.delete())}}class h_ extends g${constructor(a,b){super(gY,`IndexedDB transaction '${a}' failed: ${b}`),this.name="IndexedDbTransactionError"}}function h0(a){return"IndexedDbTransactionError"===a.name}class h1{constructor(a){this.store=a}put(a,b){let c;return void 0!==b?(gB(hV,"PUT",this.store.name,a,b),c=this.store.put(b,a)):(gB(hV,"PUT",this.store.name,"<auto-key>",a),c=this.store.put(a)),h2(c)}add(a){return gB(hV,"ADD",this.store.name,a,a),h2(this.store.add(a))}get(a){return h2(this.store.get(a)).next(b=>(void 0===b&&(b=null),gB(hV,"GET",this.store.name,a,b),b))}delete(a){return gB(hV,"DELETE",this.store.name,a),h2(this.store.delete(a))}count(){return gB(hV,"COUNT",this.store.name),h2(this.store.count())}loadAll(a,b){let c=this.options(a,b),d=c.index?this.store.index(c.index):this.store;if("function"==typeof d.getAll){let a=d.getAll(c.range);return new hU((b,c)=>{a.onerror=a=>{c(a.target.error)},a.onsuccess=a=>{b(a.target.result)}})}{let a=this.cursor(c),b=[];return this.iterateCursor(a,(a,c)=>{b.push(c)}).next(()=>b)}}loadFirst(a,b){let c=this.store.getAll(a,null===b?void 0:b);return new hU((a,b)=>{c.onerror=a=>{b(a.target.error)},c.onsuccess=b=>{a(b.target.result)}})}deleteAll(a,b){gB(hV,"DELETE ALL",this.store.name);let c=this.options(a,b);c.keysOnly=!1;let d=this.cursor(c);return this.iterateCursor(d,(a,b,c)=>c.delete())}iterate(a,b){let c;b?c=a:(c={},b=a);let d=this.cursor(c);return this.iterateCursor(d,b)}iterateSerial(a){let b=this.cursor({});return new hU((c,d)=>{b.onerror=a=>{d(h4(a.target.error))},b.onsuccess=b=>{let d=b.target.result;d?a(d.primaryKey,d.value).next(a=>{a?d.continue():c()}):c()}})}iterateCursor(a,b){let c=[];return new hU((d,e)=>{a.onerror=a=>{e(a.target.error)},a.onsuccess=a=>{let e=a.target.result;if(!e)return void d();let f=new h$(e),g=b(e.primaryKey,e.value,f);if(g instanceof hU){let a=g.catch(a=>(f.done(),hU.reject(a)));c.push(a)}f.isDone?d():null===f.skipToKey?e.continue():e.continue(f.skipToKey)}}).next(()=>hU.waitFor(c))}options(a,b){let c;return void 0!==a&&("string"==typeof a?c=a:b=a),{index:c,range:b}}cursor(a){let b="next";if(a.reverse&&(b="prev"),!a.index)return this.store.openCursor(a.range,b);{let c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}}}function h2(a){return new hU((b,c)=>{a.onsuccess=a=>{b(a.target.result)},a.onerror=a=>{c(h4(a.target.error))}})}let h3=!1;function h4(a){let b=hY.getIOSVersion(eR());if(b>=12.2&&b<13){let b="An internal error was encountered in the Indexed Database server";if(a.message.indexOf(b)>=0){let a=new g$("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${b}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return h3||(h3=!0,setTimeout(()=>{throw a},0)),a}}return a}let h5="IndexBackfiller",h6=15e3,h7=6e4,h8=50;class h9{constructor(a,b){this.asyncQueue=a,this.backfiller=b,this.task=null}start(){this.schedule(h6)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(a){gB(h5,`Scheduled in ${a}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",a,async()=>{this.task=null;try{let a=await this.backfiller.backfill();gB(h5,`Documents written: ${a}`)}catch(a){h0(a)?gB(h5,"Ignoring IndexedDB error during index backfill: ",a):await hT(a)}await this.schedule(h7)})}}class ia{constructor(a,b){this.localStore=a,this.persistence=b}async backfill(a=h8){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",b=>this.writeIndexEntries(b,a))}writeIndexEntries(a,b){let c=new Set,d=b,e=!0;return hU.doWhile(()=>!0===e&&d>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(a).next(b=>{if(!(null===b||c.has(b)))return gB(h5,`Processing collection: ${b}`),this.writeEntriesForCollectionGroup(a,b,d).next(a=>{d-=a,c.add(b)});e=!1})).next(()=>b-d)}writeEntriesForCollectionGroup(a,b,c){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(a,b).next(d=>this.localStore.localDocuments.getNextDocuments(a,b,d,c).next(c=>{let e=c.changes;return this.localStore.indexManager.updateIndexEntries(a,e).next(()=>this.getNewOffset(d,c)).next(c=>(gB(h5,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(a,b,c))).next(()=>e.size)}))}getNewOffset(a,b){let c=a;return b.changes.forEach((a,b)=>{let d=hO(b);hQ(d,c)>0&&(c=d)}),new hP(c.readTime,c.documentKey,Math.max(b.batchId,a.largestBatchId))}}class ib{constructor(a,b){this.previousValue=a,b&&(b.sequenceNumberHandler=a=>this.setPreviousValue(a),this.writeNewSequenceNumber=a=>b.writeSequenceNumber(a))}setPreviousValue(a){return this.previousValue=Math.max(a,this.previousValue),this.previousValue}next(){let a=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(a),a}}ib.INVALID=-1;let ic="\x01",id="\x01",ie="\x10",ig="\x11";function ih(a){let b="";for(let c=0;c<a.length;c++)b.length>0&&(b=ij(b)),b=ii(a.get(c),b);return ij(b)}function ii(a,b){let c=b,d=a.length;for(let b=0;b<d;b++){let d=a.charAt(b);switch(d){case"\0":c+=ic+ie;break;case ic:c+=ic+ig;break;default:c+=d}}return c}function ij(a){return a+ic+id}function ik(a){let b=a.length;if(gH(b>=2,64408,{path:a}),2===b)return gH(a.charAt(0)===ic&&a.charAt(1)===id,56145,{path:a}),hk.emptyPath();let c=b-2,d=[],e="";for(let f=0;f<b;){let b=a.indexOf(ic,f);switch((b<0||b>c)&&gF(50515,{path:a}),a.charAt(b+1)){case id:let g,h=a.substring(f,b);0===e.length?g=h:(e+=h,g=e,e=""),d.push(g);break;case ie:e+=a.substring(f,b),e+="\0";break;case ig:e+=a.substring(f,b+1);break;default:gF(61167,{path:a})}f=b+2}return new hk(d)}let il="remoteDocuments",im="owner",io="owner",ip="mutationQueues",iq="userId",ir="mutations",is="batchId",it="userMutationsIndex",iu=["userId","batchId"];function iv(a){return[a]}function iw(a,b){return[a,ih(b)]}function ix(a,b,c){return[a,ih(b),c]}let iy={},iz="documentMutations",iA="remoteDocumentsV14",iB=["prefixPath","collectionGroup","readTime","documentId"],iC="documentKeyIndex",iD=["prefixPath","collectionGroup","documentId"],iE="collectionGroupIndex",iF=["collectionGroup","readTime","prefixPath","documentId"],iG="remoteDocumentGlobal",iH="remoteDocumentGlobalKey",iI="targets",iJ="targetId",iK="queryTargetsIndex",iL=["canonicalId","targetId"],iM="targetDocuments",iN=["targetId","path"],iO="documentTargetsIndex",iP=["path","targetId"],iQ="targetGlobalKey",iR="targetGlobal",iS="collectionParents",iT=["collectionId","parent"],iU="clientMetadata",iV="clientId",iW="bundles",iX="bundleId",iY="namedQueries",iZ="name",i$="indexConfiguration",i_="indexId",i0="collectionGroupIndex",i1="collectionGroup",i2="indexState",i3=["indexId","uid"],i4="sequenceNumberIndex",i5=["uid","sequenceNumber"],i6="indexEntries",i7=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],i8="documentKeyIndex",i9=["indexId","uid","orderedDocumentKey"],ja="documentOverlays",jb=["userId","collectionPath","documentId"],jc="collectionPathOverlayIndex",jd=["userId","collectionPath","largestBatchId"],je="collectionGroupOverlayIndex",jf=["userId","collectionGroup","largestBatchId"],jg="globals",jh="name",ji=[ip,ir,iz,il,iI,im,iR,iM,iU,iG,iS,iW,iY],jj=[...ji,ja],jk=[ip,ir,iz,iA,iI,im,iR,iM,iU,iG,iS,iW,iY,ja],jl=jk,jm=[...jl,i$,i2,i6],jn=jm,jo=[...jm,jg],jp=jo;function jq(a){return 18===a?jp:17===a?jo:16===a?jn:15===a?jm:14===a?jl:13===a?jk:12===a?jj:11===a?ji:void gF(60245)}class jr extends hS{constructor(a,b){super(),this.simpleDbTransaction=a,this.currentSequenceNumber=b}}function js(a,b){let c=gI(a);return hY.getStore(c.simpleDbTransaction,b)}function jt(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}function ju(a,b){for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function jv(a,b){let c=[];for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&c.push(b(a[d],d,a));return c}function jw(a){for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}class jx{constructor(a,b){this.comparator=a,this.root=b||jz.EMPTY}insert(a,b){return new jx(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,jz.BLACK,null,null))}remove(a){return new jx(this.comparator,this.root.remove(a,this.comparator).copy(null,null,jz.BLACK,null,null))}get(a){let b=this.root;for(;!b.isEmpty();){let c=this.comparator(a,b.key);if(0===c)return b.value;c<0?b=b.left:c>0&&(b=b.right)}return null}indexOf(a){let b=0,c=this.root;for(;!c.isEmpty();){let d=this.comparator(a,c.key);if(0===d)return b+c.left.size;d<0?c=c.left:(b+=c.left.size+1,c=c.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(a){return this.root.inorderTraversal(a)}forEach(a){this.inorderTraversal((b,c)=>(a(b,c),!1))}toString(){let a=[];return this.inorderTraversal((b,c)=>(a.push(`${b}:${c}`),!1)),`{${a.join(", ")}}`}reverseTraversal(a){return this.root.reverseTraversal(a)}getIterator(){return new jy(this.root,null,this.comparator,!1)}getIteratorFrom(a){return new jy(this.root,a,this.comparator,!1)}getReverseIterator(){return new jy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(a){return new jy(this.root,a,this.comparator,!0)}}class jy{constructor(a,b,c,d){this.isReverse=d,this.nodeStack=[];let e=1;for(;!a.isEmpty();)if(e=b?c(a.key,b):1,b&&d&&(e*=-1),e<0)a=this.isReverse?a.left:a.right;else if(0===e){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left}getNext(){let a=this.nodeStack.pop(),b={key:a.key,value:a.value};if(this.isReverse)for(a=a.left;!a.isEmpty();)this.nodeStack.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack.push(a),a=a.left;return b}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let a=this.nodeStack[this.nodeStack.length-1];return{key:a.key,value:a.value}}}class jz{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:jz.RED,this.left=null!=d?d:jz.EMPTY,this.right=null!=e?e:jz.EMPTY,this.size=this.left.size+1+this.right.size}copy(a,b,c,d,e){return new jz(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp()}removeMin(){if(this.left.isEmpty())return jz.EMPTY;let a=this;return a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),(a=a.copy(null,null,null,a.left.removeMin(),null)).fixUp()}remove(a,b){let c,d=this;if(0>b(a,d.key))d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(a,b),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),0===b(a,d.key))if(d.right.isEmpty())return jz.EMPTY;else c=d.right.min(),d=d.copy(c.key,c.value,null,null,d.right.removeMin());d=d.copy(null,null,null,null,d.right.remove(a,b))}return d.fixUp()}isRed(){return this.color}fixUp(){let a=this;return a.right.isRed()&&!a.left.isRed()&&(a=a.rotateLeft()),a.left.isRed()&&a.left.left.isRed()&&(a=a.rotateRight()),a.left.isRed()&&a.right.isRed()&&(a=a.colorFlip()),a}moveRedLeft(){let a=this.colorFlip();return a.right.left.isRed()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight())).rotateLeft()).colorFlip()),a}moveRedRight(){let a=this.colorFlip();return a.left.left.isRed()&&(a=(a=a.rotateRight()).colorFlip()),a}rotateLeft(){let a=this.copy(null,null,jz.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight(){let a=this.copy(null,null,jz.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw gF(43730,{key:this.key,value:this.value});if(this.right.isRed())throw gF(14113,{key:this.key,value:this.value});let a=this.left.check();if(a===this.right.check())return a+ +!this.isRed();throw gF(27949)}}jz.EMPTY=null,jz.RED=!0,jz.BLACK=!1;class jA{constructor(){this.size=0}get key(){throw gF(57766)}get value(){throw gF(16141)}get color(){throw gF(16727)}get left(){throw gF(29726)}get right(){throw gF(36894)}copy(a,b,c,d,e){return this}insert(a,b,c){return new jz(a,b)}remove(a,b){return this}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}jz.EMPTY=new jA;class jB{constructor(a){this.comparator=a,this.data=new jx(this.comparator)}has(a){return null!==this.data.get(a)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(a){return this.data.indexOf(a)}forEach(a){this.data.inorderTraversal((b,c)=>(a(b),!1))}forEachInRange(a,b){let c=this.data.getIteratorFrom(a[0]);for(;c.hasNext();){let d=c.getNext();if(this.comparator(d.key,a[1])>=0)return;b(d.key)}}forEachWhile(a,b){let c;for(c=void 0!==b?this.data.getIteratorFrom(b):this.data.getIterator();c.hasNext();)if(!a(c.getNext().key))return}firstAfterOrEqual(a){let b=this.data.getIteratorFrom(a);return b.hasNext()?b.getNext().key:null}getIterator(){return new jC(this.data.getIterator())}getIteratorFrom(a){return new jC(this.data.getIteratorFrom(a))}add(a){return this.copy(this.data.remove(a).insert(a,!0))}delete(a){return this.has(a)?this.copy(this.data.remove(a)):this}isEmpty(){return this.data.isEmpty()}unionWith(a){let b=this;return b.size<a.size&&(b=a,a=this),a.forEach(a=>{b=b.add(a)}),b}isEqual(a){if(!(a instanceof jB)||this.size!==a.size)return!1;let b=this.data.getIterator(),c=a.data.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(0!==this.comparator(a,d))return!1}return!0}toArray(){let a=[];return this.forEach(b=>{a.push(b)}),a}toString(){let a=[];return this.forEach(b=>a.push(b)),"SortedSet("+a.toString()+")"}copy(a){let b=new jB(this.comparator);return b.data=a,b}}class jC{constructor(a){this.iter=a}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function jD(a,b,c,d,e){let f=a.getIterator(),g=b.getIterator(),h=jE(f),i=jE(g);for(;h||i;){let a=!1,b=!1;if(h&&i){let d=c(h,i);d<0?b=!0:d>0&&(a=!0)}else null!=h?b=!0:a=!0;a?(d(i),i=jE(g)):b?(e(h),h=jE(f)):(h=jE(f),i=jE(g))}}function jE(a){return a.hasNext()?a.getNext():void 0}class jF{constructor(a){this.fields=a,a.sort(hm.comparator)}static empty(){return new jF([])}unionWith(a){let b=new jB(hm.comparator);for(let a of this.fields)b=b.add(a);for(let c of a)b=b.add(c);return new jF(b.toArray())}covers(a){for(let b of this.fields)if(b.isPrefixOf(a))return!0;return!1}isEqual(a){return hg(this.fields,a.fields,(a,b)=>a.isEqual(b))}}function jG(a){return Buffer.from(a,"base64").toString("binary")}function jH(a){return Buffer.from(a,"binary").toString("base64")}class jI{constructor(a){this.binaryString=a}static fromBase64String(a){return new jI(jG(a))}static fromUint8Array(a){return new jI(jJ(a))}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return jH(this.binaryString)}toUint8Array(){return jK(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return hb(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}function jJ(a){let b="";for(let c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function jK(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}jI.EMPTY_BYTE_STRING=new jI("");let jL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jM(a){if(gH(!!a,39018),"string"==typeof a){let b=0,c=jL.exec(a);if(gH(!!c,46558,{timestamp:a}),c[1]){let a=c[1];b=Number(a=(a+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(a).getTime()/1e3),nanos:b}}return{seconds:jN(a.seconds),nanos:jN(a.nanos)}}function jN(a){return"number"==typeof a?a:"string"==typeof a?Number(a):0}function jO(a){return"string"==typeof a?jI.fromBase64String(a):jI.fromUint8Array(a)}let jP="server_timestamp",jQ="__type__",jR="__previous_value__",jS="__local_write_time__";function jT(a){return(a?.mapValue?.fields||{})[jQ]?.stringValue===jP}function jU(a,b){let c={fields:{[jQ]:{stringValue:jP},[jS]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return b&&jT(b)&&(b=jV(b)),b&&(c.fields[jR]=b),{mapValue:c}}function jV(a){let b=a.mapValue.fields[jR];return jT(b)?jV(b):b}function jW(a){let b=jM(a.mapValue.fields[jS].timestampValue);return new hA(b.seconds,b.nanos)}class jX{constructor(a,b,c,d,e,f,g,h,i,j,k){this.databaseId=a,this.appId=b,this.persistenceKey=c,this.host=d,this.ssl=e,this.forceLongPolling=f,this.autoDetectLongPolling=g,this.longPollingOptions=h,this.useFetchStreams=i,this.isUsingEmulator=j,this.apiKey=k}}let jY="(default)";class jZ{constructor(a,b){this.projectId=a,this.database=b||jY}static empty(){return new jZ("","")}get isDefaultDatabase(){return this.database===jY}isEqual(a){return a instanceof jZ&&a.projectId===this.projectId&&a.database===this.database}}function j$(a,b){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new g$(gM,'"projectId" not provided in firebase.initializeApp.');return new jZ(a.options.projectId,b)}let j_=-1;function j0(a){return null==a}function j1(a){return 0===a&&1/a==-1/0}function j2(a){return"number"==typeof a&&Number.isInteger(a)&&!j1(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}let j3="__type__",j4="__max__",j5={mapValue:{fields:{__type__:{stringValue:j4}}}},j6="__vector__",j7="value",j8={nullValue:"NULL_VALUE"};function j9(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?jT(a)?4:kL(a)?0x1fffffffffffff:kJ(a)?10:11:gF(28295,{value:a})}function ka(a,b){if(a===b)return!0;let c=j9(a);if(c!==j9(b))return!1;switch(c){case 0:case 0x1fffffffffffff:return!0;case 1:return a.booleanValue===b.booleanValue;case 4:return jW(a).isEqual(jW(b));case 3:return kb(a,b);case 5:return a.stringValue===b.stringValue;case 6:return kd(a,b);case 7:return a.referenceValue===b.referenceValue;case 8:return kc(a,b);case 2:return ke(a,b);case 9:return hg(a.arrayValue.values||[],b.arrayValue.values||[],ka);case 10:case 11:return kf(a,b);default:return gF(52216,{left:a})}}function kb(a,b){if("string"==typeof a.timestampValue&&"string"==typeof b.timestampValue&&a.timestampValue.length===b.timestampValue.length)return a.timestampValue===b.timestampValue;let c=jM(a.timestampValue),d=jM(b.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}function kc(a,b){return jN(a.geoPointValue.latitude)===jN(b.geoPointValue.latitude)&&jN(a.geoPointValue.longitude)===jN(b.geoPointValue.longitude)}function kd(a,b){return jO(a.bytesValue).isEqual(jO(b.bytesValue))}function ke(a,b){if("integerValue"in a&&"integerValue"in b)return jN(a.integerValue)===jN(b.integerValue);if("doubleValue"in a&&"doubleValue"in b){let c=jN(a.doubleValue),d=jN(b.doubleValue);return c===d?j1(c)===j1(d):isNaN(c)&&isNaN(d)}return!1}function kf(a,b){let c=a.mapValue.fields||{},d=b.mapValue.fields||{};if(jt(c)!==jt(d))return!1;for(let a in c)if(c.hasOwnProperty(a)&&(void 0===d[a]||!ka(c[a],d[a])))return!1;return!0}function kg(a,b){return void 0!==(a.values||[]).find(a=>ka(a,b))}function kh(a,b){if(a===b)return 0;let c=j9(a),d=j9(b);if(c!==d)return hb(c,d);switch(c){case 0:case 0x1fffffffffffff:return 0;case 1:return hb(a.booleanValue,b.booleanValue);case 2:return ki(a,b);case 3:return kj(a.timestampValue,b.timestampValue);case 4:return kj(jW(a),jW(b));case 5:return hc(a.stringValue,b.stringValue);case 6:return km(a.bytesValue,b.bytesValue);case 7:return kk(a.referenceValue,b.referenceValue);case 8:return kl(a.geoPointValue,b.geoPointValue);case 9:return kn(a.arrayValue,b.arrayValue);case 10:return ko(a.mapValue,b.mapValue);case 11:return kp(a.mapValue,b.mapValue);default:throw gF(23264,{leftType:c})}}function ki(a,b){let c=jN(a.integerValue||a.doubleValue),d=jN(b.integerValue||b.doubleValue);return c<d?-1:c>d?1:c===d?0:isNaN(c)?isNaN(d)?0:-1:1}function kj(a,b){if("string"==typeof a&&"string"==typeof b&&a.length===b.length)return hb(a,b);let c=jM(a),d=jM(b),e=hb(c.seconds,d.seconds);return 0!==e?e:hb(c.nanos,d.nanos)}function kk(a,b){let c=a.split("/"),d=b.split("/");for(let a=0;a<c.length&&a<d.length;a++){let b=hb(c[a],d[a]);if(0!==b)return b}return hb(c.length,d.length)}function kl(a,b){let c=hb(jN(a.latitude),jN(b.latitude));return 0!==c?c:hb(jN(a.longitude),jN(b.longitude))}function km(a,b){let c=jO(a),d=jO(b);return c.compareTo(d)}function kn(a,b){let c=a.values||[],d=b.values||[];for(let a=0;a<c.length&&a<d.length;++a){let b=kh(c[a],d[a]);if(b)return b}return hb(c.length,d.length)}function ko(a,b){let c=a.fields||{},d=b.fields||{},e=c[j7]?.arrayValue,f=d[j7]?.arrayValue,g=hb(e?.values?.length||0,f?.values?.length||0);return 0!==g?g:kn(e,f)}function kp(a,b){if(a===j5.mapValue&&b===j5.mapValue)return 0;if(a===j5.mapValue)return 1;if(b===j5.mapValue)return -1;let c=a.fields||{},d=Object.keys(c),e=b.fields||{},f=Object.keys(e);d.sort(),f.sort();for(let a=0;a<d.length&&a<f.length;++a){let b=hc(d[a],f[a]);if(0!==b)return b;let g=kh(c[d[a]],e[f[a]]);if(0!==g)return g}return hb(d.length,f.length)}function kq(a){return kr(a)}function kr(a){if("nullValue"in a)return"null";if("booleanValue"in a)return""+a.booleanValue;if("integerValue"in a)return""+a.integerValue;if("doubleValue"in a)return""+a.doubleValue;if("timestampValue"in a)return kt(a.timestampValue);else if("stringValue"in a)return a.stringValue;else if("bytesValue"in a)return ks(a.bytesValue);else if("referenceValue"in a)return kv(a.referenceValue);else if("geoPointValue"in a)return ku(a.geoPointValue);else if("arrayValue"in a)return kx(a.arrayValue);else if("mapValue"in a)return kw(a.mapValue);else return gF(61005,{value:a})}function ks(a){return jO(a).toBase64()}function kt(a){let b=jM(a);return`time(${b.seconds},${b.nanos})`}function ku(a){return`geo(${a.latitude},${a.longitude})`}function kv(a){return hn.fromName(a).toString()}function kw(a){let b=Object.keys(a.fields||{}).sort(),c="{",d=!0;for(let e of b)d?d=!1:c+=",",c+=`${e}:${kr(a.fields[e])}`;return c+"}"}function kx(a){let b="[",c=!0;for(let d of a.values||[])c?c=!1:b+=",",b+=kr(d);return b+"]"}function ky(a){switch(j9(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let b=jV(a);return b?16+ky(b):16;case 5:return 2*a.stringValue.length;case 6:return jO(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return kA(a.arrayValue);case 10:case 11:return kz(a.mapValue);default:throw gF(13486,{value:a})}}function kz(a){let b=0;return ju(a.fields,(a,c)=>{b+=a.length+ky(c)}),b}function kA(a){return(a.values||[]).reduce((a,b)=>a+ky(b),0)}function kB(a,b){return{referenceValue:`projects/${a.projectId}/databases/${a.database}/documents/${b.path.canonicalString()}`}}function kC(a){return!!a&&"integerValue"in a}function kD(a){return!!a&&"doubleValue"in a}function kE(a){return kC(a)||kD(a)}function kF(a){return!!a&&"arrayValue"in a}function kG(a){return!!a&&"nullValue"in a}function kH(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function kI(a){return!!a&&"mapValue"in a}function kJ(a){return(a?.mapValue?.fields||{})[j3]?.stringValue===j6}function kK(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&"object"==typeof a.timestampValue)return{timestampValue:{...a.timestampValue}};if(a.mapValue){let b={mapValue:{fields:{}}};return ju(a.mapValue.fields,(a,c)=>b.mapValue.fields[a]=kK(c)),b}{if(!a.arrayValue)return{...a};let b={arrayValue:{values:[]}};for(let c=0;c<(a.arrayValue.values||[]).length;++c)b.arrayValue.values[c]=kK(a.arrayValue.values[c]);return b}}function kL(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===j4}let kM={mapValue:{fields:{[j3]:{stringValue:j6},[j7]:{arrayValue:{}}}}};function kN(a){if("nullValue"in a)return j8;if("booleanValue"in a)return{booleanValue:!1};if("integerValue"in a||"doubleValue"in a)return{doubleValue:NaN};if("timestampValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in a)return{stringValue:""};else if("bytesValue"in a)return{bytesValue:""};else if("referenceValue"in a)return kB(jZ.empty(),hn.empty());else if("geoPointValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in a)return{arrayValue:{}};else if(!("mapValue"in a))return gF(35942,{value:a});else return kJ(a)?kM:{mapValue:{}}}function kO(a){if("nullValue"in a)return{booleanValue:!1};if("booleanValue"in a)return{doubleValue:NaN};if("integerValue"in a||"doubleValue"in a)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in a)return{stringValue:""};if("stringValue"in a)return{bytesValue:""};else if("bytesValue"in a)return kB(jZ.empty(),hn.empty());else if("referenceValue"in a)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in a)return{arrayValue:{}};else if("arrayValue"in a)return kM;else if(!("mapValue"in a))return gF(61959,{value:a});else return kJ(a)?{mapValue:{}}:j5}function kP(a,b){let c=kh(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?-1:!a.inclusive&&b.inclusive?1:0}function kQ(a,b){let c=kh(a.value,b.value);return 0!==c?c:a.inclusive&&!b.inclusive?1:!a.inclusive&&b.inclusive?-1:0}class kR{constructor(a){this.value=a}static empty(){return new kR({mapValue:{}})}field(a){if(a.isEmpty())return this.value;{let b=this.value;for(let c=0;c<a.length-1;++c)if(!kI(b=(b.mapValue.fields||{})[a.get(c)]))return null;return(b=(b.mapValue.fields||{})[a.lastSegment()])||null}}set(a,b){this.getFieldsMap(a.popLast())[a.lastSegment()]=kK(b)}setAll(a){let b=hm.emptyPath(),c={},d=[];a.forEach((a,e)=>{if(!b.isImmediateParentOf(e)){let a=this.getFieldsMap(b);this.applyChanges(a,c,d),c={},d=[],b=e.popLast()}a?c[e.lastSegment()]=kK(a):d.push(e.lastSegment())});let e=this.getFieldsMap(b);this.applyChanges(e,c,d)}delete(a){let b=this.field(a.popLast());kI(b)&&b.mapValue.fields&&delete b.mapValue.fields[a.lastSegment()]}isEqual(a){return ka(this.value,a.value)}getFieldsMap(a){let b=this.value;b.mapValue.fields||(b.mapValue={fields:{}});for(let c=0;c<a.length;++c){let d=b.mapValue.fields[a.get(c)];kI(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},b.mapValue.fields[a.get(c)]=d),b=d}return b.mapValue.fields}applyChanges(a,b,c){for(let d of(ju(b,(b,c)=>a[b]=c),c))delete a[d]}clone(){return new kR(kK(this.value))}}function kS(a){let b=[];return ju(a.fields,(a,c)=>{let d=new hm([a]);if(kI(c)){let a=kS(c.mapValue).fields;if(0===a.length)b.push(d);else for(let c of a)b.push(d.child(c))}else b.push(d)}),new jF(b)}class kT{constructor(a,b,c,d,e,f,g){this.key=a,this.documentType=b,this.version=c,this.readTime=d,this.createTime=e,this.data=f,this.documentState=g}static newInvalidDocument(a){return new kT(a,0,hB.min(),hB.min(),hB.min(),kR.empty(),0)}static newFoundDocument(a,b,c,d){return new kT(a,1,b,hB.min(),c,d,0)}static newNoDocument(a,b){return new kT(a,2,b,hB.min(),hB.min(),kR.empty(),0)}static newUnknownDocument(a,b){return new kT(a,3,b,hB.min(),hB.min(),kR.empty(),2)}convertToFoundDocument(a,b){return this.createTime.isEqual(hB.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=a),this.version=a,this.documentType=1,this.data=b,this.documentState=0,this}convertToNoDocument(a){return this.version=a,this.documentType=2,this.data=kR.empty(),this.documentState=0,this}convertToUnknownDocument(a){return this.version=a,this.documentType=3,this.data=kR.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=hB.min(),this}setReadTime(a){return this.readTime=a,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(a){return a instanceof kT&&this.key.isEqual(a.key)&&this.version.isEqual(a.version)&&this.documentType===a.documentType&&this.documentState===a.documentState&&this.data.isEqual(a.data)}mutableCopy(){return new kT(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function kU(a,b,c){let d=b.data.field(a),e=c.data.field(a);return null!==d&&null!==e?kh(d,e):gF(42886)}class kV{constructor(a,b){this.position=a,this.inclusive=b}}function kW(a,b,c){let d=0;for(let e=0;e<a.position.length;e++){let f=b[e],g=a.position[e];if(d=f.field.isKeyField()?hn.comparator(hn.fromName(g.referenceValue),c.key):kh(g,c.data.field(f.field)),"desc"===f.dir&&(d*=-1),0!==d)break}return d}function kX(a,b,c){let d=kW(a,b,c);return a.inclusive?d>=0:d>0}function kY(a,b,c){let d=kW(a,b,c);return a.inclusive?d<=0:d<0}function kZ(a,b){if(null===a)return null===b;if(null===b||a.inclusive!==b.inclusive||a.position.length!==b.position.length)return!1;for(let c=0;c<a.position.length;c++)if(!ka(a.position[c],b.position[c]))return!1;return!0}class k${constructor(a,b="asc"){this.field=a,this.dir=b}}function k_(a){return a.field.canonicalString()+a.dir}function k0(a){return`${a.field.canonicalString()} (${a.dir})`}function k1(a,b){return a.dir===b.dir&&a.field.isEqual(b.field)}class k2{}class k3 extends k2{constructor(a,b,c){super(),this.field=a,this.op=b,this.value=c}static create(a,b,c){if(a.isKeyField())if("in"===b||"not-in"===b)return this.createKeyFieldInFilter(a,b,c);else return new lh(a,b,c);if("array-contains"===b)return new ll(a,c);if("in"===b)return new lm(a,c);if("not-in"===b)return new ln(a,c);if("array-contains-any"===b)return new lo(a,c);else return new k3(a,b,c)}static createKeyFieldInFilter(a,b,c){return"in"===b?new li(a,c):new lj(a,c)}matches(a){let b=a.data.field(this.field);return"!="===this.op?null!==b&&void 0===b.nullValue&&this.matchesComparison(kh(b,this.value)):null!==b&&j9(this.value)===j9(b)&&this.matchesComparison(kh(b,this.value))}matchesComparison(a){switch(this.op){case"<":return a<0;case"<=":return a<=0;case"==":return 0===a;case"!=":return 0!==a;case">":return a>0;case">=":return a>=0;default:return gF(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class k4 extends k2{constructor(a,b){super(),this.filters=a,this.op=b,this.memoizedFlattenedFilters=null}static create(a,b){return new k4(a,b)}matches(a){return k5(this)?void 0===this.filters.find(b=>!b.matches(a)):void 0!==this.filters.find(b=>b.matches(a))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((a,b)=>a.concat(b.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function k5(a){return"and"===a.op}function k6(a){return"or"===a.op}function k7(a){return k8(a)&&k5(a)}function k8(a){for(let b of a.filters)if(b instanceof k4)return!1;return!0}function k9(a){if(a instanceof k3)return a.field.canonicalString()+a.op.toString()+kq(a.value);{if(k7(a))return a.filters.map(a=>k9(a)).join(",");let b=a.filters.map(a=>k9(a)).join(",");return`${a.op}(${b})`}}function la(a,b){return a instanceof k3?lb(a,b):a instanceof k4?lc(a,b):void gF(19439)}function lb(a,b){return b instanceof k3&&a.op===b.op&&a.field.isEqual(b.field)&&ka(a.value,b.value)}function lc(a,b){return b instanceof k4&&a.op===b.op&&a.filters.length===b.filters.length&&a.filters.reduce((a,c,d)=>a&&la(c,b.filters[d]),!0)}function ld(a,b){let c=a.filters.concat(b);return k4.create(c,a.op)}function le(a){return a instanceof k3?lg(a):a instanceof k4?lf(a):"Filter"}function lf(a){return a.op.toString()+" {"+a.getFilters().map(le).join(" ,")+"}"}function lg(a){return`${a.field.canonicalString()} ${a.op} ${kq(a.value)}`}class lh extends k3{constructor(a,b,c){super(a,b,c),this.key=hn.fromName(c.referenceValue)}matches(a){let b=hn.comparator(a.key,this.key);return this.matchesComparison(b)}}class li extends k3{constructor(a,b){super(a,"in",b),this.keys=lk("in",b)}matches(a){return this.keys.some(b=>b.isEqual(a.key))}}class lj extends k3{constructor(a,b){super(a,"not-in",b),this.keys=lk("not-in",b)}matches(a){return!this.keys.some(b=>b.isEqual(a.key))}}function lk(a,b){return(b.arrayValue?.values||[]).map(a=>hn.fromName(a.referenceValue))}class ll extends k3{constructor(a,b){super(a,"array-contains",b)}matches(a){let b=a.data.field(this.field);return kF(b)&&kg(b.arrayValue,this.value)}}class lm extends k3{constructor(a,b){super(a,"in",b)}matches(a){let b=a.data.field(this.field);return null!==b&&kg(this.value.arrayValue,b)}}class ln extends k3{constructor(a,b){super(a,"not-in",b)}matches(a){if(kg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let b=a.data.field(this.field);return null!==b&&void 0===b.nullValue&&!kg(this.value.arrayValue,b)}}class lo extends k3{constructor(a,b){super(a,"array-contains-any",b)}matches(a){let b=a.data.field(this.field);return!!kF(b)&&!!b.arrayValue.values&&b.arrayValue.values.some(a=>kg(this.value.arrayValue,a))}}class lp{constructor(a,b=null,c=[],d=[],e=null,f=null,g=null){this.path=a,this.collectionGroup=b,this.orderBy=c,this.filters=d,this.limit=e,this.startAt=f,this.endAt=g,this.memoizedCanonicalId=null}}function lq(a,b=null,c=[],d=[],e=null,f=null,g=null){return new lp(a,b,c,d,e,f,g)}function lr(a){let b=gI(a);if(null===b.memoizedCanonicalId){let a=b.path.canonicalString();null!==b.collectionGroup&&(a+="|cg:"+b.collectionGroup),a+="|f:",a+=b.filters.map(a=>k9(a)).join(","),a+="|ob:",a+=b.orderBy.map(a=>k_(a)).join(","),j0(b.limit)||(a+="|l:",a+=b.limit),b.startAt&&(a+="|lb:",a+=b.startAt.inclusive?"b:":"a:",a+=b.startAt.position.map(a=>kq(a)).join(",")),b.endAt&&(a+="|ub:",a+=b.endAt.inclusive?"a:":"b:",a+=b.endAt.position.map(a=>kq(a)).join(",")),b.memoizedCanonicalId=a}return b.memoizedCanonicalId}function ls(a){let b=a.path.canonicalString();return null!==a.collectionGroup&&(b+=" collectionGroup="+a.collectionGroup),a.filters.length>0&&(b+=`, filters: [${a.filters.map(a=>le(a)).join(", ")}]`),j0(a.limit)||(b+=", limit: "+a.limit),a.orderBy.length>0&&(b+=`, orderBy: [${a.orderBy.map(a=>k0(a)).join(", ")}]`),a.startAt&&(b+=", startAt: ",b+=a.startAt.inclusive?"b:":"a:",b+=a.startAt.position.map(a=>kq(a)).join(",")),a.endAt&&(b+=", endAt: ",b+=a.endAt.inclusive?"a:":"b:",b+=a.endAt.position.map(a=>kq(a)).join(",")),`Target(${b})`}function lt(a,b){if(a.limit!==b.limit||a.orderBy.length!==b.orderBy.length)return!1;for(let c=0;c<a.orderBy.length;c++)if(!k1(a.orderBy[c],b.orderBy[c]))return!1;if(a.filters.length!==b.filters.length)return!1;for(let c=0;c<a.filters.length;c++)if(!la(a.filters[c],b.filters[c]))return!1;return a.collectionGroup===b.collectionGroup&&!!a.path.isEqual(b.path)&&!!kZ(a.startAt,b.startAt)&&kZ(a.endAt,b.endAt)}function lu(a){return hn.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function lv(a,b){return a.filters.filter(a=>a instanceof k3&&a.field.isEqual(b))}function lw(a,b){let c=hF(b);if(void 0===c)return null;for(let b of lv(a,c.fieldPath))switch(b.op){case"array-contains-any":return b.value.arrayValue.values||[];case"array-contains":return[b.value]}return null}function lx(a,b){let c=new Map;for(let d of hG(b))for(let b of lv(a,d.fieldPath))switch(b.op){case"==":case"in":c.set(d.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return c.set(d.fieldPath.canonicalString(),b.value),Array.from(c.values())}return null}function ly(a,b){let c=[],d=!0;for(let e of hG(b)){let b=0===e.kind?lA(a,e.fieldPath,a.startAt):lB(a,e.fieldPath,a.startAt);c.push(b.value),d&&(d=b.inclusive)}return new kV(c,d)}function lz(a,b){let c=[],d=!0;for(let e of hG(b)){let b=0===e.kind?lB(a,e.fieldPath,a.endAt):lA(a,e.fieldPath,a.endAt);c.push(b.value),d&&(d=b.inclusive)}return new kV(c,d)}function lA(a,b,c){let d=j8,e=!0;for(let c of lv(a,b)){let a=j8,b=!0;switch(c.op){case"<":case"<=":a=kN(c.value);break;case"==":case"in":case">=":a=c.value;break;case">":a=c.value,b=!1;break;case"!=":case"not-in":a=j8}0>kP({value:d,inclusive:e},{value:a,inclusive:b})&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];0>kP({value:d,inclusive:e},{value:a,inclusive:c.inclusive})&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function lB(a,b,c){let d=j5,e=!0;for(let c of lv(a,b)){let a=j5,b=!0;switch(c.op){case">=":case">":a=kO(c.value),b=!1;break;case"==":case"in":case"<=":a=c.value;break;case"<":a=c.value,b=!1;break;case"!=":case"not-in":a=j5}kQ({value:d,inclusive:e},{value:a,inclusive:b})>0&&(d=a,e=b)}if(null!==c){for(let f=0;f<a.orderBy.length;++f)if(a.orderBy[f].field.isEqual(b)){let a=c.position[f];kQ({value:d,inclusive:e},{value:a,inclusive:c.inclusive})>0&&(d=a,e=c.inclusive);break}}return{value:d,inclusive:e}}function lC(a){let b=new jB(hm.comparator),c=!1;for(let d of a.filters)for(let a of d.getFlattenedFilters())a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?c=!0:b=b.add(a.field));for(let c of a.orderBy)c.field.isKeyField()||(b=b.add(c.field));return b.size+ +!!c}function lD(a){return null!==a.limit}class lE{constructor(a,b=null,c=[],d=[],e=null,f="F",g=null,h=null){this.path=a,this.collectionGroup=b,this.explicitOrderBy=c,this.filters=d,this.limit=e,this.limitType=f,this.startAt=g,this.endAt=h,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function lF(a,b,c,d,e,f,g,h){return new lE(a,b,c,d,e,f,g,h)}function lG(a){return new lE(a)}function lH(a,b){return new lE(b,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function lI(a){return 0===a.filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())}function lJ(a){let b=new jB(hm.comparator);return a.filters.forEach(a=>{a.getFlattenedFilters().forEach(a=>{a.isInequality()&&(b=b.add(a.field))})}),b}function lK(a){return hn.isDocumentKey(a.path)&&null===a.collectionGroup&&0===a.filters.length}function lL(a){return null!==a.collectionGroup}function lM(a){let b=gI(a);if(null===b.memoizedNormalizedOrderBy){b.memoizedNormalizedOrderBy=[];let a=new Set;for(let c of b.explicitOrderBy)b.memoizedNormalizedOrderBy.push(c),a.add(c.field.canonicalString());let c=b.explicitOrderBy.length>0?b.explicitOrderBy[b.explicitOrderBy.length-1].dir:"asc";lJ(b).forEach(d=>{a.has(d.canonicalString())||d.isKeyField()||b.memoizedNormalizedOrderBy.push(new k$(d,c))}),a.has(hm.keyField().canonicalString())||b.memoizedNormalizedOrderBy.push(new k$(hm.keyField(),c))}return b.memoizedNormalizedOrderBy}function lN(a){let b=gI(a);return b.memoizedTarget||(b.memoizedTarget=lP(b,lM(a))),b.memoizedTarget}function lO(a){let b=gI(a);return b.memoizedAggregateTarget||(b.memoizedAggregateTarget=lP(b,a.explicitOrderBy)),b.memoizedAggregateTarget}function lP(a,b){if("F"===a.limitType)return lq(a.path,a.collectionGroup,b,a.filters,a.limit,a.startAt,a.endAt);{b=b.map(a=>{let b="desc"===a.dir?"asc":"desc";return new k$(a.field,b)});let c=a.endAt?new kV(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new kV(a.startAt.position,a.startAt.inclusive):null;return lq(a.path,a.collectionGroup,b,a.filters,a.limit,c,d)}}function lQ(a,b){let c=a.filters.concat([b]);return new lE(a.path,a.collectionGroup,a.explicitOrderBy.slice(),c,a.limit,a.limitType,a.startAt,a.endAt)}function lR(a,b){let c=a.explicitOrderBy.concat([b]);return new lE(a.path,a.collectionGroup,c,a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt)}function lS(a,b,c){return new lE(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),b,c,a.startAt,a.endAt)}function lT(a,b){return new lE(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,b,a.endAt)}function lU(a,b){return new lE(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,b)}function lV(a,b){return lt(lN(a),lN(b))&&a.limitType===b.limitType}function lW(a){return`${lr(lN(a))}|lt:${a.limitType}`}function lX(a){return`Query(target=${ls(lN(a))}; limitType=${a.limitType})`}function lY(a,b){return b.isFoundDocument()&&lZ(a,b)&&l$(a,b)&&l_(a,b)&&l0(a,b)}function lZ(a,b){let c=b.key.path;return null!==a.collectionGroup?b.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(c):hn.isDocumentKey(a.path)?a.path.isEqual(c):a.path.isImmediateParentOf(c)}function l$(a,b){for(let c of lM(a))if(!c.field.isKeyField()&&null===b.data.field(c.field))return!1;return!0}function l_(a,b){for(let c of a.filters)if(!c.matches(b))return!1;return!0}function l0(a,b){return(!a.startAt||!!kY(a.startAt,lM(a),b))&&(!a.endAt||!!kX(a.endAt,lM(a),b))}function l1(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function l2(a){return(b,c)=>{let d=!1;for(let e of lM(a)){let a=l3(e,b,c);if(0!==a)return a;d=d||e.field.isKeyField()}return 0}}function l3(a,b,c){let d=a.field.isKeyField()?hn.comparator(b.key,c.key):kU(a.field,b,c);switch(a.dir){case"asc":return d;case"desc":return -1*d;default:return gF(19790,{direction:a.dir})}}class l4{constructor(a,b){this.mapKeyFn=a,this.equalsFn=b,this.inner={},this.innerSize=0}get(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0!==c){for(let[b,d]of c)if(this.equalsFn(b,a))return d}}has(a){return void 0!==this.get(a)}set(a,b){let c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d){this.inner[c]=[[a,b]],this.innerSize++;return}for(let c=0;c<d.length;c++)if(this.equalsFn(d[c][0],a)){d[c]=[a,b];return}d.push([a,b]),this.innerSize++}delete(a){let b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],a))return 1===c.length?delete this.inner[b]:c.splice(d,1),this.innerSize--,!0;return!1}forEach(a){ju(this.inner,(b,c)=>{for(let[b,d]of c)a(b,d)})}isEmpty(){return jw(this.inner)}size(){return this.innerSize}}let l5=new jx(hn.comparator);function l6(){return l5}let l7=new jx(hn.comparator);function l8(...a){let b=l7;for(let c of a)b=b.insert(c.key,c);return b}function l9(){return md()}function ma(a){let b=l7;return a.forEach((a,c)=>b=b.insert(a,c.overlayedDocument)),b}function mb(){return md()}function mc(){return md()}function md(){return new l4(a=>a.toString(),(a,b)=>a.isEqual(b))}let me=new jx(hn.comparator);function mf(){return me}let mg=new jB(hn.comparator);function mh(...a){let b=mg;for(let c of a)b=b.add(c);return b}let mi=new jB(hb);function mj(){return mi}function mk(a,b){if(a.useProto3Json){if(isNaN(b))return{doubleValue:"NaN"};else if(b===1/0)return{doubleValue:"Infinity"};else if(b===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:j1(b)?"-0":b}}function ml(a){return{integerValue:""+a}}function mm(a,b){return j2(b)?ml(b):mk(a,b)}class mn{constructor(){this._=void 0}}function mo(a,b,c){return a instanceof ms?jU(c,b):a instanceof mt?mu(a,b):a instanceof mv?mw(a,b):my(a,b)}function mp(a,b,c){return a instanceof mt?mu(a,b):a instanceof mv?mw(a,b):c}function mq(a,b){return a instanceof mx?kE(b)?b:{integerValue:0}:null}function mr(a,b){return a instanceof mt&&b instanceof mt||a instanceof mv&&b instanceof mv?hg(a.elements,b.elements,ka):a instanceof mx&&b instanceof mx?ka(a.operand,b.operand):a instanceof ms&&b instanceof ms}class ms extends mn{}class mt extends mn{constructor(a){super(),this.elements=a}}function mu(a,b){let c=mA(b);for(let b of a.elements)c.some(a=>ka(a,b))||c.push(b);return{arrayValue:{values:c}}}class mv extends mn{constructor(a){super(),this.elements=a}}function mw(a,b){let c=mA(b);for(let b of a.elements)c=c.filter(a=>!ka(a,b));return{arrayValue:{values:c}}}class mx extends mn{constructor(a,b){super(),this.serializer=a,this.operand=b}}function my(a,b){let c=mq(a,b),d=mz(c)+mz(a.operand);return kC(c)&&kC(a.operand)?ml(d):mk(a.serializer,d)}function mz(a){return jN(a.integerValue||a.doubleValue)}function mA(a){return kF(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}class mB{constructor(a,b){this.field=a,this.transform=b}}function mC(a,b){return a.field.isEqual(b.field)&&mr(a.transform,b.transform)}function mD(a,b){return void 0===a&&void 0===b||!!a&&!!b&&hg(a,b,(a,b)=>mC(a,b))}class mE{constructor(a,b){this.version=a,this.transformResults=b}}class mF{constructor(a,b){this.updateTime=a,this.exists=b}static none(){return new mF}static exists(a){return new mF(void 0,a)}static updateTime(a){return new mF(a)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(a){return this.exists===a.exists&&(this.updateTime?!!a.updateTime&&this.updateTime.isEqual(a.updateTime):!a.updateTime)}}function mG(a,b){return void 0!==a.updateTime?b.isFoundDocument()&&b.version.isEqual(a.updateTime):void 0===a.exists||a.exists===b.isFoundDocument()}class mH{}function mI(a,b){if(!a.hasLocalMutations||b&&0===b.fields.length)return null;if(null===b)if(a.isNoDocument())return new mW(a.key,mF.none());else return new mN(a.key,a.data,mF.none());{let c=a.data,d=kR.empty(),e=new jB(hm.comparator);for(let a of b.fields)if(!e.has(a)){let b=c.field(a);null===b&&a.length>1&&(a=a.popLast(),b=c.field(a)),null===b?d.delete(a):d.set(a,b),e=e.add(a)}return new mQ(a.key,d,new jF(e.toArray()),mF.none())}}function mJ(a,b,c){a instanceof mN?mO(a,b,c):a instanceof mQ?mR(a,b,c):mX(a,b,c)}function mK(a,b,c,d){return a instanceof mN?mP(a,b,c,d):a instanceof mQ?mS(a,b,c,d):mY(a,b,c)}function mL(a,b){let c=null;for(let d of a.fieldTransforms){let a=b.data.field(d.field),e=mq(d.transform,a||null);null!=e&&(null===c&&(c=kR.empty()),c.set(d.field,e))}return c||null}function mM(a,b){return a.type===b.type&&!!a.key.isEqual(b.key)&&!!a.precondition.isEqual(b.precondition)&&!!mD(a.fieldTransforms,b.fieldTransforms)&&(0===a.type?a.value.isEqual(b.value):1!==a.type||a.data.isEqual(b.data)&&a.fieldMask.isEqual(b.fieldMask))}class mN extends mH{constructor(a,b,c,d=[]){super(),this.key=a,this.value=b,this.precondition=c,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}function mO(a,b,c){let d=a.value.clone(),e=mU(a.fieldTransforms,b,c.transformResults);d.setAll(e),b.convertToFoundDocument(c.version,d).setHasCommittedMutations()}function mP(a,b,c,d){if(!mG(a.precondition,b))return c;let e=a.value.clone(),f=mV(a.fieldTransforms,d,b);return e.setAll(f),b.convertToFoundDocument(b.version,e).setHasLocalMutations(),null}class mQ extends mH{constructor(a,b,c,d,e=[]){super(),this.key=a,this.data=b,this.fieldMask=c,this.precondition=d,this.fieldTransforms=e,this.type=1}getFieldMask(){return this.fieldMask}}function mR(a,b,c){if(!mG(a.precondition,b))return void b.convertToUnknownDocument(c.version);let d=mU(a.fieldTransforms,b,c.transformResults),e=b.data;e.setAll(mT(a)),e.setAll(d),b.convertToFoundDocument(c.version,e).setHasCommittedMutations()}function mS(a,b,c,d){if(!mG(a.precondition,b))return c;let e=mV(a.fieldTransforms,d,b),f=b.data;return(f.setAll(mT(a)),f.setAll(e),b.convertToFoundDocument(b.version,f).setHasLocalMutations(),null===c)?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(a=>a.field))}function mT(a){let b=new Map;return a.fieldMask.fields.forEach(c=>{if(!c.isEmpty()){let d=a.data.field(c);b.set(c,d)}}),b}function mU(a,b,c){let d=new Map;gH(a.length===c.length,32656,{serverTransformResultCount:c.length,fieldTransformCount:a.length});for(let e=0;e<c.length;e++){let f=a[e],g=f.transform,h=b.data.field(f.field);d.set(f.field,mp(g,h,c[e]))}return d}function mV(a,b,c){let d=new Map;for(let e of a){let a=e.transform,f=c.data.field(e.field);d.set(e.field,mo(a,f,b))}return d}class mW extends mH{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function mX(a,b,c){b.convertToNoDocument(c.version).setHasCommittedMutations()}function mY(a,b,c){return mG(a.precondition,b)?(b.convertToNoDocument(b.version).setHasLocalMutations(),null):c}class mZ extends mH{constructor(a,b){super(),this.key=a,this.precondition=b,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class m${constructor(a,b,c,d){this.batchId=a,this.localWriteTime=b,this.baseMutations=c,this.mutations=d}applyToRemoteDocument(a,b){let c=b.mutationResults;for(let b=0;b<this.mutations.length;b++){let d=this.mutations[b];d.key.isEqual(a.key)&&mJ(d,a,c[b])}}applyToLocalView(a,b){for(let c of this.baseMutations)c.key.isEqual(a.key)&&(b=mK(c,a,b,this.localWriteTime));for(let c of this.mutations)c.key.isEqual(a.key)&&(b=mK(c,a,b,this.localWriteTime));return b}applyToLocalDocumentSet(a,b){let c=mc();return this.mutations.forEach(d=>{let e=a.get(d.key),f=e.overlayedDocument,g=this.applyToLocalView(f,e.mutatedFields),h=mI(f,g=b.has(d.key)?null:g);null!==h&&c.set(d.key,h),f.isValidDocument()||f.convertToNoDocument(hB.min())}),c}keys(){return this.mutations.reduce((a,b)=>a.add(b.key),mh())}isEqual(a){return this.batchId===a.batchId&&hg(this.mutations,a.mutations,(a,b)=>mM(a,b))&&hg(this.baseMutations,a.baseMutations,(a,b)=>mM(a,b))}}class m_{constructor(a,b,c,d){this.batch=a,this.commitVersion=b,this.mutationResults=c,this.docVersions=d}static from(a,b,c){gH(a.mutations.length===c.length,58842,{mutationsSent:a.mutations.length,resultsReceived:c.length});let d=mf(),e=a.mutations;for(let a=0;a<e.length;a++)d=d.insert(e[a].key,c[a].version);return new m_(a,b,c,d)}}class m0{constructor(a,b){this.largestBatchId=a,this.mutation=b}getKey(){return this.mutation.key}isEqual(a){return null!==a&&this.mutation===a.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class m1{constructor(a,b){this.count=a,this.unchangedNames=b}}function m2(a){switch(a){case gJ:return gF(64938);case gK:case gL:case gN:case gS:case gX:case gY:case gR:return!1;case gM:case gO:case gP:case gQ:case gT:case gU:case gV:case gW:case gZ:return!0;default:return gF(15467,{code:a})}}function m3(a){return m2(a)&&a!==gU}function m4(a){if(void 0===a)return gC("GRPC error has no .code"),gL;switch(a){case o.OK:return gJ;case o.CANCELLED:return gK;case o.UNKNOWN:return gL;case o.DEADLINE_EXCEEDED:return gN;case o.RESOURCE_EXHAUSTED:return gS;case o.INTERNAL:return gX;case o.UNAVAILABLE:return gY;case o.UNAUTHENTICATED:return gR;case o.INVALID_ARGUMENT:return gM;case o.NOT_FOUND:return gO;case o.ALREADY_EXISTS:return gP;case o.PERMISSION_DENIED:return gQ;case o.FAILED_PRECONDITION:return gT;case o.ABORTED:return gU;case o.OUT_OF_RANGE:return gV;case o.UNIMPLEMENTED:return gW;case o.DATA_LOSS:return gZ;default:return gF(39323,{code:a})}}!function(a){a[a.OK=0]="OK",a[a.CANCELLED=1]="CANCELLED",a[a.UNKNOWN=2]="UNKNOWN",a[a.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",a[a.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",a[a.NOT_FOUND=5]="NOT_FOUND",a[a.ALREADY_EXISTS=6]="ALREADY_EXISTS",a[a.PERMISSION_DENIED=7]="PERMISSION_DENIED",a[a.UNAUTHENTICATED=16]="UNAUTHENTICATED",a[a.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",a[a.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",a[a.ABORTED=10]="ABORTED",a[a.OUT_OF_RANGE=11]="OUT_OF_RANGE",a[a.UNIMPLEMENTED=12]="UNIMPLEMENTED",a[a.INTERNAL=13]="INTERNAL",a[a.UNAVAILABLE=14]="UNAVAILABLE",a[a.DATA_LOSS=15]="DATA_LOSS"}(o||(o={}));class m5 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let m6=null;function m7(a){if(m6)throw Error("a TestingHooksSpi instance is already set");m6=a}function m8(){return new gr.TextEncoder}function m9(){return new gr.TextDecoder("utf-8")}let na=new m([0xffffffff,0xffffffff],0);function nb(a){let b=m8().encode(a),c=new n;return c.update(b),new Uint8Array(c.digest())}function nc(a){let b=new DataView(a.buffer),c=b.getUint32(0,!0),d=b.getUint32(4,!0),e=b.getUint32(8,!0),f=b.getUint32(12,!0);return[new m([c,d],0),new m([e,f],0)]}class nd{constructor(a,b,c){if(this.bitmap=a,this.padding=b,this.hashCount=c,b<0||b>=8)throw new ne(`Invalid padding: ${b}`);if(c<0||a.length>0&&0===this.hashCount)throw new ne(`Invalid hash count: ${c}`);if(0===a.length&&0!==b)throw new ne(`Invalid padding when bitmap length is 0: ${b}`);this.bitCount=8*a.length-b,this.bitCountInInteger=m.fromNumber(this.bitCount)}getBitIndex(a,b,c){let d=a.add(b.multiply(m.fromNumber(c)));return 1===d.compare(na)&&(d=new m([d.getBits(0),d.getBits(1)],0)),d.modulo(this.bitCountInInteger).toNumber()}isBitSet(a){return(this.bitmap[Math.floor(a/8)]&1<<a%8)!=0}mightContain(a){if(0===this.bitCount)return!1;let[b,c]=nc(nb(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);if(!this.isBitSet(d))return!1}return!0}static create(a,b,c){let d=a%8==0?0:8-a%8,e=new nd(new Uint8Array(Math.ceil(a/8)),d,b);return c.forEach(a=>e.insert(a)),e}insert(a){if(0===this.bitCount)return;let[b,c]=nc(nb(a));for(let a=0;a<this.hashCount;a++){let d=this.getBitIndex(b,c,a);this.setBit(d)}}setBit(a){let b=Math.floor(a/8),c=a%8;this.bitmap[b]|=1<<c}}class ne extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class nf{constructor(a,b,c,d,e){this.snapshotVersion=a,this.targetChanges=b,this.targetMismatches=c,this.documentUpdates=d,this.resolvedLimboDocuments=e}static createSynthesizedRemoteEventForCurrentChange(a,b,c){let d=new Map;return d.set(a,ng.createSynthesizedTargetChangeForCurrentChange(a,b,c)),new nf(hB.min(),d,new jx(hb),l6(),mh())}}class ng{constructor(a,b,c,d,e){this.resumeToken=a,this.current=b,this.addedDocuments=c,this.modifiedDocuments=d,this.removedDocuments=e}static createSynthesizedTargetChangeForCurrentChange(a,b,c){return new ng(c,b,mh(),mh(),mh())}}class nh{constructor(a,b,c,d){this.updatedTargetIds=a,this.removedTargetIds=b,this.key=c,this.newDoc=d}}class ni{constructor(a,b){this.targetId=a,this.existenceFilter=b}}class nj{constructor(a,b,c=jI.EMPTY_BYTE_STRING,d=null){this.state=a,this.targetIds=b,this.resumeToken=c,this.cause=d}}class nk{constructor(){this.pendingResponses=0,this.documentChanges=no(),this._resumeToken=jI.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(a){a.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=a)}toTargetChange(){let a=mh(),b=mh(),c=mh();return this.documentChanges.forEach((d,e)=>{switch(e){case 0:a=a.add(d);break;case 2:b=b.add(d);break;case 1:c=c.add(d);break;default:gF(38017,{changeType:e})}}),new ng(this._resumeToken,this._current,a,b,c)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=no()}addDocumentChange(a,b){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(a,b)}removeDocumentChange(a){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(a)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,gH(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let nl="WatchChangeAggregator";class nm{constructor(a){this.metadataProvider=a,this.targetStates=new Map,this.pendingDocumentUpdates=l6(),this.pendingDocumentUpdatesByTarget=nn(),this.pendingDocumentTargetMapping=nn(),this.pendingTargetResets=new jx(hb)}handleDocumentChange(a){for(let b of a.updatedTargetIds)a.newDoc&&a.newDoc.isFoundDocument()?this.addDocumentToTarget(b,a.newDoc):this.removeDocumentFromTarget(b,a.key,a.newDoc);for(let b of a.removedTargetIds)this.removeDocumentFromTarget(b,a.key,a.newDoc)}handleTargetChange(a){this.forEachTarget(a,b=>{let c=this.ensureTargetState(b);switch(a.state){case 0:this.isActiveTarget(b)&&c.updateResumeToken(a.resumeToken);break;case 1:c.recordTargetResponse(),c.isPending||c.clearPendingChanges(),c.updateResumeToken(a.resumeToken);break;case 2:c.recordTargetResponse(),c.isPending||this.removeTarget(b);break;case 3:this.isActiveTarget(b)&&(c.markCurrent(),c.updateResumeToken(a.resumeToken));break;case 4:this.isActiveTarget(b)&&(this.resetTarget(b),c.updateResumeToken(a.resumeToken));break;default:gF(56790,{state:a.state})}})}forEachTarget(a,b){a.targetIds.length>0?a.targetIds.forEach(b):this.targetStates.forEach((a,c)=>{this.isActiveTarget(c)&&b(c)})}handleExistenceFilter(a){let b=a.targetId,c=a.existenceFilter.count,d=this.targetDataForActiveTarget(b);if(d){let e=d.target;if(lu(e))if(0===c){let a=new hn(e.path);this.removeDocumentFromTarget(b,a,kT.newNoDocument(a,hB.min()))}else gH(1===c,20013,{expectedCount:c});else{let d=this.getCurrentDocumentCountForTarget(b);if(d!==c){let c=this.parseBloomFilter(a),e=c?this.applyBloomFilter(c,a,d):1;if(0!==e){this.resetTarget(b);let a=2===e?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(b,a)}m6?.notifyOnExistenceFilterMismatch(np(d,a.existenceFilter,this.metadataProvider.getDatabaseId(),c,e))}}}}parseBloomFilter(a){let b,c,d=a.existenceFilter.unchangedNames;if(!d||!d.bits)return null;let{bits:{bitmap:e="",padding:f=0},hashCount:g=0}=d;try{b=jO(e).toUint8Array()}catch(a){if(a instanceof m5)return gD("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{c=new nd(b,f,g)}catch(a){return a instanceof ne?gD("BloomFilter error: ",a):gD("Applying bloom filter failed: ",a),null}return 0===c.bitCount?null:c}applyBloomFilter(a,b,c){return 2*(b.existenceFilter.count!==c-this.filterRemovedDocuments(a,b.targetId))}filterRemovedDocuments(a,b){let c=this.metadataProvider.getRemoteKeysForTarget(b),d=0;return c.forEach(c=>{let e=this.metadataProvider.getDatabaseId(),f=`projects/${e.projectId}/databases/${e.database}/documents/${c.path.canonicalString()}`;!a.mightContain(f)&&(this.removeDocumentFromTarget(b,c,null),d++)}),d}createRemoteEvent(a){let b=new Map;this.targetStates.forEach((c,d)=>{let e=this.targetDataForActiveTarget(d);if(e){if(c.current&&lu(e.target)){let b=new hn(e.target.path);this.ensureDocumentUpdateByTarget(b).has(d)||this.targetContainsDocument(d,b)||this.removeDocumentFromTarget(d,b,kT.newNoDocument(b,a))}c.hasPendingChanges&&(b.set(d,c.toTargetChange()),c.clearPendingChanges())}});let c=mh();this.pendingDocumentTargetMapping.forEach((a,b)=>{let d=!0;b.forEachWhile(a=>{let b=this.targetDataForActiveTarget(a);return!b||"TargetPurposeLimboResolution"===b.purpose||(d=!1,!1)}),d&&(c=c.add(a))}),this.pendingDocumentUpdates.forEach((b,c)=>c.setReadTime(a));let d=new nf(a,b,this.pendingTargetResets,this.pendingDocumentUpdates,c);return this.pendingDocumentUpdates=l6(),this.pendingDocumentUpdatesByTarget=nn(),this.pendingDocumentTargetMapping=nn(),this.pendingTargetResets=new jx(hb),d}addDocumentToTarget(a,b){if(!this.isActiveTarget(a))return;let c=2*!!this.targetContainsDocument(a,b.key);this.ensureTargetState(a).addDocumentChange(b.key,c),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b.key,b),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(b.key,this.ensureDocumentUpdateByTarget(b.key).add(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b.key,this.ensureDocumentTargetMapping(b.key).add(a))}removeDocumentFromTarget(a,b,c){if(!this.isActiveTarget(a))return;let d=this.ensureTargetState(a);this.targetContainsDocument(a,b)?d.addDocumentChange(b,1):d.removeDocumentChange(b),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).delete(a)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(b,this.ensureDocumentTargetMapping(b).add(a)),c&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(b,c))}removeTarget(a){this.targetStates.delete(a)}getCurrentDocumentCountForTarget(a){let b=this.ensureTargetState(a).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(a).size+b.addedDocuments.size-b.removedDocuments.size}recordPendingTargetRequest(a){this.ensureTargetState(a).recordPendingTargetRequest()}ensureTargetState(a){let b=this.targetStates.get(a);return b||(b=new nk,this.targetStates.set(a,b)),b}ensureDocumentTargetMapping(a){let b=this.pendingDocumentTargetMapping.get(a);return b||(b=new jB(hb),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(a,b)),b}ensureDocumentUpdateByTarget(a){let b=this.pendingDocumentUpdatesByTarget.get(a);return b||(b=new jB(hb),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(a,b)),b}isActiveTarget(a){let b=null!==this.targetDataForActiveTarget(a);return b||gB(nl,"Detected inactive target",a),b}targetDataForActiveTarget(a){let b=this.targetStates.get(a);return b&&b.isPending?null:this.metadataProvider.getTargetDataForTarget(a)}resetTarget(a){this.targetStates.set(a,new nk),this.metadataProvider.getRemoteKeysForTarget(a).forEach(b=>{this.removeDocumentFromTarget(a,b,null)})}targetContainsDocument(a,b){return this.metadataProvider.getRemoteKeysForTarget(a).has(b)}}function nn(){return new jx(hn.comparator)}function no(){return new jx(hn.comparator)}function np(a,b,c,d,e){let f={localCacheCount:a,existenceFilterCount:b.count,databaseId:c.database,projectId:c.projectId},g=b.unchangedNames;return g&&(f.bloomFilter={applied:0===e,hashCount:g?.hashCount??0,bitmapLength:g?.bits?.bitmap?.length??0,padding:g?.bits?.padding??0,mightContain:a=>d?.mightContain(a)??!1}),f}let nq=(()=>{let a={};return a.asc="ASCENDING",a.desc="DESCENDING",a})(),nr=(()=>{let a={};return a["<"]="LESS_THAN",a["<="]="LESS_THAN_OR_EQUAL",a[">"]="GREATER_THAN",a[">="]="GREATER_THAN_OR_EQUAL",a["=="]="EQUAL",a["!="]="NOT_EQUAL",a["array-contains"]="ARRAY_CONTAINS",a.in="IN",a["not-in"]="NOT_IN",a["array-contains-any"]="ARRAY_CONTAINS_ANY",a})(),ns=(()=>{let a={};return a.and="AND",a.or="OR",a})();function nt(a,b){}class nu{constructor(a,b){this.databaseId=a,this.useProto3Json=b}}function nv(a){return new g$(void 0===a.code?gL:m4(a.code),a.message||"")}function nw(a,b){return a.useProto3Json||j0(b)?b:{value:b}}function nx(a){let b;return j0(b="object"==typeof a?a.value:a)?null:b}function ny(a,b){if(!a.useProto3Json)return{seconds:""+b.seconds,nanos:b.nanoseconds};{let a=new Date(1e3*b.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),c=("000000000"+b.nanoseconds).slice(-9);return`${a}.${c}Z`}}function nz(a){let b=jM(a);return new hA(b.seconds,b.nanos)}function nA(a,b){return a.useProto3Json?b.toBase64():b.toUint8Array()}function nB(a,b){return a.useProto3Json?(gH(void 0===b||"string"==typeof b,58123),jI.fromBase64String(b||"")):(gH(void 0===b||b instanceof Buffer||b instanceof Uint8Array,16193),jI.fromUint8Array(b||new Uint8Array))}function nC(a,b){return ny(a,b.toTimestamp())}function nD(a){return gH(!!a,49232),hB.fromTimestamp(nz(a))}function nE(a,b){return nF(a,b).canonicalString()}function nF(a,b){let c=nM(a).child("documents");return void 0===b?c:c.child(b)}function nG(a){let b=hk.fromString(a);return gH(oD(b),10190,{key:b.toString()}),b}function nH(a,b){return nE(a.databaseId,b.path)}function nI(a,b){let c=nG(b);if(c.get(1)!==a.databaseId.projectId)throw new g$(gM,"Tried to deserialize key from different project: "+c.get(1)+" vs "+a.databaseId.projectId);if(c.get(3)!==a.databaseId.database)throw new g$(gM,"Tried to deserialize key from different database: "+c.get(3)+" vs "+a.databaseId.database);return new hn(nN(c))}function nJ(a,b){return nE(a.databaseId,b)}function nK(a){let b=nG(a);return 4===b.length?hk.emptyPath():nN(b)}function nL(a){return new hk(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function nM(a){return new hk(["projects",a.projectId,"databases",a.database])}function nN(a){return gH(a.length>4&&"documents"===a.get(4),29091,{key:a.toString()}),a.popFirst(5)}function nO(a,b,c){return{name:nH(a,b),fields:c.value.mapValue.fields}}function nP(a,b){return{name:nH(a,b.key),fields:b.data.value.mapValue.fields,updateTime:ny(a,b.version.toTimestamp()),createTime:ny(a,b.createTime.toTimestamp())}}function nQ(a,b,c){let d=nI(a,b.name),e=nD(b.updateTime),f=b.createTime?nD(b.createTime):hB.min(),g=new kR({mapValue:{fields:b.fields}}),h=kT.newFoundDocument(d,e,f,g);return c&&h.setHasCommittedMutations(),c?h.setHasCommittedMutations():h}function nR(a,b){gH(!!b.found,43571),nt(b.found.name),nt(b.found.updateTime);let c=nI(a,b.found.name),d=nD(b.found.updateTime),e=b.found.createTime?nD(b.found.createTime):hB.min(),f=new kR({mapValue:{fields:b.found.fields}});return kT.newFoundDocument(c,d,e,f)}function nS(a,b){gH(!!b.missing,3894),gH(!!b.readTime,22933);let c=nI(a,b.missing),d=nD(b.readTime);return kT.newNoDocument(c,d)}function nT(a,b){return"found"in b?nR(a,b):"missing"in b?nS(a,b):gF(7234,{result:b})}function nU(a,b){let c;if("targetChange"in b){nt(b.targetChange);let d=nV(b.targetChange.targetChangeType||"NO_CHANGE"),e=b.targetChange.targetIds||[],f=nB(a,b.targetChange.resumeToken),g=b.targetChange.cause;c=new nj(d,e,f,g&&nv(g)||null)}else if("documentChange"in b){nt(b.documentChange);let d=b.documentChange;nt(d.document),nt(d.document.name),nt(d.document.updateTime);let e=nI(a,d.document.name),f=nD(d.document.updateTime),g=d.document.createTime?nD(d.document.createTime):hB.min(),h=new kR({mapValue:{fields:d.document.fields}}),i=kT.newFoundDocument(e,f,g,h);c=new nh(d.targetIds||[],d.removedTargetIds||[],i.key,i)}else if("documentDelete"in b){nt(b.documentDelete);let d=b.documentDelete;nt(d.document);let e=nI(a,d.document),f=d.readTime?nD(d.readTime):hB.min(),g=kT.newNoDocument(e,f);c=new nh([],d.removedTargetIds||[],g.key,g)}else if("documentRemove"in b){nt(b.documentRemove);let d=b.documentRemove;nt(d.document);let e=nI(a,d.document);c=new nh([],d.removedTargetIds||[],e,null)}else{if(!("filter"in b))return gF(11601,{change:b});nt(b.filter);let a=b.filter;nt(a.targetId);let{count:d=0,unchangedNames:e}=a,f=new m1(d,e);c=new ni(a.targetId,f)}return c}function nV(a){if("NO_CHANGE"===a)return 0;if("ADD"===a)return 1;if("REMOVE"===a)return 2;if("CURRENT"===a)return 3;if("RESET"===a)return 4;else return gF(39313,{state:a})}function nW(a){if(!("targetChange"in a))return hB.min();let b=a.targetChange;return b.targetIds&&b.targetIds.length||!b.readTime?hB.min():nD(b.readTime)}function nX(a,b){let c;if(b instanceof mN)c={update:nO(a,b.key,b.value)};else if(b instanceof mW)c={delete:nH(a,b.key)};else if(b instanceof mQ)c={update:nO(a,b.key,b.data),updateMask:oB(b.fieldMask)};else{if(!(b instanceof mZ))return gF(16599,{mutationType:b.type});c={verify:nH(a,b.key)}}return b.fieldTransforms.length>0&&(c.updateTransforms=b.fieldTransforms.map(b=>n1(a,b))),b.precondition.isNone||(c.currentDocument=nZ(a,b.precondition)),c}function nY(a,b){let c=b.currentDocument?n$(b.currentDocument):mF.none(),d=b.updateTransforms?b.updateTransforms.map(b=>n2(a,b)):[];if(b.update){nt(b.update.name);let e=nI(a,b.update.name),f=new kR({mapValue:{fields:b.update.fields}});return b.updateMask?new mQ(e,f,oC(b.updateMask),c,d):new mN(e,f,c,d)}return b.delete?new mW(nI(a,b.delete),c):b.verify?new mZ(nI(a,b.verify),c):gF(1463,{proto:b})}function nZ(a,b){return void 0!==b.updateTime?{updateTime:nC(a,b.updateTime)}:void 0!==b.exists?{exists:b.exists}:gF(27497)}function n$(a){return void 0!==a.updateTime?mF.updateTime(nD(a.updateTime)):void 0!==a.exists?mF.exists(a.exists):mF.none()}function n_(a,b){let c=a.updateTime?nD(a.updateTime):nD(b);return c.isEqual(hB.min())&&(c=nD(b)),new mE(c,a.transformResults||[])}function n0(a,b){return a&&a.length>0?(gH(void 0!==b,14353),a.map(a=>n_(a,b))):[]}function n1(a,b){let c=b.transform;if(c instanceof ms)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof mt)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof mv)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof mx)return{fieldPath:b.field.canonicalString(),increment:c.operand};throw gF(20930,{transform:b.transform})}function n2(a,b){let c=null;return"setToServerValue"in b?(gH("REQUEST_TIME"===b.setToServerValue,16630,{proto:b}),c=new ms):"appendMissingElements"in b?c=new mt(b.appendMissingElements.values||[]):"removeAllFromArray"in b?c=new mv(b.removeAllFromArray.values||[]):"increment"in b?c=new mx(a,b.increment):gF(16584,{proto:b}),new mB(hm.fromServerFormat(b.fieldPath),c)}function n3(a,b){return{documents:[nJ(a,b.path)]}}function n4(a){let b=a.documents.length;return gH(1===b,1966,{count:b}),lN(lG(nK(a.documents[0])))}function n5(a,b){let c,d={structuredQuery:{}},e=b.path;null!==b.collectionGroup?(c=e,d.structuredQuery.from=[{collectionId:b.collectionGroup,allDescendants:!0}]):(c=e.popLast(),d.structuredQuery.from=[{collectionId:e.lastSegment()}]),d.parent=nJ(a,c);let f=oc(b.filters);f&&(d.structuredQuery.where=f);let g=of(b.orderBy);g&&(d.structuredQuery.orderBy=g);let h=nw(a,b.limit);return null!==h&&(d.structuredQuery.limit=h),b.startAt&&(d.structuredQuery.startAt=oh(b.startAt)),b.endAt&&(d.structuredQuery.endAt=oi(b.endAt)),{queryTarget:d,parent:c}}function n6(a,b,c,d){let{queryTarget:e,parent:f}=n5(a,b),g={},h=[],i=0;return c.forEach(a=>{let b=d?a.alias:`aggregate_${i++}`;g[b]=a.alias,"count"===a.aggregateType?h.push({alias:b,count:{}}):"avg"===a.aggregateType?h.push({alias:b,avg:{field:or(a.fieldPath)}}):"sum"===a.aggregateType&&h.push({alias:b,sum:{field:or(a.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:h,structuredQuery:e.structuredQuery},parent:e.parent},aliasMap:g,parent:f}}function n7(a){let b=nK(a.parent),c=a.structuredQuery,d=c.from?c.from.length:0,e=null;if(d>0){gH(1===d,65062);let a=c.from[0];a.allDescendants?e=a.collectionId:b=b.child(a.collectionId)}let f=[];c.where&&(f=od(c.where));let g=[];c.orderBy&&(g=og(c.orderBy));let h=null;c.limit&&(h=nx(c.limit));let i=null;c.startAt&&(i=oj(c.startAt));let j=null;return c.endAt&&(j=ok(c.endAt)),lF(b,e,g,f,h,"F",i,j)}function n8(a){return lN(n7(a))}function n9(a,b){let c=oa(b.purpose);return null==c?null:{"goog-listen-tags":c}}function oa(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return gF(28987,{purpose:a})}}function ob(a,b){let c,d=b.target;if((c=lu(d)?{documents:n3(a,d)}:{query:n5(a,d).queryTarget}).targetId=b.targetId,b.resumeToken.approximateByteSize()>0){c.resumeToken=nA(a,b.resumeToken);let d=nw(a,b.expectedCount);null!==d&&(c.expectedCount=d)}else if(b.snapshotVersion.compareTo(hB.min())>0){c.readTime=ny(a,b.snapshotVersion.toTimestamp());let d=nw(a,b.expectedCount);null!==d&&(c.expectedCount=d)}return c}function oc(a){if(0!==a.length)return ov(k4.create(a,"and"))}function od(a){let b=oe(a);return b instanceof k4&&k7(b)?b.getFilters():[b]}function oe(a){return void 0!==a.unaryFilter?oy(a):void 0!==a.fieldFilter?oz(a):void 0!==a.compositeFilter?oA(a):gF(30097,{filter:a})}function of(a){if(0!==a.length)return a.map(a=>ot(a))}function og(a){return a.map(a=>ou(a))}function oh(a){return{before:a.inclusive,values:a.position}}function oi(a){return{before:!a.inclusive,values:a.position}}function oj(a){let b=!!a.before;return new kV(a.values||[],b)}function ok(a){let b=!a.before;return new kV(a.values||[],b)}function ol(a){return nq[a]}function om(a){switch(a){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function on(a){return nr[a]}function oo(a){return ns[a]}function op(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return gF(58110);default:return gF(50506)}}function oq(a){switch(a){case"AND":return"and";case"OR":return"or";default:return gF(1026)}}function or(a){return{fieldPath:a.canonicalString()}}function os(a){return hm.fromServerFormat(a.fieldPath)}function ot(a){return{field:or(a.field),direction:ol(a.dir)}}function ou(a){return new k$(os(a.field),om(a.direction))}function ov(a){return a instanceof k3?ox(a):a instanceof k4?ow(a):gF(54877,{filter:a})}function ow(a){let b=a.getFilters().map(a=>ov(a));return 1===b.length?b[0]:{compositeFilter:{op:oo(a.op),filters:b}}}function ox(a){if("=="===a.op){if(kH(a.value))return{unaryFilter:{field:or(a.field),op:"IS_NAN"}};else if(kG(a.value))return{unaryFilter:{field:or(a.field),op:"IS_NULL"}}}else if("!="===a.op){if(kH(a.value))return{unaryFilter:{field:or(a.field),op:"IS_NOT_NAN"}};else if(kG(a.value))return{unaryFilter:{field:or(a.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:or(a.field),op:on(a.op),value:a.value}}}function oy(a){switch(a.unaryFilter.op){case"IS_NAN":let b=os(a.unaryFilter.field);return k3.create(b,"==",{doubleValue:NaN});case"IS_NULL":let c=os(a.unaryFilter.field);return k3.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let d=os(a.unaryFilter.field);return k3.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let e=os(a.unaryFilter.field);return k3.create(e,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return gF(61313);default:return gF(60726)}}function oz(a){return k3.create(os(a.fieldFilter.field),op(a.fieldFilter.op),a.fieldFilter.value)}function oA(a){return k4.create(a.compositeFilter.filters.map(a=>oe(a)),oq(a.compositeFilter.op))}function oB(a){let b=[];return a.fields.forEach(a=>b.push(a.canonicalString())),{fieldPaths:b}}function oC(a){return new jF((a.fieldPaths||[]).map(a=>hm.fromServerFormat(a)))}function oD(a){return a.length>=4&&"projects"===a.get(0)&&"databases"===a.get(2)}function oE(a){return!!a&&"function"==typeof a._toProto&&"ProtoValue"===a._protoValueType}class oF{constructor(a,b,c,d,e=hB.min(),f=hB.min(),g=jI.EMPTY_BYTE_STRING,h=null){this.target=a,this.targetId=b,this.purpose=c,this.sequenceNumber=d,this.snapshotVersion=e,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=g,this.expectedCount=h}withSequenceNumber(a){return new oF(this.target,this.targetId,this.purpose,a,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(a,b){return new oF(this.target,this.targetId,this.purpose,this.sequenceNumber,b,this.lastLimboFreeSnapshotVersion,a,null)}withExpectedCount(a){return new oF(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,a)}withLastLimboFreeSnapshotVersion(a){return new oF(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,a,this.resumeToken,this.expectedCount)}}class oG{constructor(a){this.remoteSerializer=a}}function oH(a,b){let c;if(b.document)c=nQ(a.remoteSerializer,b.document,!!b.hasCommittedMutations);else if(b.noDocument){let a=hn.fromSegments(b.noDocument.path),d=oM(b.noDocument.readTime);c=kT.newNoDocument(a,d),b.hasCommittedMutations&&c.setHasCommittedMutations()}else{if(!b.unknownDocument)return gF(56709);let a=hn.fromSegments(b.unknownDocument.path),d=oM(b.unknownDocument.version);c=kT.newUnknownDocument(a,d)}return b.readTime&&c.setReadTime(oK(b.readTime)),c}function oI(a,b){let c=b.key,d={prefixPath:c.getCollectionPath().popLast().toArray(),collectionGroup:c.collectionGroup,documentId:c.path.lastSegment(),readTime:oJ(b.readTime),hasCommittedMutations:b.hasCommittedMutations};if(b.isFoundDocument())d.document=nP(a.remoteSerializer,b);else if(b.isNoDocument())d.noDocument={path:c.path.toArray(),readTime:oL(b.version)};else{if(!b.isUnknownDocument())return gF(57904,{document:b});d.unknownDocument={path:c.path.toArray(),version:oL(b.version)}}return d}function oJ(a){let b=a.toTimestamp();return[b.seconds,b.nanoseconds]}function oK(a){let b=new hA(a[0],a[1]);return hB.fromTimestamp(b)}function oL(a){let b=a.toTimestamp();return{seconds:b.seconds,nanoseconds:b.nanoseconds}}function oM(a){let b=new hA(a.seconds,a.nanoseconds);return hB.fromTimestamp(b)}function oN(a,b,c){let d=c.baseMutations.map(b=>nX(a.remoteSerializer,b)),e=c.mutations.map(b=>nX(a.remoteSerializer,b));return{userId:b,batchId:c.batchId,localWriteTimeMs:c.localWriteTime.toMillis(),baseMutations:d,mutations:e}}function oO(a,b){let c=(b.baseMutations||[]).map(b=>nY(a.remoteSerializer,b));for(let a=0;a<b.mutations.length-1;++a){let c=b.mutations[a];a+1<b.mutations.length&&void 0!==b.mutations[a+1].transform&&(c.updateTransforms=b.mutations[a+1].transform.fieldTransforms,b.mutations.splice(a+1,1),++a)}let d=b.mutations.map(b=>nY(a.remoteSerializer,b)),e=hA.fromMillis(b.localWriteTimeMs);return new m$(b.batchId,e,c,d)}function oP(a){let b,c=oM(a.readTime),d=void 0!==a.lastLimboFreeSnapshotVersion?oM(a.lastLimboFreeSnapshotVersion):hB.min();return new oF(b=oR(a.query)?n4(a.query):n8(a.query),a.targetId,"TargetPurposeListen",a.lastListenSequenceNumber,c,d,jI.fromBase64String(a.resumeToken))}function oQ(a,b){let c,d=oL(b.snapshotVersion),e=oL(b.lastLimboFreeSnapshotVersion);c=lu(b.target)?n3(a.remoteSerializer,b.target):n5(a.remoteSerializer,b.target).queryTarget;let f=b.resumeToken.toBase64();return{targetId:b.targetId,canonicalId:lr(b.target),readTime:d,resumeToken:f,lastListenSequenceNumber:b.sequenceNumber,lastLimboFreeSnapshotVersion:e,query:c}}function oR(a){return void 0!==a.documents}function oS(a){return{id:a.bundleId,createTime:oM(a.createTime),version:a.version}}function oT(a){return{bundleId:a.id,createTime:oL(nD(a.createTime)),version:a.version}}function oU(a){return{name:a.name,query:oW(a.bundledQuery),readTime:oM(a.readTime)}}function oV(a){return{name:a.name,readTime:oL(nD(a.readTime)),bundledQuery:a.bundledQuery}}function oW(a){let b=n7({parent:a.parent,structuredQuery:a.structuredQuery});return"LAST"===a.limitType?lS(b,b.limit,"L"):b}function oX(a){return{name:a.name,query:oW(a.bundledQuery),readTime:nD(a.readTime)}}function oY(a){return{id:a.id,version:a.version,createTime:nD(a.createTime)}}function oZ(a,b){return new m0(b.largestBatchId,nY(a.remoteSerializer,b.overlayMutation))}function o$(a,b,c){let[d,e,f]=o_(b,c.mutation.key);return{userId:b,collectionPath:e,documentId:f,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:nX(a.remoteSerializer,c.mutation)}}function o_(a,b){let c=b.path.lastSegment();return[a,ih(b.path.popLast()),c]}function o0(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}function o1(a,b){let c=b?new hM(b.sequenceNumber,new hP(oM(b.readTime),new hn(ik(b.documentKey)),b.largestBatchId)):hM.empty(),d=a.fields.map(([a,b])=>new hK(hm.fromServerFormat(a),b));return new hE(a.indexId,a.collectionGroup,d,c)}function o2(a,b,c,d){return{indexId:a,uid:b,sequenceNumber:c,readTime:oL(d.readTime),documentKey:ih(d.documentKey.path),largestBatchId:d.largestBatchId}}class o3{getBundleMetadata(a,b){return o4(a).get(b).next(a=>{if(a)return oS(a)})}saveBundleMetadata(a,b){return o4(a).put(oT(b))}getNamedQuery(a,b){return o5(a).get(b).next(a=>{if(a)return oU(a)})}saveNamedQuery(a,b){return o5(a).put(oV(b))}}function o4(a){return js(a,iW)}function o5(a){return js(a,iY)}class o6{constructor(a,b){this.serializer=a,this.userId=b}static forUser(a,b){return new o6(a,b.uid||"")}getOverlay(a,b){return o7(a).get(o_(this.userId,b)).next(a=>a?oZ(this.serializer,a):null)}getOverlays(a,b){let c=mb();return hU.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){let d=[];return c.forEach((c,e)=>{let f=new m0(b,e);d.push(this.saveOverlay(a,f))}),hU.waitFor(d)}removeOverlaysForBatchId(a,b,c){let d=new Set;b.forEach(a=>d.add(ih(a.getCollectionPath())));let e=[];return d.forEach(b=>{let d=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,c+1],!1,!0);e.push(o7(a).deleteAll(jc,d))}),hU.waitFor(e)}getOverlaysForCollection(a,b,c){let d=mb(),e=ih(b),f=IDBKeyRange.bound([this.userId,e,c],[this.userId,e,1/0],!0);return o7(a).loadAll(jc,f).next(a=>{for(let b of a){let a=oZ(this.serializer,b);d.set(a.getKey(),a)}return d})}getOverlaysForCollectionGroup(a,b,c,d){let e,f=mb(),g=IDBKeyRange.bound([this.userId,b,c],[this.userId,b,1/0],!0);return o7(a).iterate({index:je,range:g},(a,b,c)=>{let g=oZ(this.serializer,b);f.size()<d||g.largestBatchId===e?(f.set(g.getKey(),g),e=g.largestBatchId):c.done()}).next(()=>f)}saveOverlay(a,b){return o7(a).put(o$(this.serializer,this.userId,b))}}function o7(a){return js(a,ja)}class o8{globalsStore(a){return js(a,jg)}getSessionToken(a){return this.globalsStore(a).get("sessionToken").next(a=>{let b=a?.value;return b?jI.fromUint8Array(b):jI.EMPTY_BYTE_STRING})}setSessionToken(a,b){return this.globalsStore(a).put({name:"sessionToken",value:b.toUint8Array()})}}let o9=5,pa=10,pb=13,pc=15,pd=20,pe=25,pf=30,pg=37,ph=45,pi=50,pj=53,pk=55,pl=60,pm=2;class pn{writeIndexValue(a,b){this.writeIndexValueAux(a,b),b.writeInfinity()}writeIndexValueAux(a,b){if("nullValue"in a)this.writeValueTypeLabel(b,o9);else if("booleanValue"in a)this.writeValueTypeLabel(b,pa),b.writeNumber(+!!a.booleanValue);else if("integerValue"in a)this.writeValueTypeLabel(b,pc),b.writeNumber(jN(a.integerValue));else if("doubleValue"in a){let c=jN(a.doubleValue);isNaN(c)?this.writeValueTypeLabel(b,pb):(this.writeValueTypeLabel(b,pc),j1(c)?b.writeNumber(0):b.writeNumber(c))}else if("timestampValue"in a){let c=a.timestampValue;this.writeValueTypeLabel(b,pd),"string"==typeof c&&(c=jM(c)),b.writeString(`${c.seconds||""}`),b.writeNumber(c.nanos||0)}else if("stringValue"in a)this.writeIndexString(a.stringValue,b),this.writeTruncationMarker(b);else if("bytesValue"in a)this.writeValueTypeLabel(b,pf),b.writeBytes(jO(a.bytesValue)),this.writeTruncationMarker(b);else if("referenceValue"in a)this.writeIndexEntityRef(a.referenceValue,b);else if("geoPointValue"in a){let c=a.geoPointValue;this.writeValueTypeLabel(b,ph),b.writeNumber(c.latitude||0),b.writeNumber(c.longitude||0)}else"mapValue"in a?kL(a)?this.writeValueTypeLabel(b,Number.MAX_SAFE_INTEGER):kJ(a)?this.writeIndexVector(a.mapValue,b):(this.writeIndexMap(a.mapValue,b),this.writeTruncationMarker(b)):"arrayValue"in a?(this.writeIndexArray(a.arrayValue,b),this.writeTruncationMarker(b)):gF(19022,{indexValue:a})}writeIndexString(a,b){this.writeValueTypeLabel(b,pe),this.writeUnlabeledIndexString(a,b)}writeUnlabeledIndexString(a,b){b.writeString(a)}writeIndexMap(a,b){let c=a.fields||{};for(let a of(this.writeValueTypeLabel(b,pk),Object.keys(c)))this.writeIndexString(a,b),this.writeIndexValueAux(c[a],b)}writeIndexVector(a,b){let c=a.fields||{};this.writeValueTypeLabel(b,pj);let d=j7,e=c[d].arrayValue?.values?.length||0;this.writeValueTypeLabel(b,pc),b.writeNumber(jN(e)),this.writeIndexString(d,b),this.writeIndexValueAux(c[d],b)}writeIndexArray(a,b){let c=a.values||[];for(let a of(this.writeValueTypeLabel(b,pi),c))this.writeIndexValueAux(a,b)}writeIndexEntityRef(a,b){this.writeValueTypeLabel(b,pg),hn.fromName(a).path.forEach(a=>{this.writeValueTypeLabel(b,pl),this.writeUnlabeledIndexString(a,b)})}writeValueTypeLabel(a,b){a.writeNumber(b)}writeTruncationMarker(a){a.writeNumber(pm)}}pn.INSTANCE=new pn;let po="\uD800",pp="\uDBFF",pq=0,pr=255,ps=1,pt=255,pu=255,pv=0,pw=64,px=8,py=1024;function pz(a){let b=new DataView(new ArrayBuffer(8));return b.setFloat64(0,a,!1),new Uint8Array(b.buffer)}function pA(a){if(0===a)return 8;let b=0;return a>>4==0&&(b+=4,a<<=4),a>>6==0&&(b+=2,a<<=2),a>>7==0&&(b+=1),b}function pB(a){let b=0;for(let c=0;c<8;++c){let d=pA(255&a[c]);if(b+=d,8!==d)break}return b}function pC(a){return Math.ceil((pw-pB(a))/px)}class pD{constructor(){this.buffer=new Uint8Array(py),this.position=0}writeBytesAscending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteAscending(c.value),c=b.next();this.writeSeparatorAscending()}writeBytesDescending(a){let b=a[Symbol.iterator](),c=b.next();for(;!c.done;)this.writeByteDescending(c.value),c=b.next();this.writeSeparatorDescending()}writeUtf8Ascending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteAscending(a);else if(a<2048)this.writeByteAscending(960|a>>>6),this.writeByteAscending(128|63&a);else if(b<po||pp<b)this.writeByteAscending(480|a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a);else{let a=b.codePointAt(0);this.writeByteAscending(240|a>>>18),this.writeByteAscending(128|63&a>>>12),this.writeByteAscending(128|63&a>>>6),this.writeByteAscending(128|63&a)}}this.writeSeparatorAscending()}writeUtf8Descending(a){for(let b of a){let a=b.charCodeAt(0);if(a<128)this.writeByteDescending(a);else if(a<2048)this.writeByteDescending(960|a>>>6),this.writeByteDescending(128|63&a);else if(b<po||pp<b)this.writeByteDescending(480|a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a);else{let a=b.codePointAt(0);this.writeByteDescending(240|a>>>18),this.writeByteDescending(128|63&a>>>12),this.writeByteDescending(128|63&a>>>6),this.writeByteDescending(128|63&a)}}this.writeSeparatorDescending()}writeNumberAscending(a){let b=this.toOrderedBits(a),c=pC(b);this.ensureAvailable(1+c),this.buffer[this.position++]=255&c;for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=255&b[a]}writeNumberDescending(a){let b=this.toOrderedBits(a),c=pC(b);this.ensureAvailable(1+c),this.buffer[this.position++]=~(255&c);for(let a=b.length-c;a<b.length;++a)this.buffer[this.position++]=~(255&b[a])}writeInfinityAscending(){this.writeEscapedByteAscending(pt),this.writeEscapedByteAscending(pu)}writeInfinityDescending(){this.writeEscapedByteDescending(pt),this.writeEscapedByteDescending(pu)}reset(){this.position=0}seed(a){this.ensureAvailable(a.length),this.buffer.set(a,this.position),this.position+=a.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(a){let b=pz(a),c=(128&b[0])!=0;b[0]^=c?255:128;for(let a=1;a<b.length;++a)b[a]^=255*!!c;return b}writeByteAscending(a){let b=255&a;b===pq?(this.writeEscapedByteAscending(pq),this.writeEscapedByteAscending(pr)):b===pt?(this.writeEscapedByteAscending(pt),this.writeEscapedByteAscending(pv)):this.writeEscapedByteAscending(b)}writeByteDescending(a){let b=255&a;b===pq?(this.writeEscapedByteDescending(pq),this.writeEscapedByteDescending(pr)):b===pt?(this.writeEscapedByteDescending(pt),this.writeEscapedByteDescending(pv)):this.writeEscapedByteDescending(a)}writeSeparatorAscending(){this.writeEscapedByteAscending(pq),this.writeEscapedByteAscending(ps)}writeSeparatorDescending(){this.writeEscapedByteDescending(pq),this.writeEscapedByteDescending(ps)}writeEscapedByteAscending(a){this.ensureAvailable(1),this.buffer[this.position++]=a}writeEscapedByteDescending(a){this.ensureAvailable(1),this.buffer[this.position++]=~a}ensureAvailable(a){let b=a+this.position;if(b<=this.buffer.length)return;let c=2*this.buffer.length;c<b&&(c=b);let d=new Uint8Array(c);d.set(this.buffer),this.buffer=d}}class pE{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesAscending(a)}writeString(a){this.orderedCode.writeUtf8Ascending(a)}writeNumber(a){this.orderedCode.writeNumberAscending(a)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class pF{constructor(a){this.orderedCode=a}writeBytes(a){this.orderedCode.writeBytesDescending(a)}writeString(a){this.orderedCode.writeUtf8Descending(a)}writeNumber(a){this.orderedCode.writeNumberDescending(a)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class pG{constructor(){this.orderedCode=new pD,this.ascending=new pE(this.orderedCode),this.descending=new pF(this.orderedCode)}seed(a){this.orderedCode.seed(a)}forKind(a){return 0===a?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class pH{constructor(a,b,c,d){this._indexId=a,this._documentKey=b,this._arrayValue=c,this._directionalValue=d}successor(){let a=this._directionalValue.length,b=0===a||255===this._directionalValue[a-1]?a+1:a,c=new Uint8Array(b);return c.set(this._directionalValue,0),b!==a?c.set([0],this._directionalValue.length):++c[c.length-1],new pH(this._indexId,this._documentKey,this._arrayValue,c)}dbIndexEntry(a,b,c){return{indexId:this._indexId,uid:a,arrayValue:pK(this._arrayValue),directionalValue:pK(this._directionalValue),orderedDocumentKey:pK(b),documentKey:c.path.toArray()}}dbIndexEntryKey(a,b,c){let d=this.dbIndexEntry(a,b,c);return[d.indexId,d.uid,d.arrayValue,d.directionalValue,d.orderedDocumentKey,d.documentKey]}}function pI(a,b){let c=a._indexId-b._indexId;return 0!==c||0!==(c=pJ(a._arrayValue,b._arrayValue))||0!==(c=pJ(a._directionalValue,b._directionalValue))?c:hn.comparator(a._documentKey,b._documentKey)}function pJ(a,b){for(let c=0;c<a.length&&c<b.length;++c){let d=a[c]-b[c];if(0!==d)return d}return a.length-b.length}function pK(a){return eW()?pM(a):a}function pL(a){return"string"!=typeof a?a:pN(a)}function pM(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function pN(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}class pO{constructor(a){for(const b of(this.inequalityFilters=new jB((a,b)=>hm.comparator(a.field,b.field)),this.collectionId=null!=a.collectionGroup?a.collectionGroup:a.path.lastSegment(),this.orderBys=a.orderBy,this.equalityFilters=[],a.filters)){const a=b;a.isInequality()?this.inequalityFilters=this.inequalityFilters.add(a):this.equalityFilters.push(a)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(a){if(gH(a.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let b=hF(a);if(void 0!==b&&!this.hasMatchingEqualityFilter(b))return!1;let c=hG(a),d=new Set,e=0,f=0;for(;e<c.length;++e)if(this.hasMatchingEqualityFilter(c[e]))d=d.add(c[e].fieldPath.canonicalString());else break;if(e===c.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!d.has(a.field.canonicalString())){let b=c[e];if(!this.matchesFilter(a,b)||!this.matchesOrderBy(this.orderBys[f++],b))return!1}++e}for(;e<c.length;++e){let a=c[e];if(f>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[f++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let a=new jB(hm.comparator),b=[];for(let c of this.equalityFilters)if(!c.field.isKeyField())if("array-contains"===c.op||"array-contains-any"===c.op)b.push(new hK(c.field,2));else{if(a.has(c.field))continue;a=a.add(c.field),b.push(new hK(c.field,0))}for(let c of this.orderBys)!c.field.isKeyField()&&(a.has(c.field)||(a=a.add(c.field),b.push(new hK(c.field,+("asc"!==c.dir)))));return new hE(hE.UNKNOWN_ID,this.collectionId,b,hM.empty())}hasMatchingEqualityFilter(a){for(let b of this.equalityFilters)if(this.matchesFilter(b,a))return!0;return!1}matchesFilter(a,b){if(void 0===a||!a.field.isEqual(b.fieldPath))return!1;let c="array-contains"===a.op||"array-contains-any"===a.op;return 2===b.kind===c}matchesOrderBy(a,b){return!!a.field.isEqual(b.fieldPath)&&(0===b.kind&&"asc"===a.dir||1===b.kind&&"desc"===a.dir)}}function pP(a){if(gH(a instanceof k3||a instanceof k4,20012),a instanceof k3)if(!(a instanceof lm))return a;else{let b=a.value.arrayValue?.values?.map(b=>k3.create(a.field,"==",b))||[];return k4.create(b,"or")}let b=a.filters.map(a=>pP(a));return k4.create(b,a.op)}function pQ(a){if(0===a.getFilters().length)return[];let b=pV(pP(a));return(gH(pT(b),7391),pR(b)||pS(b))?[b]:b.getFilters()}function pR(a){return a instanceof k3}function pS(a){return a instanceof k4&&k7(a)}function pT(a){return pR(a)||pS(a)||pU(a)}function pU(a){if(a instanceof k4&&k6(a)){for(let b of a.getFilters())if(!pR(b)&&!pS(b))return!1;return!0}return!1}function pV(a){if(gH(a instanceof k3||a instanceof k4,34018),a instanceof k3)return a;if(1===a.filters.length)return pV(a.filters[0]);let b=a.filters.map(a=>pV(a)),c=k4.create(b,a.op);return pT(c=p$(c))?c:(gH(c instanceof k4,64498),gH(k5(c),40251),gH(c.filters.length>1,57927),c.filters.reduce((a,b)=>pW(a,b)))}function pW(a,b){let c;return gH(a instanceof k3||a instanceof k4,38388),gH(b instanceof k3||b instanceof k4,25473),p$(c=a instanceof k3?b instanceof k3?pX(a,b):pZ(a,b):b instanceof k3?pZ(b,a):pY(a,b))}function pX(a,b){return k4.create([a,b],"and")}function pY(a,b){if(gH(a.filters.length>0&&b.filters.length>0,48005),k5(a)&&k5(b))return ld(a,b.getFilters());let c=k6(a)?a:b,d=k6(a)?b:a,e=c.filters.map(a=>pW(a,d));return k4.create(e,"or")}function pZ(a,b){if(k5(b))return ld(b,a.getFilters());{let c=b.filters.map(b=>pW(a,b));return k4.create(c,"or")}}function p$(a){if(gH(a instanceof k3||a instanceof k4,11850),a instanceof k3)return a;let b=a.getFilters();if(1===b.length)return p$(b[0]);if(k8(a))return a;let c=b.map(a=>p$(a)),d=[];return(c.forEach(b=>{b instanceof k3?d.push(b):b instanceof k4&&(b.op===a.op?d.push(...b.filters):d.push(b))}),1===d.length)?d[0]:k4.create(d,a.op)}class p_{constructor(){this.collectionParentIndex=new p0}addToCollectionParentIndex(a,b){return this.collectionParentIndex.add(b),hU.resolve()}getCollectionParents(a,b){return hU.resolve(this.collectionParentIndex.getEntries(b))}addFieldIndex(a,b){return hU.resolve()}deleteFieldIndex(a,b){return hU.resolve()}deleteAllFieldIndexes(a){return hU.resolve()}createTargetIndexes(a,b){return hU.resolve()}getDocumentsMatchingTarget(a,b){return hU.resolve(null)}getIndexType(a,b){return hU.resolve(0)}getFieldIndexes(a,b){return hU.resolve([])}getNextCollectionGroupToUpdate(a){return hU.resolve(null)}getMinOffset(a,b){return hU.resolve(hP.min())}getMinOffsetFromCollectionGroup(a,b){return hU.resolve(hP.min())}updateCollectionGroup(a,b,c){return hU.resolve()}updateIndexEntries(a,b){return hU.resolve()}}class p0{constructor(){this.index={}}add(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b]||new jB(hk.comparator),e=!d.has(c);return this.index[b]=d.add(c),e}has(a){let b=a.lastSegment(),c=a.popLast(),d=this.index[b];return d&&d.has(c)}getEntries(a){return(this.index[a]||new jB(hk.comparator)).toArray()}}let p1="IndexedDbIndexManager",p2=new Uint8Array(0);class p3{constructor(a,b){this.databaseId=b,this.collectionParentsCache=new p0,this.targetToDnfSubTargets=new l4(a=>lr(a),(a,b)=>lt(a,b)),this.uid=a.uid||""}addToCollectionParentIndex(a,b){if(!this.collectionParentsCache.has(b)){let c=b.lastSegment(),d=b.popLast();a.addOnCommittedListener(()=>{this.collectionParentsCache.add(b)});let e={collectionId:c,parent:ih(d)};return p4(a).put(e)}return hU.resolve()}getCollectionParents(a,b){let c=[],d=IDBKeyRange.bound([b,""],[hh(b),""],!1,!0);return p4(a).loadAll(d).next(a=>{for(let d of a){if(d.collectionId!==b)break;c.push(ik(d.parent))}return c})}addFieldIndex(a,b){let c=p6(a),d=o0(b);delete d.indexId;let e=c.add(d);if(!b.indexState)return e.next();{let c=p7(a);return e.next(a=>{c.put(o2(a,this.uid,b.indexState.sequenceNumber,b.indexState.offset))})}}deleteFieldIndex(a,b){let c=p6(a),d=p7(a),e=p5(a);return c.delete(b.indexId).next(()=>d.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0))).next(()=>e.delete(IDBKeyRange.bound([b.indexId],[b.indexId+1],!1,!0)))}deleteAllFieldIndexes(a){let b=p6(a),c=p5(a),d=p7(a);return b.deleteAll().next(()=>c.deleteAll()).next(()=>d.deleteAll())}createTargetIndexes(a,b){return hU.forEach(this.getSubTargets(b),b=>this.getIndexType(a,b).next(c=>{if(0===c||1===c){let c=new pO(b).buildTargetIndex();if(null!=c)return this.addFieldIndex(a,c)}}))}getDocumentsMatchingTarget(a,b){let c=p5(a),d=!0,e=new Map;return hU.forEach(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>{d&&(d=!!a),e.set(b,a)})).next(()=>{if(!d)return hU.resolve(null);{let a=mh(),d=[];return hU.forEach(e,(e,f)=>{gB(p1,`Using index ${hJ(e)} to execute ${lr(b)}`);let g=lw(f,e),h=lx(f,e),i=ly(f,e),j=lz(f,e),k=this.encodeBound(e,f,i),l=this.encodeBound(e,f,j),m=this.encodeValues(e,f,h),n=this.generateIndexRanges(e.indexId,g,k,i.inclusive,l,j.inclusive,m);return hU.forEach(n,e=>c.loadFirst(e,b.limit).next(b=>{b.forEach(b=>{let c=hn.fromSegments(b.documentKey);a.has(c)||(a=a.add(c),d.push(c))})}))}).next(()=>d)}})}getSubTargets(a){let b=this.targetToDnfSubTargets.get(a);return b||(b=0===a.filters.length?[a]:pQ(k4.create(a.filters,"and")).map(b=>lq(a.path,a.collectionGroup,a.orderBy,b.getFilters(),a.limit,a.startAt,a.endAt)),this.targetToDnfSubTargets.set(a,b)),b}generateIndexRanges(a,b,c,d,e,f,g){let h=(null!=b?b.length:1)*Math.max(c.length,e.length),i=h/(null!=b?b.length:1),j=[];for(let k=0;k<h;++k){let h=b?this.encodeSingleElement(b[k/i]):p2,l=this.generateLowerBound(a,h,c[k%i],d),m=this.generateUpperBound(a,h,e[k%i],f),n=g.map(b=>this.generateLowerBound(a,h,b,!0));j.push(...this.createRange(l,m,n))}return j}generateLowerBound(a,b,c,d){let e=new pH(a,hn.empty(),b,c);return d?e:e.successor()}generateUpperBound(a,b,c,d){let e=new pH(a,hn.empty(),b,c);return d?e.successor():e}getFieldIndex(a,b){let c=new pO(b),d=null!=b.collectionGroup?b.collectionGroup:b.path.lastSegment();return this.getFieldIndexes(a,d).next(a=>{let b=null;for(let d of a)c.servedByIndex(d)&&(!b||d.fields.length>b.fields.length)&&(b=d);return b})}getIndexType(a,b){let c=2,d=this.getSubTargets(b);return hU.forEach(d,b=>this.getFieldIndex(a,b).next(a=>{a?0!==c&&a.fields.length<lC(b)&&(c=1):c=0})).next(()=>lD(b)&&d.length>1&&2===c?1:c)}encodeDirectionalElements(a,b){let c=new pG;for(let d of hG(a)){let a=b.data.field(d.fieldPath);if(null==a)return null;let e=c.forKind(d.kind);pn.INSTANCE.writeIndexValue(a,e)}return c.encodedBytes()}encodeSingleElement(a){let b=new pG;return pn.INSTANCE.writeIndexValue(a,b.forKind(0)),b.encodedBytes()}encodeDirectionalKey(a,b){let c=new pG;return pn.INSTANCE.writeIndexValue(kB(this.databaseId,b),c.forKind(hH(a))),c.encodedBytes()}encodeValues(a,b,c){if(null===c)return[];let d=[];d.push(new pG);let e=0;for(let f of hG(a)){let a=c[e++];for(let c of d)if(this.isInFilter(b,f.fieldPath)&&kF(a))d=this.expandIndexValues(d,f,a);else{let b=c.forKind(f.kind);pn.INSTANCE.writeIndexValue(a,b)}}return this.getEncodedBytes(d)}encodeBound(a,b,c){return this.encodeValues(a,b,c.position)}getEncodedBytes(a){let b=[];for(let c=0;c<a.length;++c)b[c]=a[c].encodedBytes();return b}expandIndexValues(a,b,c){let d=[...a],e=[];for(let a of c.arrayValue.values||[])for(let c of d){let d=new pG;d.seed(c.encodedBytes()),pn.INSTANCE.writeIndexValue(a,d.forKind(b.kind)),e.push(d)}return e}isInFilter(a,b){return!!a.filters.find(a=>a instanceof k3&&a.field.isEqual(b)&&("in"===a.op||"not-in"===a.op))}getFieldIndexes(a,b){let c=p6(a),d=p7(a);return(b?c.loadAll(i0,IDBKeyRange.bound(b,b)):c.loadAll()).next(a=>{let b=[];return hU.forEach(a,a=>d.get([a.indexId,this.uid]).next(c=>{b.push(o1(a,c))})).next(()=>b)})}getNextCollectionGroupToUpdate(a){return this.getFieldIndexes(a).next(a=>0===a.length?null:(a.sort((a,b)=>{let c=a.indexState.sequenceNumber-b.indexState.sequenceNumber;return 0!==c?c:hb(a.collectionGroup,b.collectionGroup)}),a[0].collectionGroup))}updateCollectionGroup(a,b,c){let d=p6(a),e=p7(a);return this.getNextSequenceNumber(a).next(a=>d.loadAll(i0,IDBKeyRange.bound(b,b)).next(b=>hU.forEach(b,b=>e.put(o2(b.indexId,this.uid,a,c)))))}updateIndexEntries(a,b){let c=new Map;return hU.forEach(b,(b,d)=>{let e=c.get(b.collectionGroup);return(e?hU.resolve(e):this.getFieldIndexes(a,b.collectionGroup)).next(e=>(c.set(b.collectionGroup,e),hU.forEach(e,c=>this.getExistingIndexEntries(a,b,c).next(b=>{let e=this.computeIndexEntries(d,c);return b.isEqual(e)?hU.resolve():this.updateEntries(a,d,c,b,e)}))))})}addIndexEntry(a,b,c,d){return p5(a).put(d.dbIndexEntry(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}deleteIndexEntry(a,b,c,d){return p5(a).delete(d.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(c,b.key),b.key))}getExistingIndexEntries(a,b,c){let d=p5(a),e=new jB(pI);return d.iterate({index:i8,range:IDBKeyRange.only([c.indexId,this.uid,pK(this.encodeDirectionalKey(c,b))])},(a,d)=>{e=e.add(new pH(c.indexId,b,pL(d.arrayValue),pL(d.directionalValue)))}).next(()=>e)}computeIndexEntries(a,b){let c=new jB(pI),d=this.encodeDirectionalElements(b,a);if(null==d)return c;let e=hF(b);if(null!=e){let f=a.data.field(e.fieldPath);if(kF(f))for(let e of f.arrayValue.values||[])c=c.add(new pH(b.indexId,a.key,this.encodeSingleElement(e),d))}else c=c.add(new pH(b.indexId,a.key,p2,d));return c}updateEntries(a,b,c,d,e){gB(p1,"Updating index entries for document '%s'",b.key);let f=[];return jD(d,e,pI,d=>{f.push(this.addIndexEntry(a,b,c,d))},d=>{f.push(this.deleteIndexEntry(a,b,c,d))}),hU.waitFor(f)}getNextSequenceNumber(a){let b=1;return p7(a).iterate({index:i4,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(a,c,d)=>{d.done(),b=c.sequenceNumber+1}).next(()=>b)}createRange(a,b,c){c=c.sort((a,b)=>pI(a,b)).filter((a,b,c)=>!b||0!==pI(a,c[b-1]));let d=[];for(let e of(d.push(a),c)){let c=pI(e,a),f=pI(e,b);if(0===c)d[0]=a.successor();else if(c>0&&f<0)d.push(e),d.push(e.successor());else if(f>0)break}d.push(b);let e=[];for(let a=0;a<d.length;a+=2){if(this.isRangeMatchable(d[a],d[a+1]))return[];let b=d[a].dbIndexEntryKey(this.uid,p2,hn.empty()),c=d[a+1].dbIndexEntryKey(this.uid,p2,hn.empty());e.push(IDBKeyRange.bound(b,c))}return e}isRangeMatchable(a,b){return pI(a,b)>0}getMinOffsetFromCollectionGroup(a,b){return this.getFieldIndexes(a,b).next(p8)}getMinOffset(a,b){return hU.mapArray(this.getSubTargets(b),b=>this.getFieldIndex(a,b).next(a=>a||gF(44426))).next(p8)}}function p4(a){return js(a,iS)}function p5(a){return js(a,i6)}function p6(a){return js(a,i$)}function p7(a){return js(a,i2)}function p8(a){gH(0!==a.length,28825);let b=a[0].indexState.offset,c=b.largestBatchId;for(let d=1;d<a.length;d++){let e=a[d].indexState.offset;0>hQ(e,b)&&(b=e),c<e.largestBatchId&&(c=e.largestBatchId)}return new hP(b.readTime,b.documentKey,c)}function p9(a,b,c){let d=a.store(ir),e=a.store(iz),f=[],g=IDBKeyRange.only(c.batchId),h=0,i=d.iterate({range:g},(a,b,c)=>(h++,c.delete()));f.push(i.next(()=>{gH(1===h,47070,{batchId:c.batchId})}));let j=[];for(let a of c.mutations){let d=ix(b,a.key.path,c.batchId);f.push(e.delete(d)),j.push(a.key)}return hU.waitFor(f).next(()=>j)}function qa(a){let b;if(!a)return 0;if(a.document)b=a.document;else if(a.unknownDocument)b=a.unknownDocument;else if(a.noDocument)b=a.noDocument;else throw gF(14731);return JSON.stringify(b).length}class qb{constructor(a,b,c,d){this.userId=a,this.serializer=b,this.indexManager=c,this.referenceDelegate=d,this.documentKeysByBatchId={}}static forUser(a,b,c,d){return gH(""!==a.uid,64387),new qb(a.isAuthenticated()?a.uid:"",b,c,d)}checkEmpty(a){let b=!0,c=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return qe(a).iterate({index:it,range:c},(a,c,d)=>{b=!1,d.done()}).next(()=>b)}addMutationBatch(a,b,c,d){let e=qf(a),f=qe(a);return f.add({}).next(g=>{gH("number"==typeof g,49019);let h=new m$(g,b,c,d),i=oN(this.serializer,this.userId,h),j=[],k=new jB((a,b)=>hb(a.canonicalString(),b.canonicalString()));for(let a of d){let b=ix(this.userId,a.key.path,g);k=k.add(a.key.path.popLast()),j.push(f.put(i)),j.push(e.put(b,iy))}return k.forEach(b=>{j.push(this.indexManager.addToCollectionParentIndex(a,b))}),a.addOnCommittedListener(()=>{this.documentKeysByBatchId[g]=h.keys()}),hU.waitFor(j).next(()=>h)})}lookupMutationBatch(a,b){return qe(a).get(b).next(a=>a?(gH(a.userId===this.userId,48,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),oO(this.serializer,a)):null)}lookupMutationKeys(a,b){return this.documentKeysByBatchId[b]?hU.resolve(this.documentKeysByBatchId[b]):this.lookupMutationBatch(a,b).next(a=>{if(!a)return null;{let c=a.keys();return this.documentKeysByBatchId[b]=c,c}})}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=IDBKeyRange.lowerBound([this.userId,c]),e=null;return qe(a).iterate({index:it,range:d},(a,b,d)=>{b.userId===this.userId&&(gH(b.batchId>=c,47524,{nextBatchId:c}),e=oO(this.serializer,b)),d.done()}).next(()=>e)}getHighestUnacknowledgedBatchId(a){let b=IDBKeyRange.upperBound([this.userId,1/0]),c=j_;return qe(a).iterate({index:it,range:b,reverse:!0},(a,b,d)=>{c=b.batchId,d.done()}).next(()=>c)}getAllMutationBatches(a){let b=IDBKeyRange.bound([this.userId,j_],[this.userId,1/0]);return qe(a).loadAll(it,b).next(a=>a.map(a=>oO(this.serializer,a)))}getAllMutationBatchesAffectingDocumentKey(a,b){let c=iw(this.userId,b.path),d=IDBKeyRange.lowerBound(c),e=[];return qf(a).iterate({range:d},(c,d,f)=>{let[g,h,i]=c,j=ik(h);return g===this.userId&&b.path.isEqual(j)?qe(a).get(i).next(a=>{if(!a)throw gF(61480,{indexKey:c,batchId:i});gH(a.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),e.push(oO(this.serializer,a))}):void f.done()}).next(()=>e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new jB(hb),d=[];return b.forEach(b=>{let e=iw(this.userId,b.path),f=IDBKeyRange.lowerBound(e),g=qf(a).iterate({range:f},(a,d,e)=>{let[f,g,h]=a,i=ik(g);f===this.userId&&b.path.isEqual(i)?c=c.add(h):e.done()});d.push(g)}),hU.waitFor(d).next(()=>this.lookupMutationBatches(a,c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=iw(this.userId,c),f=IDBKeyRange.lowerBound(e),g=new jB(hb);return qf(a).iterate({range:f},(a,b,e)=>{let[f,h,i]=a,j=ik(h);f===this.userId&&c.isPrefixOf(j)?j.length===d&&(g=g.add(i)):e.done()}).next(()=>this.lookupMutationBatches(a,g))}lookupMutationBatches(a,b){let c=[],d=[];return b.forEach(b=>{d.push(qe(a).get(b).next(a=>{if(null===a)throw gF(35274,{batchId:b});gH(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:b}),c.push(oO(this.serializer,a))}))}),hU.waitFor(d).next(()=>c)}removeMutationBatch(a,b){return p9(a.simpleDbTransaction,this.userId,b).next(c=>(a.addOnCommittedListener(()=>{this.removeCachedMutationKeys(b.batchId)}),hU.forEach(c,b=>this.referenceDelegate.markPotentiallyOrphaned(a,b))))}removeCachedMutationKeys(a){delete this.documentKeysByBatchId[a]}performConsistencyCheck(a){return this.checkEmpty(a).next(b=>{if(!b)return hU.resolve();let c=IDBKeyRange.lowerBound(iv(this.userId)),d=[];return qf(a).iterate({range:c},(a,b,c)=>{if(a[0]!==this.userId)return void c.done();{let b=ik(a[1]);d.push(b)}}).next(()=>{gH(0===d.length,56720,{danglingKeys:d.map(a=>a.canonicalString())})})})}containsKey(a,b){return qc(a,this.userId,b)}getMutationQueueMetadata(a){return qg(a).get(this.userId).next(a=>a||{userId:this.userId,lastAcknowledgedBatchId:j_,lastStreamToken:""})}}function qc(a,b,c){let d=iw(b,c.path),e=d[1],f=IDBKeyRange.lowerBound(d),g=!1;return qf(a).iterate({range:f,keysOnly:!0},(a,c,d)=>{let[f,h,i]=a;f===b&&h===e&&(g=!0),d.done()}).next(()=>g)}function qd(a,b){let c=!1;return qg(a).iterateSerial(d=>qc(a,d,b).next(a=>(a&&(c=!0),hU.resolve(!a)))).next(()=>c)}function qe(a){return js(a,ir)}function qf(a){return js(a,iz)}function qg(a){return js(a,ip)}let qh=2;class qi{constructor(a){this.lastId=a}next(){return this.lastId+=qh,this.lastId}static forTargetCache(){return new qi(2-qh)}static forSyncEngine(){return new qi(1-qh)}}class qj{constructor(a,b){this.referenceDelegate=a,this.serializer=b}allocateTargetId(a){return this.retrieveMetadata(a).next(b=>{let c=new qi(b.highestTargetId);return b.highestTargetId=c.next(),this.saveMetadata(a,b).next(()=>b.highestTargetId)})}getLastRemoteSnapshotVersion(a){return this.retrieveMetadata(a).next(a=>hB.fromTimestamp(new hA(a.lastRemoteSnapshotVersion.seconds,a.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(a){return this.retrieveMetadata(a).next(a=>a.highestListenSequenceNumber)}setTargetsMetadata(a,b,c){return this.retrieveMetadata(a).next(d=>(d.highestListenSequenceNumber=b,c&&(d.lastRemoteSnapshotVersion=c.toTimestamp()),b>d.highestListenSequenceNumber&&(d.highestListenSequenceNumber=b),this.saveMetadata(a,d)))}addTargetData(a,b){return this.saveTargetData(a,b).next(()=>this.retrieveMetadata(a).next(c=>(c.targetCount+=1,this.updateMetadataFromTargetData(b,c),this.saveMetadata(a,c))))}updateTargetData(a,b){return this.saveTargetData(a,b)}removeTargetData(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(()=>qk(a).delete(b.targetId)).next(()=>this.retrieveMetadata(a)).next(b=>(gH(b.targetCount>0,8065),b.targetCount-=1,this.saveMetadata(a,b)))}removeTargets(a,b,c){let d=0,e=[];return qk(a).iterate((f,g)=>{let h=oP(g);h.sequenceNumber<=b&&null===c.get(h.targetId)&&(d++,e.push(this.removeTargetData(a,h)))}).next(()=>hU.waitFor(e)).next(()=>d)}forEachTarget(a,b){return qk(a).iterate((a,c)=>{b(oP(c))})}retrieveMetadata(a){return ql(a).get(iQ).next(a=>(gH(null!==a,2888),a))}saveMetadata(a,b){return ql(a).put(iQ,b)}saveTargetData(a,b){return qk(a).put(oQ(this.serializer,b))}updateMetadataFromTargetData(a,b){let c=!1;return a.targetId>b.highestTargetId&&(b.highestTargetId=a.targetId,c=!0),a.sequenceNumber>b.highestListenSequenceNumber&&(b.highestListenSequenceNumber=a.sequenceNumber,c=!0),c}getTargetCount(a){return this.retrieveMetadata(a).next(a=>a.targetCount)}getTargetData(a,b){let c=lr(b),d=IDBKeyRange.bound([c,-1/0],[c,1/0]),e=null;return qk(a).iterate({range:d,index:iK},(a,c,d)=>{let f=oP(c);lt(b,f.target)&&(e=f,d.done())}).next(()=>e)}addMatchingKeys(a,b,c){let d=[],e=qm(a);return b.forEach(b=>{let f=ih(b.path);d.push(e.put({targetId:c,path:f})),d.push(this.referenceDelegate.addReference(a,c,b))}),hU.waitFor(d)}removeMatchingKeys(a,b,c){let d=qm(a);return hU.forEach(b,b=>{let e=ih(b.path);return hU.waitFor([d.delete([c,e]),this.referenceDelegate.removeReference(a,c,b)])})}removeMatchingKeysForTargetId(a,b){let c=qm(a),d=IDBKeyRange.bound([b],[b+1],!1,!0);return c.delete(d)}getMatchingKeysForTargetId(a,b){let c=IDBKeyRange.bound([b],[b+1],!1,!0),d=qm(a),e=mh();return d.iterate({range:c,keysOnly:!0},(a,b,c)=>{let d=new hn(ik(a[1]));e=e.add(d)}).next(()=>e)}containsKey(a,b){let c=ih(b.path),d=IDBKeyRange.bound([c],[hh(c)],!1,!0),e=0;return qm(a).iterate({index:iO,keysOnly:!0,range:d},([a,b],c,d)=>{0!==a&&(e++,d.done())}).next(()=>e>0)}getTargetDataForTarget(a,b){return qk(a).get(b).next(a=>a?oP(a):null)}}function qk(a){return js(a,iI)}function ql(a){return js(a,iR)}function qm(a){return js(a,iM)}let qn={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qo=-1,qp=0x2800000;class qq{static withCacheSize(a){return new qq(a,qq.DEFAULT_COLLECTION_PERCENTILE,qq.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(a,b,c){this.cacheSizeCollectionThreshold=a,this.percentileToCollect=b,this.maximumSequenceNumbersToCollect=c}}qq.DEFAULT_COLLECTION_PERCENTILE=10,qq.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qq.DEFAULT=new qq(qp,qq.DEFAULT_COLLECTION_PERCENTILE,qq.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qq.DISABLED=new qq(qo,0,0);let qr="LruGarbageCollector",qs=1048576,qt=6e4,qu=3e5;function qv([a,b],[c,d]){let e=hb(a,c);return 0===e?hb(b,d):e}class qw{constructor(a){this.maxElements=a,this.buffer=new jB(qv),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(a){let b=[a,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(b);else{let a=this.buffer.last();0>qv(b,a)&&(this.buffer=this.buffer.delete(a).add(b))}}get maxValue(){return this.buffer.last()[0]}}class qx{constructor(a,b,c){this.garbageCollector=a,this.asyncQueue=b,this.localStore=c,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==qo&&this.scheduleGC(qt)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(a){gB(qr,`Garbage collection scheduled in ${a}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",a,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(a){h0(a)?gB(qr,"Ignoring IndexedDB error during garbage collection: ",a):await hT(a)}await this.scheduleGC(qu)})}}class qy{constructor(a,b){this.delegate=a,this.params=b}calculateTargetCount(a,b){return this.delegate.getSequenceNumberCount(a).next(a=>Math.floor(b/100*a))}nthSequenceNumber(a,b){if(0===b)return hU.resolve(ib.INVALID);let c=new qw(b);return this.delegate.forEachTarget(a,a=>c.addElement(a.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(a,a=>c.addElement(a))).next(()=>c.maxValue)}removeTargets(a,b,c){return this.delegate.removeTargets(a,b,c)}removeOrphanedDocuments(a,b){return this.delegate.removeOrphanedDocuments(a,b)}collect(a,b){return this.params.cacheSizeCollectionThreshold===qo?(gB("LruGarbageCollector","Garbage collection skipped; disabled"),hU.resolve(qn)):this.getCacheSize(a).next(c=>c<this.params.cacheSizeCollectionThreshold?(gB("LruGarbageCollector",`Garbage collection skipped; Cache size ${c} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qn):this.runGarbageCollection(a,b))}getCacheSize(a){return this.delegate.getCacheSize(a)}runGarbageCollection(a,b){let c,d,e,f,g,h,i,j=Date.now();return this.calculateTargetCount(a,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(gB("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),d=this.params.maximumSequenceNumbersToCollect):d=b,f=Date.now(),this.nthSequenceNumber(a,d))).next(d=>(c=d,g=Date.now(),this.removeTargets(a,c,b))).next(b=>(e=b,h=Date.now(),this.removeOrphanedDocuments(a,c))).next(a=>(i=Date.now(),gA()<=l.DEBUG&&gB("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-j}ms
	Determined least recently used ${d} in ${g-f}ms
	Removed ${e} targets in ${h-g}ms
	Removed ${a} documents in ${i-h}ms
Total Duration: ${i-j}ms`),hU.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:e,documentsRemoved:a})))}}function qz(a,b){return new qy(a,b)}class qA{constructor(a,b){this.db=a,this.garbageCollector=qz(this,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.db.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachTarget(a,b){return this.db.getTargetCache().forEachTarget(a,b)}forEachOrphanedDocumentSequenceNumber(a,b){return this.forEachOrphanedDocument(a,(a,c)=>b(c))}addReference(a,b,c){return qD(a,c)}removeReference(a,b,c){return qD(a,c)}removeTargets(a,b,c){return this.db.getTargetCache().removeTargets(a,b,c)}markPotentiallyOrphaned(a,b){return qD(a,b)}isPinned(a,b){return qd(a,b)}removeOrphanedDocuments(a,b){let c=this.db.getRemoteDocumentCache().newChangeBuffer(),d=[],e=0;return this.forEachOrphanedDocument(a,(f,g)=>{if(g<=b){let b=this.isPinned(a,f).next(b=>{if(!b)return e++,c.getEntry(a,f).next(()=>(c.removeEntry(f,hB.min()),qm(a).delete(qB(f))))});d.push(b)}}).next(()=>hU.waitFor(d)).next(()=>c.apply(a)).next(()=>e)}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(a,c)}updateLimboDocument(a,b){return qD(a,b)}forEachOrphanedDocument(a,b){let c,d=qm(a),e=ib.INVALID;return d.iterate({index:iO},([a,d],{path:f,sequenceNumber:g})=>{0===a?(e!==ib.INVALID&&b(new hn(ik(c)),e),e=g,c=f):e=ib.INVALID}).next(()=>{e!==ib.INVALID&&b(new hn(ik(c)),e)})}getCacheSize(a){return this.db.getRemoteDocumentCache().getSize(a)}}function qB(a){return[0,ih(a.path)]}function qC(a,b){return{targetId:0,path:ih(a.path),sequenceNumber:b}}function qD(a,b){return qm(a).put(qC(b,a.currentSequenceNumber))}class qE{constructor(){this.changes=new l4(a=>a.toString(),(a,b)=>a.isEqual(b)),this.changesApplied=!1}addEntry(a){this.assertNotApplied(),this.changes.set(a.key,a)}removeEntry(a,b){this.assertNotApplied(),this.changes.set(a,kT.newInvalidDocument(a).setReadTime(b))}getEntry(a,b){this.assertNotApplied();let c=this.changes.get(b);return void 0!==c?hU.resolve(c):this.getFromCache(a,b)}getEntries(a,b){return this.getAllFromCache(a,b)}apply(a){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(a)}assertNotApplied(){}}class qF{constructor(a){this.serializer=a}setIndexManager(a){this.indexManager=a}addEntry(a,b,c){return qJ(a).put(c)}removeEntry(a,b,c){return qJ(a).delete(qL(b,c))}updateMetadata(a,b){return this.getMetadata(a).next(c=>(c.byteSize+=b,this.setMetadata(a,c)))}getEntry(a,b){let c=kT.newInvalidDocument(b);return qJ(a).iterate({index:iC,range:IDBKeyRange.only(qK(b))},(a,d)=>{c=this.maybeDecodeDocument(b,d)}).next(()=>c)}getSizedEntry(a,b){let c={size:0,document:kT.newInvalidDocument(b)};return qJ(a).iterate({index:iC,range:IDBKeyRange.only(qK(b))},(a,d)=>{c={document:this.maybeDecodeDocument(b,d),size:qa(d)}}).next(()=>c)}getEntries(a,b){let c=l6();return this.forEachDbEntry(a,b,(a,b)=>{let d=this.maybeDecodeDocument(a,b);c=c.insert(a,d)}).next(()=>c)}getSizedEntries(a,b){let c=l6(),d=new jx(hn.comparator);return this.forEachDbEntry(a,b,(a,b)=>{let e=this.maybeDecodeDocument(a,b);c=c.insert(a,e),d=d.insert(a,qa(b))}).next(()=>({documents:c,sizeMap:d}))}forEachDbEntry(a,b,c){if(b.isEmpty())return hU.resolve();let d=new jB(qN);b.forEach(a=>d=d.add(a));let e=IDBKeyRange.bound(qK(d.first()),qK(d.last())),f=d.getIterator(),g=f.getNext();return qJ(a).iterate({index:iC,range:e},(a,b,d)=>{let e=hn.fromSegments([...b.prefixPath,b.collectionGroup,b.documentId]);for(;g&&0>qN(g,e);)c(g,null),g=f.getNext();g&&g.isEqual(e)&&(c(g,b),g=f.hasNext()?f.getNext():null),g?d.skip(qK(g)):d.done()}).next(()=>{for(;g;)c(g,null),g=f.hasNext()?f.getNext():null})}getDocumentsMatchingQuery(a,b,c,d,e){let f=b.path,g=[f.popLast().toArray(),f.lastSegment(),oJ(c.readTime),c.documentKey.path.isEmpty()?"":c.documentKey.path.lastSegment()],h=[f.popLast().toArray(),f.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qJ(a).loadAll(IDBKeyRange.bound(g,h,!0)).next(a=>{e?.incrementDocumentReadCount(a.length);let c=l6();for(let e of a){let a=this.maybeDecodeDocument(hn.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);a.isFoundDocument()&&(lY(b,a)||d.has(a.key))&&(c=c.insert(a.key,a))}return c})}getAllFromCollectionGroup(a,b,c,d){let e=l6(),f=qM(b,c),g=qM(b,hP.max());return qJ(a).iterate({index:iE,range:IDBKeyRange.bound(f,g,!0)},(a,b,c)=>{let f=this.maybeDecodeDocument(hn.fromSegments(b.prefixPath.concat(b.collectionGroup,b.documentId)),b);(e=e.insert(f.key,f)).size===d&&c.done()}).next(()=>e)}newChangeBuffer(a){return new qH(this,!!a&&a.trackRemovals)}getSize(a){return this.getMetadata(a).next(a=>a.byteSize)}getMetadata(a){return qI(a).get(iH).next(a=>(gH(!!a,20021),a))}setMetadata(a,b){return qI(a).put(iH,b)}maybeDecodeDocument(a,b){if(b){let a=oH(this.serializer,b);if(!(a.isNoDocument()&&a.version.isEqual(hB.min())))return a}return kT.newInvalidDocument(a)}}function qG(a){return new qF(a)}class qH extends qE{constructor(a,b){super(),this.documentCache=a,this.trackRemovals=b,this.documentStates=new l4(a=>a.toString(),(a,b)=>a.isEqual(b))}applyChanges(a){let b=[],c=0,d=new jB((a,b)=>hb(a.canonicalString(),b.canonicalString()));return this.changes.forEach((e,f)=>{let g=this.documentStates.get(e);if(b.push(this.documentCache.removeEntry(a,e,g.readTime)),f.isValidDocument()){let h=oI(this.documentCache.serializer,f);d=d.add(e.path.popLast());let i=qa(h);c+=i-g.size,b.push(this.documentCache.addEntry(a,e,h))}else if(c-=g.size,this.trackRemovals){let c=oI(this.documentCache.serializer,f.convertToNoDocument(hB.min()));b.push(this.documentCache.addEntry(a,e,c))}}),d.forEach(c=>{b.push(this.documentCache.indexManager.addToCollectionParentIndex(a,c))}),b.push(this.documentCache.updateMetadata(a,c)),hU.waitFor(b)}getFromCache(a,b){return this.documentCache.getSizedEntry(a,b).next(a=>(this.documentStates.set(b,{size:a.size,readTime:a.document.readTime}),a.document))}getAllFromCache(a,b){return this.documentCache.getSizedEntries(a,b).next(({documents:a,sizeMap:b})=>(b.forEach((b,c)=>{this.documentStates.set(b,{size:c,readTime:a.get(b).readTime})}),a))}}function qI(a){return js(a,iG)}function qJ(a){return js(a,iA)}function qK(a){let b=a.path.toArray();return[b.slice(0,b.length-2),b[b.length-2],b[b.length-1]]}function qL(a,b){let c=a.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],oJ(b),c[c.length-1]]}function qM(a,b){let c=b.documentKey.path.toArray();return[a,oJ(b.readTime),c.slice(0,c.length-2),c.length>0?c[c.length-1]:""]}function qN(a,b){let c=a.path.toArray(),d=b.path.toArray(),e=0;for(let a=0;a<c.length-2&&a<d.length-2;++a)if(e=hb(c[a],d[a]))return e;return(e=hb(c.length,d.length))||(e=hb(c[c.length-2],d[d.length-2]))?e:hb(c[c.length-1],d[d.length-1])}let qO=18;class qP{constructor(a,b){this.overlayedDocument=a,this.mutatedFields=b}}class qQ{constructor(a,b,c,d){this.remoteDocumentCache=a,this.mutationQueue=b,this.documentOverlayCache=c,this.indexManager=d}getDocument(a,b){let c=null;return this.documentOverlayCache.getOverlay(a,b).next(d=>(c=d,this.remoteDocumentCache.getEntry(a,b))).next(a=>(null!==c&&mK(c.mutation,a,jF.empty(),hA.now()),a))}getDocuments(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.getLocalViewOfDocuments(a,b,mh()).next(()=>b))}getLocalViewOfDocuments(a,b,c=mh()){let d=mb();return this.populateOverlays(a,d,b).next(()=>this.computeViews(a,b,d,c).next(a=>{let b=l8();return a.forEach((a,c)=>{b=b.insert(a,c.overlayedDocument)}),b}))}getOverlayedDocuments(a,b){let c=mb();return this.populateOverlays(a,c,b).next(()=>this.computeViews(a,b,c,mh()))}populateOverlays(a,b,c){let d=[];return c.forEach(a=>{b.has(a)||d.push(a)}),this.documentOverlayCache.getOverlays(a,d).next(a=>{a.forEach((a,c)=>{b.set(a,c)})})}computeViews(a,b,c,d){let e=l6(),f=md(),g=l9();return b.forEach((a,b)=>{let g=c.get(b.key);d.has(b.key)&&(void 0===g||g.mutation instanceof mQ)?e=e.insert(b.key,b):void 0!==g?(f.set(b.key,g.mutation.getFieldMask()),mK(g.mutation,b,g.mutation.getFieldMask(),hA.now())):f.set(b.key,jF.empty())}),this.recalculateAndSaveOverlays(a,e).next(a=>(a.forEach((a,b)=>f.set(a,b)),b.forEach((a,b)=>g.set(a,new qP(b,f.get(a)??null))),g))}recalculateAndSaveOverlays(a,b){let c=md(),d=new jx((a,b)=>a-b),e=mh();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,b).next(a=>{for(let e of a)e.keys().forEach(a=>{let f=b.get(a);if(null===f)return;let g=c.get(a)||jF.empty();g=e.applyToLocalView(f,g),c.set(a,g);let h=(d.get(e.batchId)||mh()).add(a);d=d.insert(e.batchId,h)})}).next(()=>{let f=[],g=d.getReverseIterator();for(;g.hasNext();){let d=g.getNext(),h=d.key,i=d.value,j=mc();i.forEach(a=>{if(!e.has(a)){let d=mI(b.get(a),c.get(a));null!==d&&j.set(a,d),e=e.add(a)}}),f.push(this.documentOverlayCache.saveOverlays(a,h,j))}return hU.waitFor(f)}).next(()=>c)}recalculateAndSaveOverlaysForDocumentKeys(a,b){return this.remoteDocumentCache.getEntries(a,b).next(b=>this.recalculateAndSaveOverlays(a,b))}getDocumentsMatchingQuery(a,b,c,d){return lK(b)?this.getDocumentsMatchingDocumentQuery(a,b.path):lL(b)?this.getDocumentsMatchingCollectionGroupQuery(a,b,c,d):this.getDocumentsMatchingCollectionQuery(a,b,c,d)}getNextDocuments(a,b,c,d){return this.remoteDocumentCache.getAllFromCollectionGroup(a,b,c,d).next(e=>{let f=d-e.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(a,b,c.largestBatchId,d-e.size):hU.resolve(mb()),g=hC,h=e;return f.next(b=>hU.forEach(b,(b,c)=>(g<c.largestBatchId&&(g=c.largestBatchId),e.get(b))?hU.resolve():this.remoteDocumentCache.getEntry(a,b).next(a=>{h=h.insert(b,a)})).next(()=>this.populateOverlays(a,b,e)).next(()=>this.computeViews(a,h,b,mh())).next(a=>({batchId:g,changes:ma(a)})))})}getDocumentsMatchingDocumentQuery(a,b){return this.getDocument(a,new hn(b)).next(a=>{let b=l8();return a.isFoundDocument()&&(b=b.insert(a.key,a)),b})}getDocumentsMatchingCollectionGroupQuery(a,b,c,d){let e=b.collectionGroup,f=l8();return this.indexManager.getCollectionParents(a,e).next(g=>hU.forEach(g,g=>{let h=lH(b,g.child(e));return this.getDocumentsMatchingCollectionQuery(a,h,c,d).next(a=>{a.forEach((a,b)=>{f=f.insert(a,b)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(a,b,c,d){let e;return this.documentOverlayCache.getOverlaysForCollection(a,b.path,c.largestBatchId).next(f=>(e=f,this.remoteDocumentCache.getDocumentsMatchingQuery(a,b,c,e,d))).next(a=>{e.forEach((b,c)=>{let d=c.getKey();null===a.get(d)&&(a=a.insert(d,kT.newInvalidDocument(d)))});let c=l8();return a.forEach((a,d)=>{let f=e.get(a);void 0!==f&&mK(f.mutation,d,jF.empty(),hA.now()),lY(b,d)&&(c=c.insert(a,d))}),c})}}class qR{constructor(a){this.serializer=a,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(a,b){return hU.resolve(this.bundles.get(b))}saveBundleMetadata(a,b){return this.bundles.set(b.id,oY(b)),hU.resolve()}getNamedQuery(a,b){return hU.resolve(this.namedQueries.get(b))}saveNamedQuery(a,b){return this.namedQueries.set(b.name,oX(b)),hU.resolve()}}class qS{constructor(){this.overlays=new jx(hn.comparator),this.overlayByBatchId=new Map}getOverlay(a,b){return hU.resolve(this.overlays.get(b))}getOverlays(a,b){let c=mb();return hU.forEach(b,b=>this.getOverlay(a,b).next(a=>{null!==a&&c.set(b,a)})).next(()=>c)}saveOverlays(a,b,c){return c.forEach((c,d)=>{this.saveOverlay(a,b,d)}),hU.resolve()}removeOverlaysForBatchId(a,b,c){let d=this.overlayByBatchId.get(c);return void 0!==d&&(d.forEach(a=>this.overlays=this.overlays.remove(a)),this.overlayByBatchId.delete(c)),hU.resolve()}getOverlaysForCollection(a,b,c){let d=mb(),e=b.length+1,f=new hn(b.child("")),g=this.overlays.getIteratorFrom(f);for(;g.hasNext();){let a=g.getNext().value,f=a.getKey();if(!b.isPrefixOf(f.path))break;f.path.length===e&&a.largestBatchId>c&&d.set(a.getKey(),a)}return hU.resolve(d)}getOverlaysForCollectionGroup(a,b,c,d){let e=new jx((a,b)=>a-b),f=this.overlays.getIterator();for(;f.hasNext();){let a=f.getNext().value;if(a.getKey().getCollectionGroup()===b&&a.largestBatchId>c){let b=e.get(a.largestBatchId);null===b&&(b=mb(),e=e.insert(a.largestBatchId,b)),b.set(a.getKey(),a)}}let g=mb(),h=e.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((a,b)=>g.set(a,b)),!(g.size()>=d)););return hU.resolve(g)}saveOverlay(a,b,c){let d=this.overlays.get(c.key);if(null!==d){let a=this.overlayByBatchId.get(d.largestBatchId).delete(c.key);this.overlayByBatchId.set(d.largestBatchId,a)}this.overlays=this.overlays.insert(c.key,new m0(b,c));let e=this.overlayByBatchId.get(b);void 0===e&&(e=mh(),this.overlayByBatchId.set(b,e)),this.overlayByBatchId.set(b,e.add(c.key))}}class qT{constructor(){this.sessionToken=jI.EMPTY_BYTE_STRING}getSessionToken(a){return hU.resolve(this.sessionToken)}setSessionToken(a,b){return this.sessionToken=b,hU.resolve()}}class qU{constructor(){this.refsByKey=new jB(qV.compareByKey),this.refsByTarget=new jB(qV.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(a,b){let c=new qV(a,b);this.refsByKey=this.refsByKey.add(c),this.refsByTarget=this.refsByTarget.add(c)}addReferences(a,b){a.forEach(a=>this.addReference(a,b))}removeReference(a,b){this.removeRef(new qV(a,b))}removeReferences(a,b){a.forEach(a=>this.removeReference(a,b))}removeReferencesForId(a){let b=new hn(new hk([])),c=new qV(b,a),d=new qV(b,a+1),e=[];return this.refsByTarget.forEachInRange([c,d],a=>{this.removeRef(a),e.push(a.key)}),e}removeAllReferences(){this.refsByKey.forEach(a=>this.removeRef(a))}removeRef(a){this.refsByKey=this.refsByKey.delete(a),this.refsByTarget=this.refsByTarget.delete(a)}referencesForId(a){let b=new hn(new hk([])),c=new qV(b,a),d=new qV(b,a+1),e=mh();return this.refsByTarget.forEachInRange([c,d],a=>{e=e.add(a.key)}),e}containsKey(a){let b=new qV(a,0),c=this.refsByKey.firstAfterOrEqual(b);return null!==c&&a.isEqual(c.key)}}class qV{constructor(a,b){this.key=a,this.targetOrBatchId=b}static compareByKey(a,b){return hn.comparator(a.key,b.key)||hb(a.targetOrBatchId,b.targetOrBatchId)}static compareByTargetId(a,b){return hb(a.targetOrBatchId,b.targetOrBatchId)||hn.comparator(a.key,b.key)}}class qW{constructor(a,b){this.indexManager=a,this.referenceDelegate=b,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new jB(qV.compareByKey)}checkEmpty(a){return hU.resolve(0===this.mutationQueue.length)}addMutationBatch(a,b,c,d){let e=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let f=new m$(e,b,c,d);for(let b of(this.mutationQueue.push(f),d))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new qV(b.key,e)),this.indexManager.addToCollectionParentIndex(a,b.key.path.popLast());return hU.resolve(f)}lookupMutationBatch(a,b){return hU.resolve(this.findMutationBatch(b))}getNextMutationBatchAfterBatchId(a,b){let c=b+1,d=this.indexOfBatchId(c),e=d<0?0:d;return hU.resolve(this.mutationQueue.length>e?this.mutationQueue[e]:null)}getHighestUnacknowledgedBatchId(){return hU.resolve(0===this.mutationQueue.length?j_:this.nextBatchId-1)}getAllMutationBatches(a){return hU.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(a,b){let c=new qV(b,0),d=new qV(b,1/0),e=[];return this.batchesByDocumentKey.forEachInRange([c,d],a=>{let b=this.findMutationBatch(a.targetOrBatchId);e.push(b)}),hU.resolve(e)}getAllMutationBatchesAffectingDocumentKeys(a,b){let c=new jB(hb);return b.forEach(a=>{let b=new qV(a,0),d=new qV(a,1/0);this.batchesByDocumentKey.forEachInRange([b,d],a=>{c=c.add(a.targetOrBatchId)})}),hU.resolve(this.findMutationBatches(c))}getAllMutationBatchesAffectingQuery(a,b){let c=b.path,d=c.length+1,e=c;hn.isDocumentKey(e)||(e=e.child(""));let f=new qV(new hn(e),0),g=new jB(hb);return this.batchesByDocumentKey.forEachWhile(a=>{let b=a.key.path;return!!c.isPrefixOf(b)&&(b.length===d&&(g=g.add(a.targetOrBatchId)),!0)},f),hU.resolve(this.findMutationBatches(g))}findMutationBatches(a){let b=[];return a.forEach(a=>{let c=this.findMutationBatch(a);null!==c&&b.push(c)}),b}removeMutationBatch(a,b){gH(0===this.indexOfExistingBatchId(b.batchId,"removed"),55003),this.mutationQueue.shift();let c=this.batchesByDocumentKey;return hU.forEach(b.mutations,d=>{let e=new qV(d.key,b.batchId);return c=c.delete(e),this.referenceDelegate.markPotentiallyOrphaned(a,d.key)}).next(()=>{this.batchesByDocumentKey=c})}removeCachedMutationKeys(a){}containsKey(a,b){let c=new qV(b,0),d=this.batchesByDocumentKey.firstAfterOrEqual(c);return hU.resolve(b.isEqual(d&&d.key))}performConsistencyCheck(a){return this.mutationQueue.length,hU.resolve()}indexOfExistingBatchId(a,b){return this.indexOfBatchId(a)}indexOfBatchId(a){return 0===this.mutationQueue.length?0:a-this.mutationQueue[0].batchId}findMutationBatch(a){let b=this.indexOfBatchId(a);return b<0||b>=this.mutationQueue.length?null:this.mutationQueue[b]}}let qX="-9223372036854775808";function qY(){return new jx(hn.comparator)}class qZ{constructor(a){this.sizer=a,this.docs=qY(),this.size=0}setIndexManager(a){this.indexManager=a}addEntry(a,b){let c=b.key,d=this.docs.get(c),e=d?d.size:0,f=this.sizer(b);return this.docs=this.docs.insert(c,{document:b.mutableCopy(),size:f}),this.size+=f-e,this.indexManager.addToCollectionParentIndex(a,c.path.popLast())}removeEntry(a){let b=this.docs.get(a);b&&(this.docs=this.docs.remove(a),this.size-=b.size)}getEntry(a,b){let c=this.docs.get(b);return hU.resolve(c?c.document.mutableCopy():kT.newInvalidDocument(b))}getEntries(a,b){let c=l6();return b.forEach(a=>{let b=this.docs.get(a);c=c.insert(a,b?b.document.mutableCopy():kT.newInvalidDocument(a))}),hU.resolve(c)}getDocumentsMatchingQuery(a,b,c,d){let e=l6(),f=b.path,g=new hn(f.child("__id"+qX+"__")),h=this.docs.getIteratorFrom(g);for(;h.hasNext();){let{key:a,value:{document:g}}=h.getNext();if(!f.isPrefixOf(a.path))break;!(a.path.length>f.length+1||0>=hQ(hO(g),c))&&(d.has(g.key)||lY(b,g))&&(e=e.insert(g.key,g.mutableCopy()))}return hU.resolve(e)}getAllFromCollectionGroup(a,b,c,d){gF(9500)}forEachDocumentKey(a,b){return hU.forEach(this.docs,a=>b(a))}newChangeBuffer(a){return new q_(this)}getSize(a){return hU.resolve(this.size)}}function q$(a){return new qZ(a)}class q_ extends qE{constructor(a){super(),this.documentCache=a}applyChanges(a){let b=[];return this.changes.forEach((c,d)=>{d.isValidDocument()?b.push(this.documentCache.addEntry(a,d)):this.documentCache.removeEntry(c)}),hU.waitFor(b)}getFromCache(a,b){return this.documentCache.getEntry(a,b)}getAllFromCache(a,b){return this.documentCache.getEntries(a,b)}}class q0{constructor(a){this.persistence=a,this.targets=new l4(a=>lr(a),lt),this.lastRemoteSnapshotVersion=hB.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new qU,this.targetCount=0,this.targetIdGenerator=qi.forTargetCache()}forEachTarget(a,b){return this.targets.forEach((a,c)=>b(c)),hU.resolve()}getLastRemoteSnapshotVersion(a){return hU.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(a){return hU.resolve(this.highestSequenceNumber)}allocateTargetId(a){return this.highestTargetId=this.targetIdGenerator.next(),hU.resolve(this.highestTargetId)}setTargetsMetadata(a,b,c){return c&&(this.lastRemoteSnapshotVersion=c),b>this.highestSequenceNumber&&(this.highestSequenceNumber=b),hU.resolve()}saveTargetData(a){this.targets.set(a.target,a);let b=a.targetId;b>this.highestTargetId&&(this.targetIdGenerator=new qi(b),this.highestTargetId=b),a.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=a.sequenceNumber)}addTargetData(a,b){return this.saveTargetData(b),this.targetCount+=1,hU.resolve()}updateTargetData(a,b){return this.saveTargetData(b),hU.resolve()}removeTargetData(a,b){return this.targets.delete(b.target),this.references.removeReferencesForId(b.targetId),this.targetCount-=1,hU.resolve()}removeTargets(a,b,c){let d=0,e=[];return this.targets.forEach((f,g)=>{g.sequenceNumber<=b&&null===c.get(g.targetId)&&(this.targets.delete(f),e.push(this.removeMatchingKeysForTargetId(a,g.targetId)),d++)}),hU.waitFor(e).next(()=>d)}getTargetCount(a){return hU.resolve(this.targetCount)}getTargetData(a,b){let c=this.targets.get(b)||null;return hU.resolve(c)}addMatchingKeys(a,b,c){return this.references.addReferences(b,c),hU.resolve()}removeMatchingKeys(a,b,c){this.references.removeReferences(b,c);let d=this.persistence.referenceDelegate,e=[];return d&&b.forEach(b=>{e.push(d.markPotentiallyOrphaned(a,b))}),hU.waitFor(e)}removeMatchingKeysForTargetId(a,b){return this.references.removeReferencesForId(b),hU.resolve()}getMatchingKeysForTargetId(a,b){let c=this.references.referencesForId(b);return hU.resolve(c)}containsKey(a,b){return hU.resolve(this.references.containsKey(b))}}let q1="MemoryPersistence";class q2{constructor(a,b){this.mutationQueues={},this.overlays={},this.listenSequence=new ib(0),this._started=!1,this._started=!0,this.globalsCache=new qT,this.referenceDelegate=a(this),this.targetCache=new q0(this);const c=a=>this.referenceDelegate.documentSize(a);this.indexManager=new p_,this.remoteDocumentCache=q$(c),this.serializer=new oG(b),this.bundleCache=new qR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(a){return this.indexManager}getDocumentOverlayCache(a){let b=this.overlays[a.toKey()];return b||(b=new qS,this.overlays[a.toKey()]=b),b}getMutationQueue(a,b){let c=this.mutationQueues[a.toKey()];return c||(c=new qW(b,this.referenceDelegate),this.mutationQueues[a.toKey()]=c),c}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){gB(q1,"Starting transaction:",a);let d=new q3(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),c(d).next(a=>this.referenceDelegate.onTransactionCommitted(d).next(()=>a)).toPromise().then(a=>(d.raiseOnCommittedEvent(),a))}mutationQueuesContainKey(a,b){return hU.or(Object.values(this.mutationQueues).map(c=>()=>c.containsKey(a,b)))}}class q3 extends hS{constructor(a){super(),this.currentSequenceNumber=a}}class q4{constructor(a){this.persistence=a,this.localViewReferences=new qU,this._orphanedDocuments=null}static factory(a){return new q4(a)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw gF(60996)}addReference(a,b,c){return this.localViewReferences.addReference(c,b),this.orphanedDocuments.delete(c.toString()),hU.resolve()}removeReference(a,b,c){return this.localViewReferences.removeReference(c,b),this.orphanedDocuments.add(c.toString()),hU.resolve()}markPotentiallyOrphaned(a,b){return this.orphanedDocuments.add(b.toString()),hU.resolve()}removeTarget(a,b){this.localViewReferences.removeReferencesForId(b.targetId).forEach(a=>this.orphanedDocuments.add(a.toString()));let c=this.persistence.getTargetCache();return c.getMatchingKeysForTargetId(a,b.targetId).next(a=>{a.forEach(a=>this.orphanedDocuments.add(a.toString()))}).next(()=>c.removeTargetData(a,b))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(a){let b=this.persistence.getRemoteDocumentCache().newChangeBuffer();return hU.forEach(this.orphanedDocuments,c=>{let d=hn.fromPath(c);return this.isReferenced(a,d).next(a=>{a||b.removeEntry(d,hB.min())})}).next(()=>(this._orphanedDocuments=null,b.apply(a)))}updateLimboDocument(a,b){return this.isReferenced(a,b).next(a=>{a?this.orphanedDocuments.delete(b.toString()):this.orphanedDocuments.add(b.toString())})}documentSize(a){return 0}isReferenced(a,b){return hU.or([()=>hU.resolve(this.localViewReferences.containsKey(b)),()=>this.persistence.getTargetCache().containsKey(a,b),()=>this.persistence.mutationQueuesContainKey(a,b)])}}class q5{constructor(a,b){this.persistence=a,this.orphanedSequenceNumbers=new l4(a=>ih(a.path),(a,b)=>a.isEqual(b)),this.garbageCollector=qz(this,b)}static factory(a,b){return new q5(a,b)}onTransactionStarted(){}onTransactionCommitted(a){return hU.resolve()}forEachTarget(a,b){return this.persistence.getTargetCache().forEachTarget(a,b)}getSequenceNumberCount(a){let b=this.orphanedDocumentCount(a);return this.persistence.getTargetCache().getTargetCount(a).next(a=>b.next(b=>a+b))}orphanedDocumentCount(a){let b=0;return this.forEachOrphanedDocumentSequenceNumber(a,a=>{b++}).next(()=>b)}forEachOrphanedDocumentSequenceNumber(a,b){return hU.forEach(this.orphanedSequenceNumbers,(c,d)=>this.isPinned(a,c,d).next(a=>a?hU.resolve():b(d)))}removeTargets(a,b,c){return this.persistence.getTargetCache().removeTargets(a,b,c)}removeOrphanedDocuments(a,b){let c=0,d=this.persistence.getRemoteDocumentCache(),e=d.newChangeBuffer();return d.forEachDocumentKey(a,d=>this.isPinned(a,d,b).next(a=>{a||(c++,e.removeEntry(d,hB.min()))})).next(()=>e.apply(a)).next(()=>c)}markPotentiallyOrphaned(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),hU.resolve()}removeTarget(a,b){let c=b.withSequenceNumber(a.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(a,c)}addReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),hU.resolve()}removeReference(a,b,c){return this.orphanedSequenceNumbers.set(c,a.currentSequenceNumber),hU.resolve()}updateLimboDocument(a,b){return this.orphanedSequenceNumbers.set(b,a.currentSequenceNumber),hU.resolve()}documentSize(a){let b=a.key.toString().length;return a.isFoundDocument()&&(b+=ky(a.data.value)),b}isPinned(a,b,c){return hU.or([()=>this.persistence.mutationQueuesContainKey(a,b),()=>this.persistence.getTargetCache().containsKey(a,b),()=>{let a=this.orphanedSequenceNumbers.get(b);return hU.resolve(void 0!==a&&a>c)}])}getCacheSize(a){return this.persistence.getRemoteDocumentCache().getSize(a)}}class q6{constructor(a){this.serializer=a}createOrUpgrade(a,b,c,d){let e=new hX("createOrUpgrade",b);c<1&&d>=1&&(q8(a),q9(a),re(a),rb(a));let f=hU.resolve();return c<3&&d>=3&&(0!==c&&(rf(a),re(a)),f=f.next(()=>rh(e))),c<4&&d>=4&&(0!==c&&(f=f.next(()=>ra(a,e))),f=f.next(()=>{ri(a)})),c<5&&d>=5&&(f=f.next(()=>this.removeAcknowledgedMutations(e))),c<6&&d>=6&&(f=f.next(()=>(rd(a),this.addDocumentGlobal(e)))),c<7&&d>=7&&(f=f.next(()=>this.ensureSequenceNumbers(e))),c<8&&d>=8&&(f=f.next(()=>this.createCollectionParentIndex(a,e))),c<9&&d>=9&&(f=f.next(()=>{rg(a)})),c<10&&d>=10&&(f=f.next(()=>this.rewriteCanonicalIds(e))),c<11&&d>=11&&(f=f.next(()=>{rj(a),rk(a)})),c<12&&d>=12&&(f=f.next(()=>{rm(a)})),c<13&&d>=13&&(f=f.next(()=>rc(a)).next(()=>this.rewriteRemoteDocumentCache(a,e)).next(()=>a.deleteObjectStore(il))),c<14&&d>=14&&(f=f.next(()=>this.runOverlayMigration(a,e))),c<15&&d>=15&&(f=f.next(()=>rl(a))),c<16&&d>=16&&(f=f.next(()=>{b.objectStore(i2).clear()}).next(()=>{b.objectStore(i6).clear()})),c<17&&d>=17&&(f=f.next(()=>{rn(a)})),c<18&&d>=18&&eW()&&(f=f.next(()=>{b.objectStore(i2).clear()}).next(()=>{b.objectStore(i6).clear()})),f}addDocumentGlobal(a){let b=0;return a.store(il).iterate((a,c)=>{b+=qa(c)}).next(()=>{let c={byteSize:b};return a.store(iG).put(iH,c)})}removeAcknowledgedMutations(a){let b=a.store(ip),c=a.store(ir);return b.loadAll().next(b=>hU.forEach(b,b=>{let d=IDBKeyRange.bound([b.userId,j_],[b.userId,b.lastAcknowledgedBatchId]);return c.loadAll(it,d).next(c=>hU.forEach(c,c=>{gH(c.userId===b.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let d=oO(this.serializer,c);return p9(a,b.userId,d).next(()=>{})}))}))}ensureSequenceNumbers(a){let b=a.store(iM),c=a.store(il);return a.store(iR).get(iQ).next(a=>{let d=c=>b.put({targetId:0,path:ih(c),sequenceNumber:a.highestListenSequenceNumber}),e=[];return c.iterate((a,c)=>{let f=new hk(a),g=q7(f);e.push(b.get(g).next(a=>a?hU.resolve():d(f)))}).next(()=>hU.waitFor(e))})}createCollectionParentIndex(a,b){a.createObjectStore(iS,{keyPath:iT});let c=b.store(iS),d=new p0,e=a=>{if(d.add(a)){let b=a.lastSegment(),d=a.popLast();return c.put({collectionId:b,parent:ih(d)})}};return b.store(il).iterate({keysOnly:!0},(a,b)=>e(new hk(a).popLast())).next(()=>b.store(iz).iterate({keysOnly:!0},([a,b,c],d)=>e(ik(b).popLast())))}rewriteCanonicalIds(a){let b=a.store(iI);return b.iterate((a,c)=>{let d=oP(c),e=oQ(this.serializer,d);return b.put(e)})}rewriteRemoteDocumentCache(a,b){let c=b.store(il),d=[];return c.iterate((a,c)=>{let e=b.store(iA),f=ro(c).path.toArray(),g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};d.push(e.put(g))}).next(()=>hU.waitFor(d))}runOverlayMigration(a,b){let c=b.store(ir),d=qG(this.serializer),e=new q2(q4.factory,this.serializer.remoteSerializer);return c.loadAll().next(a=>{let c=new Map;return a.forEach(a=>{let b=c.get(a.userId)??mh();oO(this.serializer,a).keys().forEach(a=>b=b.add(a)),c.set(a.userId,b)}),hU.forEach(c,(a,c)=>{let f=new gv(c),g=o6.forUser(this.serializer,f),h=e.getIndexManager(f);return new qQ(d,qb.forUser(f,this.serializer,h,e.referenceDelegate),g,h).recalculateAndSaveOverlaysForDocumentKeys(new jr(b,ib.INVALID),a).next()})})}}function q7(a){return[0,ih(a)]}function q8(a){a.createObjectStore(im)}function q9(a){a.createObjectStore(ip,{keyPath:iq}),a.createObjectStore(ir,{keyPath:is,autoIncrement:!0}).createIndex(it,iu,{unique:!0}),a.createObjectStore(iz)}function ra(a,b){return b.store(ir).loadAll().next(c=>{a.deleteObjectStore(ir),a.createObjectStore(ir,{keyPath:is,autoIncrement:!0}).createIndex(it,iu,{unique:!0});let d=b.store(ir),e=c.map(a=>d.put(a));return hU.waitFor(e)})}function rb(a){a.createObjectStore(il)}function rc(a){let b=a.createObjectStore(iA,{keyPath:iB});b.createIndex(iC,iD),b.createIndex(iE,iF)}function rd(a){a.createObjectStore(iG)}function re(a){a.createObjectStore(iM,{keyPath:iN}).createIndex(iO,iP,{unique:!0}),a.createObjectStore(iI,{keyPath:iJ}).createIndex(iK,iL,{unique:!0}),a.createObjectStore(iR)}function rf(a){a.deleteObjectStore(iM),a.deleteObjectStore(iI),a.deleteObjectStore(iR)}function rg(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}function rh(a){let b=a.store(iR),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:hB.min().toTimestamp(),targetCount:0};return b.put(iQ,c)}function ri(a){a.createObjectStore(iU,{keyPath:iV})}function rj(a){a.createObjectStore(iW,{keyPath:iX})}function rk(a){a.createObjectStore(iY,{keyPath:iZ})}function rl(a){a.createObjectStore(i$,{keyPath:i_,autoIncrement:!0}).createIndex(i0,i1,{unique:!1}),a.createObjectStore(i2,{keyPath:i3}).createIndex(i4,i5,{unique:!1}),a.createObjectStore(i6,{keyPath:i7}).createIndex(i8,i9,{unique:!1})}function rm(a){let b=a.createObjectStore(ja,{keyPath:jb});b.createIndex(jc,jd,{unique:!1}),b.createIndex(je,jf,{unique:!1})}function rn(a){a.createObjectStore(jg,{keyPath:jh})}function ro(a){return a.document?new hn(hk.fromString(a.document.name).popFirst(5)):a.noDocument?hn.fromSegments(a.noDocument.path):a.unknownDocument?hn.fromSegments(a.unknownDocument.path):gF(36783)}let rp="IndexedDbPersistence",rq=18e5,rr=5e3,rs=4e3,rt="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ru="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",rv="firestore_zombie",rw="main";class rx{constructor(a,b,c,d,e,f,g,h,i,j,k=qO){if(this.allowTabSynchronization=a,this.persistenceKey=b,this.clientId=c,this.queue=e,this.window=f,this.document=g,this.sequenceNumberSyncer=i,this.forceOwningTab=j,this.schemaVersion=k,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=-1/0,this.primaryStateListener=a=>Promise.resolve(),!rx.isAvailable())throw new g$(gW,ru);this.referenceDelegate=new qA(this,d),this.dbName=b+rw,this.serializer=new oG(h),this.simpleDb=new hY(this.dbName,this.schemaVersion,new q6(this.serializer)),this.globalsCache=new o8,this.targetCache=new qj(this.referenceDelegate,this.serializer),this.remoteDocumentCache=qG(this.serializer),this.bundleCache=new o3,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===j&&gC(rp,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new g$(gT,rt);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",a=>this.targetCache.getHighestSequenceNumber(a))}).then(a=>{this.listenSequence=new ib(a,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(a=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(a)))}setPrimaryStateListener(a){return this.primaryStateListener=async b=>{if(this.started)return a(b)},a(this.isPrimary)}setDatabaseDeletedListener(a){this.simpleDb.setVersionChangeListener(async b=>{null===b.newVersion&&await a()})}setNetworkEnabled(a){this.networkEnabled!==a&&(this.networkEnabled=a,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",a=>rz(a).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(a).next(a=>{a||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(a)).next(b=>this.isPrimary&&!b?this.releasePrimaryLeaseIfHeld(a).next(()=>!1):!!b&&this.acquireOrExtendPrimaryLease(a).next(()=>!0))).catch(a=>{if(h0(a))return gB(rp,"Failed to extend owner lease: ",a),this.isPrimary;if(!this.allowTabSynchronization)throw a;return gB(rp,"Releasing owner lease after error during lease refresh",a),!1}).then(a=>{this.isPrimary!==a&&this.queue.enqueueRetryable(()=>this.primaryStateListener(a)),this.isPrimary=a})}verifyPrimaryLease(a){return ry(a).get(io).next(a=>hU.resolve(this.isLocalClient(a)))}removeClientMetadata(a){return rz(a).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,rq)){this.lastGarbageCollectionTime=Date.now();let a=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",a=>{let b=js(a,iU);return b.loadAll().next(a=>{let c=this.filterActiveClients(a,rq),d=a.filter(a=>-1===c.indexOf(a));return hU.forEach(d,a=>b.delete(a.clientId)).next(()=>d)})}).catch(()=>[]);if(this.webStorage)for(let b of a)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(b.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",rs,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(a){return!!a&&a.ownerId===this.clientId}canActAsPrimary(a){return this.forceOwningTab?hU.resolve(!0):ry(a).get(io).next(b=>{if(null!==b&&this.isWithinAge(b.leaseTimestampMs,rr)&&!this.isClientZombied(b.ownerId)){if(this.isLocalClient(b)&&this.networkEnabled)return!0;if(!this.isLocalClient(b)){if(!b.allowTabSynchronization)throw new g$(gT,rt);return!1}}return!!this.networkEnabled&&!!this.inForeground||rz(a).loadAll().next(a=>void 0===this.filterActiveClients(a,rr).find(a=>{if(this.clientId!==a.clientId){let b=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,d=this.networkEnabled===a.networkEnabled;if(b||c&&d)return!0}return!1}))}).next(a=>(this.isPrimary!==a&&gB(rp,`Client ${a?"is":"is not"} eligible for a primary lease.`),a))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[im,iU],a=>{let b=new jr(a,ib.INVALID);return this.releasePrimaryLeaseIfHeld(b).next(()=>this.removeClientMetadata(b))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(a,b){return a.filter(a=>this.isWithinAge(a.updateTimeMs,b)&&!this.isClientZombied(a.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",a=>rz(a).loadAll().next(a=>this.filterActiveClients(a,rq).map(a=>a.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(a,b){return qb.forUser(a,this.serializer,b,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(a){return new p3(a,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(a){return o6.forUser(this.serializer,a)}getBundleCache(){return this.bundleCache}runTransaction(a,b,c){let d;gB(rp,"Starting transaction:",a);let e="readonly"===b?"readonly":"readwrite",f=jq(this.schemaVersion);return this.simpleDb.runTransaction(a,e,f,e=>(d=new jr(e,this.listenSequence?this.listenSequence.next():ib.INVALID),"readwrite-primary"===b)?this.verifyPrimaryLease(d).next(a=>!!a||this.canActAsPrimary(d)).next(b=>{if(!b)throw gC(`Failed to obtain primary lease for action '${a}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new g$(gT,hR);return c(d)}).next(a=>this.acquireOrExtendPrimaryLease(d).next(()=>a)):this.verifyAllowTabSynchronization(d).next(()=>c(d))).then(a=>(d.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(a){return ry(a).get(io).next(a=>{if(null!==a&&this.isWithinAge(a.leaseTimestampMs,rr)&&!this.isClientZombied(a.ownerId)&&!this.isLocalClient(a)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!a.allowTabSynchronization))throw new g$(gT,rt)})}acquireOrExtendPrimaryLease(a){let b={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ry(a).put(io,b)}static isAvailable(){return hY.isAvailable()}releasePrimaryLeaseIfHeld(a){let b=ry(a);return b.get(io).next(a=>this.isLocalClient(a)?(gB(rp,"Releasing primary lease."),b.delete(io)):hU.resolve())}isWithinAge(a,b){let c=Date.now(),d=c-b,e=c;return!(a<d)&&(!(a>e)||(gC(`Detected an update time that is in the future: ${a} > ${e}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let a=/(?:Version|Mobile)\/1[456]/;eV()&&(navigator.appVersion.match(a)||navigator.userAgent.match(a))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(a){try{let b=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(a))!==null;return gB(rp,`Client '${a}' ${b?"is":"is not"} zombied in LocalStorage`),b}catch(a){return gC(rp,"Failed to get zombied client id.",a),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(a){gC("Failed to set zombie client id.",a)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(a){}}zombiedClientLocalStorageKey(a){return`${rv}_${this.persistenceKey}_${a}`}}function ry(a){return js(a,im)}function rz(a){return js(a,iU)}function rA(a,b){let c=a.projectId;return a.isDefaultDatabase||(c+="."+a.database),"firestore/"+b+"/"+c+"/"}function rB(a,b,c,d,e){b=[...b],(a=[...a]).sort(c),b.sort(c);let f=a.length,g=b.length,h=0,i=0;for(;h<g&&i<f;){let f=c(a[i],b[h]);f<0?e(a[i++]):f>0?d(b[h++]):(h++,i++)}for(;h<g;)d(b[h++]);for(;i<f;)e(a[i++])}function rC(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}let rD="LocalStore",rE=3e8;class rF{constructor(a,b,c,d){this.persistence=a,this.queryEngine=b,this.serializer=d,this.targetDataByTarget=new jx(hb),this.targetIdByTarget=new l4(a=>lr(a),lt),this.collectionGroupReadTime=new Map,this.remoteDocuments=a.getRemoteDocumentCache(),this.targetCache=a.getTargetCache(),this.bundleCache=a.getBundleCache(),this.initializeUserComponents(c)}initializeUserComponents(a){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(a),this.indexManager=this.persistence.getIndexManager(a),this.mutationQueue=this.persistence.getMutationQueue(a,this.indexManager),this.localDocuments=new qQ(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(a){return this.persistence.runTransaction("Collect garbage","readwrite-primary",b=>a.collect(b,this.targetDataByTarget))}}function rG(a,b,c,d){return new rF(a,b,c,d)}async function rH(a,b){let c=gI(a);return await c.persistence.runTransaction("Handle user change","readonly",a=>{let d;return c.mutationQueue.getAllMutationBatches(a).next(e=>(d=e,c.initializeUserComponents(b),c.mutationQueue.getAllMutationBatches(a))).next(b=>{let e=[],f=[],g=mh();for(let a of d)for(let b of(e.push(a.batchId),a.mutations))g=g.add(b.key);for(let a of b)for(let b of(f.push(a.batchId),a.mutations))g=g.add(b.key);return c.localDocuments.getDocuments(a,g).next(a=>({affectedDocuments:a,removedBatchIds:e,addedBatchIds:f}))})})}function rI(a,b){let c,d,e=gI(a),f=hA.now(),g=b.reduce((a,b)=>a.add(b.key),mh());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let h=l6(),i=mh();return e.remoteDocuments.getEntries(a,g).next(a=>{(h=a).forEach((a,b)=>{b.isValidDocument()||(i=i.add(a))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,h)).next(d=>{c=d;let g=[];for(let a of b){let b=mL(a,c.get(a.key).overlayedDocument);null!=b&&g.push(new mQ(a.key,b,kS(b.value.mapValue),mF.exists(!0)))}return e.mutationQueue.addMutationBatch(a,f,g,b)}).next(b=>{d=b;let f=b.applyToLocalDocumentSet(c,i);return e.documentOverlayCache.saveOverlays(a,b.batchId,f)})}).then(()=>({batchId:d.batchId,changes:ma(c)}))}function rJ(a,b){let c=gI(a);return c.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{let d=b.batch.keys(),e=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});return rX(c,a,b,e).next(()=>e.apply(a)).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b.batch.batchId)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,rK(b))).next(()=>c.localDocuments.getDocuments(a,d))})}function rK(a){let b=mh();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(b=b.add(a.batch.mutations[c].key));return b}function rL(a,b){let c=gI(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",a=>{let d;return c.mutationQueue.lookupMutationBatch(a,b).next(b=>(gH(null!==b,37113),d=b.keys(),c.mutationQueue.removeMutationBatch(a,b))).next(()=>c.mutationQueue.performConsistencyCheck(a)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(a,d,b)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,d)).next(()=>c.localDocuments.getDocuments(a,d))})}function rM(a){let b=gI(a);return b.persistence.runTransaction("Get last remote snapshot version","readonly",a=>b.targetCache.getLastRemoteSnapshotVersion(a))}function rN(a,b){let c=gI(a),d=b.snapshotVersion,e=c.targetDataByTarget;return c.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{let f=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});e=c.targetDataByTarget;let g=[];b.targetChanges.forEach((f,h)=>{let i=e.get(h);if(!i)return;g.push(c.targetCache.removeMatchingKeys(a,f.removedDocuments,h).next(()=>c.targetCache.addMatchingKeys(a,f.addedDocuments,h)));let j=i.withSequenceNumber(a.currentSequenceNumber);null!==b.targetMismatches.get(h)?j=j.withResumeToken(jI.EMPTY_BYTE_STRING,hB.min()).withLastLimboFreeSnapshotVersion(hB.min()):f.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(f.resumeToken,d)),e=e.insert(h,j),rP(i,j,f)&&g.push(c.targetCache.updateTargetData(a,j))});let h=l6(),i=mh();if(b.documentUpdates.forEach(d=>{b.resolvedLimboDocuments.has(d)&&g.push(c.persistence.referenceDelegate.updateLimboDocument(a,d))}),g.push(rO(a,f,b.documentUpdates).next(a=>{h=a.changedDocuments,i=a.existenceChangedKeys})),!d.isEqual(hB.min())){let b=c.targetCache.getLastRemoteSnapshotVersion(a).next(b=>c.targetCache.setTargetsMetadata(a,a.currentSequenceNumber,d));g.push(b)}return hU.waitFor(g).next(()=>f.apply(a)).next(()=>c.localDocuments.getLocalViewOfDocuments(a,h,i)).next(()=>h)}).then(a=>(c.targetDataByTarget=e,a))}function rO(a,b,c){let d=mh(),e=mh();return c.forEach(a=>d=d.add(a)),b.getEntries(a,d).next(a=>{let d=l6();return c.forEach((c,f)=>{let g=a.get(c);f.isFoundDocument()!==g.isFoundDocument()&&(e=e.add(c)),f.isNoDocument()&&f.version.isEqual(hB.min())?(b.removeEntry(c,f.readTime),d=d.insert(c,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||0===f.version.compareTo(g.version)&&g.hasPendingWrites?(b.addEntry(f),d=d.insert(c,f)):gB(rD,"Ignoring outdated watch update for ",c,". Current version:",g.version," Watch version:",f.version)}),{changedDocuments:d,existenceChangedKeys:e}})}function rP(a,b,c){return!!(0===a.resumeToken.approximateByteSize()||b.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=rE)||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0}async function rQ(a,b){let c=gI(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",a=>hU.forEach(b,b=>hU.forEach(b.addedKeys,d=>c.persistence.referenceDelegate.addReference(a,b.targetId,d)).next(()=>hU.forEach(b.removedKeys,d=>c.persistence.referenceDelegate.removeReference(a,b.targetId,d)))))}catch(a){if(h0(a))gB(rD,"Failed to update sequence numbers: "+a);else throw a}for(let a of b){let b=a.targetId;if(!a.fromCache){let a=c.targetDataByTarget.get(b),d=a.snapshotVersion,e=a.withLastLimboFreeSnapshotVersion(d);c.targetDataByTarget=c.targetDataByTarget.insert(b,e)}}}function rR(a,b){let c=gI(a);return c.persistence.runTransaction("Get next mutation batch","readonly",a=>(void 0===b&&(b=j_),c.mutationQueue.getNextMutationBatchAfterBatchId(a,b)))}function rS(a,b){let c=gI(a);return c.persistence.runTransaction("read document","readonly",a=>c.localDocuments.getDocument(a,b))}function rT(a,b){let c=gI(a);return c.persistence.runTransaction("Allocate target","readwrite",a=>{let d;return c.targetCache.getTargetData(a,b).next(e=>e?(d=e,hU.resolve(d)):c.targetCache.allocateTargetId(a).next(e=>(d=new oF(b,e,"TargetPurposeListen",a.currentSequenceNumber),c.targetCache.addTargetData(a,d).next(()=>d))))}).then(a=>{let d=c.targetDataByTarget.get(a.targetId);return(null===d||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(c.targetDataByTarget=c.targetDataByTarget.insert(a.targetId,a),c.targetIdByTarget.set(b,a.targetId)),a})}function rU(a,b,c){let d=gI(a),e=d.targetIdByTarget.get(c);return void 0!==e?hU.resolve(d.targetDataByTarget.get(e)):d.targetCache.getTargetData(b,c)}async function rV(a,b,c){let d=gI(a),e=d.targetDataByTarget.get(b),f=c?"readwrite":"readwrite-primary";try{c||await d.persistence.runTransaction("Release target",f,a=>d.persistence.referenceDelegate.removeTarget(a,e))}catch(a){if(h0(a))gB(rD,`Failed to update sequence numbers for target ${b}: ${a}`);else throw a}d.targetDataByTarget=d.targetDataByTarget.remove(b),d.targetIdByTarget.delete(e.target)}function rW(a,b,c){let d=gI(a),e=hB.min(),f=mh();return d.persistence.runTransaction("Execute query","readwrite",a=>rU(d,a,lN(b)).next(b=>{if(b)return e=b.lastLimboFreeSnapshotVersion,d.targetCache.getMatchingKeysForTargetId(a,b.targetId).next(a=>{f=a})}).next(()=>d.queryEngine.getDocumentsMatchingQuery(a,b,c?e:hB.min(),c?f:mh())).next(a=>(r1(d,l1(b),a),{documents:a,remoteKeys:f})))}function rX(a,b,c,d){let e=c.batch,f=e.keys(),g=hU.resolve();return f.forEach(a=>{g=g.next(()=>d.getEntry(b,a)).next(b=>{let f=c.docVersions.get(a);gH(null!==f,48541),0>b.version.compareTo(f)&&(e.applyToRemoteDocument(b,c),b.isValidDocument()&&(b.setReadTime(c.commitVersion),d.addEntry(b)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(b,e))}function rY(a,b){let c=gI(a),d=gI(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",a=>d.lookupMutationKeys(a,b).next(b=>b?c.localDocuments.getDocuments(a,b):hU.resolve(null)))}function rZ(a,b){gI(gI(a,rF).mutationQueue).removeCachedMutationKeys(b)}function r$(a){return gI(gI(a,rF).persistence).getActiveClients()}function r_(a,b){let c=gI(a),d=gI(c.targetCache),e=c.targetDataByTarget.get(b);return e?Promise.resolve(e.target):c.persistence.runTransaction("Get target data","readonly",a=>d.getTargetDataForTarget(a,b).next(a=>a?a.target:null))}function r0(a,b){let c=gI(a),d=c.collectionGroupReadTime.get(b)||hB.min();return c.persistence.runTransaction("Get new document changes","readonly",a=>c.remoteDocuments.getAllFromCollectionGroup(a,b,hN(d,hC),Number.MAX_SAFE_INTEGER)).then(a=>(r1(c,b,a),a))}function r1(a,b,c){let d=a.collectionGroupReadTime.get(b)||hB.min();c.forEach((a,b)=>{b.readTime.compareTo(d)>0&&(d=b.readTime)}),a.collectionGroupReadTime.set(b,d)}function r2(a){return lN(lG(hk.fromString(`__bundle__/docs/${a}`)))}async function r3(a,b,c,d){let e=gI(a),f=mh(),g=l6();for(let a of c){let c=b.toDocumentKey(a.metadata.name);a.document&&(f=f.add(c));let d=b.toMutableDocument(a);d.setReadTime(b.toSnapshotVersion(a.metadata.readTime)),g=g.insert(c,d)}let h=e.remoteDocuments.newChangeBuffer({trackRemovals:!0}),i=await rT(e,r2(d));return e.persistence.runTransaction("Apply bundle documents","readwrite",a=>rO(a,h,g).next(b=>(h.apply(a),b)).next(b=>e.targetCache.removeMatchingKeysForTargetId(a,i.targetId).next(()=>e.targetCache.addMatchingKeys(a,f,i.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(a,b.changedDocuments,b.existenceChangedKeys)).next(()=>b.changedDocuments)))}function r4(a,b){let c=gI(a),d=nD(b.createTime);return c.persistence.runTransaction("hasNewerBundle","readonly",a=>c.bundleCache.getBundleMetadata(a,b.id)).then(a=>!!a&&a.createTime.compareTo(d)>=0)}function r5(a,b){let c=gI(a);return c.persistence.runTransaction("Save bundle","readwrite",a=>c.bundleCache.saveBundleMetadata(a,b))}function r6(a,b){let c=gI(a);return c.persistence.runTransaction("Get named query","readonly",a=>c.bundleCache.getNamedQuery(a,b))}async function r7(a,b,c=mh()){let d=await rT(a,lN(oW(b.bundledQuery))),e=gI(a);return e.persistence.runTransaction("Save named query","readwrite",a=>{let f=nD(b.readTime);if(d.snapshotVersion.compareTo(f)>=0)return e.bundleCache.saveNamedQuery(a,b);let g=d.withResumeToken(jI.EMPTY_BYTE_STRING,f);return e.targetDataByTarget=e.targetDataByTarget.insert(g.targetId,g),e.targetCache.updateTargetData(a,g).next(()=>e.targetCache.removeMatchingKeysForTargetId(a,d.targetId)).next(()=>e.targetCache.addMatchingKeys(a,c,d.targetId)).next(()=>e.bundleCache.saveNamedQuery(a,b))})}async function r8(a,b){let c=gI(a),d=c.indexManager,e=[];return c.persistence.runTransaction("Configure indexes","readwrite",a=>d.getFieldIndexes(a).next(c=>rB(c,b,hI,b=>{e.push(d.addFieldIndex(a,b))},b=>{e.push(d.deleteFieldIndex(a,b))})).next(()=>hU.waitFor(e)))}function r9(a,b){gI(a).queryEngine.indexAutoCreationEnabled=b}function sa(a){let b=gI(a),c=b.indexManager;return b.persistence.runTransaction("Delete All Indexes","readwrite",a=>c.deleteAllFieldIndexes(a))}class sb{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(a){this._documentReadCount+=a}}let sc=100;function sd(){return eV()?8:hZ(eR())>0?6:4}class se{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=sc,this.relativeIndexReadCostPerDocument=sd()}initialize(a,b){this.localDocumentsView=a,this.indexManager=b,this.initialized=!0}getDocumentsMatchingQuery(a,b,c,d){let e={result:null};return this.performQueryUsingIndex(a,b).next(a=>{e.result=a}).next(()=>{if(!e.result)return this.performQueryUsingRemoteKeys(a,b,d,c).next(a=>{e.result=a})}).next(()=>{if(e.result)return;let c=new sb;return this.executeFullCollectionScan(a,b,c).next(d=>{if(e.result=d,this.indexAutoCreationEnabled)return this.createCacheIndexes(a,b,c,d.size)})}).next(()=>e.result)}createCacheIndexes(a,b,c,d){return c.documentReadCount<this.indexAutoCreationMinCollectionSize?(gA()<=l.DEBUG&&gB("QueryEngine","SDK will not create cache indexes for query:",lX(b),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),hU.resolve()):(gA()<=l.DEBUG&&gB("QueryEngine","Query:",lX(b),"scans",c.documentReadCount,"local documents and returns",d,"documents as results."),c.documentReadCount>this.relativeIndexReadCostPerDocument*d)?(gA()<=l.DEBUG&&gB("QueryEngine","The SDK decides to create cache indexes for query:",lX(b),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(a,lN(b))):hU.resolve()}performQueryUsingIndex(a,b){if(lI(b))return hU.resolve(null);let c=lN(b);return this.indexManager.getIndexType(a,c).next(d=>0===d?null:(null!==b.limit&&1===d&&(c=lN(b=lS(b,null,"F"))),this.indexManager.getDocumentsMatchingTarget(a,c).next(d=>{let e=mh(...d);return this.localDocumentsView.getDocuments(a,e).next(d=>this.indexManager.getMinOffset(a,c).next(c=>{let f=this.applyQuery(b,d);return this.needsRefill(b,f,e,c.readTime)?this.performQueryUsingIndex(a,lS(b,null,"F")):this.appendRemainingResults(a,f,b,c)}))})))}performQueryUsingRemoteKeys(a,b,c,d){return lI(b)||d.isEqual(hB.min())?hU.resolve(null):this.localDocumentsView.getDocuments(a,c).next(e=>{let f=this.applyQuery(b,e);return this.needsRefill(b,f,c,d)?hU.resolve(null):(gA()<=l.DEBUG&&gB("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),lX(b)),this.appendRemainingResults(a,f,b,hN(d,hC)).next(a=>a))})}applyQuery(a,b){let c=new jB(l2(a));return b.forEach((b,d)=>{lY(a,d)&&(c=c.add(d))}),c}needsRefill(a,b,c,d){if(null===a.limit)return!1;if(c.size!==b.size)return!0;let e="F"===a.limitType?b.last():b.first();return!!e&&(e.hasPendingWrites||e.version.compareTo(d)>0)}executeFullCollectionScan(a,b,c){return gA()<=l.DEBUG&&gB("QueryEngine","Using full collection scan to execute query:",lX(b)),this.localDocumentsView.getDocumentsMatchingQuery(a,b,hP.min(),c)}appendRemainingResults(a,b,c,d){return this.localDocumentsView.getDocumentsMatchingQuery(a,c,d).next(a=>(b.forEach(b=>{a=a.insert(b.key,b)}),a))}}let sf="firestore_clients";function sg(a,b){return`${sf}_${a}_${b}`}let sh="firestore_mutations";function si(a,b,c){let d=`${sh}_${a}_${c}`;return b.isAuthenticated()&&(d+=`_${b.uid}`),d}let sj="firestore_targets";function sk(a,b){return`${sj}_${a}_${b}`}let sl="firestore_online_state";function sm(a){return`${sl}_${a}`}let sn="firestore_bundle_loaded_v2";function so(a){return`${sn}_${a}`}let sp="firestore_sequence_number";function sq(a){return`${sp}_${a}`}let sr="SharedClientState";class ss{constructor(a,b,c,d){this.user=a,this.batchId=b,this.state=c,this.error=d}static fromWebStorageEntry(a,b,c){let d,e=JSON.parse(c),f="object"==typeof e&&-1!==["pending","acknowledged","rejected"].indexOf(e.state)&&(void 0===e.error||"object"==typeof e.error);return(f&&e.error&&(f="string"==typeof e.error.message&&"string"==typeof e.error.code)&&(d=new g$(e.error.code,e.error.message)),f)?new ss(a,b,e.state,d):(gC(sr,`Failed to parse mutation state for ID '${b}': ${c}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class st{constructor(a,b,c){this.targetId=a,this.state=b,this.error=c}static fromWebStorageEntry(a,b){let c,d=JSON.parse(b),e="object"==typeof d&&-1!==["not-current","current","rejected"].indexOf(d.state)&&(void 0===d.error||"object"==typeof d.error);return(e&&d.error&&(e="string"==typeof d.error.message&&"string"==typeof d.error.code)&&(c=new g$(d.error.code,d.error.message)),e)?new st(a,d.state,c):(gC(sr,`Failed to parse target state for ID '${a}': ${b}`),null)}toWebStorageJSON(){let a={state:this.state,updateTimeMs:Date.now()};return this.error&&(a.error={code:this.error.code,message:this.error.message}),JSON.stringify(a)}}class su{constructor(a,b){this.clientId=a,this.activeTargetIds=b}static fromWebStorageEntry(a,b){let c=JSON.parse(b),d="object"==typeof c&&c.activeTargetIds instanceof Array,e=mj();for(let a=0;d&&a<c.activeTargetIds.length;++a)d=j2(c.activeTargetIds[a]),e=e.add(c.activeTargetIds[a]);return d?new su(a,e):(gC(sr,`Failed to parse client data for instance '${a}': ${b}`),null)}}class sv{constructor(a,b){this.clientId=a,this.onlineState=b}static fromWebStorageEntry(a){let b=JSON.parse(a);return"object"==typeof b&&-1!==["Unknown","Online","Offline"].indexOf(b.onlineState)&&"string"==typeof b.clientId?new sv(b.clientId,b.onlineState):(gC(sr,`Failed to parse online state: ${a}`),null)}}class sw{constructor(){this.activeTargetIds=mj()}addQueryTarget(a){this.activeTargetIds=this.activeTargetIds.add(a)}removeQueryTarget(a){this.activeTargetIds=this.activeTargetIds.delete(a)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class sx{constructor(a,b,c,d,e){this.window=a,this.queue=b,this.persistenceKey=c,this.localClientId=d,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new jx(hb),this.started=!1,this.earlyEvents=[];const f=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=e,this.localClientStorageKey=sg(this.persistenceKey,this.localClientId),this.sequenceNumberKey=sq(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new sw),this.clientStateKeyRe=RegExp(`^${sf}_${f}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${sh}_${f}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${sj}_${f}_(\\d+)$`),this.onlineStateKey=sm(this.persistenceKey),this.bundleLoadedKey=so(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(a){return!!(a&&a.localStorage)}async start(){for(let a of(await this.syncEngine.getActiveClients())){if(a===this.localClientId)continue;let b=this.getItem(sg(this.persistenceKey,a));if(b){let c=su.fromWebStorageEntry(a,b);c&&(this.activeClients=this.activeClients.insert(c.clientId,c))}}this.persistClientState();let a=this.storage.getItem(this.onlineStateKey);if(a){let b=this.fromWebStorageOnlineState(a);b&&this.handleOnlineStateEvent(b)}for(let a of this.earlyEvents)this.handleWebStorageEvent(a);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(a){this.setItem(this.sequenceNumberKey,JSON.stringify(a))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(a){let b=!1;return this.activeClients.forEach((c,d)=>{d.activeTargetIds.has(a)&&(b=!0)}),b}addPendingMutation(a){this.persistMutationState(a,"pending")}updateMutationState(a,b,c){this.persistMutationState(a,b,c),this.removeMutationState(a)}addLocalQueryTarget(a,b=!0){let c="not-current";if(this.isActiveQueryTarget(a)){let b=this.storage.getItem(sk(this.persistenceKey,a));if(b){let d=st.fromWebStorageEntry(a,b);d&&(c=d.state)}}return b&&this.localClientState.addQueryTarget(a),this.persistClientState(),c}removeLocalQueryTarget(a){this.localClientState.removeQueryTarget(a),this.persistClientState()}isLocalQueryTarget(a){return this.localClientState.activeTargetIds.has(a)}clearQueryState(a){this.removeItem(sk(this.persistenceKey,a))}updateQueryState(a,b,c){this.persistQueryTargetState(a,b,c)}handleUserChange(a,b,c){b.forEach(a=>{this.removeMutationState(a)}),this.currentUser=a,c.forEach(a=>{this.addPendingMutation(a)})}setOnlineState(a){this.persistOnlineState(a)}notifyBundleLoaded(a){this.persistBundleLoadedState(a)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(a){let b=this.storage.getItem(a);return gB(sr,"READ",a,b),b}setItem(a,b){gB(sr,"SET",a,b),this.storage.setItem(a,b)}removeItem(a){gB(sr,"REMOVE",a),this.storage.removeItem(a)}handleWebStorageEvent(a){let b=a;if(b.storageArea===this.storage){if(gB(sr,"EVENT",b.key,b.newValue),b.key===this.localClientStorageKey)return void gC("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(b);if(null!==b.key){if(this.clientStateKeyRe.test(b.key))if(null!=b.newValue){let a=this.fromWebStorageClientState(b.key,b.newValue);if(a)return this.handleClientStateEvent(a.clientId,a)}else{let a=this.fromWebStorageClientStateKey(b.key);return this.handleClientStateEvent(a,null)}else if(this.mutationBatchKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageMutationMetadata(b.key,b.newValue);if(a)return this.handleMutationBatchEvent(a)}}else if(this.queryTargetKeyRe.test(b.key)){if(null!==b.newValue){let a=this.fromWebStorageQueryTargetMetadata(b.key,b.newValue);if(a)return this.handleQueryTargetEvent(a)}}else if(b.key===this.onlineStateKey){if(null!==b.newValue){let a=this.fromWebStorageOnlineState(b.newValue);if(a)return this.handleOnlineStateEvent(a)}}else if(b.key===this.sequenceNumberKey){let a=sy(b.newValue);a!==ib.INVALID&&this.sequenceNumberHandler(a)}else if(b.key===this.bundleLoadedKey){let a=this.fromWebStoreBundleLoadedState(b.newValue);await Promise.all(a.map(a=>this.syncEngine.synchronizeWithChangedDocuments(a)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(a,b,c){let d=new ss(this.currentUser,a,b,c),e=si(this.persistenceKey,this.currentUser,a);this.setItem(e,d.toWebStorageJSON())}removeMutationState(a){let b=si(this.persistenceKey,this.currentUser,a);this.removeItem(b)}persistOnlineState(a){let b={clientId:this.localClientId,onlineState:a};this.storage.setItem(this.onlineStateKey,JSON.stringify(b))}persistQueryTargetState(a,b,c){let d=sk(this.persistenceKey,a),e=new st(a,b,c);this.setItem(d,e.toWebStorageJSON())}persistBundleLoadedState(a){let b=JSON.stringify(Array.from(a));this.setItem(this.bundleLoadedKey,b)}fromWebStorageClientStateKey(a){let b=this.clientStateKeyRe.exec(a);return b?b[1]:null}fromWebStorageClientState(a,b){let c=this.fromWebStorageClientStateKey(a);return su.fromWebStorageEntry(c,b)}fromWebStorageMutationMetadata(a,b){let c=this.mutationBatchKeyRe.exec(a),d=Number(c[1]),e=void 0!==c[2]?c[2]:null;return ss.fromWebStorageEntry(new gv(e),d,b)}fromWebStorageQueryTargetMetadata(a,b){let c=Number(this.queryTargetKeyRe.exec(a)[1]);return st.fromWebStorageEntry(c,b)}fromWebStorageOnlineState(a){return sv.fromWebStorageEntry(a)}fromWebStoreBundleLoadedState(a){return JSON.parse(a)}async handleMutationBatchEvent(a){return a.user.uid!==this.currentUser.uid?void gB(sr,`Ignoring mutation for non-active user ${a.user.uid}`):this.syncEngine.applyBatchState(a.batchId,a.state,a.error)}handleQueryTargetEvent(a){return this.syncEngine.applyTargetState(a.targetId,a.state,a.error)}handleClientStateEvent(a,b){let c=b?this.activeClients.insert(a,b):this.activeClients.remove(a),d=this.extractActiveQueryTargets(this.activeClients),e=this.extractActiveQueryTargets(c),f=[],g=[];return e.forEach(a=>{d.has(a)||f.push(a)}),d.forEach(a=>{e.has(a)||g.push(a)}),this.syncEngine.applyActiveTargetsChange(f,g).then(()=>{this.activeClients=c})}handleOnlineStateEvent(a){this.activeClients.get(a.clientId)&&this.onlineStateHandler(a.onlineState)}extractActiveQueryTargets(a){let b=mj();return a.forEach((a,c)=>{b=b.unionWith(c.activeTargetIds)}),b}}function sy(a){let b=ib.INVALID;if(null!=a)try{let c=JSON.parse(a);gH("number"==typeof c,30636,{seqString:a}),b=c}catch(a){gC(sr,"Failed to read sequence number from WebStorage",a)}return b}class sz{constructor(){this.localState=new sw,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(a){}updateMutationState(a,b,c){}addLocalQueryTarget(a,b=!0){return b&&this.localState.addQueryTarget(a),this.queryState[a]||"not-current"}updateQueryState(a,b,c){this.queryState[a]=b}removeLocalQueryTarget(a){this.localState.removeQueryTarget(a)}isLocalQueryTarget(a){return this.localState.activeTargetIds.has(a)}clearQueryState(a){delete this.queryState[a]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(a){return this.localState.activeTargetIds.has(a)}start(){return this.localState=new sw,Promise.resolve()}handleUserChange(a,b,c){}setOnlineState(a){}shutdown(){}writeSequenceNumber(a){}notifyBundleLoaded(a){}}class sA{addCallback(a){}shutdown(){}}class sB{constructor(a){this.sendFn=a.sendFn,this.closeFn=a.closeFn}onConnected(a){this.wrappedOnConnected=a}onOpen(a){this.wrappedOnOpen=a}onClose(a){this.wrappedOnClose=a}onMessage(a){this.wrappedOnMessage=a}close(){this.closeFn()}send(a){this.sendFn(a)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(a){this.wrappedOnClose(a)}callOnMessage(a){this.wrappedOnMessage(a)}}let sC=null;function sD(){return 0x10000000+Math.round(0x80000000*Math.random())}function sE(){return null===sC?sC=sD():sC++,"0x"+sC.toString(16)}function sF(a){return new Promise((b,c)=>{a((a,d)=>{a?c(a):b(d)})})}let sG="1.9.15",sH="GrpcConnection",sI=`gl-node/${process.versions.node} fire/${gw} grpc/${sG}`;function sJ(a,b,c,d,e){gH(null===b||"OAuth"===b.type,36936);let f=new gt.Metadata;return b&&b.headers.forEach((a,b)=>f.set(b,a)),c&&c.headers.forEach((a,b)=>f.set(b,a)),d&&f.set("X-Firebase-GMPID",d),f.set("X-Goog-Api-Client",sI),f.set("Google-Cloud-Resource-Prefix",a),f.set("x-goog-request-params",a),e&&f.set("X-Goog-Api-Key",e),f}class sK{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(a,b){this.databaseInfo=b,this.cachedStub=null,this.firestore=a.google.firestore.v1,this.databasePath=`projects/${b.databaseId.projectId}/databases/${b.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){gB(sH,"Creating Firestore stub.");let a=this.databaseInfo.ssl?gt.credentials.createSsl():gt.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,a)}return this.cachedStub}invokeRPC(a,b,c,d,e){let f=sE(),g=this.ensureActiveStub(),h=sJ(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),i={database:this.databasePath,...c};return sF(b=>(gB(sH,`RPC '${a}' ${f} invoked with request:`,c),g[a](i,h,(c,d)=>{c?(gB(sH,`RPC '${a}' ${f} failed with error:`,c),b(new g$(m4(c.code),c.message))):(gB(sH,`RPC '${a}' ${f} completed with response:`,d),b(void 0,d))})))}invokeStreamingRPC(a,b,c,d,e,f){let g=sE(),h=[],i=new g_;gB(sH,`RPC '${a}' ${g} invoked (streaming) with request:`,c);let j=this.ensureActiveStub(),k=sJ(this.databasePath,d,e,this.databaseInfo.appId,this.databaseInfo.apiKey),l={...c,database:this.databasePath},m=j[a](l,k),n=!1;return m.on("data",b=>{gB(sH,`RPC ${a} ${g} received result:`,b),h.push(b),void 0!==f&&h.length===f&&(n=!0,i.resolve(h))}),m.on("end",()=>{gB(sH,`RPC '${a}' ${g} completed.`),n||(n=!0,i.resolve(h))}),m.on("error",b=>{gB(sH,`RPC '${a}' ${g} failed with error:`,b);let c=m4(b.code);i.reject(new g$(c,b.message))}),i.promise}openStream(a,b,c){let d=sE(),e=this.ensureActiveStub(),f=sJ(this.databasePath,b,c,this.databaseInfo.appId,this.databaseInfo.apiKey),g=e[a](f),h=!1,i=a=>{h||(h=!0,j.callOnClose(a),g.end())},j=new sB({sendFn:b=>{if(h)gB(sH,`RPC '${a}' stream ${d} not sending because gRPC stream is closed:`,b);else{gB(sH,`RPC '${a}' stream ${d} sending:`,b);try{g.write(b)}catch(a){throw gC("Failure sending:",b),gC("Error:",a),a}}},closeFn:()=>{gB(sH,`RPC '${a}' stream ${d} closed locally via close().`),i()}}),k=!1;return g.on("data",b=>{h||(gB(sH,`RPC '${a}' stream ${d} received:`,b),k||(j.callOnConnected(),k=!0),j.callOnMessage(b))}),g.on("end",()=>{gB(sH,`RPC '${a}' stream ${d} ended.`),i()}),g.on("error",b=>{h||(gD(sH,`RPC '${a}' stream ${d} error. Code:`,b.code,"Message:",b.message),i(new g$(m4(b.code),b.message)))}),gB(sH,`Opening RPC '${a}' stream ${d} to ${this.databaseInfo.host}`),setTimeout(()=>{j.callOnOpen()},0),j}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let sL={google:{nested:{protobuf:{options:{go_package:"github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5,options:{default:!1}},serverStreaming:{type:"bool",id:6,options:{default:!1}}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10,options:{default:!1}},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27,options:{default:!1}},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16,options:{default:!1}},javaGenericServices:{type:"bool",id:17,options:{default:!1}},pyGenericServices:{type:"bool",id:18,options:{default:!1}},phpGenericServices:{type:"bool",id:42,options:{default:!1}},deprecated:{type:"bool",id:23,options:{default:!1}},ccEnableArenas:{type:"bool",id:31,options:{default:!1}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1,options:{default:!1}},noStandardDescriptorAccessor:{type:"bool",id:2,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8],[9,9]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5,options:{default:!1}},deprecated:{type:"bool",id:3,options:{default:!1}},weak:{type:"bool",id:10,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[5,5]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33,options:{default:!1}},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Empty:{fields:{}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Duration:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"cloud.google.com/go/firestore/apiv1/firestorepb;firestorepb",java_multiple_files:!0,java_outer_classname:"QueryProfileProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue","fieldReferenceValue","functionValue","pipelineValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6},fieldReferenceValue:{type:"string",id:19},functionValue:{type:"Function",id:20},pipelineValue:{type:"Pipeline",id:21}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Function:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}},Pipeline:{fields:{stages:{rule:"repeated",type:"Stage",id:1}},nested:{Stage:{fields:{name:{type:"string",id:1},args:{rule:"repeated",type:"Value",id:2},options:{keyType:"string",type:"Value",id:3}}}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},ExecutePipeline:{requestType:"ExecutePipelineRequest",responseType:"ExecutePipelineResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:executePipeline","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:executePipeline",body:"*"}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},ExecutePipelineRequest:{oneofs:{pipelineType:{oneof:["structuredPipeline"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredPipeline:{type:"StructuredPipeline",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},ExecutePipelineResponse:{fields:{transaction:{type:"bytes",id:1},results:{rule:"repeated",type:"Document",id:2},executionTime:{type:"google.protobuf.Timestamp",id:3}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredPipeline:{fields:{pipeline:{type:"Pipeline",id:1},options:{keyType:"string",type:"Value",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}},Avg:{fields:{field:{type:"StructuredQuery.FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}},ExplainOptions:{fields:{analyze:{type:"bool",id:1,options:{"(google.api.field_behavior)":"OPTIONAL"}}}},ExplainMetrics:{fields:{planSummary:{type:"PlanSummary",id:1},executionStats:{type:"ExecutionStats",id:2}}},PlanSummary:{fields:{indexesUsed:{rule:"repeated",type:"google.protobuf.Struct",id:1}}},ExecutionStats:{fields:{resultsReturned:{type:"int64",id:1},executionDuration:{type:"google.protobuf.Duration",id:3},readOperations:{type:"int64",id:4},debugStats:{type:"google.protobuf.Struct",id:5}}}}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api;api",java_multiple_files:!0,java_outer_classname:"LaunchStageProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1},fullyDecodeReservedExpansion:{type:"bool",id:2}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{selector:{type:"string",id:1},get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},body:{type:"string",id:7},responseBody:{type:"string",id:12},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}},LaunchStage:{values:{LAUNCH_STAGE_UNSPECIFIED:0,UNIMPLEMENTED:6,PRELAUNCH:7,EARLY_ACCESS:1,ALPHA:2,BETA:3,GA:4,DEPRECATED:5}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var sM={nested:sL},sN=Object.freeze({__proto__:null,nested:sL,default:sM});let sO={longs:String,enums:String,defaults:!0,oneofs:!1};function sP(){let a=gu.fromJSON(sN,sO);return gt.loadPackageDefinition(a)}function sQ(a){return new sK(sP(),a)}function sR(){return new sA}function sS(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function sT(){return null}function sU(a){return new nu(a,!1)}let sV="ExponentialBackoff",sW=1e3,sX=1.5,sY=6e4;class sZ{constructor(a,b,c=sW,d=sX,e=sY){this.queue=a,this.timerId=b,this.initialDelayMs=c,this.backoffFactor=d,this.maxDelayMs=e,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(a){this.cancel();let b=Math.floor(this.currentBaseMs+this.jitterDelayMs()),c=Math.max(0,Date.now()-this.lastAttemptTime),d=Math.max(0,b-c);d>0&&gB(sV,`Backing off for ${d} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${b} ms, last attempt: ${c} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,d,()=>(this.lastAttemptTime=Date.now(),a())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let s$="PersistentStream",s_=6e4,s0=1e4;class s1{constructor(a,b,c,d,e,f,g,h){this.queue=a,this.idleTimerId=c,this.healthTimerId=d,this.connection=e,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=g,this.listener=h,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new sZ(a,b)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){(this.responseCount=0,4===this.state)?this.performBackoff():this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,s_,()=>this.handleIdleCloseTimer()))}sendRequest(a){this.cancelIdleCheck(),this.stream.send(a)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(a,b){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==a?this.backoff.reset():b&&b.code===gS?(gC(b.toString()),gC("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):b&&b.code===gR&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=a,await this.listener.onClose(b)}tearDown(){}auth(){this.state=1;let a=this.getCloseGuardedDispatcher(this.closeCount),b=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,c])=>{this.closeCount===b&&this.startStream(a,c)},b=>{a(()=>{let a=new g$(gL,"Fetching auth token failed: "+b.message);return this.handleStreamClose(a)})})}startStream(a,b){let c=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(a,b),this.stream.onConnected(()=>{c(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{c(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,s0,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(a=>{c(()=>this.handleStreamClose(a))}),this.stream.onMessage(a=>{c(()=>1==++this.responseCount?this.onFirst(a):this.onNext(a))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(a){return gB(s$,`close with error: ${a}`),this.stream=null,this.close(4,a)}getCloseGuardedDispatcher(a){return b=>{this.queue.enqueueAndForget(()=>this.closeCount===a?b():(gB(s$,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class s2 extends s1{constructor(a,b,c,d,e,f){super(a,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}startRpc(a,b){return this.connection.openStream("Listen",a,b)}onFirst(a){return this.onNext(a)}onNext(a){this.backoff.reset();let b=nU(this.serializer,a),c=nW(a);return this.listener.onWatchChange(b,c)}watch(a){let b={};b.database=nL(this.serializer),b.addTarget=ob(this.serializer,a);let c=n9(this.serializer,a);c&&(b.labels=c),this.sendRequest(b)}unwatch(a){let b={};b.database=nL(this.serializer),b.removeTarget=a,this.sendRequest(b)}}class s3 extends s1{constructor(a,b,c,d,e,f){super(a,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",b,c,d,f),this.serializer=e}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(a,b){return this.connection.openStream("Write",a,b)}onFirst(a){return gH(!!a.streamToken,31322),this.lastStreamToken=a.streamToken,gH(!a.writeResults||0===a.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(a){gH(!!a.streamToken,12678),this.lastStreamToken=a.streamToken,this.backoff.reset();let b=n0(a.writeResults,a.commitTime),c=nD(a.commitTime);return this.listener.onMutationResult(c,b)}writeHandshake(){let a={};a.database=nL(this.serializer),this.sendRequest(a)}writeMutations(a){let b={streamToken:this.lastStreamToken,writes:a.map(a=>nX(this.serializer,a))};this.sendRequest(b)}}class s4{}class s5 extends s4{constructor(a,b,c,d){super(),this.authCredentials=a,this.appCheckCredentials=b,this.connection=c,this.serializer=d,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new g$(gT,"The client has already been terminated.")}invokeRPC(a,b,c,d){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,f])=>this.connection.invokeRPC(a,nF(b,c),d,e,f)).catch(a=>{if("FirebaseError"===a.name)throw a.code===gR&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new g$(gL,a.toString())})}invokeStreamingRPC(a,b,c,d,e){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,g])=>this.connection.invokeStreamingRPC(a,nF(b,c),d,f,g,e)).catch(a=>{if("FirebaseError"===a.name)throw a.code===gR&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a;throw new g$(gL,a.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function s6(a,b,c,d){return new s5(a,b,c,d)}async function s7(a,b){let c=gI(a),d={writes:b.map(a=>nX(c.serializer,a))};await c.invokeRPC("Commit",c.serializer.databaseId,hk.emptyPath(),d)}async function s8(a,b){let c=gI(a),d={documents:b.map(a=>nH(c.serializer,a))},e=await c.invokeStreamingRPC("BatchGetDocuments",c.serializer.databaseId,hk.emptyPath(),d,b.length),f=new Map;e.forEach(a=>{let b=nT(c.serializer,a);f.set(b.key.toString(),b)});let g=[];return b.forEach(a=>{let b=f.get(a.toString());gH(!!b,55234,{key:a}),g.push(b)}),g}async function s9(a,b,c){let d=gI(a),{request:e,aliasMap:f,parent:g}=n6(d.serializer,lO(b),c);d.connection.shouldResourcePathBeIncludedInRequest||delete e.parent;let h=(await d.invokeStreamingRPC("RunAggregationQuery",d.serializer.databaseId,g,e,1)).filter(a=>!!a.result);gH(1===h.length,64727);let i=h[0].result?.aggregateFields;return Object.keys(i).reduce((a,b)=>(a[f[b]]=i[b],a),{})}function ta(a,b,c){let d=gI(a);return d.verifyInitialized(),new s3(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}function tb(a,b,c){let d=gI(a);return d.verifyInitialized(),new s2(b,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}let tc="OnlineStateTracker",td=1,te=1e4;class tf{constructor(a,b){this.asyncQueue=a,this.onlineStateHandler=b,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",te,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${te/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(a){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=td&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${td} times. Most recent error: ${a.toString()}`),this.setAndBroadcast("Offline")))}set(a){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===a&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(a)}setAndBroadcast(a){a!==this.state&&(this.state=a,this.onlineStateHandler(a))}logClientOfflineWarningIfNecessary(a){let b=`Could not reach Cloud Firestore backend. ${a}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(gC(b),this.shouldWarnClientIsOffline=!1):gB(tc,b)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let tg="RemoteStore",th=10;class ti{constructor(a,b,c,d,e){this.localStore=a,this.datastore=b,this.asyncQueue=c,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=e,this.connectivityMonitor.addCallback(a=>{c.enqueueAndForget(async()=>{tt(this)&&(gB(tg,"Restarting streams for network reachability change."),await tN(this))})}),this.onlineStateTracker=new tf(c,d)}}function tj(a,b,c,d,e){return new ti(a,b,c,d,e)}async function tk(a){if(tt(a))for(let b of a.onNetworkStatusChange)await b(!0)}async function tl(a){for(let b of a.onNetworkStatusChange)await b(!1)}async function tm(a){let b=gI(a);gB(tg,"RemoteStore shutting down."),b.offlineCauses.add(5),await tl(b),b.connectivityMonitor.shutdown(),b.onlineStateTracker.set("Unknown")}function tn(a,b){let c=gI(a);!c.listenTargets.has(b.targetId)&&(c.listenTargets.set(b.targetId,b),ts(c)?tr(c):tQ(c).isOpen()&&tp(c,b))}function to(a,b){let c=gI(a),d=tQ(c);c.listenTargets.delete(b),d.isOpen()&&tq(c,b),0===c.listenTargets.size&&(d.isOpen()?d.markIdle():tt(c)&&c.onlineStateTracker.set("Unknown"))}function tp(a,b){if(a.watchChangeAggregator.recordPendingTargetRequest(b.targetId),b.resumeToken.approximateByteSize()>0||b.snapshotVersion.compareTo(hB.min())>0){let c=a.remoteSyncer.getRemoteKeysForTarget(b.targetId).size;b=b.withExpectedCount(c)}tQ(a).watch(b)}function tq(a,b){a.watchChangeAggregator.recordPendingTargetRequest(b),tQ(a).unwatch(b)}function tr(a){a.watchChangeAggregator=new nm({getRemoteKeysForTarget:b=>a.remoteSyncer.getRemoteKeysForTarget(b),getTargetDataForTarget:b=>a.listenTargets.get(b)||null,getDatabaseId:()=>a.datastore.serializer.databaseId}),tQ(a).start(),a.onlineStateTracker.handleWatchStreamStart()}function ts(a){return tt(a)&&!tQ(a).isStarted()&&a.listenTargets.size>0}function tt(a){return 0===gI(a).offlineCauses.size}function tu(a){a.watchChangeAggregator=void 0}async function tv(a){a.onlineStateTracker.set("Online")}async function tw(a){a.listenTargets.forEach((b,c)=>{tp(a,b)})}async function tx(a,b){tu(a),ts(a)?(a.onlineStateTracker.handleWatchStreamFailure(b),tr(a)):a.onlineStateTracker.set("Unknown")}async function ty(a,b,c){if(a.onlineStateTracker.set("Online"),b instanceof nj&&2===b.state&&b.cause){try{await tC(a,b)}catch(c){gB(tg,"Failed to remove targets %s: %s ",b.targetIds.join(","),c),await tz(a,c)}return}if(b instanceof nh?a.watchChangeAggregator.handleDocumentChange(b):b instanceof ni?a.watchChangeAggregator.handleExistenceFilter(b):a.watchChangeAggregator.handleTargetChange(b),!c.isEqual(hB.min()))try{let b=await rM(a.localStore);c.compareTo(b)>=0&&await tB(a,c)}catch(b){gB(tg,"Failed to raise snapshot:",b),await tz(a,b)}}async function tz(a,b,c){if(h0(b))a.offlineCauses.add(1),await tl(a),a.onlineStateTracker.set("Offline"),c||(c=()=>rM(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{gB(tg,"Retrying IndexedDB access"),await c(),a.offlineCauses.delete(1),await tk(a)});else throw b}function tA(a,b){return b().catch(c=>tz(a,c,b))}function tB(a,b){let c=a.watchChangeAggregator.createRemoteEvent(b);return c.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let e=a.listenTargets.get(d);e&&a.listenTargets.set(d,e.withResumeToken(c.resumeToken,b))}}),c.targetMismatches.forEach((b,c)=>{let d=a.listenTargets.get(b);d&&(a.listenTargets.set(b,d.withResumeToken(jI.EMPTY_BYTE_STRING,d.snapshotVersion)),tq(a,b),tp(a,new oF(d.target,b,c,d.sequenceNumber)))}),a.remoteSyncer.applyRemoteEvent(c)}async function tC(a,b){let c=b.cause;for(let d of b.targetIds)a.listenTargets.has(d)&&(await a.remoteSyncer.rejectListen(d,c),a.listenTargets.delete(d),a.watchChangeAggregator.removeTarget(d))}async function tD(a){let b=gI(a),c=tR(b),d=b.writePipeline.length>0?b.writePipeline[b.writePipeline.length-1].batchId:j_;for(;tE(b);)try{let a=await rR(b.localStore,d);if(null===a){0===b.writePipeline.length&&c.markIdle();break}d=a.batchId,tF(b,a)}catch(a){await tz(b,a)}tG(b)&&tH(b)}function tE(a){return tt(a)&&a.writePipeline.length<th}function tF(a,b){a.writePipeline.push(b);let c=tR(a);c.isOpen()&&c.handshakeComplete&&c.writeMutations(b.mutations)}function tG(a){return tt(a)&&!tR(a).isStarted()&&a.writePipeline.length>0}function tH(a){tR(a).start()}async function tI(a){tR(a).writeHandshake()}async function tJ(a){let b=tR(a);for(let c of a.writePipeline)b.writeMutations(c.mutations)}async function tK(a,b,c){let d=a.writePipeline.shift(),e=m_.from(d,b,c);await tA(a,()=>a.remoteSyncer.applySuccessfulWrite(e)),await tD(a)}async function tL(a,b){b&&tR(a).handshakeComplete&&await tM(a,b),tG(a)&&tH(a)}async function tM(a,b){if(m3(b.code)){let c=a.writePipeline.shift();tR(a).inhibitBackoff(),await tA(a,()=>a.remoteSyncer.rejectFailedWrite(c.batchId,b)),await tD(a)}}async function tN(a){let b=gI(a);b.offlineCauses.add(4),await tl(b),b.onlineStateTracker.set("Unknown"),b.offlineCauses.delete(4),await tk(b)}async function tO(a,b){let c=gI(a);c.asyncQueue.verifyOperationInProgress(),gB(tg,"RemoteStore received new credentials");let d=tt(c);c.offlineCauses.add(3),await tl(c),d&&c.onlineStateTracker.set("Unknown"),await c.remoteSyncer.handleCredentialChange(b),c.offlineCauses.delete(3),await tk(c)}async function tP(a,b){let c=gI(a);b?(c.offlineCauses.delete(2),await tk(c)):b||(c.offlineCauses.add(2),await tl(c),c.onlineStateTracker.set("Unknown"))}function tQ(a){return a.watchStream||(a.watchStream=tb(a.datastore,a.asyncQueue,{onConnected:tv.bind(null,a),onOpen:tw.bind(null,a),onClose:tx.bind(null,a),onWatchChange:ty.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.watchStream.inhibitBackoff(),ts(a)?tr(a):a.onlineStateTracker.set("Unknown")):(await a.watchStream.stop(),tu(a))})),a.watchStream}function tR(a){return a.writeStream||(a.writeStream=ta(a.datastore,a.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:tI.bind(null,a),onClose:tL.bind(null,a),onHandshakeComplete:tJ.bind(null,a),onMutationResult:tK.bind(null,a)}),a.onNetworkStatusChange.push(async b=>{b?(a.writeStream.inhibitBackoff(),await tD(a)):(await a.writeStream.stop(),a.writePipeline.length>0&&(gB(tg,`Stopping write stream with ${a.writePipeline.length} pending writes`),a.writePipeline=[]))})),a.writeStream}let tS="AsyncQueue";class tT{constructor(a,b,c,d,e){this.asyncQueue=a,this.timerId=b,this.targetTimeMs=c,this.op=d,this.removalCallback=e,this.deferred=new g_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(a,b,c,d,e){let f=new tT(a,b,Date.now()+c,d,e);return f.start(c),f}start(a){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new g$(gK,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(a=>this.deferred.resolve(a))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function tU(a,b){if(gC(tS,`${b}: ${a}`),h0(a))return new g$(gY,`${b}: ${a}`);throw a}class tV{static emptySet(a){return new tV(a.comparator)}constructor(a){a?this.comparator=(b,c)=>a(b,c)||hn.comparator(b.key,c.key):this.comparator=(a,b)=>hn.comparator(a.key,b.key),this.keyedMap=l8(),this.sortedSet=new jx(this.comparator)}has(a){return null!=this.keyedMap.get(a)}get(a){return this.keyedMap.get(a)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(a){let b=this.keyedMap.get(a);return b?this.sortedSet.indexOf(b):-1}get size(){return this.sortedSet.size}forEach(a){this.sortedSet.inorderTraversal((b,c)=>(a(b),!1))}add(a){let b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))}delete(a){let b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this}isEqual(a){if(!(a instanceof tV)||this.size!==a.size)return!1;let b=this.sortedSet.getIterator(),c=a.sortedSet.getIterator();for(;b.hasNext();){let a=b.getNext().key,d=c.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){let a=[];return(this.forEach(b=>{a.push(b.toString())}),0===a.length)?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"}copy(a,b){let c=new tV;return c.comparator=this.comparator,c.keyedMap=a,c.sortedSet=b,c}}class tW{constructor(){this.changeMap=new jx(hn.comparator)}track(a){let b=a.doc.key,c=this.changeMap.get(b);if(!c){this.changeMap=this.changeMap.insert(b,a);return}0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):gF(63341,{change:a,oldChange:c})}getChanges(){let a=[];return this.changeMap.inorderTraversal((b,c)=>{a.push(c)}),a}}class tX{constructor(a,b,c,d,e,f,g,h,i){this.query=a,this.docs=b,this.oldDocs=c,this.docChanges=d,this.mutatedKeys=e,this.fromCache=f,this.syncStateChanged=g,this.excludesMetadataChanges=h,this.hasCachedResults=i}static fromInitialDocuments(a,b,c,d,e){let f=[];return b.forEach(a=>{f.push({type:0,doc:a})}),new tX(a,b,tV.emptySet(b),f,c,d,!0,!1,e)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(a){if(this.fromCache!==a.fromCache||this.hasCachedResults!==a.hasCachedResults||this.syncStateChanged!==a.syncStateChanged||!this.mutatedKeys.isEqual(a.mutatedKeys)||!lV(this.query,a.query)||!this.docs.isEqual(a.docs)||!this.oldDocs.isEqual(a.oldDocs))return!1;let b=this.docChanges,c=a.docChanges;if(b.length!==c.length)return!1;for(let a=0;a<b.length;a++)if(b[a].type!==c[a].type||!b[a].doc.isEqual(c[a].doc))return!1;return!0}}class tY{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(a=>a.listensToRemoteStore())}}function tZ(){return new t$}class t${constructor(){this.queries=t_(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){t7(this,new g$(gU,"Firestore shutting down"))}}function t_(){return new l4(a=>lW(a),lV)}async function t0(a,b){let c=gI(a),d=3,e=b.query,f=c.queries.get(e);f?!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(d=2):(f=new tY,d=+!b.listensToRemoteStore());try{switch(d){case 0:f.viewSnap=await c.onListen(e,!0);break;case 1:f.viewSnap=await c.onListen(e,!1);break;case 2:await c.onFirstRemoteStoreListen(e)}}catch(c){let a=tU(c,`Initialization of query '${lX(b.query)}' failed`);b.onError(a);return}c.queries.set(e,f),f.listeners.push(b),b.applyOnlineStateChange(c.onlineState),f.viewSnap&&b.onViewSnapshot(f.viewSnap)&&t8(c)}async function t1(a,b){let c=gI(a),d=b.query,e=3,f=c.queries.get(d);if(f){let a=f.listeners.indexOf(b);a>=0&&(f.listeners.splice(a,1),0===f.listeners.length?e=+!b.listensToRemoteStore():!f.hasRemoteListeners()&&b.listensToRemoteStore()&&(e=2))}switch(e){case 0:return c.queries.delete(d),c.onUnlisten(d,!0);case 1:return c.queries.delete(d),c.onUnlisten(d,!1);case 2:return c.onLastRemoteStoreUnlisten(d);default:return}}function t2(a,b){let c=gI(a),d=!1;for(let a of b){let b=a.query,e=c.queries.get(b);if(e){for(let b of e.listeners)b.onViewSnapshot(a)&&(d=!0);e.viewSnap=a}}d&&t8(c)}function t3(a,b,c){let d=gI(a),e=d.queries.get(b);if(e)for(let a of e.listeners)a.onError(c);d.queries.delete(b)}function t4(a,b){let c=gI(a);c.onlineState=b;let d=!1;c.queries.forEach((a,c)=>{for(let a of c.listeners)a.applyOnlineStateChange(b)&&(d=!0)}),d&&t8(c)}function t5(a,b){gI(a).snapshotsInSyncListeners.add(b),b.next()}function t6(a,b){gI(a).snapshotsInSyncListeners.delete(b)}function t7(a,b){let c=gI(a),d=c.queries;c.queries=t_(),d.forEach((a,c)=>{for(let a of c.listeners)a.onError(b)})}function t8(a){a.snapshotsInSyncListeners.forEach(a=>{a.next()})}!function(a){a.Default="default",a.Cache="cache"}(p||(p={}));class t9{constructor(a,b,c){this.query=a,this.queryObserver=b,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=c||{}}onViewSnapshot(a){if(!this.options.includeMetadataChanges){let b=[];for(let c of a.docChanges)3!==c.type&&b.push(c);a=new tX(a.query,a.docs,a.oldDocs,b,a.mutatedKeys,a.fromCache,a.syncStateChanged,!0,a.hasCachedResults)}let b=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(a)&&(this.queryObserver.next(a),b=!0):this.shouldRaiseInitialEvent(a,this.onlineState)&&(this.raiseInitialEvent(a),b=!0),this.snap=a,b}onError(a){this.queryObserver.error(a)}applyOnlineStateChange(a){this.onlineState=a;let b=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,a)&&(this.raiseInitialEvent(this.snap),b=!0),b}shouldRaiseInitialEvent(a,b){if(!a.fromCache||!this.listensToRemoteStore())return!0;let c="Offline"!==b;return(!this.options.waitForSyncWhenOnline||!c)&&(!a.docs.isEmpty()||a.hasCachedResults||"Offline"===b)}shouldRaiseEvent(a){if(a.docChanges.length>0)return!0;let b=this.snap&&this.snap.hasPendingWrites!==a.hasPendingWrites;return(!!a.syncStateChanged||!!b)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(a){a=tX.fromInitialDocuments(a.query,a.docs,a.mutatedKeys,a.fromCache,a.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(a)}listensToRemoteStore(){return this.options.source!==p.Cache}}class ua{constructor(a,b,c,d){this.targetId=a,this.fromCache=b,this.addedKeys=c,this.removedKeys=d}static fromSnapshot(a,b){let c=mh(),d=mh();for(let a of b.docChanges)switch(a.type){case 0:c=c.add(a.doc.key);break;case 1:d=d.add(a.doc.key)}return new ua(a,b.fromCache,c,d)}}class ub{constructor(a){this.serializer=a}toDocumentKey(a){return nI(this.serializer,a)}toMutableDocument(a){return a.metadata.exists?nQ(this.serializer,a.document,!1):kT.newNoDocument(this.toDocumentKey(a.metadata.name),this.toSnapshotVersion(a.metadata.readTime))}toSnapshotVersion(a){return nD(a)}}class uc{constructor(a,b){this.bundleMetadata=a,this.serializer=b,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=ud(a)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(a){this.progress.bytesLoaded+=a.byteLength;let b=this.progress.documentsLoaded;if(a.payload.namedQuery)this._queries.push(a.payload.namedQuery);else if(a.payload.documentMetadata){this._documents.push({metadata:a.payload.documentMetadata}),!a.payload.documentMetadata.exists&&++b;let c=hk.fromString(a.payload.documentMetadata.name);this.collectionGroups.add(c.get(c.length-2))}else a.payload.document&&(this._documents[this._documents.length-1].document=a.payload.document,++b);return b!==this.progress.documentsLoaded?(this.progress.documentsLoaded=b,{...this.progress}):null}getQueryDocumentMapping(a){let b=new Map,c=new ub(this.serializer);for(let d of a)if(d.metadata.queries){let a=c.toDocumentKey(d.metadata.name);for(let c of d.metadata.queries){let d=(b.get(c)||mh()).add(a);b.set(c,d)}}return b}async completeAndStoreAsync(a){let b=await r3(a,new ub(this.serializer),this._documents,this.bundleMetadata.id),c=this.getQueryDocumentMapping(this.documents);for(let b of this._queries)await r7(a,b,c.get(b.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:b}}}function ud(a){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}function ue(a){return{taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}}class uf{constructor(a){this.key=a}}class ug{constructor(a){this.key=a}}class uh{constructor(a,b){this.query=a,this._syncedDocuments=b,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=mh(),this.mutatedKeys=mh(),this.docComparator=l2(a),this.documentSet=new tV(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(a,b){let c=b?b.changeSet:new tW,d=b?b.documentSet:this.documentSet,e=b?b.mutatedKeys:this.mutatedKeys,f=d,g=!1,h="F"===this.query.limitType&&d.size===this.query.limit?d.last():null,i="L"===this.query.limitType&&d.size===this.query.limit?d.first():null;if(a.inorderTraversal((a,b)=>{let j=d.get(a),k=lY(this.query,b)?b:null,l=!!j&&this.mutatedKeys.has(j.key),m=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations),n=!1;j&&k?j.data.isEqual(k.data)?l!==m&&(c.track({type:3,doc:k}),n=!0):!this.shouldWaitForSyncedDocument(j,k)&&(c.track({type:2,doc:k}),n=!0,(h&&this.docComparator(k,h)>0||i&&0>this.docComparator(k,i))&&(g=!0)):!j&&k?(c.track({type:0,doc:k}),n=!0):j&&!k&&(c.track({type:1,doc:j}),n=!0,(h||i)&&(g=!0)),n&&(k?(f=f.add(k),e=m?e.add(a):e.delete(a)):(f=f.delete(a),e=e.delete(a)))}),null!==this.query.limit)for(;f.size>this.query.limit;){let a="F"===this.query.limitType?f.last():f.first();f=f.delete(a.key),e=e.delete(a.key),c.track({type:1,doc:a})}return{documentSet:f,changeSet:c,needsRefill:g,mutatedKeys:e}}shouldWaitForSyncedDocument(a,b){return a.hasLocalMutations&&b.hasCommittedMutations&&!b.hasLocalMutations}applyChanges(a,b,c,d){let e=this.documentSet;this.documentSet=a.documentSet,this.mutatedKeys=a.mutatedKeys;let f=a.changeSet.getChanges();f.sort((a,b)=>ui(a.type,b.type)||this.docComparator(a.doc,b.doc)),this.applyTargetChange(c),d=d??!1;let g=b&&!d?this.updateLimboDocuments():[],h=+!!(0===this.limboDocuments.size&&this.current&&!d),i=h!==this.syncState;return(this.syncState=h,0!==f.length||i)?{snapshot:new tX(this.query,a.documentSet,e,f,a.mutatedKeys,0===h,i,!1,!!c&&c.resumeToken.approximateByteSize()>0),limboChanges:g}:{limboChanges:g}}applyOnlineStateChange(a){return this.current&&"Offline"===a?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new tW,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(a){return!this._syncedDocuments.has(a)&&!!this.documentSet.has(a)&&!this.documentSet.get(a).hasLocalMutations}applyTargetChange(a){a&&(a.addedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.add(a)),a.modifiedDocuments.forEach(a=>{}),a.removedDocuments.forEach(a=>this._syncedDocuments=this._syncedDocuments.delete(a)),this.current=a.current)}updateLimboDocuments(){if(!this.current)return[];let a=this.limboDocuments;this.limboDocuments=mh(),this.documentSet.forEach(a=>{this.shouldBeInLimbo(a.key)&&(this.limboDocuments=this.limboDocuments.add(a.key))});let b=[];return a.forEach(a=>{this.limboDocuments.has(a)||b.push(new ug(a))}),this.limboDocuments.forEach(c=>{a.has(c)||b.push(new uf(c))}),b}synchronizeWithPersistedState(a){this._syncedDocuments=a.remoteKeys,this.limboDocuments=mh();let b=this.computeDocChanges(a.documents);return this.applyChanges(b,!0)}computeInitialSnapshot(){return tX.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function ui(a,b){let c=a=>{switch(a){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return gF(20277,{change:a})}};return c(a)-c(b)}let uj="SyncEngine";class uk{constructor(a,b,c){this.query=a,this.targetId=b,this.view=c}}class ul{constructor(a){this.key=a,this.receivedDocument=!1}}class um{constructor(a,b,c,d,e,f){this.localStore=a,this.remoteStore=b,this.eventManager=c,this.sharedClientState=d,this.currentUser=e,this.maxConcurrentLimboResolutions=f,this.syncEngineListener={},this.queryViewsByQuery=new l4(a=>lW(a),lV),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new jx(hn.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new qU,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=qi.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function un(a,b,c,d,e,f,g){let h=new um(a,b,c,d,e,f);return g&&(h._isPrimaryClient=!0),h}async function uo(a,b,c=!0){let d,e=uX(a),f=e.queryViewsByQuery.get(b);return f?(e.sharedClientState.addLocalQueryTarget(f.targetId),d=f.view.computeInitialSnapshot()):d=await uq(e,b,c,!0),d}async function up(a,b){let c=uX(a);await uq(c,b,!0,!1)}async function uq(a,b,c,d){let e,f=await rT(a.localStore,lN(b)),g=f.targetId,h=a.sharedClientState.addLocalQueryTarget(g,c);return d&&(e=await ur(a,b,g,"current"===h,f.resumeToken)),a.isPrimaryClient&&c&&tn(a.remoteStore,f),e}async function ur(a,b,c,d,e){a.applyDocChanges=(b,c,d)=>uK(a,b,c,d);let f=await rW(a.localStore,b,!0),g=new uh(b,f.remoteKeys),h=g.computeDocChanges(f.documents),i=ng.createSynthesizedTargetChangeForCurrentChange(c,d&&"Offline"!==a.onlineState,e),j=g.applyChanges(h,a.isPrimaryClient,i);uG(a,c,j.limboChanges);let k=new uk(b,c,g);return a.queryViewsByQuery.set(b,k),a.queriesByTarget.has(c)?a.queriesByTarget.get(c).push(b):a.queriesByTarget.set(c,[b]),j.snapshot}async function us(a,b,c){let d=gI(a),e=d.queryViewsByQuery.get(b),f=d.queriesByTarget.get(e.targetId);if(f.length>1){d.queriesByTarget.set(e.targetId,f.filter(a=>!lV(a,b))),d.queryViewsByQuery.delete(b);return}d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(e.targetId),d.sharedClientState.isActiveQueryTarget(e.targetId)||await rV(d.localStore,e.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(e.targetId),c&&to(d.remoteStore,e.targetId),uE(d,e.targetId)}).catch(hT)):(uE(d,e.targetId),await rV(d.localStore,e.targetId,!0))}async function ut(a,b){let c=gI(a),d=c.queryViewsByQuery.get(b),e=c.queriesByTarget.get(d.targetId);c.isPrimaryClient&&1===e.length&&(c.sharedClientState.removeLocalQueryTarget(d.targetId),to(c.remoteStore,d.targetId))}async function uu(a,b,c){let d=uY(a);try{let a=await rI(d.localStore,b);d.sharedClientState.addPendingMutation(a.batchId),uC(d,a.batchId,c),await uJ(d,a.changes),await tD(d.remoteStore)}catch(b){let a=tU(b,"Failed to persist write");c.reject(a)}}async function uv(a,b){let c=gI(a);try{let a=await rN(c.localStore,b);b.targetChanges.forEach((a,b)=>{let d=c.activeLimboResolutionsByTarget.get(b);d&&(gH(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?d.receivedDocument=!0:a.modifiedDocuments.size>0?gH(d.receivedDocument,14607):a.removedDocuments.size>0&&(gH(d.receivedDocument,42227),d.receivedDocument=!1))}),await uJ(c,a,b)}catch(a){await hT(a)}}function uw(a,b,c){let d=gI(a);if(d.isPrimaryClient&&0===c||!d.isPrimaryClient&&1===c){let a=[];d.queryViewsByQuery.forEach((c,d)=>{let e=d.view.applyOnlineStateChange(b);e.snapshot&&a.push(e.snapshot)}),t4(d.eventManager,b),a.length&&d.syncEngineListener.onWatchChange(a),d.onlineState=b,d.isPrimaryClient&&d.sharedClientState.setOnlineState(b)}}async function ux(a,b,c){let d=gI(a);d.sharedClientState.updateQueryState(b,"rejected",c);let e=d.activeLimboResolutionsByTarget.get(b),f=e&&e.key;if(f){let a=new jx(hn.comparator);a=a.insert(f,kT.newNoDocument(f,hB.min()));let c=mh().add(f),e=new nf(hB.min(),new Map,new jx(hb),a,c);await uv(d,e),d.activeLimboTargetsByKey=d.activeLimboTargetsByKey.remove(f),d.activeLimboResolutionsByTarget.delete(b),uI(d)}else await rV(d.localStore,b,!1).then(()=>uE(d,b,c)).catch(hT)}async function uy(a,b){let c=gI(a),d=b.batch.batchId;try{let a=await rJ(c.localStore,b);uD(c,d,null),uA(c,d),c.sharedClientState.updateMutationState(d,"acknowledged"),await uJ(c,a)}catch(a){await hT(a)}}async function uz(a,b,c){let d=gI(a);try{let a=await rL(d.localStore,b);uD(d,b,c),uA(d,b),d.sharedClientState.updateMutationState(b,"rejected",c),await uJ(d,a)}catch(a){await hT(a)}}function uA(a,b){(a.pendingWritesCallbacks.get(b)||[]).forEach(a=>{a.resolve()}),a.pendingWritesCallbacks.delete(b)}function uB(a,b){a.pendingWritesCallbacks.forEach(a=>{a.forEach(a=>{a.reject(new g$(gK,b))})}),a.pendingWritesCallbacks.clear()}function uC(a,b,c){let d=a.mutationUserCallbacks[a.currentUser.toKey()];d||(d=new jx(hb)),d=d.insert(b,c),a.mutationUserCallbacks[a.currentUser.toKey()]=d}function uD(a,b,c){let d=gI(a),e=d.mutationUserCallbacks[d.currentUser.toKey()];if(e){let a=e.get(b);a&&(c?a.reject(c):a.resolve(),e=e.remove(b)),d.mutationUserCallbacks[d.currentUser.toKey()]=e}}function uE(a,b,c=null){for(let d of(a.sharedClientState.removeLocalQueryTarget(b),a.queriesByTarget.get(b)))a.queryViewsByQuery.delete(d),c&&a.syncEngineListener.onWatchError(d,c);a.queriesByTarget.delete(b),a.isPrimaryClient&&a.limboDocumentRefs.removeReferencesForId(b).forEach(b=>{a.limboDocumentRefs.containsKey(b)||uF(a,b)})}function uF(a,b){a.enqueuedLimboResolutions.delete(b.path.canonicalString());let c=a.activeLimboTargetsByKey.get(b);null!==c&&(to(a.remoteStore,c),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.remove(b),a.activeLimboResolutionsByTarget.delete(c),uI(a))}function uG(a,b,c){for(let d of c)d instanceof uf?(a.limboDocumentRefs.addReference(d.key,b),uH(a,d)):d instanceof ug?(gB(uj,"Document no longer in limbo: "+d.key),a.limboDocumentRefs.removeReference(d.key,b),a.limboDocumentRefs.containsKey(d.key)||uF(a,d.key)):gF(19791,{limboChange:d})}function uH(a,b){let c=b.key,d=c.path.canonicalString();a.activeLimboTargetsByKey.get(c)||a.enqueuedLimboResolutions.has(d)||(gB(uj,"New document in limbo: "+c),a.enqueuedLimboResolutions.add(d),uI(a))}function uI(a){for(;a.enqueuedLimboResolutions.size>0&&a.activeLimboTargetsByKey.size<a.maxConcurrentLimboResolutions;){let b=a.enqueuedLimboResolutions.values().next().value;a.enqueuedLimboResolutions.delete(b);let c=new hn(hk.fromString(b)),d=a.limboTargetIdGenerator.next();a.activeLimboResolutionsByTarget.set(d,new ul(c)),a.activeLimboTargetsByKey=a.activeLimboTargetsByKey.insert(c,d),tn(a.remoteStore,new oF(lN(lG(c.path)),d,"TargetPurposeLimboResolution",ib.INVALID))}}async function uJ(a,b,c){let d=gI(a),e=[],f=[],g=[];d.queryViewsByQuery.isEmpty()||(d.queryViewsByQuery.forEach((a,h)=>{g.push(d.applyDocChanges(h,b,c).then(a=>{if((a||c)&&d.isPrimaryClient){let b=a?!a.fromCache:c?.targetChanges.get(h.targetId)?.current;d.sharedClientState.updateQueryState(h.targetId,b?"current":"not-current")}if(a){e.push(a);let b=ua.fromSnapshot(h.targetId,a);f.push(b)}}))}),await Promise.all(g),d.syncEngineListener.onWatchChange(e),await rQ(d.localStore,f))}async function uK(a,b,c,d){let e=b.view.computeDocChanges(c);e.needsRefill&&(e=await rW(a.localStore,b.query,!1).then(({documents:a})=>b.view.computeDocChanges(a,e)));let f=d&&d.targetChanges.get(b.targetId),g=d&&null!=d.targetMismatches.get(b.targetId),h=b.view.applyChanges(e,a.isPrimaryClient,f,g);return uG(a,b.targetId,h.limboChanges),h.snapshot}async function uL(a,b){let c=gI(a);if(!c.currentUser.isEqual(b)){gB(uj,"User change. New user:",b.toKey());let a=await rH(c.localStore,b);c.currentUser=b,uB(c,"'waitForPendingWrites' promise is rejected due to a user change."),c.sharedClientState.handleUserChange(b,a.removedBatchIds,a.addedBatchIds),await uJ(c,a.affectedDocuments)}}function uM(a,b){let c=gI(a),d=c.activeLimboResolutionsByTarget.get(b);if(d&&d.receivedDocument)return mh().add(d.key);{let a=mh(),d=c.queriesByTarget.get(b);if(!d)return a;for(let b of d){let d=c.queryViewsByQuery.get(b);a=a.unionWith(d.view.syncedDocuments)}return a}}async function uN(a,b){let c=gI(a),d=await rW(c.localStore,b.query,!0),e=b.view.synchronizeWithPersistedState(d);return c.isPrimaryClient&&uG(c,b.targetId,e.limboChanges),e}async function uO(a,b){let c=gI(a);return r0(c.localStore,b).then(a=>uJ(c,a))}async function uP(a,b,c,d){let e=gI(a),f=await rY(e.localStore,b);null===f?gB(uj,"Cannot apply mutation batch with id: "+b):("pending"===c?await tD(e.remoteStore):"acknowledged"===c||"rejected"===c?(uD(e,b,d||null),uA(e,b),rZ(e.localStore,b)):gF(6720,"Unknown batchState",{batchState:c}),await uJ(e,f))}async function uQ(a,b){let c=gI(a);if(uX(c),uY(c),!0===b&&!0!==c._isPrimaryClient){let a=c.sharedClientState.getAllActiveQueryTargets(),b=await uS(c,a.toArray());for(let a of(c._isPrimaryClient=!0,await tP(c.remoteStore,!0),b))tn(c.remoteStore,a)}else if(!1===b&&!1!==c._isPrimaryClient){let a=[],b=Promise.resolve();c.queriesByTarget.forEach((d,e)=>{c.sharedClientState.isLocalQueryTarget(e)?a.push(e):b=b.then(()=>(uE(c,e),rV(c.localStore,e,!0))),to(c.remoteStore,e)}),await b,await uS(c,a),uR(c),c._isPrimaryClient=!1,await tP(c.remoteStore,!1)}}function uR(a){let b=gI(a);b.activeLimboResolutionsByTarget.forEach((a,c)=>{to(b.remoteStore,c)}),b.limboDocumentRefs.removeAllReferences(),b.activeLimboResolutionsByTarget=new Map,b.activeLimboTargetsByKey=new jx(hn.comparator)}async function uS(a,b,c){let d=gI(a),e=[],f=[];for(let a of b){let b,c=d.queriesByTarget.get(a);if(c&&0!==c.length)for(let a of(b=await rT(d.localStore,lN(c[0])),c)){let b=d.queryViewsByQuery.get(a),c=await uN(d,b);c.snapshot&&f.push(c.snapshot)}else{let c=await r_(d.localStore,a);b=await rT(d.localStore,c),await ur(d,uT(c),a,!1,b.resumeToken)}e.push(b)}return d.syncEngineListener.onWatchChange(f),e}function uT(a){return lF(a.path,a.collectionGroup,a.orderBy,a.filters,a.limit,"F",a.startAt,a.endAt)}function uU(a){return r$(gI(a).localStore)}async function uV(a,b,c,d){let e=gI(a);if(e._isPrimaryClient)return void gB(uj,"Ignoring unexpected query state notification.");let f=e.queriesByTarget.get(b);if(f&&f.length>0)switch(c){case"current":case"not-current":{let a=await r0(e.localStore,l1(f[0])),d=nf.createSynthesizedRemoteEventForCurrentChange(b,"current"===c,jI.EMPTY_BYTE_STRING);await uJ(e,a,d);break}case"rejected":await rV(e.localStore,b,!0),uE(e,b,d);break;default:gF(64155,c)}}async function uW(a,b,c){let d=uX(a);if(d._isPrimaryClient){for(let a of b){if(d.queriesByTarget.has(a)&&d.sharedClientState.isActiveQueryTarget(a)){gB(uj,"Adding an already active target "+a);continue}let b=await r_(d.localStore,a),c=await rT(d.localStore,b);await ur(d,uT(b),c.targetId,!1,c.resumeToken),tn(d.remoteStore,c)}for(let a of c)d.queriesByTarget.has(a)&&await rV(d.localStore,a,!1).then(()=>{to(d.remoteStore,a),uE(d,a)}).catch(hT)}}function uX(a){let b=gI(a);return b.remoteStore.remoteSyncer.applyRemoteEvent=uv.bind(null,b),b.remoteStore.remoteSyncer.getRemoteKeysForTarget=uM.bind(null,b),b.remoteStore.remoteSyncer.rejectListen=ux.bind(null,b),b.syncEngineListener.onWatchChange=t2.bind(null,b.eventManager),b.syncEngineListener.onWatchError=t3.bind(null,b.eventManager),b}function uY(a){let b=gI(a);return b.remoteStore.remoteSyncer.applySuccessfulWrite=uy.bind(null,b),b.remoteStore.remoteSyncer.rejectFailedWrite=uz.bind(null,b),b}function uZ(a,b,c){let d=gI(a);u$(d,b,c).then(a=>{d.sharedClientState.notifyBundleLoaded(a)})}async function u$(a,b,c){try{let d=await b.getMetadata();if(await r4(a.localStore,d))return await b.close(),c._completeWith(ue(d)),Promise.resolve(new Set);c._updateProgress(ud(d));let e=new uc(d,b.serializer),f=await b.nextElement();for(;f;){let a=await e.addSizedElement(f);a&&c._updateProgress(a),f=await b.nextElement()}let g=await e.completeAndStoreAsync(a.localStore);return await uJ(a,g.changedDocs,void 0),await r5(a.localStore,d),c._completeWith(g.progress),Promise.resolve(g.changedCollectionGroups)}catch(a){return gD(uj,`Loading bundle failed with ${a}`),c._failWith(a),Promise.resolve(new Set)}}class u_{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(a){this.serializer=sU(a.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(a),this.persistence=this.createPersistence(a),await this.persistence.start(),this.localStore=this.createLocalStore(a),this.gcScheduler=this.createGarbageCollectionScheduler(a,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(a,this.localStore)}createGarbageCollectionScheduler(a,b){return null}createIndexBackfillerScheduler(a,b){return null}createLocalStore(a){return rG(this.persistence,new se,a.initialUser,this.serializer)}createPersistence(a){return new q2(q4.factory,this.serializer)}createSharedClientState(a){return new sz}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}u_.provider={build:()=>new u_};class u0 extends u_{constructor(a){super(),this.cacheSizeBytes=a}createGarbageCollectionScheduler(a,b){return gH(this.persistence.referenceDelegate instanceof q5,46915),new qx(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createPersistence(a){let b=void 0!==this.cacheSizeBytes?qq.withCacheSize(this.cacheSizeBytes):qq.DEFAULT;return new q2(a=>q5.factory(a,b),this.serializer)}}class u1 extends u_{constructor(a,b,c){super(),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.forceOwnership=c,this.kind="persistent",this.synchronizeTabs=!1}async initialize(a){await super.initialize(a),await this.onlineComponentProvider.initialize(this,a),await uY(this.onlineComponentProvider.syncEngine),await tD(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(a){return rG(this.persistence,new se,a.initialUser,this.serializer)}createGarbageCollectionScheduler(a,b){return new qx(this.persistence.referenceDelegate.garbageCollector,a.asyncQueue,b)}createIndexBackfillerScheduler(a,b){let c=new ia(b,this.persistence);return new h9(a.asyncQueue,c)}createPersistence(a){let b=rA(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey),c=void 0!==this.cacheSizeBytes?qq.withCacheSize(this.cacheSizeBytes):qq.DEFAULT;return new rx(this.synchronizeTabs,b,a.clientId,c,a.asyncQueue,sS(),sT(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(a){return new sz}}class u2 extends u1{constructor(a,b){super(a,b,!1),this.onlineComponentProvider=a,this.cacheSizeBytes=b,this.synchronizeTabs=!0}async initialize(a){await super.initialize(a);let b=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof sx&&(this.sharedClientState.syncEngine={applyBatchState:uP.bind(null,b),applyTargetState:uV.bind(null,b),applyActiveTargetsChange:uW.bind(null,b),getActiveClients:uU.bind(null,b),synchronizeWithChangedDocuments:uO.bind(null,b)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async a=>{await uQ(this.onlineComponentProvider.syncEngine,a),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start():a||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(a&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():a||this.indexBackfillerScheduler.stop())})}createSharedClientState(a){let b=sS();if(!sx.isAvailable(b))throw new g$(gW,"IndexedDB persistence is only available on platforms that support LocalStorage.");let c=rA(a.databaseInfo.databaseId,a.databaseInfo.persistenceKey);return new sx(b,a.asyncQueue,c,a.clientId,a.initialUser)}}class u3{async initialize(a,b){this.localStore||(this.localStore=a.localStore,this.sharedClientState=a.sharedClientState,this.datastore=this.createDatastore(b),this.remoteStore=this.createRemoteStore(b),this.eventManager=this.createEventManager(b),this.syncEngine=this.createSyncEngine(b,!a.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>uw(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=uL.bind(null,this.syncEngine),await tP(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(a){return tZ()}createDatastore(a){let b=sU(a.databaseInfo.databaseId),c=sQ(a.databaseInfo);return s6(a.authCredentials,a.appCheckCredentials,c,b)}createRemoteStore(a){return tj(this.localStore,this.datastore,a.asyncQueue,a=>uw(this.syncEngine,a,0),sR())}createSyncEngine(a,b){return un(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,a.initialUser,a.maxConcurrentLimboResolutions,b)}async terminate(){await tm(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}u3.provider={build:()=>new u3};let u4=10240;function u5(a,b=u4){let c=0;return{async read(){if(c<a.byteLength){let d={value:a.slice(c,c+b),done:!1};return c+=b,d}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function u6(a,b){if(!(a instanceof Uint8Array))throw new g$(gM,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${hs(a)}`);return u5(a,b)}class u7{constructor(a){this.observer=a,this.muted=!1}next(a){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,a)}error(a){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,a):gC("Uncaught Error in snapshot listener:",a.toString()))}mute(){this.muted=!0}scheduleEvent(a,b){setTimeout(()=>{this.muted||a(b)},0)}}class u8{constructor(a,b){this.payload=a,this.byteLength=b}isBundleMetadata(){return"metadata"in this.payload}}class u9{constructor(a,b){this.reader=a,this.serializer=b,this.metadata=new g_,this.buffer=new Uint8Array,this.textDecoder=m9(),this.nextElementImpl().then(a=>{a&&a.isBundleMetadata()?this.metadata.resolve(a.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(a?.payload)}`))},a=>this.metadata.reject(a))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let a=await this.readLength();if(null===a)return null;let b=this.textDecoder.decode(a),c=Number(b);return isNaN(c)&&this.raiseError(`length string (${b}) is not valid number`),new u8(JSON.parse(await this.readJsonString(c)),a.length+c)}indexOfOpenBracket(){return this.buffer.findIndex(a=>123===a)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let a=this.indexOfOpenBracket();a<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let b=this.buffer.slice(0,a);return this.buffer=this.buffer.slice(a),b}async readJsonString(a){for(;this.buffer.length<a;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let b=this.textDecoder.decode(this.buffer.slice(0,a));return this.buffer=this.buffer.slice(a),b}raiseError(a){throw this.reader.cancel(),Error(`Invalid bundle format: ${a}`)}async pullMoreDataToBuffer(){let a=await this.reader.read();if(!a.done){let b=new Uint8Array(this.buffer.length+a.value.length);b.set(this.buffer),b.set(a.value,this.buffer.length),this.buffer=b}return a.done}}function va(a,b){return new u9(a,b)}class vb{constructor(a,b){this.bundleData=a,this.serializer=b,this.cursor=0,this.elements=[];let c=this.nextElement();if(c&&c.isBundleMetadata())this.metadata=c;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(c?.payload)}`);do null!==(c=this.nextElement())&&this.elements.push(c);while(null!==c)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let a=this.readLength();return new u8(JSON.parse(this.readJsonString(a)),a)}readJsonString(a){if(this.cursor+a>this.bundleData.length)throw new g$(gX,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=a)}readLength(){let a=this.cursor,b=this.cursor;for(;b<this.bundleData.length;){if("{"===this.bundleData[b]){if(b===a)throw Error("First character is a bracket and not a number");return this.cursor=b,Number(this.bundleData.slice(a,b))}b++}throw Error("Reached the end of bundle when more is expected.")}}function vc(a,b){return new vb(a,b)}class vd{constructor(a){this.datastore=a,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(a){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new g$(gM,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let b=await s8(this.datastore,a);return b.forEach(a=>this.recordVersion(a)),b}set(a,b){this.write(b.toMutation(a,this.precondition(a))),this.writtenDocs.add(a.toString())}update(a,b){try{this.write(b.toMutation(a,this.preconditionForUpdate(a)))}catch(a){this.lastTransactionError=a}this.writtenDocs.add(a.toString())}delete(a){this.write(new mW(a,this.precondition(a))),this.writtenDocs.add(a.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let a=this.readVersions;this.mutations.forEach(b=>{a.delete(b.key.toString())}),a.forEach((a,b)=>{let c=hn.fromPath(b);this.mutations.push(new mZ(c,this.precondition(c)))}),await s7(this.datastore,this.mutations),this.committed=!0}recordVersion(a){let b;if(a.isFoundDocument())b=a.version;else if(a.isNoDocument())b=hB.min();else throw gF(50498,{documentName:a.constructor.name});let c=this.readVersions.get(a.key.toString());if(c){if(!b.isEqual(c))throw new g$(gU,"Document version changed between two reads.")}else this.readVersions.set(a.key.toString(),b)}precondition(a){let b=this.readVersions.get(a.toString());return this.writtenDocs.has(a.toString())||!b?mF.none():b.isEqual(hB.min())?mF.exists(!1):mF.updateTime(b)}preconditionForUpdate(a){let b=this.readVersions.get(a.toString());if(this.writtenDocs.has(a.toString())||!b)return mF.exists(!0);if(b.isEqual(hB.min()))throw new g$(gM,"Can't update a document that doesn't exist.");return mF.updateTime(b)}write(a){this.ensureCommitNotCalled(),this.mutations.push(a)}ensureCommitNotCalled(){}}class ve{constructor(a,b,c,d,e){this.asyncQueue=a,this.datastore=b,this.options=c,this.updateFunction=d,this.deferred=e,this.attemptsRemaining=c.maxAttempts,this.backoff=new sZ(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let a=new vd(this.datastore),b=this.tryRunUpdateFunction(a);b&&b.then(b=>{this.asyncQueue.enqueueAndForget(()=>a.commit().then(()=>{this.deferred.resolve(b)}).catch(a=>{this.handleTransactionError(a)}))}).catch(a=>{this.handleTransactionError(a)})})}tryRunUpdateFunction(a){try{let b=this.updateFunction(a);if(j0(b)||!b.catch||!b.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return b}catch(a){return this.deferred.reject(a),null}}handleTransactionError(a){this.attemptsRemaining>0&&this.isRetryableTransactionError(a)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(a)}isRetryableTransactionError(a){if(a?.name==="FirebaseError"){let b=a.code;return"aborted"===b||"failed-precondition"===b||"already-exists"===b||!m2(b)}return!1}}let vf="FirestoreClient",vg=100,vh=11,vi=20,vj=22;class vk{constructor(a,b,c,d,e){this.authCredentials=a,this.appCheckCredentials=b,this.asyncQueue=c,this._databaseInfo=d,this.user=gv.UNAUTHENTICATED,this.clientId=ha.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=e,this.authCredentials.start(c,async a=>{gB(vf,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(c,a=>(gB(vf,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:vg}}setCredentialChangeListener(a){this.authCredentialListener=a}setAppCheckTokenChangeListener(a){this.appCheckCredentialListener=a}terminate(){this.asyncQueue.enterRestrictedMode();let a=new g_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),a.resolve()}catch(c){let b=tU(c,"Failed to shutdown persistence");a.reject(b)}}),a.promise}}async function vl(a,b){a.asyncQueue.verifyOperationInProgress(),gB(vf,"Initializing OfflineComponentProvider");let c=a.configuration;await b.initialize(c);let d=c.initialUser;a.setCredentialChangeListener(async a=>{d.isEqual(a)||(await rH(b.localStore,a),d=a)}),b.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=b}async function vm(a,b){a.asyncQueue.verifyOperationInProgress();let c=await vo(a);gB(vf,"Initializing OnlineComponentProvider"),await b.initialize(c,a.configuration),a.setCredentialChangeListener(a=>tO(b.remoteStore,a)),a.setAppCheckTokenChangeListener((a,c)=>tO(b.remoteStore,c)),a._onlineComponents=b}function vn(a){return"FirebaseError"===a.name?a.code===gT||a.code===gW:!("u">typeof DOMException&&a instanceof DOMException)||a.code===vj||a.code===vi||a.code===vh}async function vo(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){gB(vf,"Using user provided OfflineComponentProvider");try{await vl(a,a._uninitializedComponentsProvider._offline)}catch(c){let b=c;if(!vn(b))throw b;gD("Error using user provided cache. Falling back to memory cache: "+b),await vl(a,new u_)}}else gB(vf,"Using default OfflineComponentProvider"),await vl(a,new u0(void 0));return a._offlineComponents}async function vp(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(gB(vf,"Using user provided OnlineComponentProvider"),await vm(a,a._uninitializedComponentsProvider._online)):(gB(vf,"Using default OnlineComponentProvider"),await vm(a,new u3))),a._onlineComponents}function vq(a){return vo(a).then(a=>a.localStore)}function vr(a){return vp(a).then(a=>a.syncEngine)}function vs(a){return vp(a).then(a=>a.datastore)}async function vt(a){let b=await vp(a),c=b.eventManager;return c.onListen=uo.bind(null,b.syncEngine),c.onUnlisten=us.bind(null,b.syncEngine),c.onFirstRemoteStoreListen=up.bind(null,b.syncEngine),c.onLastRemoteStoreUnlisten=ut.bind(null,b.syncEngine),c}function vu(a,b,c,d){let e=new u7(d),f=new t9(b,e,c);return a.asyncQueue.enqueueAndForget(async()=>t0(await vt(a),f)),()=>{e.mute(),a.asyncQueue.enqueueAndForget(async()=>t1(await vt(a),f))}}function vv(a,b){let c=new g_;return a.asyncQueue.enqueueAndForget(async()=>vD(await vq(a),b,c)),c.promise}function vw(a,b,c={}){let d=new g_;return a.asyncQueue.enqueueAndForget(async()=>vE(await vt(a),a.asyncQueue,b,c,d)),d.promise}function vx(a,b){let c=new g_;return a.asyncQueue.enqueueAndForget(async()=>vF(await vq(a),b,c)),c.promise}function vy(a,b,c={}){let d=new g_;return a.asyncQueue.enqueueAndForget(async()=>vG(await vt(a),a.asyncQueue,b,c,d)),d.promise}function vz(a,b,c){let d=new g_;return a.asyncQueue.enqueueAndForget(async()=>{try{let e=await vs(a);d.resolve(s9(e,b,c))}catch(a){d.reject(a)}}),d.promise}function vA(a,b){let c=new g_;return a.asyncQueue.enqueueAndForget(async()=>uu(await vr(a),b,c)),c.promise}function vB(a,b){let c=new u7(b);return a.asyncQueue.enqueueAndForget(async()=>t5(await vt(a),c)),()=>{c.mute(),a.asyncQueue.enqueueAndForget(async()=>t6(await vt(a),c))}}function vC(a,b,c){let d=new g_;return a.asyncQueue.enqueueAndForget(async()=>{let e=await vs(a);new ve(a.asyncQueue,e,c,b,d).run()}),d.promise}async function vD(a,b,c){try{let d=await rS(a,b);d.isFoundDocument()?c.resolve(d):d.isNoDocument()?c.resolve(null):c.reject(new g$(gY,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){let a=tU(d,`Failed to get document '${b} from cache`);c.reject(a)}}function vE(a,b,c,d,e){let f=new u7({next:h=>{f.mute(),b.enqueueAndForget(()=>t1(a,g));let i=h.docs.has(c);!i&&h.fromCache?e.reject(new g$(gY,"Failed to get document because the client is offline.")):i&&h.fromCache&&d&&"server"===d.source?e.reject(new g$(gY,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e.resolve(h)},error:a=>e.reject(a)}),g=new t9(lG(c.path),f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return t0(a,g)}async function vF(a,b,c){try{let d=await rW(a,b,!0),e=new uh(b,d.remoteKeys),f=e.computeDocChanges(d.documents),g=e.applyChanges(f,!1);c.resolve(g.snapshot)}catch(d){let a=tU(d,`Failed to execute query '${b} against cache`);c.reject(a)}}function vG(a,b,c,d,e){let f=new u7({next:c=>{f.mute(),b.enqueueAndForget(()=>t1(a,g)),c.fromCache&&"server"===d.source?e.reject(new g$(gY,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e.resolve(c)},error:a=>e.reject(a)}),g=new t9(c,f,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return t0(a,g)}function vH(a,b,c,d){let e=vJ(c,sU(b));a.asyncQueue.enqueueAndForget(async()=>{uZ(await vr(a),e,d)})}function vI(a,b){return a.asyncQueue.enqueue(async()=>r6(await vq(a),b))}function vJ(a,b){let c;return va(u6(c="string"==typeof a?m8().encode(a):a),b)}function vK(a,b){return vc(a,b)}function vL(a,b){return a.asyncQueue.enqueue(async()=>r8(await vq(a),b))}function vM(a,b){return a.asyncQueue.enqueue(async()=>r9(await vq(a),b))}function vN(a){return a.asyncQueue.enqueue(async()=>sa(await vq(a)))}function vO(a,b){return a.timeoutSeconds===b.timeoutSeconds}function vP(a){let b={};return void 0!==a.timeoutSeconds&&(b.timeoutSeconds=a.timeoutSeconds),b}let vQ="ComponentProvider",vR=new Map;function vS(a){let b=vR.get(a);b&&(gB(vQ,"Removing Datastore"),vR.delete(a),b.terminate())}function vT(a,b,c,d,e){return new jX(a,b,c,e.host,e.ssl,e.experimentalForceLongPolling,e.experimentalAutoDetectLongPolling,vP(e.experimentalLongPollingOptions),e.useFetchStreams,e.isUsingEmulator,d)}let vU="firestore.googleapis.com",vV=!0,vW=5,vX=30,vY=!0;class vZ{constructor(a){if(void 0===a.host){if(void 0!==a.ssl)throw new g$(gM,"Can't provide ssl option if host option is not set");this.host=vU,this.ssl=vV}else this.host=a.host,this.ssl=a.ssl??vV;if(this.isUsingEmulator=void 0!==a.emulatorOptions,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,void 0===a.cacheSizeBytes)this.cacheSizeBytes=qp;else if(a.cacheSizeBytes!==qo&&a.cacheSizeBytes<qs)throw new g$(gM,`cacheSizeBytes must be at least ${qs}`);else this.cacheSizeBytes=a.cacheSizeBytes;hp("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===a.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=vY:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vP(a.experimentalLongPollingOptions??{}),v$(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&vO(this.experimentalLongPollingOptions,a.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}function v$(a){if(void 0!==a.timeoutSeconds){if(isNaN(a.timeoutSeconds))throw new g$(gM,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<vW)throw new g$(gM,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is ${vW})`);if(a.timeoutSeconds>vX)throw new g$(gM,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is ${vX})`)}}class v_{constructor(a,b,c,d){this._authCredentials=a,this._appCheckCredentials=b,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vZ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new g$(gT,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(a){if(this._settingsFrozen)throw new g$(gT,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vZ(a),this._emulatorOptions=a.emulatorOptions||{},void 0!==a.credentials&&(this._authCredentials=g8(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return vS(this),Promise.resolve()}}function v0(a,b,c,d={}){a=hu(a,v_);let e=eN(b),f=a._getSettings(),g={...f,emulatorOptions:a._getEmulatorOptions()},h=`${b}:${c}`;e&&(eO(`https://${h}`),eQ("Firestore",!0)),f.host!==vU&&f.host!==h&&gD("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let i={...f,host:h,ssl:e,emulatorOptions:d};if(!e2(i,g)&&(a._setSettings(i),d.mockUserToken)){let b,c;if("string"==typeof d.mockUserToken)b=d.mockUserToken,c=gv.MOCK_USER;else{b=eP(d.mockUserToken,a._app?.options.projectId);let e=d.mockUserToken.sub||d.mockUserToken.user_id;if(!e)throw new g$(gM,"mockUserToken must contain 'sub' or 'user_id' field!");c=new gv(e)}a._authCredentials=new g2(new g0(b,c))}}class v1{constructor(a,b,c){this.converter=b,this._query=c,this.type="query",this.firestore=a}withConverter(a){return new v1(this.firestore,a,this._query)}}class v2{constructor(a,b,c){this.converter=b,this._key=c,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new v3(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new v2(this.firestore,a,this._key)}toJSON(){return{type:v2._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,b,c){if(hx(b,v2._jsonSchema))return new v2(a,c||null,new hn(hk.fromString(b.referencePath)))}}v2._jsonSchemaVersion="firestore/documentReference/1.0",v2._jsonSchema={type:hw("string",v2._jsonSchemaVersion),referencePath:hw("string")};class v3 extends v1{constructor(a,b,c){super(a,b,lG(c)),this._path=c,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let a=this._path.popLast();return a.isEmpty()?null:new v2(this.firestore,null,new hn(a))}withConverter(a){return new v3(this.firestore,a,this._path)}}function v4(a,b,...c){if(a=e4(a),1==arguments.length&&(b=ha.newId()),ho("doc","path",b),a instanceof v_){let d=hk.fromString(b,...c);return hq(d),new v2(a,null,new hn(d))}{if(!(a instanceof v2)&&!(a instanceof v3))throw new g$(gM,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let d=a._path.child(hk.fromString(b,...c));return hq(d),new v2(a.firestore,a instanceof v3?a.converter:null,new hn(d))}}function v5(a,b){return a=e4(a),b=e4(b),a instanceof v1&&b instanceof v1&&a.firestore===b.firestore&&lV(a._query,b._query)&&a.converter===b.converter}let v6="AsyncQueue";class v7{constructor(a=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new sZ(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=a}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.verifyNotFailed(),this.enqueueInternal(a)}enterRestrictedMode(a){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=a||!1)}enqueue(a){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let b=new g_;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(a().then(b.resolve,b.reject),b.promise)).then(()=>b.promise)}enqueueRetryable(a){this.enqueueAndForget(()=>(this.retryableOps.push(a),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(a){if(h0(a))gB(v6,"Operation failed with retryable error: "+a);else throw a}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(a){let b=this.tail.then(()=>(this.operationInProgress=!0,a().catch(a=>{throw this.failure=a,this.operationInProgress=!1,gC("INTERNAL UNHANDLED ERROR: ",v8(a)),a}).then(a=>(this.operationInProgress=!1,a))));return this.tail=b,b}enqueueAfterDelay(a,b,c){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(a)>-1&&(b=0);let d=tT.createAndSchedule(this,a,b,c,a=>this.removeDelayedOperation(a));return this.delayedOperations.push(d),d}verifyNotFailed(){this.failure&&gF(47125,{messageOrStack:v8(this.failure)})}verifyOperationInProgress(){}async drain(){let a;do a=this.tail,await a;while(a!==this.tail)}containsDelayedOperation(a){for(let b of this.delayedOperations)if(b.timerId===a)return!0;return!1}runAllDelayedOperationsUntil(a){return this.drain().then(()=>{for(let b of(this.delayedOperations.sort((a,b)=>a.targetTimeMs-b.targetTimeMs),this.delayedOperations))if(b.skipDelay(),"all"!==a&&b.timerId===a)break;return this.drain()})}skipDelaysForTimerId(a){this.timerIdsToSkip.push(a)}removeDelayedOperation(a){let b=this.delayedOperations.indexOf(a);this.delayedOperations.splice(b,1)}}function v8(a){let b=a.message||"";return a.stack&&(b=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),b}class v9{constructor(){this._progressObserver={},this._taskCompletionResolver=new g_,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(a,b,c){this._progressObserver={next:a,error:b,complete:c}}catch(a){return this._taskCompletionResolver.promise.catch(a)}then(a,b){return this._taskCompletionResolver.promise.then(a,b)}_completeWith(a){this._updateProgress(a),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(a)}_failWith(a){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(a),this._taskCompletionResolver.reject(a)}_updateProgress(a){this._lastProgress=a,this._progressObserver.next&&this._progressObserver.next(a)}}class wa extends v_{constructor(a,b,c,d){super(a,b,c,d),this.type="firestore",this._queue=new v7,this._persistenceKey=d?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let a=this._firestoreClient.terminate();this._queue=new v7(a),this._firestoreClient=void 0,await a}}}function wb(a,b){let c="object"==typeof a?a:f3(),d="string"==typeof a?a:b||jY,e=fS(c,"firestore").getImmediate({identifier:d});if(!e._initialized){let a=eK("firestore");a&&v0(e,...a)}return e}function wc(a){if(a._terminated)throw new g$(gT,"The client has already been terminated.");return a._firestoreClient||wd(a),a._firestoreClient}function wd(a){let b=a._freezeSettings(),c=vT(a._databaseId,a._app?.options.appId||"",a._persistenceKey,a._app?.options.apiKey,b);!a._componentsProvider&&b.localCache?._offlineComponentProvider&&b.localCache?._onlineComponentProvider&&(a._componentsProvider={_offline:b.localCache._offlineComponentProvider,_online:b.localCache._onlineComponentProvider}),a._firestoreClient=new vk(a._authCredentials,a._appCheckCredentials,a._queue,c,a._componentsProvider&&we(a._componentsProvider))}function we(a){let b=a?._online.build();return{_offline:a?._offline.build(b),_online:b}}function wf(a,b){let c=wc(a=hu(a,wa)),d=new v9;return vH(c,a._databaseId,b,d),d}function wg(a,b){return vI(wc(a=hu(a,wa)),b).then(b=>b?new v1(a,null,b.query):null)}class wh{constructor(a,b,c){this.alias=a,this.aggregateType=b,this.fieldPath=c}}class wi{constructor(a){this._byteString=a}static fromBase64String(a){try{return new wi(jI.fromBase64String(a))}catch(a){throw new g$(gM,"Failed to construct data from Base64 string: "+a)}}static fromUint8Array(a){return new wi(jI.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:wi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(hx(a,wi._jsonSchema))return wi.fromBase64String(a.bytes)}}wi._jsonSchemaVersion="firestore/bytes/1.0",wi._jsonSchema={type:hw("string",wi._jsonSchemaVersion),bytes:hw("string")};class wj{constructor(...a){for(let b=0;b<a.length;++b)if(0===a[b].length)throw new g$(gM,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new hm(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}class wk{constructor(a){this._methodName=a}}class wl{constructor(a,b){if(!isFinite(a)||a<-90||a>90)throw new g$(gM,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||b<-180||b>180)throw new g$(gM,"Longitude must be a number between -180 and 180, but was: "+b);this._lat=a,this._long=b}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return hb(this._lat,a._lat)||hb(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:wl._jsonSchemaVersion}}static fromJSON(a){if(hx(a,wl._jsonSchema))return new wl(a.latitude,a.longitude)}}wl._jsonSchemaVersion="firestore/geoPoint/1.0",wl._jsonSchema={type:hw("string",wl._jsonSchemaVersion),latitude:hw("number"),longitude:hw("number")};class wm{constructor(a){this._values=(a||[]).map(a=>a)}toArray(){return this._values.map(a=>a)}isEqual(a){return rC(this._values,a._values)}toJSON(){return{type:wm._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(hx(a,wm._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every(a=>"number"==typeof a))return new wm(a.vectorValues);throw new g$(gM,"Expected 'vectorValues' field to be a number array")}}}wm._jsonSchemaVersion="firestore/vectorValue/1.0",wm._jsonSchema={type:hw("string",wm._jsonSchemaVersion),vectorValues:hw("object")};let wn=/^__.*__$/;class wo{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return null!==this.fieldMask?new mQ(a,this.data,this.fieldMask,b,this.fieldTransforms):new mN(a,this.data,b,this.fieldTransforms)}}class wp{constructor(a,b,c){this.data=a,this.fieldMask=b,this.fieldTransforms=c}toMutation(a,b){return new mQ(a,this.data,this.fieldMask,b,this.fieldTransforms)}}function wq(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw gF(40011,{dataSource:a})}}class wr{constructor(a,b,c,d,e,f){this.settings=a,this.databaseId=b,this.serializer=c,this.ignoreUndefinedProperties=d,void 0===e&&this.validatePath(),this.fieldTransforms=e||[],this.fieldMask=f||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(a){return new wr({...this.settings,...a},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePathSegment(a),c}childContextForFieldPath(a){let b=this.path?.child(a),c=this.contextWith({path:b,arrayElement:!1});return c.validatePath(),c}childContextForArray(a){return this.contextWith({path:void 0,arrayElement:!0})}createError(a){return wK(a,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(a){return void 0!==this.fieldMask.find(b=>a.isPrefixOf(b))||void 0!==this.fieldTransforms.find(b=>a.isPrefixOf(b.field))}validatePath(){if(this.path)for(let a=0;a<this.path.length;a++)this.validatePathSegment(this.path.get(a))}validatePathSegment(a){if(0===a.length)throw this.createError("Document fields must not be empty");if(wq(this.dataSource)&&wn.test(a))throw this.createError('Document fields cannot begin and end with "__"')}}class ws{constructor(a,b,c){this.databaseId=a,this.ignoreUndefinedProperties=b,this.serializer=c||sU(a)}createContext(a,b,c,d=!1){return new wr({dataSource:a,methodName:b,targetDoc:c,path:hm.emptyPath(),arrayElement:!1,hasConverter:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wt(a){let b=a._freezeSettings(),c=sU(a._databaseId);return new ws(a._databaseId,!!b.ignoreUndefinedProperties,c)}function wu(a,b,c,d,e,f={}){let g,h,i=a.createContext(f.merge||f.mergeFields?2:0,b,c,e);wG("Data must be an object, but it was:",i,d);let j=wA(d,i);if(f.merge)g=new jF(i.fieldMask),h=i.fieldTransforms;else if(f.mergeFields){let a=[];for(let d of f.mergeFields){let e=wH(b,d,c);if(!i.contains(e))throw new g$(gM,`Field '${e}' is specified in your field mask but missing from your input data.`);wL(a,e)||a.push(e)}g=new jF(a),h=i.fieldTransforms.filter(a=>g.covers(a.field))}else g=null,h=i.fieldTransforms;return new wo(new kR(j),g,h)}class wv extends wk{_toFieldTransform(a){if(2===a.dataSource)a.fieldMask.push(a.path);else if(1===a.dataSource)throw a.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw a.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(a){return a instanceof wv}}function ww(a,b,c,d){let e=a.createContext(1,b,c);wG("Data must be an object, but it was:",e,d);let f=[],g=kR.empty();return ju(d,(a,d)=>{let h=wJ(b,a,c);d=e4(d);let i=e.childContextForFieldPath(h);if(d instanceof wv)f.push(h);else{let a=wz(d,i);null!=a&&(f.push(h),g.set(h,a))}}),new wp(g,new jF(f),e.fieldTransforms)}function wx(a,b,c,d,e,f){let g=a.createContext(1,b,c),h=[wH(b,d,c)],i=[e];if(f.length%2!=0)throw new g$(gM,`Function ${b}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<f.length;a+=2)h.push(wH(b,f[a])),i.push(f[a+1]);let j=[],k=kR.empty();for(let a=h.length-1;a>=0;--a)if(!wL(j,h[a])){let b=h[a],c=i[a];c=e4(c);let d=g.childContextForFieldPath(b);if(c instanceof wv)j.push(b);else{let a=wz(c,d);null!=a&&(j.push(b),k.set(b,a))}}return new wp(k,new jF(j),g.fieldTransforms)}function wy(a,b,c,d=!1){return wz(c,a.createContext(d?4:3,b))}function wz(a,b){if(wF(a=e4(a)))return wG("Unsupported field value:",b,a),wA(a,b);if(a instanceof wk)return wC(a,b),null;if(void 0===a&&b.ignoreUndefinedProperties)return null;if(b.path&&b.fieldMask.push(b.path),!(a instanceof Array))return wD(a,b);if(b.settings.arrayElement&&4!==b.dataSource)throw b.createError("Nested arrays are not supported");return wB(a,b)}function wA(a,b){let c={};return jw(a)?b.path&&b.path.length>0&&b.fieldMask.push(b.path):ju(a,(a,d)=>{let e=wz(d,b.childContextForField(a));null!=e&&(c[a]=e)}),{mapValue:{fields:c}}}function wB(a,b){let c=[],d=0;for(let e of a){let a=wz(e,b.childContextForArray(d));null==a&&(a={nullValue:"NULL_VALUE"}),c.push(a),d++}return{arrayValue:{values:c}}}function wC(a,b){if(!wq(b.dataSource))throw b.createError(`${a._methodName}() can only be used with update() and set()`);if(!b.path)throw b.createError(`${a._methodName}() is not currently supported inside arrays`);let c=a._toFieldTransform(b);c&&b.fieldTransforms.push(c)}function wD(a,b){if(null===(a=e4(a)))return{nullValue:"NULL_VALUE"};if("number"==typeof a)return mm(b.serializer,a);if("boolean"==typeof a)return{booleanValue:a};if("string"==typeof a)return{stringValue:a};if(a instanceof Date){let c=hA.fromDate(a);return{timestampValue:ny(b.serializer,c)}}else if(a instanceof hA){let c=new hA(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:ny(b.serializer,c)}}else if(a instanceof wl)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};else if(a instanceof wi)return{bytesValue:nA(b.serializer,a._byteString)};else if(a instanceof v2){let c=b.databaseId,d=a.firestore._databaseId;if(!d.isEqual(c))throw b.createError(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:nE(a.firestore._databaseId||b.databaseId,a._key.path)}}else if(a instanceof wm)return wE(a,b);else if(oE(a))return a._toProto(b.serializer);else throw b.createError(`Unsupported field value: ${hs(a)}`)}function wE(a,b){return{mapValue:{fields:{[j3]:{stringValue:j6},[j7]:{arrayValue:{values:(a instanceof wm?a.toArray():a).map(a=>{if("number"!=typeof a)throw b.createError("VectorValues must only contain numeric values.");return mk(b.serializer,a)})}}}}}}function wF(a){return"object"==typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof hA)&&!(a instanceof wl)&&!(a instanceof wi)&&!(a instanceof v2)&&!(a instanceof wk)&&!(a instanceof wm)&&!oE(a)}function wG(a,b,c){if(!wF(c)||!hr(c)){let d=hs(c);if("an object"===d)throw b.createError(a+" a custom object");throw b.createError(a+" "+d)}}function wH(a,b,c){if((b=e4(b))instanceof wj)return b._internalPath;if("string"==typeof b)return wJ(a,b);throw wK("Field path arguments must be of type string or ",a,!1,void 0,c)}let wI=RegExp("[~\\*/\\[\\]]");function wJ(a,b,c){if(b.search(wI)>=0)throw wK(`Invalid field path (${b}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,c);try{return new wj(...b.split("."))._internalPath}catch(d){throw wK(`Invalid field path (${b}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,c)}}function wK(a,b,c,d,e){let f=d&&!d.isEmpty(),g=void 0!==e,h=`Function ${b}() called with invalid data`;c&&(h+=" (via `toFirestore()`)"),h+=". ";let i="";return(f||g)&&(i+=" (found",f&&(i+=` in field ${d}`),g&&(i+=` in document ${e}`),i+=")"),new g$(gM,h+a+i)}function wL(a,b){return a.some(a=>a.isEqual(b))}class wM{convertValue(a,b="none"){switch(j9(a)){case 0:return null;case 1:return a.booleanValue;case 2:return jN(a.integerValue||a.doubleValue);case 3:return this.convertTimestamp(a.timestampValue);case 4:return this.convertServerTimestamp(a,b);case 5:return a.stringValue;case 6:return this.convertBytes(jO(a.bytesValue));case 7:return this.convertReference(a.referenceValue);case 8:return this.convertGeoPoint(a.geoPointValue);case 9:return this.convertArray(a.arrayValue,b);case 11:return this.convertObject(a.mapValue,b);case 10:return this.convertVectorValue(a.mapValue);default:throw gF(62114,{value:a})}}convertObject(a,b){return this.convertObjectMap(a.fields,b)}convertObjectMap(a,b="none"){let c={};return ju(a,(a,d)=>{c[a]=this.convertValue(d,b)}),c}convertVectorValue(a){return new wm(a.fields?.[j7].arrayValue?.values?.map(a=>jN(a.doubleValue)))}convertGeoPoint(a){return new wl(jN(a.latitude),jN(a.longitude))}convertArray(a,b){return(a.values||[]).map(a=>this.convertValue(a,b))}convertServerTimestamp(a,b){switch(b){case"previous":let c=jV(a);if(null==c)return null;return this.convertValue(c,b);case"estimate":return this.convertTimestamp(jW(a));default:return null}}convertTimestamp(a){let b=jM(a);return new hA(b.seconds,b.nanos)}convertDocumentKey(a,b){let c=hk.fromString(a);gH(oD(c),9688,{name:a});let d=new jZ(c.get(1),c.get(3)),e=new hn(c.popFirst(5));return d.isEqual(b)||gC(`Document ${e} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${b.projectId}/${b.database}) instead.`),e}}class wN extends wM{constructor(a){super(),this.firestore=a}convertBytes(a){return new wi(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new v2(this.firestore,null,b)}}let wO="@firebase/firestore",wP="4.10.0";function wQ(a,b=!0){gx(f0),fR(new e5("firestore",(a,{instanceIdentifier:c,options:d})=>{let e=a.getProvider("app").getImmediate(),f=new wa(new g3(a.getProvider("auth-internal")),new g7(e,a.getProvider("app-check-internal")),j$(e,c),e);return d={useFetchStreams:b,...d},f._setSettings(d),f},"PUBLIC").setMultipleInstances(!0)),f6(wO,wP,a),f6(wO,wP,"esm2020")}class wR{constructor(a="count",b){this._internalFieldPath=b,this.type="AggregateField",this.aggregateType=a}}class wS{constructor(a,b,c){this._userDataWriter=b,this._data=c,this.type="AggregateQuerySnapshot",this.query=a}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new kR({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class wT{constructor(a,b,c,d,e){this._firestore=a,this._userDataWriter=b,this._key=c,this._document=d,this._converter=e}get id(){return this._key.path.lastSegment()}get ref(){return new v2(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let a=new wU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(a){if(this._document){let b=this._document.data.field(wH("DocumentSnapshot.get",a));if(null!==b)return this._userDataWriter.convertValue(b)}}}class wU extends wT{data(){return super.data()}}function wV(a){if("L"===a.limitType&&0===a.explicitOrderBy.length)throw new g$(gW,"limitToLast() queries require specifying at least one orderBy() clause")}class wW{}class wX extends wW{}function wY(a,b,...c){let d=[];for(let e of(b instanceof wW&&d.push(b),xp(d=d.concat(c)),d))a=e._apply(a);return a}class wZ extends wX{constructor(a,b,c){super(),this._field=a,this._op=b,this._value=c,this.type="where"}static _create(a,b,c){return new wZ(a,b,c)}_apply(a){let b=this._parse(a);return xl(a._query,b),new v1(a.firestore,a.converter,lQ(a._query,b))}_parse(a){let b=wt(a.firestore);return xe(a._query,"where",b,a.firestore._databaseId,this._field,this._op,this._value)}}function w$(a,b,c){let d=b,e=wH("where",a);return wZ._create(e,d,c)}class w_ extends wW{constructor(a,b){super(),this.type=a,this._queryConstraints=b}static _create(a,b){return new w_(a,b)}_parse(a){let b=this._queryConstraints.map(b=>b._parse(a)).filter(a=>a.getFilters().length>0);return 1===b.length?b[0]:k4.create(b,this._getOperator())}_apply(a){let b=this._parse(a);return 0===b.getFilters().length?a:(xm(a._query,b),new v1(a.firestore,a.converter,lQ(a._query,b)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function w0(...a){return a.forEach(a=>xo("or",a)),w_._create("or",a)}function w1(...a){return a.forEach(a=>xo("and",a)),w_._create("and",a)}class w2 extends wX{constructor(a,b){super(),this._field=a,this._direction=b,this.type="orderBy"}static _create(a,b){return new w2(a,b)}_apply(a){let b=xf(a._query,this._field,this._direction);return new v1(a.firestore,a.converter,lR(a._query,b))}}function w3(a,b="asc"){let c=b,d=wH("orderBy",a);return w2._create(d,c)}class w4 extends wX{constructor(a,b,c){super(),this.type=a,this._limit=b,this._limitType=c}static _create(a,b,c){return new w4(a,b,c)}_apply(a){return new v1(a.firestore,a.converter,lS(a._query,this._limit,this._limitType))}}function w5(a){return hv("limit",a),w4._create("limit",a,"F")}function w6(a){return hv("limitToLast",a),w4._create("limitToLast",a,"L")}class w7 extends wX{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new w7(a,b,c)}_apply(a){let b=xd(a,this.type,this._docOrFields,this._inclusive);return new v1(a.firestore,a.converter,lT(a._query,b))}}function w8(...a){return w7._create("startAt",a,!0)}function w9(...a){return w7._create("startAfter",a,!1)}class xa extends wX{constructor(a,b,c){super(),this.type=a,this._docOrFields=b,this._inclusive=c}static _create(a,b,c){return new xa(a,b,c)}_apply(a){let b=xd(a,this.type,this._docOrFields,this._inclusive);return new v1(a.firestore,a.converter,lU(a._query,b))}}function xb(...a){return xa._create("endBefore",a,!1)}function xc(...a){return xa._create("endAt",a,!0)}function xd(a,b,c,d){if(c[0]=e4(c[0]),c[0]instanceof wT)return xg(a._query,a.firestore._databaseId,b,c[0]._document,d);{let e=wt(a.firestore);return xh(a._query,a.firestore._databaseId,e,b,c,d)}}function xe(a,b,c,d,e,f,g){let h;if(e.isKeyField())if("array-contains"===f||"array-contains-any"===f)throw new g$(gM,`Invalid Query. You can't perform '${f}' queries on documentId().`);else if("in"===f||"not-in"===f){xj(g,f);let b=[];for(let c of g)b.push(xi(d,a,c));h={arrayValue:{values:b}}}else h=xi(d,a,g);else("in"===f||"not-in"===f||"array-contains-any"===f)&&xj(g,f),h=wy(c,b,g,"in"===f||"not-in"===f);return k3.create(e,f,h)}function xf(a,b,c){if(null!==a.startAt)throw new g$(gM,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==a.endAt)throw new g$(gM,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new k$(b,c)}function xg(a,b,c,d,e){if(!d)throw new g$(gO,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let c of lM(a))if(c.field.isKeyField())f.push(kB(b,d.key));else{let a=d.data.field(c.field);if(jT(a))throw new g$(gM,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==a)f.push(a);else{let a=c.field.canonicalString();throw new g$(gM,`Invalid query. You are trying to start or end a query using a document for which the field '${a}' (used as the orderBy) does not exist.`)}}return new kV(f,e)}function xh(a,b,c,d,e,f){let g=a.explicitOrderBy;if(e.length>g.length)throw new g$(gM,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let h=[];for(let f=0;f<e.length;f++){let i=e[f];if(g[f].field.isKeyField()){if("string"!=typeof i)throw new g$(gM,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof i}`);if(!lL(a)&&-1!==i.indexOf("/"))throw new g$(gM,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${i}' contains a slash.`);let c=a.path.child(hk.fromString(i));if(!hn.isDocumentKey(c))throw new g$(gM,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${c}' is not because it contains an odd number of segments.`);let e=new hn(c);h.push(kB(b,e))}else{let a=wy(c,d,i);h.push(a)}}return new kV(h,f)}function xi(a,b,c){if("string"==typeof(c=e4(c))){if(""===c)throw new g$(gM,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!lL(b)&&-1!==c.indexOf("/"))throw new g$(gM,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${c}' contains a '/' character.`);let d=b.path.child(hk.fromString(c));if(!hn.isDocumentKey(d))throw new g$(gM,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${d}' is not because it has an odd number of segments (${d.length}).`);return kB(a,new hn(d))}if(c instanceof v2)return kB(a,c._key);throw new g$(gM,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hs(c)}.`)}function xj(a,b){if(!Array.isArray(a)||0===a.length)throw new g$(gM,`Invalid Query. A non-empty array is required for '${b.toString()}' filters.`)}function xk(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function xl(a,b){let c=xn(a.filters,xk(b.op));if(null!==c)if(c===b.op)throw new g$(gM,`Invalid query. You cannot use more than one '${b.op.toString()}' filter.`);else throw new g$(gM,`Invalid query. You cannot use '${b.op.toString()}' filters with '${c.toString()}' filters.`)}function xm(a,b){let c=a;for(let a of b.getFlattenedFilters())xl(c,a),c=lQ(c,a)}function xn(a,b){for(let c of a)for(let a of c.getFlattenedFilters())if(b.indexOf(a.op)>=0)return a.op;return null}function xo(a,b){if(!(b instanceof wZ)&&!(b instanceof w_))throw new g$(gM,`Function ${a}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function xp(a){let b=a.filter(a=>a instanceof w_).length,c=a.filter(a=>a instanceof wZ).length;if(b>1||b>0&&c>0)throw new g$(gM,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}function xq(a,b,c){return a?c&&(c.merge||c.mergeFields)?a.toFirestore(b,c):a.toFirestore(b):b}class xr extends wM{constructor(a){super(),this.firestore=a}convertBytes(a){return new wi(a)}convertReference(a){let b=this.convertDocumentKey(a,this.firestore._databaseId);return new v2(this.firestore,null,b)}}function xs(a){return new wR("sum",wH("sum",a))}function xt(a){return new wR("avg",wH("average",a))}function xu(){return new wR("count")}function xv(a,b){return a instanceof wR&&b instanceof wR&&a.aggregateType===b.aggregateType&&a._internalFieldPath?.canonicalString()===b._internalFieldPath?.canonicalString()}function xw(a,b){return v5(a.query,b.query)&&e2(a.data(),b.data())}function xx(a){return xy(a,{count:xu()})}function xy(a,b){let c=hu(a.firestore,wa),d=wc(c),e=jv(b,(a,b)=>new wh(b,a.aggregateType,a._internalFieldPath));return vz(d,a._query,e).then(b=>xz(c,a,b))}function xz(a,b,c){return new wS(b,new wN(a),c)}class xA{constructor(a){this.kind="memory",this._onlineComponentProvider=u3.provider,a?.garbageCollector?this._offlineComponentProvider=a.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new u0(void 0)}}toJSON(){return{kind:this.kind}}}class xB{constructor(a){let b;this.kind="persistent",a?.tabManager?(a.tabManager._initialize(a),b=a.tabManager):(b=xK(void 0))._initialize(a),this._onlineComponentProvider=b._onlineComponentProvider,this._offlineComponentProvider=b._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class xC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=u_.provider}toJSON(){return{kind:this.kind}}}class xD{constructor(a){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new u0(a)}}toJSON(){return{kind:this.kind}}}function xE(){return new xC}function xF(a){return new xD(a?.cacheSizeBytes)}function xG(a){return new xA(a)}function xH(a){return new xB(a)}class xI{constructor(a){this.forceOwnership=a,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=u3.provider,this._offlineComponentProvider={build:b=>new u1(b,a?.cacheSizeBytes,this.forceOwnership)}}}class xJ{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(a){this._onlineComponentProvider=u3.provider,this._offlineComponentProvider={build:b=>new u2(b,a?.cacheSizeBytes)}}}function xK(a){return new xI(a?.forceOwnership)}function xL(){return new xJ}let xM=m8();function xN(a){let b=JSON.stringify(a),c=xM.encode(b).byteLength;return`${c}${b}`}xN({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),xN({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),xN({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),xN({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),xN({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),xN({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),xN({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),xN({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let xO=1;class xP{constructor(a,b){this.firestore=a,this.bundleId=b,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new hA(0,0),this.databaseId=a._databaseId,this.serializer=new nu(this.databaseId,!0),this.userDataReader=new ws(this.databaseId,!0,this.serializer)}addBundleDocument(a,b){let c=this.documents.get(a.documentPath),d=c?.metadata.queries,e=a.readTime,f=c?.metadata.readTime?nz(c.metadata.readTime):null,g=!e&&null==f,h=void 0!==e&&(null==f||f<e);if((g||h)&&this.documents.set(a.documentPath,{document:this.toBundleDocument(a),metadata:{name:nH(this.serializer,a.documentKey),readTime:e?ny(this.serializer,e):void 0,exists:a.documentExists}}),e&&e>this.latestReadTime&&(this.latestReadTime=e),b){let c=this.documents.get(a.documentPath);c.metadata.queries=d||[],c.metadata.queries.push(b)}}addBundleQuery(a){if(this.namedQueries.has(a.name))throw Error(`Query name conflict: ${name} has already been added.`);let b=new hA(0,0);for(let c of a.docBundleDataArray)this.addBundleDocument(c,a.name),c.readTime&&c.readTime>b&&(b=c.readTime);let c=n5(this.serializer,lN(a.query)),d={parent:a.parent,structuredQuery:c.queryTarget.structuredQuery};this.namedQueries.set(a.name,{name:a.name,bundledQuery:d,readTime:ny(this.serializer,b)})}toBundleDocument(a){let b=this.userDataReader.createContext(4,"internal toBundledDocument"),c=wA(a.documentData,b);return{name:nH(this.serializer,a.documentKey),fields:c.mapValue.fields,updateTime:ny(this.serializer,a.versionTime),createTime:ny(this.serializer,a.createdTime)}}lengthPrefixedString(a){let b=JSON.stringify(a),c=xM.encode(b).byteLength;return`${c}${b}`}build(){let a="";for(let b of this.namedQueries.values())a+=this.lengthPrefixedString({namedQuery:b});for(let b of this.documents.values()){let c=b.metadata;a+=this.lengthPrefixedString({documentMetadata:c});let d=b.document;d&&(a+=this.lengthPrefixedString({document:d}))}let b={id:this.bundleId,createTime:ny(this.serializer,this.latestReadTime),version:xO,totalDocuments:this.documents.size,totalBytes:xM.encode(a).length};return this.lengthPrefixedString({metadata:b})+a}}function xQ(a,b,c,d){let e=new xP(a,ha.newId());return e.addBundleDocument(xS(d,c,b)),e.build()}function xR(a,b,c,d,e,f,g){let h=[];for(let a=0;a<f.length;a++)h.push(xS(e[a],g[a],f[a]));let i={name:c,query:b,parent:d,docBundleDataArray:h},j=new xP(a,c);return j.addBundleQuery(i),j.build()}function xS(a,b,c){return{documentData:b,documentKey:c.mutableCopy().key,documentPath:a,documentExists:!0,createdTime:c.createTime.toTimestamp(),readTime:c.readTime.toTimestamp(),versionTime:c.version.toTimestamp()}}let xT="NOT SUPPORTED";class xU{constructor(a,b){this.hasPendingWrites=a,this.fromCache=b}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class xV extends wT{constructor(a,b,c,d,e,f){super(a,b,c,d,f),this._firestore=a,this._firestoreImpl=a,this.metadata=e}exists(){return super.exists()}data(a={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps);{let b=new xX(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(b,a)}}}get(a,b={}){if(this._document){let c=this._document.data.field(wH("DocumentSnapshot.get",a));if(null!==c)return this._userDataWriter.convertValue(c,b.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new g$(gT,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a=this._document,b={};if(b.type=xV._jsonSchemaVersion,b.bundle="",b.bundleSource="DocumentSnapshot",b.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument())return b;let c=this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous");return b.bundle=xQ(this._firestore,a,c,this.ref.path),b}}function xW(a,b,c){if(hx(b,xV._jsonSchema)){if(b.bundle===xT)throw new g$(gM,"The provided JSON object was created in a client environment, which is not supported.");let d=sU(a._databaseId),e=vK(b.bundle,d),f=e.getElements(),g=new uc(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);let h=g.documents;if(1!==h.length)throw new g$(gM,`Expected bundle data to contain 1 document, but it contains ${h.length} documents.`);let i=nQ(d,h[0].document),j=new hn(hk.fromString(b.bundleName));return new xV(a,new xr(a),j,i,new xU(!1,!1),c||null)}}xV._jsonSchemaVersion="firestore/documentSnapshot/1.0",xV._jsonSchema={type:hw("string",xV._jsonSchemaVersion),bundleSource:hw("string","DocumentSnapshot"),bundleName:hw("string"),bundle:hw("string")};class xX extends xV{data(a={}){return super.data(a)}}class xY{constructor(a,b,c,d){this._firestore=a,this._userDataWriter=b,this._snapshot=d,this.metadata=new xU(d.hasPendingWrites,d.fromCache),this.query=c}get docs(){let a=[];return this.forEach(b=>a.push(b)),a}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(a,b){this._snapshot.docs.forEach(c=>{a.call(b,new xX(this._firestore,this._userDataWriter,c.key,c,new xU(this._snapshot.mutatedKeys.has(c.key),this._snapshot.fromCache),this.query.converter))})}docChanges(a={}){let b=!!a.includeMetadataChanges;if(b&&this._snapshot.excludesMetadataChanges)throw new g$(gM,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===b||(this._cachedChanges=x$(this,b),this._cachedChangesIncludeMetadataChanges=b),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new g$(gT,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let a={};a.type=xY._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=ha.newId();let b=this._firestore._databaseId.database,c=this._firestore._databaseId.projectId,d=`projects/${c}/databases/${b}/documents`,e=[],f=[],g=[];return this.docs.forEach(a=>{null!==a._document&&(e.push(a._document),f.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),g.push(a.ref.path))}),a.bundle=xR(this._firestore,this.query._query,a.bundleName,d,g,e,f),a}}function xZ(a,b,c){if(hx(b,xY._jsonSchema)){if(b.bundle===xT)throw new g$(gM,"The provided JSON object was created in a client environment, which is not supported.");let d=sU(a._databaseId),e=vK(b.bundle,d),f=e.getElements(),g=new uc(e.getMetadata(),d);for(let a of f)g.addSizedElement(a);if(1!==g.queries.length)throw new g$(gM,`Snapshot data expected 1 query but found ${g.queries.length} queries.`);let h=oW(g.queries[0].bundledQuery),i=g.documents,j=new tV;i.map(a=>{let b=nQ(d,a.document);j=j.add(b)});let k=tX.fromInitialDocuments(h,j,mh(),!1,!1),l=new v1(a,c||null,h);return new xY(a,new xr(a),l,k)}}function x$(a,b){if(a._snapshot.oldDocs.isEmpty()){let b=0;return a._snapshot.docChanges.map(c=>{let d=new xX(a._firestore,a._userDataWriter,c.doc.key,c.doc,new xU(a._snapshot.mutatedKeys.has(c.doc.key),a._snapshot.fromCache),a.query.converter);return c.doc,{type:"added",doc:d,oldIndex:-1,newIndex:b++}})}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(a=>b||3!==a.type).map(b=>{let d=new xX(a._firestore,a._userDataWriter,b.doc.key,b.doc,new xU(a._snapshot.mutatedKeys.has(b.doc.key),a._snapshot.fromCache),a.query.converter),e=-1,f=-1;return 0!==b.type&&(e=c.indexOf(b.doc.key),c=c.delete(b.doc.key)),1!==b.type&&(f=(c=c.add(b.doc)).indexOf(b.doc.key)),{type:x_(b.type),doc:d,oldIndex:e,newIndex:f}})}}function x_(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return gF(61501,{type:a})}}function x0(a,b){return a instanceof xV&&b instanceof xV?a._firestore===b._firestore&&a._key.isEqual(b._key)&&(null===a._document?null===b._document:a._document.isEqual(b._document))&&a._converter===b._converter:a instanceof xY&&b instanceof xY&&a._firestore===b._firestore&&v5(a.query,b.query)&&a.metadata.isEqual(b.metadata)&&a._snapshot.isEqual(b._snapshot)}xY._jsonSchemaVersion="firestore/querySnapshot/1.0",xY._jsonSchema={type:hw("string",xY._jsonSchemaVersion),bundleSource:hw("string","QuerySnapshot"),bundleName:hw("string"),bundle:hw("string")};let x1={maxAttempts:5};function x2(a){if(a.maxAttempts<1)throw new g$(gM,"Max attempts must be at least 1")}class x3{constructor(a,b){this._firestore=a,this._commitHandler=b,this._mutations=[],this._committed=!1,this._dataReader=wt(a)}set(a,b,c){this._verifyNotCommitted();let d=x4(a,this._firestore),e=xq(d.converter,b,c),f=wu(this._dataReader,"WriteBatch.set",d._key,e,null!==d.converter,c);return this._mutations.push(f.toMutation(d._key,mF.none())),this}update(a,b,c,...d){let e;this._verifyNotCommitted();let f=x4(a,this._firestore);return e="string"==typeof(b=e4(b))||b instanceof wj?wx(this._dataReader,"WriteBatch.update",f._key,b,c,d):ww(this._dataReader,"WriteBatch.update",f._key,b),this._mutations.push(e.toMutation(f._key,mF.exists(!0))),this}delete(a){this._verifyNotCommitted();let b=x4(a,this._firestore);return this._mutations=this._mutations.concat(new mW(b._key,mF.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new g$(gT,"A write batch can no longer be used after commit() has been called.")}}function x4(a,b){if((a=e4(a)).firestore===b)return a;throw new g$(gM,"Provided document reference is from a different Firestore instance.")}class x5{constructor(a,b){this._firestore=a,this._transaction=b,this._dataReader=wt(a)}get(a){let b=x4(a,this._firestore),c=new xr(this._firestore);return this._transaction.lookup([b._key]).then(a=>{if(!a||1!==a.length)return gF(24041);let d=a[0];if(d.isFoundDocument())return new wT(this._firestore,c,d.key,d,b.converter);if(d.isNoDocument())return new wT(this._firestore,c,b._key,null,b.converter);throw gF(18433,{doc:d})})}set(a,b,c){let d=x4(a,this._firestore),e=xq(d.converter,b,c),f=wu(this._dataReader,"Transaction.set",d._key,e,null!==d.converter,c);return this._transaction.set(d._key,f),this}update(a,b,c,...d){let e,f=x4(a,this._firestore);return e="string"==typeof(b=e4(b))||b instanceof wj?wx(this._dataReader,"Transaction.update",f._key,b,c,d):ww(this._dataReader,"Transaction.update",f._key,b),this._transaction.update(f._key,e),this}delete(a){let b=x4(a,this._firestore);return this._transaction.delete(b._key),this}}class x6 extends x5{constructor(a,b){super(a,b),this._firestore=a}get(a){let b=x4(a,this._firestore),c=new wN(this._firestore);return super.get(a).then(a=>new xV(this._firestore,c,b._key,a._document,new xU(!1,!1),b.converter))}}function x7(a,b,c){a=hu(a,wa);let d={...x1,...c};return x2(d),vC(wc(a),c=>b(new x6(a,c)),d)}function x8(a){return x9(a,["next","error","complete"])}function x9(a,b){if("object"!=typeof a||null===a)return!1;let c=a;for(let a of b)if(a in c&&"function"==typeof c[a])return!0;return!1}function ya(a){a=hu(a,v2);let b=hu(a.firestore,wa);return vw(wc(b),a._key).then(c=>yo(b,a,c))}function yb(a){a=hu(a,v2);let b=hu(a.firestore,wa),c=wc(b),d=new wN(b);return vv(c,a._key).then(c=>new xV(b,d,a._key,c,new xU(null!==c&&c.hasLocalMutations,!0),a.converter))}function yc(a){a=hu(a,v2);let b=hu(a.firestore,wa);return vw(wc(b),a._key,{source:"server"}).then(c=>yo(b,a,c))}function yd(a){a=hu(a,v1);let b=hu(a.firestore,wa),c=wc(b),d=new wN(b);return wV(a._query),vy(c,a._query).then(c=>new xY(b,d,a,c))}function ye(a){a=hu(a,v1);let b=hu(a.firestore,wa),c=wc(b),d=new wN(b);return vx(c,a._query).then(c=>new xY(b,d,a,c))}function yf(a){a=hu(a,v1);let b=hu(a.firestore,wa),c=wc(b),d=new wN(b);return vy(c,a._query,{source:"server"}).then(c=>new xY(b,d,a,c))}function yg(a,b,c){a=hu(a,v2);let d=hu(a.firestore,wa),e=xq(a.converter,b,c),f=wu(wt(d),"setDoc",a._key,e,null!==a.converter,c).toMutation(a._key,mF.none());return yn(d,[f])}function yh(a,b,c,...d){let e;a=hu(a,v2);let f=hu(a.firestore,wa),g=wt(f);return yn(f,[(e="string"==typeof(b=e4(b))||b instanceof wj?wx(g,"updateDoc",a._key,b,c,d):ww(g,"updateDoc",a._key,b)).toMutation(a._key,mF.exists(!0))])}function yi(a){return yn(hu(a.firestore,wa),[new mW(a._key,mF.none())])}function yj(a,b){let c=hu(a.firestore,wa),d=v4(a),e=xq(a.converter,b);return yn(c,[wu(wt(a.firestore),"addDoc",d._key,e,null!==a.converter,{}).toMutation(d._key,mF.exists(!1))]).then(()=>d)}function yk(a,...b){let c,d,e;a=e4(a);let f={includeMetadataChanges:!1,source:"default"},g=0;"object"!=typeof b[0]||x8(b[g])||(f=b[g++]);let h={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(x8(b[g])){let a=b[g];b[g]=a.next?.bind(a),b[g+1]=a.error?.bind(a),b[g+2]=a.complete?.bind(a)}if(a instanceof v2)d=hu(a.firestore,wa),e=lG(a._key.path),c={next:c=>{b[g]&&b[g](yo(d,a,c))},error:b[g+1],complete:b[g+2]};else{let f=hu(a,v1);d=hu(f.firestore,wa),e=f._query;let h=new wN(d);c={next:a=>{b[g]&&b[g](new xY(d,h,f,a))},error:b[g+1],complete:b[g+2]},wV(a._query)}return vu(wc(d),e,h,c)}function yl(a,b,...c){let d,e=e4(a),f=yp(b);if(f.error)throw new g$(gM,f.error);let g=0;if("object"!=typeof c[0]||x8(c[g])||(d=c[g++]),"QuerySnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&x8(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return yr(e,f,d,a,c[g])}if("DocumentSnapshot"===f.bundleSource){let a=null;if("object"==typeof c[g]&&x8(c[g])){let b=c[g++];a={next:b.next,error:b.error,complete:b.complete}}else a={next:c[g++],error:c[g++],complete:c[g++]};return yq(e,f,d,a,c[g])}throw new g$(gM,`unsupported bundle source: ${f.bundleSource}`)}function ym(a,b){return vB(wc(a=hu(a,wa)),x8(b)?b:{next:b})}function yn(a,b){return vA(wc(a),b)}function yo(a,b,c){let d=c.docs.get(b._key),e=new wN(a);return new xV(a,e,b._key,d,new xU(c.hasPendingWrites,c.fromCache),b.converter)}function yp(a){let b={bundle:"",bundleName:"",bundleSource:""};for(let c of["bundle","bundleName","bundleSource"]){if(!(c in a)){b.error=`snapshotJson missing required field: ${c}`;break}let d=a[c];if("string"!=typeof d){b.error=`snapshotJson field '${c}' must be a string.`;break}if(0===d.length){b.error=`snapshotJson field '${c}' cannot be an empty string.`;break}"bundle"===c?b.bundle=d:"bundleName"===c?b.bundleName=d:"bundleSource"===c&&(b.bundleSource=d)}return b}function yq(a,b,c,d,e){let f,g=!1;return wf(a,b.bundle).then(()=>{g||(f=yk(new v2(a,e||null,hn.fromPath(b.bundleName)),c||{},d))}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function yr(a,b,c,d,e){let f,g=!1;return wf(a,b.bundle).then(()=>wg(a,b.bundleName)).then(a=>{if(a&&!g){let b=a;e&&b.withConverter(e),f=yk(a,c||{},d)}}).catch(a=>(d.error&&d.error(a),()=>{})),()=>{!g&&(g=!0,f&&f())}}function ys(a){return wc(a=hu(a,wa)),new x3(a,b=>yn(a,b))}function yt(a,b){let c=wc(a=hu(a,wa));return c._uninitializedComponentsProvider&&"memory"!==c._uninitializedComponentsProvider._offline.kind?vL(c,yu(b)):(gD("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function yu(a){let b="string"==typeof a?yv(a):a,c=[];if(Array.isArray(b.indexes))for(let a of b.indexes){let b=yw(a,"collectionGroup"),d=[];if(Array.isArray(a.fields))for(let b of a.fields){let a=wJ("setIndexConfiguration",yw(b,"fieldPath"));"CONTAINS"===b.arrayConfig?d.push(new hK(a,2)):"ASCENDING"===b.order?d.push(new hK(a,0)):"DESCENDING"===b.order&&d.push(new hK(a,1))}c.push(new hE(hE.UNKNOWN_ID,b,d,hM.empty()))}return c}function yv(a){try{return JSON.parse(a)}catch(a){throw new g$(gM,"Failed to parse JSON: "+a?.message)}}function yw(a,b){if("string"!=typeof a[b])throw new g$(gM,"Missing string value for: "+b);return a[b]}class yx{constructor(a){this._firestore=a,this.type="PersistentCacheIndexManager"}}function yy(a){a=hu(a,wa);let b=yD.get(a);if(b)return b;let c=wc(a);if(c._uninitializedComponentsProvider?._offline.kind!=="persistent")return null;let d=new yx(a);return yD.set(a,d),d}function yz(a){yC(a,!0)}function yA(a){yC(a,!1)}function yB(a){vN(wc(a._firestore)).then(a=>gB("deleting all persistent cache indexes succeeded")).catch(a=>gD("deleting all persistent cache indexes failed",a))}function yC(a,b){vM(wc(a._firestore),b).then(a=>gB(`setting persistent cache index auto creation isEnabled=${b} succeeded`)).catch(a=>gD(`setting persistent cache index auto creation isEnabled=${b} failed`,a))}let yD=new WeakMap;class yE{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(a){return yF.instance.onExistenceFilterMismatch(a)}}class yF{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return yG||m7(yG=new yF),yG}notifyOnExistenceFilterMismatch(a){this.existenceFilterMismatchCallbacksById.forEach(b=>b(a))}onExistenceFilterMismatch(a){let b=Symbol(),c=this.existenceFilterMismatchCallbacksById;return c.set(b,a),()=>c.delete(b)}}let yG=null;wQ("node"),a.s(["AggregateField",()=>wR,"AggregateQuerySnapshot",()=>wS,"DocumentSnapshot",()=>xV,"PersistentCacheIndexManager",()=>yx,"QueryCompositeFilterConstraint",()=>w_,"QueryConstraint",()=>wX,"QueryDocumentSnapshot",()=>xX,"QueryEndAtConstraint",()=>xa,"QueryFieldFilterConstraint",()=>wZ,"QueryLimitConstraint",()=>w4,"QueryOrderByConstraint",()=>w2,"QuerySnapshot",()=>xY,"QueryStartAtConstraint",()=>w7,"SnapshotMetadata",()=>xU,"Transaction",()=>x6,"WriteBatch",()=>x3,"_TestingHooks",()=>yE,"addDoc",()=>yj,"aggregateFieldEqual",()=>xv,"aggregateQuerySnapshotEqual",()=>xw,"and",()=>w1,"average",()=>xt,"count",()=>xu,"deleteAllPersistentCacheIndexes",()=>yB,"deleteDoc",()=>yi,"disablePersistentCacheIndexAutoCreation",()=>yA,"documentSnapshotFromJSON",()=>xW,"enablePersistentCacheIndexAutoCreation",()=>yz,"endAt",()=>xc,"endBefore",()=>xb,"executeWrite",()=>yn,"getAggregateFromServer",()=>xy,"getCountFromServer",()=>xx,"getDoc",()=>ya,"getDocFromCache",()=>yb,"getDocFromServer",()=>yc,"getDocs",()=>yd,"getDocsFromCache",()=>ye,"getDocsFromServer",()=>yf,"getPersistentCacheIndexManager",()=>yy,"limit",()=>w5,"limitToLast",()=>w6,"memoryEagerGarbageCollector",()=>xE,"memoryLocalCache",()=>xG,"memoryLruGarbageCollector",()=>xF,"onSnapshot",()=>yk,"onSnapshotResume",()=>yl,"onSnapshotsInSync",()=>ym,"or",()=>w0,"orderBy",()=>w3,"persistentLocalCache",()=>xH,"persistentMultipleTabManager",()=>xL,"persistentSingleTabManager",()=>xK,"query",()=>wY,"querySnapshotFromJSON",()=>xZ,"runTransaction",()=>x7,"setDoc",()=>yg,"setIndexConfiguration",()=>yt,"snapshotEqual",()=>x0,"startAfter",()=>w9,"startAt",()=>w8,"sum",()=>xs,"updateDoc",()=>yh,"where",()=>w$,"writeBatch",()=>ys],1787),a.i(1787);let yH=wb(f1({apiKey:"AIzaSyBrxT8CT87m2p7c0_rckJJ7DG4J-0J1aag",authDomain:"munchies-umain-f1cb1.firebaseapp.com",projectId:"munchies-umain-f1cb1",storageBucket:"munchies-umain-f1cb1.firebasestorage.app",messagingSenderId:"950529560244",appId:"1:950529560244:web:65180ab076ac4155ca51e1"})),yI="restaurants";async function yJ(a,b){async function c(){console.log("Loading initial data..."),await a.loadRestaurants();let b=await a.loadFoodFilters();a.setFilter("priceFilters",a.generatePriceFilters()),a.setFilter("deliveryTimeFilters",a.generateDeliveryTimeFilters());try{cj(()=>{a.setFilter("foodCategoryFilters",b),a.setReady(!0)}),console.log("Model ready set to true")}catch(a){console.error("Error loading restaurants:",a)}}async function d(b){let d=b.data();cj(()=>{d?(a.setAllRestaurants(d.restaurants),a.setFilter("deliveryTimeFilters",d.filters.deliveryTimeFilters),a.setFilter("priceFilters",d.filters.priceFilters),a.setFilter("foodCategoryFilters",d.filters.foodCategoryFilters),a.setReady(!0),console.log("Model ready set to true (from firebase)")):c()})}function e(a){console.log("Error getting snapshot:",a),c()}function f(){return[a.appliedFilters.length,a.allRestaurants.length]}async function g(){if(a.ready)try{let b=v4(yH,yI,"SavedData"),c={restaurants:a.allRestaurants,filters:{foodCategoryFilters:a.foodCategoryFilters,priceFilters:a.priceFilters,deliveryTimeFilters:a.deliveryTimeFilters}};await yg(b,c),console.log("Data saved to firebase")}catch(a){console.log("Error saving to firebase:",a)}}return console.log("connectToPersistence called"),ya(v4(yH,yI,"SavedData")).then(d).catch(e),b(f,g)}var yK=dQ;function yL(){let[a,b]=(0,yK.useState)(!1),c=(0,yK.useRef)(!1);return((0,yK.useEffect)(()=>{if(b(!0),!c.current){c.current=!0;let a=yJ(eu,co);return()=>{a&&a()}}},[]),a)?(0,q.jsx)("div",{children:(0,q.jsx)(en,{model:eu})}):(0,q.jsx)(ed,{model:eu})}a.s(["default",()=>yL],54052)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__2f68b799._.js.map